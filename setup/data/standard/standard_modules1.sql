INSERT INTO !PREFIX!_mod VALUES('1', '1', 'Headline (HTML)', 'Content', 'none', 'Eine HTML Headline anzeigen', '1', '', '<?php \r\n/***********************************************\r\n* Headline Output\r\n*\r\n* Author      :     Andreas Lindner\r\n* Copyright   :     four for business AG\r\n* Version	  : 	1.0\r\n* Created     :     05-08-2005\r\n************************************************/\r\n\r\nif (!$edit) {\r\n    echo "<h1>".strip_tags("CMS_HTMLHEAD[1]")."</h1>";\r\n} else {\r\n    echo "<h1>"."CMS_HTMLHEAD[1]"."</h1>";\r\n}\r\n?>', '', '0', '', '', 'sysadmin', '2003-05-15 12:02:41', '2005-09-29 11:09:19');
INSERT INTO !PREFIX!_mod VALUES('2', '1', 'Text (HTML)', 'Content', 'none', 'Ein HTML Text\r\n\r\nAuthor: Andreas Lindner\r\nVersion:1.1', '1', '', '<?php\r\n/***********************************************\r\n* CONTENIDO MODUL - OUTPUT\r\n*\r\n* Modulname  :      Text HTML\r\n* Author(s)   :     Andreas Lindner\r\n* Copyright   :     Contenido - four for business, Andreas Lindner\r\n* Created     :     05.08.2005\r\n************************************************/\r\n\r\necho "<div class=\\"content\\">";\r\necho "<p>"."CMS_HTML[1]"."</p>";\r\necho "</div>";\r\n?>', '', '0', '', '', 'sysadmin', '2003-05-15 12:04:32', '2005-09-28 10:07:43');
INSERT INTO !PREFIX!_mod VALUES('9', '1', 'Hauptnavigation', 'Navigation', 'none', 'Hauptnavigation aufbauen\r\n\r\nAuthor:  Jan lengowski, Andreas Lindner\r\nVersion: 1.0', '1', '?><?php\r\n/***********************************************\r\n* CONTENIDO MODUL - INPUT\r\n*\r\n* Modulname  :      Hauptnavigation\r\n* Author(s)   :     Jan Lengowski, Andreas Lindner, 4fb\r\n* Copyright   :     Contenido - four for business, Andreas Lindner\r\n* Created     :     12.08.2005\r\n************************************************/\r\n\r\n#Select tree\r\n?>\r\n<table cellspacing="0" cellpadding="0" cellpadding="4">\r\n    <tr>\r\n        <td class="text"><?php echo mi18n("Baum wählen");?>:</td>\r\n        <td>\r\n            <select name="CMS_VAR[0]">\r\n            <option value="0">-- <?php echo mi18n("kein");?> --</option>\r\n            <?php\r\n                $sql = "SELECT\r\n                            A.idcat,\r\n                            C.name\r\n                        FROM\r\n                            ".$cfg["tab"]["cat_tree"]." AS A,\r\n                            ".$cfg["tab"]["cat"]." AS B,\r\n                            ".$cfg["tab"]["cat_lang"]." AS C\r\n                        WHERE\r\n                            A.idcat     = B.idcat AND\r\n                            B.idcat     = C.idcat AND\r\n                            C.idlang    = ''".$lang."'' AND\r\n                            B.idclient  = ''".$client."'' AND\r\n                            C.visible   = 1 AND\r\n                            A.level     = ''0''\r\n                        ORDER BY\r\n                            A.idtree";\r\n\r\n                $db->query($sql);\r\n\r\n                while ( $db->next_record() ) {\r\n                    if ( "CMS_VALUE[0]" == $db->f("idcat") ) {\r\n                        echo ''<option selected="selected" value="''.$db->f("idcat").''">''.$db->f("name").''</option>'';\r\n                    } else {\r\n                        echo ''<option value="''.$db->f("idcat").''">''.$db->f("name").''</option>'';\r\n                    }\r\n                }\r\n            ?>\r\n            </select>\r\n        </td>\r\n    </tr>\r\n</table>\r\n<?php\r\n\r\n', '<?php\r\n/***********************************************\r\n* CONTENIDO MODUL - OUTPUT\r\n*\r\n* Modulname  :      Hauptnavigation\r\n* Author(s)   :     Jan Lengowski, Andreas Lindner, 4fb\r\n* Copyright   :     Contenido - four for business, Andreas Lindner\r\n* Created     :     12.08.2005\r\n************************************************/\r\n\r\n#System properties in use:\r\n#Type: navigation, Name: idcat_homepage\r\n#Contains idcat of tree to be displayed in main navigation\r\n\r\n#Includes\r\ncInclude("frontend", "includes/functions.navigation.php");\r\n\r\n#If no tree is selected, use client setting\r\n$start_cat = "CMS_VALUE[0]";\r\nif ($start_cat=='''') {\r\n    $cApiClient = new cApiClient($client);\r\n	$start_cat = $cApiClient->getProperty(''navigation'',''idcat_homepage'');\r\n}\r\n\r\nif ( !is_object($db2) ) {\r\n    $db2 = new DB_Contenido;\r\n}\r\n\r\n/**\r\n * Check if a category is child\r\n * of another category\r\n *\r\n * @return boolean true/false\r\n * @author Jan Lengowski <Jan.Lengowski@4fb.de>\r\n * @copyright four for business AG 2003\r\n */\r\nif (!function_exists("catIsChildOf")) {\r\nfunction catIsChildOf($id, $idparent) {\r\n\r\n    global $cfg, $client, $lang;\r\n\r\n    $db = new DB_Contenido;\r\n\r\n    $parent = $id;\r\n\r\n    while ( $parent != 0 ) {\r\n\r\n        $sql = "SELECT\r\n                    a.parentid\r\n                FROM\r\n                    ".$cfg["tab"]["cat"]." AS a,\r\n                    ".$cfg["tab"]["cat_lang"]." AS b\r\n                WHERE\r\n                    a.idclient  = ''".$client."'' AND\r\n                    b.idlang    = ''".$lang."'' AND\r\n                    a.idcat     = b.idcat AND\r\n                    a.idcat   = ''".$parent."''";\r\n\r\n        $db->query($sql);\r\n        $db->next_record();\r\n\r\n        $parent = $db->f("parentid");\r\n\r\n        if ($parent == $idparent) {\r\n            return true;\r\n        }\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n}\r\n}\r\nif ( catIsChildOf($idcat, $start_cat) ) {\r\n    $sel_idcat = $idcat;\r\n} else {\r\n    $sel_idcat = $start_cat;\r\n}\r\n\r\n/* Include Template Class */\r\ninclude_once($cfg["path"]["contenido"] . ''classes/class.template.php'');\r\n\r\n/**\r\n * Array storing alle the\r\n * navigation data\r\n */\r\n$navitems = array();\r\n\r\n\r\n/* Template Instance */\r\n$tpl = new Template;\r\n\r\n/**\r\n * Recursive function for creating\r\n * the navigation array\r\n * @param Int $idcat Category id\r\n */\r\nfunction nav($idcat) {\r\n\r\n        global $navitems, $client, $lang, $cfg, $start_cat;\r\n\r\n        $db  = new DB_Contenido;\r\n        $db2 = new DB_Contenido;\r\n\r\n        $sql = "SELECT parentid FROM ".$cfg["tab"]["cat"]." WHERE idcat = ''$idcat''";\r\n\r\n        $db->query($sql);\r\n        $db->next_record();\r\n\r\n        $parentid = $db->f("parentid");\r\n\r\n        if ( $parentid == 0 ) {\r\n\r\n           if ( $idcat != $start_cat ){\r\n\r\n                $navitems = array();\r\n              \r\n                $sql = "SELECT\r\n                            A.idcat,\r\n                            C.name,\r\n                            C.public,\r\n                            C.idcatlang\r\n                        FROM\r\n                            ".$cfg["tab"]["cat_tree"]." AS A,\r\n                            ".$cfg["tab"]["cat"]." AS B,\r\n                            ".$cfg["tab"]["cat_lang"]." AS C\r\n                        WHERE\r\n                            A.idcat     = B.idcat   AND\r\n                            B.idcat     = C.idcat   AND\r\n                            B.idclient  = ''$client'' AND\r\n                            C.idlang    = ''$lang''   AND\r\n                            C.visible   = ''1''       AND\r\n                            B.parentid  = ''".$start_cat."''\r\n                        ORDER\r\n                            BY A.idtree";\r\n\r\n                      $db->query($sql);\r\n\r\n                      while ($db->next_record()) {\r\n\r\n                            /* Check for external redirects... */\r\n                            $sql = "SELECT\r\n                                        a.external_redirect AS ext,\r\n                                        a.idartlang AS idartlang\r\n                                    FROM\r\n                                        ".$cfg["tab"]["art_lang"]." AS a,\r\n                                        ".$cfg["tab"]["cat_art"]." AS b,\r\n                                        ".$cfg["tab"]["cat"]." AS c\r\n                                    WHERE\r\n                                        b.idcat     = ''".$db->f("idcat")."'' AND\r\n                                        c.idclient  = ''".$client."'' AND\r\n                                        c.idcat     = b.idcat AND\r\n                                        a.idart     = b.idart AND\r\n                                        a.idlang    = ''".$lang."''";\r\n\r\n                            $db2->query($sql);\r\n                            $flag = false;\r\n							while ($db2->next_record()&&!$flag) {\r\n	                            if (isStartArticle($db2->f("idartlang"), $db->f("idcat"), $lang))\r\n	                            {\r\n									$flag = true;\r\n	                                $target = ( $db2->f("ext") == 0 ) ? ''_self'' : ''_blank'';\r\n	\r\n	                                $navitems[$db->f("idcat")] = array("idcat"      => $db->f("idcat"),\r\n	                                                                    "name"      => $db->f("name"),\r\n	                                                                    "target"    => $target,\r\n						                        	                    "public" => $db->f("public"),\r\n		            					            	                "idcatlang" => $db->f("idcatlang"));\r\n	                            }\r\n							}\r\n                      }\r\n\r\n           }\r\n           \r\n           return true;\r\n        }\r\n\r\n        $sql = "SELECT\r\n                    A.idcat,\r\n                    C.name,\r\n		            C.public,\r\n       			    C.idcatlang\r\n                FROM\r\n                    ".$cfg["tab"]["cat_tree"]." AS A,\r\n                    ".$cfg["tab"]["cat"]." AS B,\r\n                    ".$cfg["tab"]["cat_lang"]." AS C\r\n                WHERE\r\n                    A.idcat     = B.idcat   AND\r\n                    B.idcat     = C.idcat   AND\r\n                    B.idclient  = ''$client'' AND\r\n                    C.idlang    = ''$lang''   AND\r\n                    C.visible   = ''1''       AND\r\n                    B.parentid  = ''$parentid''\r\n                ORDER BY\r\n                    A.idtree";\r\n\r\n        $db->query($sql);\r\n\r\n        while ($db->next_record()) {\r\n\r\n                /* Check for external redirects... */\r\n                $sql = "SELECT\r\n                            a.external_redirect AS ext,\r\n                            a.idartlang AS idartlang\r\n                        FROM\r\n                            ".$cfg["tab"]["art_lang"]." AS a,\r\n                            ".$cfg["tab"]["cat_art"]." AS b,\r\n                            ".$cfg["tab"]["cat"]." AS c\r\n                        WHERE\r\n                            b.idcat     = ''".$db->f("idcat")."'' AND\r\n                            c.idclient  = ''".$client."'' AND\r\n                            c.idcat     = b.idcat AND\r\n                            a.idart     = b.idart AND\r\n                            a.idlang    = ''".$lang."''";\r\n\r\n                $db2->query($sql);\r\n				$flag = false;\r\n                while ($db2->next_record() && !$flag) {\r\n	                if (isStartArticle($db2->f("idartlang"), $db->f("idcat"), $lang))\r\n	                {\r\n						$flag = true;\r\n	                    $target = ( $db2->f("ext") == 0 ) ? ''_self'' : ''_blank'';\r\n	                    \r\n	                    $tmp_nav[$db->f("idcat")] = array("idcat"   => $db->f("idcat"),\r\n	                                                      "name"    => $db->f("name"),\r\n	   	                        	                      "public" => $db->f("public"),\r\n		            					            	  "idcatlang" => $db->f("idcatlang"),\r\n	                                                      "target"  => $target);\r\n	                }\r\n				}\r\n        }\r\n\r\n        $tmp_nav[$idcat]["sub"] = $navitems;\r\n        $navitems = $tmp_nav;\r\n\r\n        /* Function call */\r\n        nav($parentid);\r\n\r\n}  // end function\r\n\r\n$sql = "SELECT\r\n            A.idcat,\r\n            C.name,\r\n		    C.public,\r\n       		C.idcatlang\r\n        FROM\r\n            ".$cfg["tab"]["cat_tree"]." AS A,\r\n            ".$cfg["tab"]["cat"]." AS B,\r\n            ".$cfg["tab"]["cat_lang"]." AS C\r\n        WHERE\r\n            A.idcat     = B.idcat   AND\r\n            B.idcat     = C.idcat   AND\r\n            B.idclient  = ''$client'' AND\r\n            C.idlang    = ''$lang''   AND\r\n            C.visible   = ''1''       AND\r\n            B.parentid  = ''$sel_idcat''\r\n        ORDER BY\r\n            A.idtree";\r\n\r\n$db->query($sql);\r\n\r\nwhile ( $db->next_record() ) {\r\n\r\n        /* Check for external redirects... */\r\n        $sql = "SELECT\r\n                    a.external_redirect AS ext,\r\n                    a.idartlang AS idartlang\r\n                FROM\r\n                    ".$cfg["tab"]["art_lang"]." AS a,\r\n                    ".$cfg["tab"]["cat_art"]." AS b,\r\n                    ".$cfg["tab"]["cat"]." AS c\r\n                WHERE\r\n                    b.idcat     = ''".$db->f("idcat")."'' AND\r\n                    c.idclient  = ''".$client."'' AND\r\n                    c.idcat     = b.idcat AND\r\n                    a.idart     = b.idart AND\r\n                    a.idlang    = ''".$lang."''";\r\n\r\n        $db2->query($sql);\r\n        #$db2->next_record();\r\n		$flag = false;\r\n		while ($db2->next_record()&&!$flag) {\r\n	        if (isStartArticle($db2->f("idartlang"), $db->f("idcat"), $lang))\r\n	        {\r\n				$flag = true;\r\n	            $target = ( $db2->f("ext") == 0 ) ? ''_self'' : ''_blank'';\r\n	    \r\n	            $navitems[$db->f("idcat")] = array("idcat"  => $db->f("idcat"),\r\n	                                               "name"   => $db->f("name"),\r\n	  	                        	               "public" => $db->f("public"),\r\n		            					           "idcatlang" => $db->f("idcatlang"),\r\n	                                               "target" => $target);\r\n	        }\r\n		}\r\n}\r\n\r\n/* Create Navigation Array */\r\nif (($sel_idcat == '''') || ($sel_idcat == ''0'')) {\r\n    $cApiClient = new cApiClient($client);\r\n    $sel_idcat = $cApiClient->getProperty(''navigation'', ''idcat_homepage'');\r\n}\r\n\r\nnav($sel_idcat);\r\n\r\n/* Start Output buffer */\r\nob_start();\r\n\r\nforeach( $navitems as $key => $data ) {\r\n\r\n /* 1. Navigation level */\r\n if( checkCatPermission($data[''idcatlang''],$data[''public'']) ) {\r\n 	$tpl->reset();\r\n  $tpl->set(''d'', ''NAME'',  $data[''name'']);\r\n  $tpl->set(''d'', ''UL_STAGE'', ''2'');\r\n  $tpl->set(''d'', ''LI_STAGE'', ''1'');\r\n  $tpl->set(''d'', ''TARGET'', $data[''target'']);\r\n  $tpl->set(''d'', ''HREF'',  $sess->url(''front_content.php?idcat=''.$data[''idcat'']));\r\n  $tpl->next();\r\n  if( $idcat == $data[''idcat''] && empty($data[''sub'']) ) {\r\n  	$tpl->generate(''templates/mnavi_on.html'', 0, 0);\r\n  } elseif( $idcat == $data[''idcat''] && !empty($data[''sub'']) ) {\r\n  	$tpl->generate(''templates/mnavi_on_open.html'', 0, 0);\r\n  } elseif( $idcat != $data[''idcat''] && !empty($data[''sub'']) && catIsChildOf($sel_idcat, $data[''idcat'']) ) {\r\n  	$tpl->generate(''templates/mnavi_off_open.html'', 0, 0);\r\n  } else {\r\n  	$tpl->generate(''templates/mnavi_off.html'', 0, 0);\r\n  }\r\n  $second_subdata = $data[''sub''];\r\n\r\n  /* 2. Navigation level */\r\n  if( is_array($data[''sub'']) ) {\r\n   foreach( $data[''sub''] as $key => $data ) {\r\n    if( checkCatPermission($data[''idcatlang''],$data[''public'']) ) {\r\n     $tpl->reset();\r\n     $tpl->set(''d'', ''NAME'',  $data[''name'']);\r\n     $tpl->set(''d'', ''UL_STAGE'', ''3'');\r\n     $tpl->set(''d'', ''LI_STAGE'', ''2'');\r\n     $tpl->set(''d'', ''TARGET'', $data[''target'']);\r\n     $tpl->set(''d'', ''HREF'',  $sess->url(''front_content.php?idcat=''.$data[''idcat'']));\r\n     $tpl->next();\r\n     if( $idcat == $data[''idcat''] && empty($data[''sub'']) ) {               \r\n     	$tpl->generate(''templates/mnavi_on.html'', 0, 0);                     # AKTIVER PUNKT HAT KEINE SUBCATS\r\n     } elseif( $idcat == $data[''idcat''] && !empty($data[''sub'']) ) {\r\n     	$tpl->generate(''templates/mnavi_on_open.html'', 0, 0);                # AKTIVER PUNKT HAT SUBCATS\r\n    	} elseif( $idcat != $data[''idcat''] && is_array($data[''sub'']) && catIsChildOf($sel_idcat, $data[''idcat'']) ) {\r\n    		$tpl->generate(''templates/mnavi_off_open.html'', 0, 0);               # PASSIVER PUNKT HAT SUBCATS\r\n   		} else {\r\n   			$tpl->generate(''templates/mnavi_off.html'', 0, 0);                    # PASSIVER PUNKT HAT KEINE SUBCATS\r\n  			}\r\n\r\n  			if( is_array( $second_subdata ) ) {\r\n  				$last_cat = end( $second_subdata );\r\n  			 if( $data[''idcat''] == $last_cat[''idcat''] ) {\r\n  			 	$tpl->generate(''templates/mnavi_end.html'', 0, 0);\r\n  			 } // end if\r\n  			} // end if\r\n  			$third_subdata = $data[''sub''];\r\n\r\n     /* 3. Navigation level */\r\n     if( is_array($data[''sub'']) ) {\r\n      foreach( $data[''sub''] as $key => $data ) {\r\n      	if( checkCatPermission($data[''idcatlang''],$data[''public'']) ) {\r\n        $tpl->reset();\r\n        $tpl->set(''d'', ''NAME'',  $data[''name'']);\r\n        $tpl->set(''d'', ''UL_STAGE'', ''4'');\r\n        $tpl->set(''d'', ''LI_STAGE'', ''3'');\r\n        $tpl->set(''d'', ''TARGET'', $data[''target'']);\r\n        $tpl->set(''d'', ''HREF'',  $sess->url(''front_content.php?idcat=''.$data[''idcat'']));\r\n        $tpl->next();\r\n        if( $idcat == $data[''idcat''] && empty($data[''sub''])) {\r\n        	$tpl->generate(''templates/mnavi_on.html'', 0, 0);\r\n       	} elseif( $idcat == $data[''idcat''] && !empty($data[''sub'']) ) {\r\n       		$tpl->generate(''templates/mnavi_on_open.html'', 0, 0);\r\n      		} elseif( $idcat != $data[''idcat''] && is_array($data[''sub'']) && catIsChildOf($sel_idcat, $data[''idcat'']) ) {\r\n      			$tpl->generate(''templates/mnavi_off_open.html'', 0, 0);\r\n     			} else {\r\n     				$tpl->generate(''templates/mnavi_off.html'', 0, 0);\r\n    				}\r\n\r\n    				if( is_array($third_subdata) ) {\r\n    					$last_cat = end( $third_subdata );\r\n    					if( $data[''idcat''] == $last_cat[''idcat''] ) {\r\n    						$tpl->generate(''templates/mnavi_end.html'', 0, 0);\r\n    				 } // end if\r\n    				} // end if\r\n    				$forth_subdata = $data[''sub''];\r\n\r\n        /* 4. Navigation level */\r\n        if( is_array($data[''sub'']) ) {\r\n         foreach( $data[''sub''] as $key => $data) {\r\n          if( checkCatPermission($data[''idcatlang''],$data[''public'']) ) {\r\n           $tpl->reset();\r\n           $tpl->set(''d'', ''NAME'',  $data[''name'']);\r\n           $tpl->set(''d'', ''UL_STAGE'', ''5'');\r\n           $tpl->set(''d'', ''LI_STAGE'', ''4'');\r\n           $tpl->set(''d'', ''TARGET'', $data[''target'']);\r\n           $tpl->set(''d'', ''HREF'',  $sess->url(''front_content.php?idcat=''.$data[''idcat'']));\r\n           $tpl->next();\r\n           if( $idcat == $data[''idcat''] && empty($data[''sub'']) ) {\r\n           	$tpl->generate(''templates/mnavi_on.html'', 0, 0);\r\n           } elseif( $idcat == $data[''idcat''] && !empty($data[''sub'']) ) {\r\n           	$tpl->generate(''templates/mnavi_on_open.html'', 0, 0);\r\n           } elseif( $idcat != $data[''idcat''] && is_array($data[''sub'']) && catIsChildOf($sel_idcat, $data[''idcat'']) ) {\r\n           	$tpl->generate(''templates/mnavi_off_open.html'', 0, 0);\r\n           } else {\r\n           	$tpl->generate(''templates/mnavi_off.html'', 0, 0);\r\n           }\r\n\r\n           if( is_array($forth_subdata) ) {\r\n           	$last_cat = end( $forth_subdata );\r\n            if( $data[''idcat''] == $last_cat[''idcat''] ) {\r\n            	$tpl->generate(''templates/mnavi_end.html'', 0, 0);\r\n            } // end if\r\n           } // end if\r\n           $fith_subdata = $data[''sub''];\r\n\r\n           /* 5. Navigation level */\r\n           if( is_array($data[''sub'']) ) {\r\n           	foreach( $data[''sub''] as $key => $data ) {\r\n             if( checkCatPermission($data[''idcatlang''],$data[''public'']) ) {\r\n              $tpl->reset();\r\n              $tpl->set(''d'', ''NAME'', $data[''name'']);\r\n              $tpl->set(''d'', ''UL_STAGE'', ''6'');\r\n              $tpl->set(''d'', ''LI_STAGE'', ''5'');\r\n              $tpl->set(''d'', ''TARGET'', $data[''target'']);\r\n              $tpl->set(''d'', ''HREF'', $sess->url(''front_content.php?idcat=''.$data[''idcat'']));\r\n              $tpl->next();\r\n              if( $idcat == $data[''idcat''] && empty($data[''sub'']) ) {\r\n              	$tpl->generate(''templates/mnavi_on.html'', 0, 0);\r\n              } else {\r\n              	$tpl->generate(''templates/mnavi_off.html'', 0, 0);\r\n              }\r\n\r\n              if( is_array($fith_subdata) ) {\r\n              	$last_cat = end($fith_subdata);\r\n              	if( $data[''idcat''] == $last_cat[''idcat''] ) {\r\n              		$tpl->generate(''templates/mnavi_end.html'', 0, 0);\r\n              	} // end if\r\n              } // end if\r\n\r\n             } // end if\r\n            } // end foreach\r\n           } // end if\r\n          } // end if\r\n         } // end foreach\r\n        } // end if\r\n       } // end if\r\n      } // end foreach\r\n     } // end if\r\n    } // end if\r\n   } // end foreach\r\n  } // end if\r\n } // end if\r\n} // end foreach\r\n\r\n/* Read out buffer */\r\n$html = ob_get_contents();\r\n\r\n/* Clean buffer */\r\nob_end_clean();\r\n\r\n/* Output buffer-contents */\r\necho "  <div id=\\"mnavi\\">\r\n   <ul class=\\"e1\\">\r\n".$html."\r\n   </ul>\r\n  </div>\\n";\r\n\r\n?>', '', '0', '', '', 'sysadmin', '2003-05-15 13:46:50', '2005-10-25 13:26:45');
INSERT INTO !PREFIX!_mod VALUES('12', '1', 'Login', 'Navigation', 'none', 'Einfaches Login-Modul\r\n\r\nAuthor: Andreas Lindner\r\nVersion:1.0', '1', '', '<?php\r\n/***********************************************\r\n* CONTENIDO MODUL - OUTPUT\r\n*\r\n* Modulname  :      Loginbox\r\n* Author(s)   :     Andreas Lindner\r\n* Copyright   :     Contenido - four for business, Andreas Lindner\r\n* Created     :     05.08.2005\r\n************************************************/\r\n\r\n#Includes\r\ncInclude(''classes'', ''class.template.php'');\r\n\r\nif ( !is_object($tpl) ) {\r\n    $tpl = new Template;\r\n}\r\n$tpl->reset();\r\n\r\nif ($auth->auth["uid"] == "nobody"){\r\n	$template = ''login.html'';\r\n\r\n	$tpl->set(''s'', ''FORM_ACTION'', ''front_content.php?idcatart=''.$idcatart);	\r\n	$tpl->set(''s'', ''USERNAME'', mi18n("Username"));	\r\n	$tpl->set(''s'', ''PASSWORD'', mi18n("Passwort"));	\r\n	$tpl->set(''s'', ''GO'', mi18n("Go"));	\r\n	$tpl->set(''s'', ''LOGIN'', mi18n("Login"));	\r\n} else {\r\n	$template = ''logout.html'';\r\n\r\n	$tpl->set(''s'', ''CURRENT_USERNAME'', mi18n("Sie sind angemeldet als"));	\r\n	$tpl->set(''s'', ''USERNAME'', $auth->auth["uname"]);	\r\n	$tpl->set(''s'', ''HREF'', ''front_content.php?idcatart=''.$idcatart.''&logout=yes'');	\r\n	$tpl->set(''s'', ''LOGOUT'', mi18n("Logout"));	\r\n}\r\n\r\n$tpl->generate(''templates/''.$template);\r\n?>\r\n', '', '0', '', '', 'sysadmin', '2003-10-31 13:15:18', '2005-09-27 16:47:21');
INSERT INTO !PREFIX!_mod VALUES('22', '1', 'Hilfsnavigation', 'Navigation', 'none', '', '0', '// selected category\r\n$selected = "CMS_VALUE[0]";\r\n\r\necho "<table cellspacing=\\"0\\" cellpadding=\\"10\\" border=\\"0\\">\r\n        <tr valign=\\"top\\">\r\n          <td>Kategorie wählen:</td>\r\n          <td>\r\n            <select name=\\"CMS_VAR[0]\\">";\r\n            if($selected!="0" && $selected!=""){\r\n             echo"<option value=\\"0\\">--- kein ---</option>";\r\n\r\n            }else{\r\n            echo"<option selected=\\"selected\\" value=\\"0\\">--- kein ---</option>";\r\n            }\r\n\r\n            // fetch all categorys\r\n            $query = "SELECT A.idcat, A.level, C.name FROM ".$cfg["tab"]["cat_tree"]." AS A, ".\r\n                     $cfg["tab"]["cat"]." AS B,  ".$cfg["tab"]["cat_lang"]." AS C WHERE A.idcat=B.idcat ".\r\n                     "AND B.idcat=C.idcat AND C.idlang=''$lang'' AND B.idclient=''$client'' ".\r\n                     "AND C.visible=1 ORDER BY A.idtree";\r\n            // execute query\r\n            $db->query($query);\r\n\r\n            // loop result and build the options\r\n            while ($db->next_record()) {\r\n\r\n              // indent spacer\r\n              $spaces = "|";\r\n\r\n              // how many levels\r\n              $levels = $db->f("level");\r\n\r\n              for ($i = 0; $i < $levels; $i ++) {\r\n                // add 2 spaces for every level\r\n                $spaces = $spaces . "--";\r\n\r\n              } // end for\r\n              \r\n              $spaces .= ">";\r\n\r\n\r\n              if ($selected == $db->f("idcat")) {\r\n                // selected category\r\n                echo "<option selected=\\"selected\\" value=\\"". $db->f("idcat") ."\\">". $spaces . $db->f("name") ."</option>";\r\n\r\n              } else {\r\n                // category\r\n                echo "<option value=\\"". $db->f("idcat") ."\\">". $spaces . $db->f("name") ."</option>";\r\n\r\n              } // end if\r\n\r\n            } // end while\r\n\r\necho "      </select>";\r\n\r\necho "    </td>\r\n        </tr>\r\n      </table>";\r\n', '<?php\r\n/***********************************************\r\n* CONTENIDO MODUL - OUTPUT\r\n*\r\n* Modulname  :      Hilfsnavigation\r\n* Author(s)   :     Andreas Lindner\r\n* Copyright   :     Contenido - four for business, Andreas Lindner\r\n* Created     :     05.08.2005\r\n************************************************/\r\n\r\ncInclude("frontend", "includes/functions.navigation.php");\r\ncInclude(''classes'', ''class.template.php'');\r\n\r\necho " <div id=\\"meta\\"><p>";\r\n\r\n$catStart = "CMS_VALUE[0]";\r\nif(($catStart=='''')||($catStart==''0'')){\r\n    $cApiClient = new cApiClient($client);\r\n    $catStart = $cApiClient->getProperty(''navigation'', ''idcat_hilfsnavi'');\r\n}\r\nif(!is_object($oClient)) {\r\n	$oClient = new cApiClient($client);\r\n}\r\n\r\n$navigation = array();\r\n$navigation = createNavigationArray($catStart, $db);\r\n\r\nif (count($navigation) > 0) { \r\n	foreach ($navigation as $key => $data) {\r\n		echo ''<a href="''.$sess->url(''front_content.php?idcat=''.$data[''idcat'']).''">''.$data[''name''].''</a> | '';\r\n	} \r\n}\r\n\r\nswitch($lang){\r\n	case ''2'':\r\n		//englisch -> deutsch\r\n		echo ''<a href="''.$sess->url(''front_content.php?changelang=1'').''">''.mi18n("Deutsch").''</a>'';\r\n		break;\r\n	default:\r\n		//deutsch -> englisch\r\n		echo ''<a href="''.$sess->url(''front_content.php?changelang=2'').''">''.mi18n("English").''</a>'';\r\n		break;\r\n}\r\necho "</p></div>";\r\n?>', '', '0', '', '', 'sysadmin', '2005-06-23 16:41:30', '2005-10-25 13:30:51');
INSERT INTO !PREFIX!_mod VALUES('34', '1', 'Artikel einfuegen (rechts)', 'Content', 'none', 'This module includes an article into an other\r\n\r\nAuthor: Willi Man, Andreas Lindner, 4fb, B. Behrens\r\nVersion: 1.1', '0', '?><?php\r\n/***********************************************\r\n* Article Include Output\r\n*\r\n* Author      :     Willi Man\r\n* Copyright   :     Contenido - four for business\r\n* Created     :     18-12-2003\r\n* Modified    :     02-01-2004\r\n* Modified    :     05-08-2005, Andreas Lindner\r\n************************************************/\r\n\r\n#Get current settings\r\n$name         = "CMS_VAR[1]";\r\n$cms_idcat    = "CMS_VALUE[1]";\r\n$cms_idcatart = "CMS_VALUE[2]";\r\n\r\n#Cat selector\r\necho buildCategorySelect($name, $cms_idcat);\r\n\r\n$bDebug = false;\r\nif ($bDebug)\r\n	echo "<pre>cat $cms_idcat catart $cms_idcatart client $client lang $lang <br>webpath ".$cfgClient[$client][''path''][''htmlpath'']."</pre>";\r\n\r\necho ''<table cellpadding="0" cellspacing="0" border="0">'';\r\n\r\n#Article selector\r\necho ''\r\n	  <tr><td class="text_medium" style="padding:5px">''.mi18n("Artikel wählen").'': </td></tr>\r\n	  <tr><td class="text_medium" style="padding:5px">'';\r\necho ''<select name="CMS_VAR[2]" style="width:240px">'';\r\necho ''<option value="" selected>''.i18n("Please choose").''</option>'';\r\n\r\nif ($cms_idcat != "0" && strlen($cms_idcat) > 0) {\r\n	$sql = "SELECT\r\n						a.title AS title,\r\n						b.idcatart AS idcatart\r\n			   		FROM\r\n	            		".$cfg["tab"]["art_lang"]." AS a,\r\n	            		".$cfg["tab"]["cat_art"]." AS b\r\n						WHERE\r\n						b.idcat = ''".$cms_idcat."'' AND\r\n						a.idart = b.idart AND\r\n						a.idlang = ''".$lang."''";\r\n\r\n	$db->query($sql);\r\n\r\n	while ($db->next_record()) {\r\n\r\n		$catartid = $db->f(''idcatart'');\r\n		$title = $db->f(''title'');\r\n\r\n		if ($cms_idcatart != $catartid) {\r\n			echo ''<option value="''.$catartid.''">&nbsp;''.$title.''</option>'';\r\n		} else {\r\n			echo ''<option selected="selected" value="''.$catartid.''">&nbsp;''.$title.''</option>'';\r\n		}\r\n\r\n	}\r\n}\r\n\r\necho ''</select>&nbsp;<input type="image" src="images/submit.gif">'';\r\necho ''</td></tr></table>'';\r\n?><?php', '<?php\r\n/***********************************************\r\n* Article Include Output\r\n*\r\n* Author      :     Willi Man\r\n* Copyright   :     Contenido - four for business\r\n* Created     :     18-12-2003\r\n* Modified    :     02-01-2004\r\n* Modified    :     05-08-2005, Andreas Lindner\r\n************************************************/\r\n\r\n#Get current settings\r\n$cms_idcat    = "CMS_VALUE[1]";\r\n$cms_idcatart = "CMS_VALUE[2]";\r\n\r\n$bDebug = false;\r\n\r\n#Check data\r\n$cms_idcat    = (int)$cms_idcat;\r\n$cms_idcatart = (int)$cms_idcatart;\r\n\r\nif ($bDebug) {\r\n   echo "<pre> cat $cms_idcat catart $cms_idcatart</pre>";\r\n}\r\n\r\nif ($cms_idcat >= 0 && $cms_idcatart >= 0)\r\n{\r\n   $bArticleAvailable = false;\r\n   # Get idcat, idcatart, idart and lastmodified from the database\r\n   $sql = "SELECT A.idart AS idart, A.idcat AS idcat, A.createcode AS createcode,\r\n                  A.idcatart AS idcatart, B.lastmodified AS lastmodified\r\n           FROM ".$cfg["tab"]["cat_art"]." AS A, ".$cfg["tab"]["art_lang"]." AS B\r\n           WHERE\r\n            A.idart = B.idart AND\r\n            B.online = 1 AND ";\r\n\r\n   if ($cms_idcatart == 0)\r\n   {\r\n      $sql .= "A.idcat = ''" . $cms_idcat . "'' ORDER BY B.lastmodified DESC"; # Only idcat specified, get latest article of category\r\n   } else {\r\n      $sql .= "A.idcatart = ''" . $cms_idcatart . "''"; # Article specified\r\n   }\r\n\r\n   if ($bDebug)\r\n   {\r\n      echo "<pre>";\r\n      print_r($sql);\r\n      echo "</pre>";\r\n   }\r\n   $db->query($sql);\r\n\r\n   if ($db->next_record())\r\n   { \r\n      $bArticleAvailable = true; \r\n      $iIDCatArt   = $db->f("idcatart"); \r\n      $iIDCat      = $db->f("idcat"); \r\n      $iIDArt      = $db->f("idart"); \r\n      $iCreateCode = $db->f("createcode"); \r\n      $sModified   = $db->f("lastmodified"); \r\n   } \r\n\r\n   $db->free();\r\n\r\n   # Check if category is online or protected\r\n   $sql = "SELECT public, visible \r\n           FROM " . $cfg["tab"]["cat_lang"] . " \r\n           WHERE idcat = ''" . $iIDCat . "'' AND idlang = ''" . $lang . "''";\r\n   \r\n   if ($bDebug)\r\n   {\r\n      echo "<pre>";\r\n      print_r($sql);\r\n      echo "</pre>";\r\n   }\r\n   \r\n   $db->query($sql);\r\n   $db->next_record();\r\n\r\n   $iPublic  = $db->f("public");\r\n   $iVisible = $db->f("visible"); \r\n\r\n   $db->free(); \r\n\r\n   # Check if article is online\r\n   # Not needed anymore, as only online articles are used\r\n   /* $sql = "SELECT online FROM " . $cfg["tab"]["art_lang"] . "\r\n           WHERE idart = ''" . $cms_artid . "'' AND idlang = ''" . $lang . "''";\r\n\r\n   if ($bDebug)\r\n   {\r\n      echo "<pre>";\r\n      print_r($sql);\r\n      echo "</pre>";\r\n   }\r\n   $db->query($sql);\r\n   $db->next_record();\r\n\r\n   $online = $db->f("online");\r\n\r\n   $db->free(); */\r\n\r\n   # If the article is online and the according category is not protected and visible, include the article\r\n   if ($bArticleAvailable && $iPublic == 1 && $iVisible == 1) \r\n   { \r\n      # Check, if code creation is necessary \r\n      # Note, that createcode may be 0, but no code is available (all code for other languages will be deleted in \r\n      # front_content, if code for one language will be created). This "bug" may be fixed in future releases. \r\n      if ($iCreateCode == 0) \r\n      { \r\n         $sql = "SELECT count(*) AS CodeCount FROM " . $cfg["tab"]["code"] . " \r\n                 WHERE idcatart = ''" . $iIDCatArt . "'' AND idlang = ''" . $lang . "''";\r\n         \r\n         if ($bDebug)\r\n         {\r\n            echo "<pre>";\r\n            print_r($sql);\r\n            echo "</pre>";\r\n         }\r\n\r\n         $db->query($sql);\r\n         $db->next_record();\r\n\r\n         if ($db->f("CodeCount") == 0) {\r\n            $iCreateCode = 1;\r\n         }\r\n         $db->free();\r\n      }\r\n\r\n      # Create code if necessary\r\n      if ($iCreateCode == 1)\r\n      {\r\n         cInclude(''includes'', ''functions.con.php'');\r\n         cInclude(''includes'', ''functions.tpl.php'');\r\n         cInclude(''includes'', ''functions.mod.php'');\r\n\r\n         conGenerateCode($iIDCat, $iIDArt, $lang, $client);\r\n      } \r\n\r\n      # Get code from database and execute it \r\n      $sql = "SELECT code FROM " . $cfg["tab"]["code"] . " \r\n              WHERE idcatart = ''" . $iIDCatArt . "'' AND idlang = ''" . $lang . "''";\r\n\r\n      if ($bDebug)\r\n      {\r\n         echo "<pre>"; \r\n         print_r($sql); \r\n         echo "</pre>"; \r\n      } \r\n\r\n      $db->query($sql); \r\n\r\n      if ($db->next_record()) \r\n      {\r\n         $sCode = stripslashes($db->f("code")); \r\n         $db->free(); \r\n\r\n         ob_start();\r\n         eval("?>\r\n".$sCode."\r\n<?php\r\n");\r\n         $sCode = ob_get_contents();\r\n\r\n         # Clean buffer\r\n         ob_end_clean();\r\n\r\n         $iStartPos = strpos($sCode, "<!--start:content-->");\r\n         $iEndPos   = strpos($sCode, "<!--end:content-->");\r\n         $iDiffLen  = $iEndPos - $iStartPos;\r\n\r\n         $sCode = substr($sCode, $iStartPos, $iDiffLen);\r\n\r\n         echo $sCode;\r\n      } else {\r\n         echo "<!-- ERROR in module Article Include<pre>no code created for article to include!<br>idcat $cms_catid, idart $cms_artid, idlang $lang, idclient $client</pre>-->";\r\n      }\r\n   }\r\n}\r\n?>\r\n', '', '0', '', '', 'sysadmin', '2005-06-29 12:45:15', '2005-10-11 12:11:44');
INSERT INTO !PREFIX!_mod VALUES('25', '1', 'Sitemap', 'Content', 'none', 'Sitemap aufbauen\r\n\r\nAuthor: Ingo van Peeren (ingo@van-peeren.de)\r\nVersion: 0.1', '0', '$selected = "CMS_VALUE[0]";\r\n\r\necho "\r\n<table cellspacing=\\"0\\" cellpadding=\\"10\\" border=\\"0\\">\r\n  <tr valign=\\"top\\">\r\n    <td>Kategorie w&auml;hlen:</td>\r\n    <td><select name=\\"CMS_VAR[0]\\">\r\n    <option value=\\"0\\">---Alle---</option>";\r\n\r\n// alle Kategorien auslesen\r\n$query = "SELECT\r\n           A.idcat,\r\n           A.level,\r\n           C.name\r\n          FROM\r\n           ".$cfg[''tab''][''cat_tree'']." AS A,\r\n           ".$cfg[''tab''][''cat'']." AS B,\r\n           ".$cfg[''tab''][''cat_lang'']." AS C\r\n          WHERE\r\n           A.idcat=B.idcat AND\r\n           B.idcat=C.idcat AND\r\n           C.idlang=''$lang'' AND\r\n           B.idclient=''$client'' AND\r\n           C.visible=1\r\n          ORDER BY\r\n           A.idtree";\r\n\r\n// Abfrage ausführen\r\n$db->query($query);\r\n\r\n// loop result and build the options\r\nwhile( $db->next_record() ) {\r\n\r\n	// indent spacer\r\n	$spaces = "";\r\n\r\n	// how many levels\r\n	$levels = $db->f("level");\r\n\r\n	for( $i = 0; $i > $levels; $i++ ) {\r\n		// add 2 spaces for every level\r\n		$spaces = $spaces . "  ";\r\n	} // end for\r\n\r\n	echo "<option";\r\n	if( $selected == $db->f("idcat") ) echo " selected=\\"selected\\"";\r\n	echo " value=\\"". $db->f("idcat") ."\\">". $spaces . $db->f("name") ."</option>";\r\n\r\n} // end while\r\n\r\necho "\r\n    </select>\r\n    </td>\r\n  </tr>\r\n  <tr>\r\n    <td>Anzahl Ebenen:</td>\r\n    <td><input type=\\"text\\" name=\\"CMS_VAR[1]\\" value=\\"CMS_VALUE[1]\\"></td>\r\n  </tr>\r\n  <tr>\r\n    <td>Ebene \\"0\\" anzeigen:</td>\r\n";\r\n\r\necho "<td><input type=\\"radio\\" name=\\"CMS_VAR[2]\\" value=\\"1\\"";\r\nif( "CMS_VALUE[2]" == "1" ) {\r\n	echo "checked=\\"checked\\"";\r\n}\r\necho "> ja\r\n<input type=\\"radio\\" name=\\"CMS_VAR[2]\\" value=\\"0\\"";\r\nif( "CMS_VALUE[2]" == "0" ) {\r\n	echo "checked=checked";\r\n}\r\necho "> nein </td></tr>";\r\necho "      </table>";', '<?php\r\n\r\n// CMS_VALUES initialisieren\r\n$anzahlEbenen      = "CMS_VALUE[1]";\r\n$startkategorie    = "CMS_VALUE[0]";\r\n$ebeneNullAnzeigen = "CMS_VALUE[2]";\r\n\r\nfunction vpSitemap($kategorie=0) {\r\n	global $lang, $client, $cfg, $startkategorie, $anzahlEbenen, $ebeneNullAnzeigen;\r\n	$db  = new DB_Contenido;\r\n	$sql  = "SELECT\r\n           *,\r\n           C.public\r\n          FROM\r\n           ".$cfg["tab"]["cat_tree"]." AS A,\r\n           ".$cfg["tab"]["cat"]." AS B,\r\n           ".$cfg["tab"]["cat_lang"]." AS C\r\n          WHERE\r\n           A.idcat=B.idcat AND\r\n           B.idcat=C.idcat AND\r\n           C.idlang=''$lang'' AND\r\n           B.idclient=''$client'' AND\r\n           B.parentid=$kategorie AND\r\n           level <= $anzahlEbenen AND\r\n           C.visible=1\r\n          ORDER BY\r\n           A.idtree";\r\n $db->query($sql);\r\n $treffer = $db->num_rows();\r\n if( $treffer ) {\r\n 	if( $kategorie == $startkategorie ) {\r\n 		$result .= "<ul class=\\"sitemap\\">\\n";\r\n 	} else {\r\n 		$result .= "<ul>\\n";\r\n 	}\r\n }\r\n while( $db->next_record() ) {\r\n 	$lvl = $db->f("level");\r\n 	if( checkCatPermission($db->f("idcatlang"),$db->f("public")) ) {\r\n 	if( ($lvl > 0) || ($ebeneNullAnzeigen) ) {\r\n 		$result.=  "<li><a href=''front_content.php?idcat=".$db->f("idcat")."&amp;lang=$lang&amp;client=$client'' title=''Ebene ".$lvl.": ".$db->f("name")."''>".$db->f("name")."</a>".vpSitemap($db->f("idcat"), $lvl)."</li>\\n";\r\n 	} else {\r\n 		$result.=  "<li>&nbsp;".vpSitemap($db->f("idcat"), $lvl)."</li>\\n";\r\n 	}\r\n 	}\r\n }\r\n if( $treffer ) $result .= "</ul>\\n";\r\n return($result);\r\n}\r\n\r\n$sql = "SELECT\r\n         level\r\n        FROM\r\n         ".$cfg["tab"]["cat_tree"]."\r\n        WHERE\r\n         idcat=$startkategorie";\r\n$db->query($sql);\r\n$db->next_record();\r\n$startEbene = $db->f("level");\r\n$anzahlEbenen += $startEbene;\r\nif( ($startkategorie==0) && ($ebeneNullAnzeigen) ) {\r\n	$anzahlEbenen--;\r\n}\r\necho vpSitemap($startkategorie);\r\n\r\necho "<br class=\\"y\\"/>";\r\n\r\n?>', '', '0', '', '', 'sysadmin', '2005-06-23 16:42:41', '2005-10-25 13:31:17');
INSERT INTO !PREFIX!_mod VALUES('37', '1', 'Bildergalerie', 'Content', 'none', '', '0', '?><?php\r\n/***********************************************\r\n* Bildergalerie Input\r\n*\r\n* Author      :     Timo A. Hummel\r\n* Copyright   :     four for business AG\r\n* Created     :     30-09-2005\r\n************************************************/?>\r\n\r\n<table>\r\n  <tr>\r\n    <td><?php echo mi18n("Breite");?></td>\r\n    <td><input type="text" name="<?php echo "CMS_VAR[0]"; ?>" value="<?php echo "CMS_VALUE[0]"; ?>"></td>\r\n  </tr>\r\n  <tr>\r\n    <td><?php echo mi18n("Höhe");?></td>\r\n    <td><input type="text" name="<?php echo "CMS_VAR[1]"; ?>" value="<?php echo "CMS_VALUE[1]"; ?>"></td>\r\n  </tr>\r\n  <tr>\r\n    <td><?php echo mi18n("Spalten");?></td>\r\n    <td><input type="text" name="<?php echo "CMS_VAR[2]"; ?>" value="<?php echo "CMS_VALUE[2]"; ?>"></td>\r\n  </tr>\r\n  <tr>\r\n    <td><?php echo mi18n("Zeilen");?></td>\r\n    <td><input type="text" name="<?php echo "CMS_VAR[3]"; ?>" value="<?php echo "CMS_VALUE[3]"; ?>"></td>\r\n  </tr>\r\n  <tr>\r\n    <td><?php echo mi18n("Breite Detailansicht");?></td>\r\n    <td><input type="text" name="<?php echo "CMS_VAR[4]"; ?>" value="<?php echo "CMS_VALUE[4]"; ?>"></td>\r\n  </tr>\r\n  <?php\r\n  $sql = "SELECT DISTINCT dirname FROM ".$cfg[''tab''][''upl'']." ORDER BY dirname";\r\n  $db->query($sql);\r\n  echo ''<tr><td>''.mi18n("Verzeichnis auswählen").''</td><td>\r\n		<select name="CMS_VAR[5]" size="1" style="width: 320px">\r\n			<option value="">''.mi18n("Nichts ausgewählt").''</option>'';\r\n			while ($db->next_record()) {\r\n				if ( stristr($db->f("dirname"),''CVS/'') === FALSE ) {\r\n					if ($db->f("dirname")=="CMS_VALUE[5]") {\r\n						echo ''<option value="''.$db->f("dirname").''" selected="selected">''.$db->f("dirname").''</option>'';\r\n					} else {\r\n						echo ''<option value="''.$db->f("dirname").''">''.$db->f("dirname").''</option>'';\r\n					}\r\n				}\r\n			}\r\n	echo ''</select></td></tr>'';?>\r\n</table>\r\n<?php\r\n', '<?php\r\n/***********************************************\r\n* Bildergalerie Output\r\n*\r\n* Author      :     Timo A. Hummel\r\n* Copyright   :     four for business AG\r\n* Created     :     30-09-2005\r\n************************************************/\r\n\r\ncInclude("includes", "functions.api.images.php");\r\n\r\n/* Gallery variables */\r\n$bRecursive = false;\r\n\r\n$sPath = "CMS_VALUE[5]";\r\nif ($sPath=='''') {\r\n	$sPath = $cfgClient[$client]["path"]["frontend"] . $cfgClient[$client]["upl"]["frontendpath"] . "bildergalerie/";\r\n} else {\r\n	$sPath = $cfgClient[$client]["path"]["frontend"] . $cfgClient[$client]["upl"]["frontendpath"] . "CMS_VALUE[5]";\r\n}\r\n\r\n$iRows = "CMS_VALUE[3]";\r\n\r\nif ($iRows == 0)\r\n{\r\n  $iRows = 2;\r\n}\r\n\r\n$iColumns = "CMS_VALUE[2]";\r\n\r\nif ($iColumns == 0)\r\n{\r\n  $iColumns = 2;\r\n}\r\n\r\nif (isset($start))\r\n{\r\n  $iCurrentPage = $start;\r\n} else {\r\n  $iCurrentPage = 1;\r\n}\r\n\r\n$iWidth = "CMS_VALUE[0]";\r\n$iHeight = "CMS_VALUE[1]";\r\n\r\nif ($iWidth == 0)\r\n{\r\n  $iWidth = 300;\r\n}\r\n\r\nif ($iHeight == 0)\r\n{\r\n  $iHeight = 300;\r\n}\r\n\r\n$iDetailWidth = "CMS_VALUE[4]";\r\n\r\nif ($iDetailWidth == 0)\r\n{\r\n  $iDetailWidth = 300;\r\n}\r\n\r\n$aValidExtensions = array("jpg", "jpeg", "gif", "png");\r\n\r\n$iImagesPerPage = $iRows * $iColumns;\r\n\r\nif ($_REQUEST[''view'']=='''') {\r\n	/* Read all gallery files */\r\n	$aGalleryFiles = scanDirectory($sPath, $bRecursive);\r\n	\r\n         if (is_array($aGalleryFiles))\r\n         {\r\n	/* Filter out non-images */\r\n	foreach ($aGalleryFiles as $key => $aGalleryFile)\r\n	{\r\n	  $sExtension = strtolower(getFileExtension($aGalleryFile));\r\n	\r\n	  if (!in_array($sExtension, $aValidExtensions))\r\n	  {\r\n	     unset($aGalleryFiles[$key]);\r\n	  }\r\n	}\r\n	\r\n	/* Calculate effective variables */\r\n	$iFileCount = count($aGalleryFiles);\r\n	$iPages = ceil($iFileCount / $iImagesPerPage);\r\n	\r\n	$aImagesToDisplay = array_slice($aGalleryFiles, ($iCurrentPage - 1) * $iImagesPerPage, $iImagesPerPage);\r\n	\r\n	$oImageTpl = new Template;\r\n	$oGalleryTpl = new Template;\r\n	$oEmptyImageTpl = new Template;\r\n	\r\n	$aRenderedImages = array();\r\n	\r\n	$iRow = 0;\r\n	$iImagesRendered = 0;\r\n	\r\n	foreach ($aImagesToDisplay as $sImageToDisplay)\r\n	{\r\n	  /* Do Scaling */\r\n	  $sScaledImage = cApiImgScale($sImageToDisplay, $iWidth, $iHeight);\r\n	\r\n	  $link = ''front_content.php?idcatart=''.$idcatart.''&amp;start=''.$_REQUEST[''start''].''&amp;view=''.urlencode(str_replace($cfgClient[$client][''path''][''frontend''],'''',$sImageToDisplay));\r\n\r\n	  $description = ig_getImageDescription($sImageToDisplay);\r\n	  if ($description=='''') {\r\n	  	$description = ''&nbsp;'';\r\n	  }\r\n	  \r\n	  $download_link = str_replace($cfgClient[$client][''path''][''frontend''],$cfgClient[$client][''path''][''htmlpath''],$sImageToDisplay);\r\n\r\n	  $download_size = ig_GetReadableFileSize($sImageToDisplay);\r\n	  	  	\r\n	  $oImageTpl->reset();\r\n	  $oImageTpl->set("s", "FILE", $sScaledImage);\r\n	  $oImageTpl->set("s", "WIDTH", $iWidth);\r\n	  $oImageTpl->set("s", "HEIGHT", $iHeight);\r\n	  $oImageTpl->set("s", "LINK", $link);\r\n	  $oImageTpl->set("s", "DESCRIPTION", $description);\r\n	  $oImageTpl->set("s", "DOWNLOAD_LINK", $download_link);\r\n	  $oImageTpl->set("s", "DOWNLOAD_SIZE", $download_size);\r\n	  $oImageTpl->set("s", "DOWNLOAD_CAPTION", mi18n("Bild herunterladen"));\r\n	  $oImageTpl->set("s", "PREVIEW_CAPTION", mi18n("Bildvorschau"));\r\n	  \r\n	  $aRenderedImages[] = $oImageTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery_image.html", true, false);\r\n	\r\n	  $iImagesRendered++;\r\n	\r\n	  if ($iImagesRendered == $iColumns)\r\n	  {\r\n	    $oGalleryTpl->set("d", "COLUMNS", implode("", $aRenderedImages));\r\n	    $oGalleryTpl->next();\r\n	    $iImagesRendered = 0;\r\n	    $aRenderedImages = array();\r\n	  }\r\n	}\r\n	\r\n	if (count($aRenderedImages) < $iColumns && count($aRenderedImages) > 0)\r\n	{\r\n	  $iEmptyCells = $iColumns - count($aRenderedImages);\r\n	\r\n	  $oEmptyImageTpl->set("s", "WIDTH", $iWidth);\r\n	  $oEmptyImageTpl->set("s", "HEIGHT", $iHeight);\r\n	\r\n	  $sEmptyCells = str_repeat($oEmptyImageTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery_empty.html", true, false),$iEmptyCells);\r\n	 \r\n	  $oGalleryTpl->set("d", "COLUMNS", implode("", $aRenderedImages) . $sEmptyCells);\r\n	  $oGalleryTpl->next();\r\n	}\r\n	\r\n	$aLinks = array();\r\n	\r\n	if ($iCurrentPage > 1)\r\n	{\r\n	  $oPreviousTpl = new Template;\r\n	  $oPreviousTpl->set("s", "LINK", $cfgClient[$client]["path"]["htmlpath"] . sprintf("front_content.php?idcatart=%s&amp;start=%s", $idcatart, $iCurrentPage - 1));\r\n	  $oPreviousTpl->set("s", "TITLE", mi18n("&lsaquo; zur&uuml;ck"));\r\n	  $aLinks[] = $oPreviousTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery_link.html", true, false);\r\n	}\r\n	\r\n	if (($iCurrentPage < $iPages) && $iCurrentPage)\r\n	{\r\n	  $oNextTpl = new Template;\r\n	  $oNextTpl->set("s", "LINK", $cfgClient[$client]["path"]["htmlpath"] . sprintf("front_content.php?idcatart=%s&amp;start=%s", $idcatart, $iCurrentPage + 1));\r\n	  $oNextTpl->set("s", "TITLE", mi18n("vor &rsaquo;"));\r\n	  $aLinks[] = $oNextTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery_link.html", true, false);\r\n	}\r\n	\r\n	$oGalleryTpl->set("s", "NAVIGATION", implode("", $aLinks));\r\n	\r\n	$oGalleryTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery.html", false, false);\r\n    }\r\n} else {\r\n	$sImageToDisplay = $cfgClient[$client][''path''][''frontend''].$_REQUEST[''view''];\r\n	$sScaledImage = cApiImgScale($sImageToDisplay, $iDetailWidth, 1000);\r\n\r\n	$description = ig_getImageDescription($sImageToDisplay);\r\n\r\n	$download_link = str_replace($cfgClient[$client][''path''][''frontend''],$cfgClient[$client][''path''][''htmlpath''],$sImageToDisplay);\r\n\r\n	$download_size = ig_GetReadableFileSize($sImageToDisplay);\r\n	\r\n	$oImageTpl = new Template;\r\n	$oImageTpl->set("s", "IMG",$sScaledImage);\r\n	$oImageTpl->set("s", "BACKLINK",''front_content.php?idcat=''.$idcat.''&amp;idart=''.$idart.''&amp;start=''.$_REQUEST[''start'']);\r\n	$oImageTpl->set("s", "BACKCAPTION",mi18n("&lsaquo; zur&uuml;ck"));\r\n	$oImageTpl->set("s", "DESCRIPTION", $description);\r\n	$oImageTpl->set("s", "DOWNLOAD_LINK", $download_link);\r\n	$oImageTpl->set("s", "DOWNLOAD_SIZE", $download_size);\r\n	$oImageTpl->set("s", "DOWNLOAD_CAPTION", mi18n("Bild herunterladen"));\r\n	\r\n	$oImageTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery_detail.html", false, false);\r\n}\r\n\r\nfunction ig_getImageDescription($idupl){\r\n\r\n	global $cfg, $cfgClient, $db, $client, $lang;\r\n	\r\n	$cApiClient = new cApiClient($client);\r\n	$language_separator = $cApiClient->getProperty(''language'',''separator'');\r\n	if ($language_separator == "") {\r\n		//Sanity, if module used in client without set client setting\r\n		$language_separator = "§§§";\r\n		$cApiClient->setProperty(''language'',''separator'', $language_separator);\r\n	}\r\n	if(is_numeric($idupl)){\r\n		//ID is a number \r\n		$query = "SELECT description FROM ".$cfg["tab"]["upl"]." WHERE idupl = ".$idupl;\r\n	}else{\r\n		//ID is a string\r\n		$path_parts = pathinfo($idupl);\r\n		$upload = $cfgClient[$client][''upl''][''frontendpath''];\r\n		$len = strlen($upload);\r\n		$pos = strpos($idupl,$upload);\r\n		$dirname = substr($path_parts[''dirname''],$pos+$len).''/'';\r\n		$query = "SELECT description FROM ".$cfg["tab"]["upl"]." WHERE (dirname = ''".$dirname."'') AND (filename=''".$path_parts[''basename'']."'') AND (filetype=''".$path_parts[''extension'']."'')";\r\n	}\r\n	$db->query($query);\r\n	if($db->next_record()){\r\n		return htmlspecialchars(urldecode($db->f("description")));\r\n	}else{\r\n		return '''';\r\n	}\r\n}\r\n\r\nfunction ig_GetReadableFileSize($path) {\r\n	$filesize = filesize($path);\r\n	$unit = "bytes";\r\n	\r\n	if ($filesize > 1024) {\r\n	$filesize = ($filesize / 1024);\r\n	$unit = "kB"; }\r\n	if ($filesize > 1024) {\r\n	$filesize = ($filesize / 1024);\r\n	$unit = "MB"; }\r\n	if ($filesize > 1024) {\r\n	$filesize = ($filesize / 1024);\r\n	$unit = "GB"; }\r\n	if ($filesize > 1024) {\r\n	$filesize = ($filesize / 1024);\r\n	$unit = "TB"; }\r\n	\r\n	$filesize = round($filesize, 0);\r\n	return $filesize." ".$unit;\r\n}\r\n?>', '', '0', '', '', 'sysadmin', '2005-08-08 11:25:37', '2005-11-14 14:18:48');
INSERT INTO !PREFIX!_mod VALUES('36', '1', 'Text HTML (2)', 'Content', 'none', 'Ein HTML Text\r\n\r\nAuthor: Andreas Lindner\r\nVersion:1.0', '0', '', '<?php\r\n/***********************************************\r\n* CONTENIDO MODUL - OUTPUT\r\n*\r\n* Modulname  :      Text HTML\r\n* Author(s)   :     Andreas Lindner\r\n* Copyright   :     Contenido - four for business, Andreas Lindner\r\n* Created     :     05.08.2005\r\n************************************************/\r\n\r\necho "<p>"."CMS_HTML[2]"."</p>";\r\n?>', '', '0', '', '', 'sysadmin', '2005-06-29 12:51:07', '2005-09-28 10:08:52');
INSERT INTO !PREFIX!_mod VALUES('28', '1', 'News', 'Content', 'none', 'Artikel einer Kategorie teasern\r\nAuthor: Andreas Lindner\r\nVersion:1.0', '0', '?><?php\r\n/***********************************************\r\n* CONTENIDO MODUL - INPUT\r\n*\r\n* Modulname  :      News\r\n* Author(s)   :     Andreas Lindner, 4fb\r\n* Copyright   :     Contenido - four for business, Andreas Lindner\r\n* Created     :     12.08.2005\r\n************************************************/\r\n\r\n#Select category\r\n$cms_idcat = "CMS_VALUE[1]";\r\n\r\necho ''<table cellpadding="0" cellspacing="0" border="0">'';\r\n\r\necho ''\r\n		<tr><td class="text_medium" style="padding:5px">Kategorie wählen: </td></tr>\r\n		<tr><td class="text_medium" style="padding:5px">'';\r\n\r\necho buildCategorySelect("CMS_VAR[1]", "CMS_VALUE[1]");\r\necho ''&nbsp;<input type="image" src="images/submit.gif">'';\r\n\r\necho ''</td></tr>'';\r\n\r\n#Select sort field and sort order\r\n$sortdate = ''checked'';\r\n$cms_imgsize = "CMS_VALUE[14]";\r\n$cms_limit_articles = "CMS_VALUE[15]";\r\n$cms_sort_direction = "CMS_VALUE[16]";\r\nif ("CMS_VALUE[17]" != '''') {\r\n	$cms_include_start_article = '' checked'';\r\n} else {\r\n	$cms_include_start_article = '''';\r\n}\r\n\r\nif ("CMS_VALUE[3]" == ''sortdate'') {\r\n	$sortdate = ''checked'';\r\n	$sortnum = '''';\r\n}\r\nelseif ("CMS_VALUE[3]" == ''sortnum'') {\r\n	$sortdate = '''';\r\n	$sortnum = ''checked'';\r\n}\r\n\r\necho ''\r\n        <tr>\r\n          <td class="text_medium" style="padding:5px;">''.mi18n("Sortierung nach Datum").'':</td>\r\n          <td style="padding:5px;"><input type="radio" name="CMS_VAR[3]" value="sortdate" ''.$sortdate.''></td>\r\n        </tr>\r\n        <tr>\r\n          <td class="text_medium" style="padding:5px;">''.mi18n("Sortierung nach Nummer").'':</td>\r\n          <td style="padding:5px;"><input type="radio" name="CMS_VAR[3]" value="sortnum" ''.$sortnum.''></td>\r\n        </tr>\r\n        <tr>\r\n          <td class="text_medium" style="padding:5px;">''.mi18n("Sortierung aufsteigend").'':</td>\r\n          <td style="padding:5px;">'';\r\nif (strtolower($cms_sort_direction) == ''desc'') {\r\n	echo ''<input type="radio" name="CMS_VAR[16]" value="asc"/>'';\r\n} else {\r\n	echo ''<input type="radio" name="CMS_VAR[16]" value="asc" checked/>'';\r\n}\r\necho ''</td>\r\n        </tr>\r\n        <tr>\r\n          <td class="text_medium" style="padding:5px;">''.mi18n("Sortierung absteigend").'':</td>\r\n          <td style="padding:5px;">'';\r\nif (strtolower($cms_sort_direction) == ''desc'') {\r\n	echo ''<input type="radio" name="CMS_VAR[16]" value="desc" checked/>'';\r\n} else {\r\n	echo ''<input type="radio" name="CMS_VAR[16]" value="desc"/>'';\r\n}\r\necho ''</td>\r\n        </tr>'';\r\n\r\n$noimg = '''';\r\nif ("CMS_VALUE[13]" == ''true'') {\r\n	$noimg = ''checked'';\r\n}\r\n\r\n#Headline\r\necho ''\r\n	  	<tr><td class="text_medium" style="padding:5px;">''.mi18n("Überschrift").'': </td></tr>\r\n	  	<tr><td style="padding:5px;"><input type="text" name="CMS_VAR[4]" value="CMS_VALUE[4]"></td></tr>\r\n        <tr>\r\n          <td colspan="2" class="text_medium" style="padding:5px;"><b><u>''.mi18n("Bild für Teaser").'':</u></b></td>\r\n        </tr>\r\n        <tr>\r\n          <td colspan="2" class="text_medium" style="padding:5px;">''.mi18n("Es wird das erste Bild des Artikels angezeigt.").''</td>\r\n        </tr>'';\r\n#Image width\r\necho ''\r\n		<tr><td class="text_medium" style="padding:5px;">''.mi18n("Bildbreite").'': </td></tr>\r\n	  	<tr><td style="padding:5px;"><input type="text" name="CMS_VAR[14]" value="''.$cms_imgsize.''" maxlength="3"></td></tr>'';\r\n#Disable images\r\necho ''\r\n        <tr>\r\n          <td class="text_medium" style="padding:5px;">''.mi18n("Kein Bild anzeigen").'':</td>\r\n          <td style="padding:5px;"><input type="checkbox" name="CMS_VAR[13]" value="true" ''.$noimg.''></td>\r\n        </tr>'';\r\n#Number of articles\r\necho ''\r\n        <tr>\r\n          <td class="text_medium" style="padding:5px;">''.mi18n("Anzahl Artikel begrenzen").'':</td>\r\n          <td style="padding:5px;"><input type="text" name="CMS_VAR[15]" value="''.$cms_limit_articles.''"></td>\r\n        </tr>'';\r\n#Include start article\r\necho ''\r\n        <tr>\r\n          <td class="text_medium" style="padding:5px;">''.mi18n("Startartikel in Liste einbeziehen").'':</td>\r\n          <td style="padding:5px;"><input type="checkbox" name="CMS_VAR[17]" value="yes"''.$cms_include_start_article.''></td>\r\n        </tr>'';\r\n\r\necho ''</table>'';\r\n?><?php', '<?php\r\n/***********************************************\r\n* CONTENIDO MODUL - OUTPUT\r\n*\r\n* Modulname  :      News\r\n* Author(s)   :     Andreas Lindner, 4fb\r\n* Copyright   :     Contenido - four for business, Andreas Lindner\r\n* Created     :     12.08.2005\r\n************************************************/\r\n\r\ncInclude(''classes'', ''class.article.php'');\r\ncInclude(''includes'', ''functions.api.string.php'');\r\ncInclude(''includes'', ''functions.api.images.php'');\r\n\r\nif (!is_object($tpl)) {\r\n	$tpl = new Template;\r\n}\r\n\r\n$tpl->reset();\r\n\r\n$sql = "SELECT\r\n            htmlpath, frontendpath\r\n        FROM\r\n            ".$cfg["tab"]["clients"]." \r\n        WHERE\r\n            idclient = ".$client." ";\r\n\r\n$db->query($sql);\r\n\r\nif ($db->next_record()) {\r\n	$htmlpath = $db->f(''htmlpath'');\r\n	$frontendpath = $db->f(''frontendpath'');\r\n}\r\n\r\n// selected category\r\n$selcat = "CMS_VALUE[1]";\r\n$template = "teaser-standard.html";\r\n// anzahl der zeichen text\r\n$mxtext = 200;\r\n\r\n$limit = "CMS_VALUE[15]";\r\n\r\n$cms_sort_direction = "CMS_VALUE[16]";\r\nif ($cms_sort_direction == '''') {\r\n	$cms_sort_direction = ''desc'';\r\n}\r\n\r\nif ("CMS_VALUE[3]" == "sortdate") {\r\n	$order = ''lastmodified'';\r\n} else {\r\n	$order = ''artsort'';\r\n}\r\n\r\nif ("CMS_VALUE[17]" != '''') {\r\n	$with_start = true;\r\n} else {\r\n	$with_start = false;\r\n}\r\n\r\n$newsheadline = "CMS_VALUE[4]";\r\n\r\n$tpl->set(''s'', ''TITLE'', $newsheadline);\r\n\r\nif (strlen($selcat) > 0 && $selcat != ''0'') {\r\n	$options = array (''idcat'' => $selcat, "start" => $with_start, "order" => $order, "direction" => $cms_sort_direction);\r\n\r\n	$list = new ArticleCollection($options);\r\n\r\n	$count = $list->count;\r\n\r\n	if ($count > 0) {\r\n		if (is_numeric($limit) AND strlen($limit) > 0) {\r\n			if ($limit < $list->count) {\r\n				$limit_art = $limit;\r\n			} else {\r\n				$limit_art = $list->count;\r\n			}\r\n		} else {\r\n			$limit_art = $list->count;\r\n		}\r\n\r\n		for ($i = 0; $i < $limit_art; $i ++) {\r\n\r\n			$article = $list->nextArticle();\r\n\r\n			$article_id = $article->getField(''idart'');\r\n\r\n			$teaser_img = '''';\r\n			if ($noimg != ''true'') {\r\n				$text_html = $article->getContent(''CMS_HTML'', 1);\r\n\r\n				$regEx = "/<img[^>]*?>.*?/i";\r\n				$match = array ();\r\n				preg_match($regEx, $text_html, $match);\r\n\r\n				$regEx = "/(src)(=)([''\\"]?)([^\\"'']*)([''\\"]?)/i";\r\n				$img = array ();\r\n				preg_match($regEx, $match[0], $img);\r\n				$img_src = preg_split("/\\//", $img[0]);\r\n\r\n				$img_name = $img_src[count($img_src) - 1];\r\n				$img_name = preg_replace("/\\"/", "", $img_name);\r\n				$img_split = preg_split("/\\./", $img_name);\r\n				$img_type = $img_split[count($img_split) - 1];\r\n\r\n				$img_split2 = preg_split("/_/", $img_split[0]);\r\n\r\n				$name = $img_name;\r\n\r\n				if (count($img_split2) > 1) {\r\n					$img_x = $img_split2[count($img_split2) - 1];\r\n					$img_y = $img_split2[count($img_split2) - 2];\r\n\r\n					if (is_numeric($img_x) AND is_numeric($img_y)) {\r\n						$suffix = "_".$img_x."_".$img_y.".".$img_type;\r\n						$name = preg_replace("/$suffix/", "", $img_name);\r\n						$name = $name.".[a-zA-Z]{3}";\r\n					}\r\n				}\r\n\r\n				$img_teaser = '''';\r\n\r\n				if (strlen($name) > 0) {\r\n					$sql = "SELECT\r\n													*\r\n												FROM\r\n													".$cfg["tab"]["upl"]." \r\n												WHERE\r\n													filename REGEXP ''$name'' ";\r\n\r\n					//echo "<pre>"; print_r($sql); echo "</pre>";\r\n\r\n					$db->query($sql);\r\n\r\n					if ($db->next_record()) {\r\n						$filename = $db->f(''filename'');\r\n						$dirname = $db->f(''dirname'');\r\n					}\r\n\r\n					$img_path = $cfgClient[$client]["upl"]["path"].$dirname.$filename;\r\n\r\n					$img_size = "CMS_VALUE[14]";\r\n\r\n					$img_teaser = capiImgScale($img_path, $img_size, $img_size, $crop = false, $expand = false, $cacheTime = 1000, $wantHQ = false);\r\n				} // end if strlen\r\n\r\n				if (strlen($img_teaser) > 0) {\r\n					$teaser_img = ''<img src="''.$img_teaser.''" class="teaser_img">'';\r\n				} else {\r\n					$teaser_img = '''';\r\n				}\r\n\r\n			} // end if noimg 		\r\n\r\n			$headline = strip_tags($article->getContent(''CMS_HTMLHEAD'', 1));\r\n			$headline = str_replace($replace, " ", $headline);\r\n\r\n			/*			$subheadline = strip_tags($article->getContent(''CMS_HTMLHEAD'', 2));\r\n						$subheadline = str_replace($replace, " ", $subheadline);*/\r\n\r\n			$teaserheadline = /*$subheadline."&nbsp;-&nbsp;".*/\r\n			$headline;\r\n			$href = $sess->url("front_content.php?idcat=$selcat&amp;idart=$article_id");\r\n			$teasertext = $article->getField(''summary'');\r\n\r\n			if (strlen(trim($teasertext)) == 0) {\r\n				$teasertext = strip_tags($article->getContent(''CMS_HTML'', 1));\r\n				$teasertext2 = $teasertext;\r\n				$teasertext = capiStrTrimAfterWord($teasertext, $mxtext);\r\n				if ($teasertext!=$teasertext2) {\r\n					$teasertext.= ''...'';\r\n				}\r\n				\r\n			} // end if   			\r\n\r\n			$teasertext = $teasertext."&nbsp;";\r\n\r\n			$tpl->set(''d'', ''HEADLINE'', $teaserheadline);\r\n			$tpl->set(''d'', ''TEXT'', $teasertext);\r\n			$tpl->set(''d'', ''HREF'', $href);\r\n			$tpl->set(''d'', ''IMG'', $teaser_img);\r\n			$tpl->set(''d'', ''MORE'', mi18n("mehr"));\r\n\r\n			$tpl->next();\r\n\r\n		} // end for\r\n\r\n		$tpl->generate(''templates/''.$template);\r\n\r\n	}\r\n}\r\n?>', '', '0', '', '', 'sysadmin', '2005-06-23 17:33:09', '2005-11-14 14:14:11');
INSERT INTO !PREFIX!_mod VALUES('29', '1', 'BottomNavigation', 'Navigation', 'none', 'Zusatznavigation am Ende der Seite\r\n\r\nAuthor:  Andreas Lindner\r\nVersion: 1.0', '0', '', '<?php\r\n/***********************************************\r\n* Bottom Navigation Output\r\n*\r\n* Author      :     Willi Man\r\n* Copyright   :     four for business AG\r\n* Version	  : 	1.0\r\n* Created     :     17-03-2005\r\n* Modified    :     05-08-2005, Andreas Lindner\r\n************************************************/\r\n\r\n#System properties in use:\r\n#Type: navigation, Name: idcat_bottomnavi\r\n#Contains idcat of tree to be displayed in bottom navigation\r\n\r\n\r\n#Includes\r\ncInclude("frontend", "includes/functions.navigation.php");\r\ncInclude("classes", "class.template.php");\r\n\r\n#Get settings	\r\n$cApiClient = new cApiClient($client);\r\n$catStart = $cApiClient->getProperty(''navigation'', ''idcat_bottomnavi'');\r\n\r\nif (!is_object($oClient)) {\r\n	$oClient = new cApiClient($client);\r\n}\r\n\r\n#Get sub categories\r\n$navigation = array ();\r\n$navigation = createNavigationArray($catStart, $db);\r\n\r\n#Output sub categories\r\n$output = '''';\r\nif (count($navigation) > 0) {\r\n	foreach ($navigation as $key => $data) {\r\n		$output .= ''<a href="''.$sess->url("front_content.php?idcat=".$data[''idcat'']).''" title="''.$data[''name''].''">''.$data[''name''].''</a> | '';\r\n	}\r\n}\r\nif (strlen($output) > 0) {\r\n	$output = substr($output, 0, strlen($output) - 3);\r\n}\r\n\r\necho "<div id=\\"footer\\">".$output."</div>\\n";\r\n?>\r\n\r\n', '', '0', '', '', 'sysadmin', '2005-06-27 15:49:28', '2005-10-25 13:30:22');
INSERT INTO !PREFIX!_mod VALUES('45', '1', 'Illustration', 'Content', 'none', '<Ihre Modulbeschreibung>\r\n\r\nAutor:\r\nVersion', '0', '?><?php\r\n/***********************************************\r\n* CONTENIDO MODUL - INPUT\r\n*\r\n* Modulname   :     Illustration\r\n* Author(s)   :     Andreas Lindner, 4fb\r\n* Copyright   :     Contenido - four for business, Andreas Lindner\r\n* Created     :     12.08.2005\r\n************************************************/\r\n\r\n#Selected img directory\r\n$cms_dirname = "CMS_VALUE[1]";\r\n#Selected img\r\n$cms_filename = "CMS_VALUE[2]";\r\n\r\nif ($cms_dirname == '''' || $cms_dirname == ''0'') {\r\n	$cms_dirname = ''bilder/'';\r\n}\r\n\r\n#Get paths\r\n$sql = "SELECT\r\n	htmlpath, frontendpath\r\n	FROM\r\n	".$cfg["tab"]["clients"]." \r\n	WHERE\r\n	idclient = ".$client." ";\r\n\r\n$db->query($sql);\r\n\r\nif ($db->next_record()) {\r\n	$htmlpath = $db->f(''htmlpath'');\r\n	$frontendpath = $db->f(''frontendpath'');\r\n}\r\n\r\n#Choose image folder\r\necho ''<table cellpadding="0" cellspacing="0" border="0">\r\n	<tr><td class="text_medium" style="padding:5px">''.mi18n("The image should have these dimensions: 170 x 80px").''</td></tr>\r\n	<tr><td class="text_medium" style="padding:5px">''.mi18n("Choose image directory").'': </td></tr>\r\n	<tr><td class="text_medium" style="padding:5px">'';\r\necho ''<select name="CMS_VAR[1]" style="width:200px">'';\r\n\r\n#Get upload directories\r\n$sql = "SELECT DISTINCT\r\n	dirname\r\n	FROM\r\n	".$cfg["tab"]["upl"]."\r\n	WHERE\r\n	idclient=''$client'' AND\r\n	filetype IN (''jpeg'',''jpg'',''gif'',''png'')\r\n	ORDER BY\r\n	dirname";\r\n\r\n$db->query($sql);\r\n\r\n$selected = false;\r\nwhile ($db->next_record()) {\r\n	$dirname = $db->f(''dirname'');\r\n	if ($cms_dirname != $dirname) {\r\n		echo ''<option value="''.$dirname.''">&nbsp;''.$dirname.''</option>'';\r\n	} else {\r\n		$selected = true;\r\n		echo ''<option value="''.$dirname.''" selected="selected">&nbsp;''.$dirname.''</option>'';\r\n	}\r\n}\r\n\r\nif (!$selected) {\r\n	echo ''<option value="0" selected="selected">''.i18n("Please choose").''</option>'';\r\n} else {\r\n	echo ''<option value="0">''.i18n("Please choose").''</option>'';\r\n}\r\n\r\n#Choose image file\r\necho ''</select>&nbsp;<input type="image" src="images/submit.gif">\r\n	<tr><td class="text_medium" style="padding:5px">''.mi18n("Choose image").'': </td></tr>\r\n	<tr><td class="text_medium" style="padding:5px">'';\r\necho ''<select name="CMS_VAR[2]" style="width:200px">'';\r\necho ''<option value="0" selected="selected">''.mi18n("Please choose").''</option>'';\r\n\r\nif ($cms_dirname != ''0'') {\r\n	#Get uploaded files\r\n	$sql = "SELECT \r\n			filename\r\n			FROM\r\n			".$cfg["tab"]["upl"]."\r\n			WHERE\r\n			idclient = ''$client'' AND\r\n			filetype IN (''jpeg'',''jpg'',''gif'',''png'',''swf'') AND\r\n			dirname = ''$cms_dirname'' \r\n			ORDER BY\r\n			filename";\r\n\r\n	$db->query($sql);\r\n\r\n	while ($db->next_record()) {\r\n		$img_name = $db->f(''filename'');\r\n		if ($cms_filename != $img_name) {\r\n			echo ''<option value="''.$img_name.''">&nbsp;''.$img_name.''</option>'';\r\n		} else {\r\n			echo ''<option selected="selected" value="''.$img_name.''">&nbsp;''.$img_name.''</option>'';\r\n		}\r\n	}\r\n}\r\n\r\necho ''</select>&nbsp;<input type="image" src="images/submit.gif">'';\r\n\r\n#Preview image\r\nif ($cms_dirname != ''0'' && $cms_filename != ''0'' && strlen($cms_dirname) > 0 && strlen($cms_filename) > 0) {\r\n	$img_path = $htmlpath.$cfgClient[$client][''upload''].$cms_dirname.$cms_filename;\r\n	$img_split = preg_split("/\\./", $cms_filename);\r\n	$count = count($img_split);\r\n	$type = $img_split[$count -1];\r\n\r\n	echo ''<tr><td colspan="2" style="padding:5px">		\r\n				<img src="''.$img_path.''">\r\n			</td></tr> '';\r\n}\r\n\r\necho ''</td></tr>'';\r\necho ''</table>'';\r\n?><?php ', '<?php\r\n/***********************************************\r\n* CONTENIDO MODUL - OUTPUT\r\n*\r\n* Modulname   :     Illustration\r\n* Author(s)   :     Andreas Lindner, 4fb\r\n* Copyright   :     Contenido - four for business, Andreas Lindner\r\n* Created     :     12.08.2005\r\n************************************************/\r\n\r\n#Selected img directory\r\n$cms_dirname = "CMS_VALUE[1]";\r\n#Selected img\r\n$cms_filename = "CMS_VALUE[2]";\r\n\r\n#Default settings\r\n$img_width = 170;\r\n$img_height = 80;\r\n$defaultImage = ''bilder/illu.jpg'';\r\n\r\n$htmlpath = $cfgClient[$client][''path''][''htmlpath''];\r\n$frontendpath = $cfgClient[$client][''path''][''frontend''];\r\n\r\n$img_path = $htmlpath.$cfgClient[$client][''upload''].$defaultImage;\r\n$img_path_fs = $frontendpath.$cfgClient[$client][''upload''].$defaultImage;\r\n\r\n#Check configured images\r\nif ($cms_dirname != ''0'' && $cms_filename != ''0'' && strlen($cms_dirname) > 0 && strlen($cms_filename) > 0) {\r\n	$img_path = $htmlpath.$cfgClient[$client][''upload''].$cms_dirname.$cms_filename;\r\n	$img_path_fs = $frontendpath.$cfgClient[$client][''upload''].$cms_dirname.$cms_filename;\r\n\r\n	$img_split = preg_split("/\\./", $cms_filename);\r\n	$count = count($img_split);\r\n	$type = $img_split[$count -1];\r\n\r\n	if (!file_exists($img_path_fs)) {\r\n		$img_path = $htmlpath.$cfgClient[$client][''upload''].$defaultImage;\r\n		$img_path_fs = $frontendpath.$cfgClient[$client][''upload''].$defaultImage;\r\n	}\r\n}\r\n\r\n#Scale image\r\n$image = capiImgScale($img_path_fs, $img_width, $img_height, false, false, 10, false);\r\n\r\n#Get dimensions of scaled image\r\nlist ($width, $height, $type, $attr) = getimagesize(str_replace($cfgClient[$client]["path"]["htmlpath"], $cfgClient[$client]["path"]["frontend"], $image));\r\n\r\n#Output header with logo and illustration\r\necho " <div id=\\"header\\"><p style=\\"background-image: url(".$image.");\\"><a href=\\"front_content.php\\"><img src=\\"images/logo.gif\\" alt=\\"".mi18n("Logo")."\\" title=\\"".mi18n("Back to home")."\\"/></a></p></div>";\r\n?>', '', '0', '', '', 'sysadmin', '2005-09-29 12:50:40', '2005-09-30 09:02:05');
INSERT INTO !PREFIX!_mod VALUES('30', '1', 'Navigationspfad', 'Navigation', 'none', '', '0', '', '<?php\r\n/***********************************************\r\n* CONTENIDO MODUL - OUTPUT\r\n*\r\n* Modulname  :      Navigationpath\r\n* Author(s)   :     Andreas Lindner\r\n* Copyright   :     Contenido - four for business, Andreas Lindner\r\n* Created     :     05-08-2005\r\n************************************************/\r\n\r\n#Settings\r\n$separator = ''>'';\r\n$max_length = 65;\r\n\r\n#Get path to root\r\n$dummy = conCreateLocationString($idcat, '' ''.$separator.'' '', $retval, true, "bc", 1);\r\n\r\nif ($retval=='''') {\r\n	$retval=''&nbsp;'';	\r\n} else {\r\n	$pattern = "''>.*?<''";\r\n	\r\n	preg_match_all($pattern, $retval, $matches);\r\n	$matches = $matches[0];\r\n	\r\n	#Get effective text length\r\n	$length = 0;\r\n	foreach ($matches as $value) {\r\n		$length += strlen($value) - 2;\r\n	}\r\n	\r\n	#Get shorten factor\r\n	if ($length > $max_length * 4) {\r\n		$shorten = 5;\r\n	}\r\n	elseif ($length > $max_length * 3) {\r\n		$shorten = 4;\r\n	}\r\n	elseif ($length > $max_length * 2) {\r\n		$shorten = 3;\r\n	}\r\n	elseif ($length > $max_length) {\r\n		$shorten = 2;\r\n	} else {\r\n		$shorten = 1;\r\n	}\r\n	\r\n	#Shorten items\r\n	if ($length > $max_length) {\r\n		foreach ($matches as $value) {\r\n			if (strpos($value, $separator) === FALSE) {\r\n				$text = substr($value, 1, strlen($value) - 2);\r\n				$len = strlen($text);\r\n				if (strpos($text, '' '') === FALSE) {\r\n					$text_new = $text;\r\n				} else {\r\n					$text_new = capiStrTrimAfterWord($text, intval($len / $shorten));\r\n				}\r\n	\r\n				if (strlen($text) != strlen($text_new)) {\r\n					$text_new .= ''...'';\r\n				}\r\n	\r\n				$text_new = ''>''.$text_new.''<'';\r\n				$retval = str_replace(''>''.$text.''<'', $text_new, $retval);\r\n			}\r\n		}\r\n	}\r\n	\r\n	$retval = str_replace(''"/index.html"'', ''"Home/index.html"'', $retval);\r\n}\r\n\r\necho "<div id=\\"bc\\">".$retval."</div>";\r\n?>\r\n', '', '0', '', '', 'sysadmin', '2005-06-27 15:50:10', '2005-10-10 13:26:24');
INSERT INTO !PREFIX!_mod VALUES('31', '1', 'Kontakt', 'Content', 'none', 'Kontaktformular anzeigen und eingegebene Daten per eMail verschicken\r\n\r\nAuthor: Andreas Lindner\r\nVersion:1.0', '0', '?><?php\r\n/***********************************************\r\n* CONTENIDO MODUL - INPUT\r\n*\r\n* Modulname  :      Contact form\r\n* Author(s)   :     Andreas Lindner\r\n* Copyright   :     Contenido - four for business\r\n* Created     :     12.08.2005\r\n************************************************/\r\n?>\r\n\r\n<table border="0">\r\n	<tr>\r\n		<td><?php echo mi18n("Absender EMail");?></td>\r\n		<td><input type="text" name="<?php echo "CMS_VAR[0]";?>" value="<?php echo "CMS_VALUE[0]"; ?>"></td>\r\n	</tr>\r\n	<tr>\r\n		<td><?php echo mi18n("Absender Name");?></td>\r\n		<td><input type="text" name="<?php echo "CMS_VAR[2]";?>" value="<?php echo "CMS_VALUE[2]"; ?>"></td>\r\n	</tr>\r\n	<tr>\r\n		<td><?php echo mi18n("Empfänger EMail");?></td>\r\n		<td><input type="text" name="<?php echo "CMS_VAR[1]";?>" value="<?php echo "CMS_VALUE[1]"; ?>"></td>\r\n	</tr>\r\n	<tr>\r\n		<td><?php echo mi18n("Betreff");?></td>\r\n		<td><input type="text" name="<?php echo "CMS_VAR[3]";?>" value="<?php echo "CMS_VALUE[3]"; ?>"></td>\r\n	</tr>\r\n	<?php\r\n	$c1 = '''';\r\n	$c2 = '''';\r\n	$c3 = '''';\r\n	$c4 = '''';\r\n	switch (strtolower("CMS_VALUE[4]")) {\r\n		case "smtp" :\r\n			$c1 = '' checked'';\r\n			break;\r\n		case "mail" :\r\n			$c2 = '' checked'';\r\n			break;\r\n		case "sendmail" :\r\n			$c3 = '' checked'';\r\n			break;\r\n		case "qmail" :\r\n			$c4 = '' checked'';\r\n			break;\r\n		default :\r\n			$c3 = '' checked'';\r\n	}\r\n	?>\r\n	<tr>\r\n		<td valign="top"><?php echo mi18n("Mailer");?></td>\r\n		<td>\r\n			<input type="radio" name="<?php echo "CMS_VAR[4]";?>" value="mail"<?php echo $c2;?>>&nbsp;<?php echo mi18n("mail");?><br/>\r\n			<input type="radio" name="<?php echo "CMS_VAR[4]";?>" value="qmail"<?php echo $c4;?>>&nbsp;<?php echo mi18n("qmail");?><br/>\r\n			<input type="radio" name="<?php echo "CMS_VAR[4]";?>" value="sendmail"<?php echo $c3;?>>&nbsp;<?php echo mi18n("sendmail");?><br/>\r\n			<input type="radio" name="<?php echo "CMS_VAR[4]";?>" value="smtp"<?php echo $c1;?>>&nbsp;<?php echo mi18n("smtp");?><br/>\r\n		</td>\r\n	</tr>\r\n	<tr>\r\n		<td><?php echo mi18n("SMTP Host");?></td>\r\n		<td><input type="text" name="<?php echo "CMS_VAR[5]";?>" value="<?php echo "CMS_VALUE[5]"; ?>"></td>\r\n	</tr>\r\n	<tr>\r\n		<td><?php echo mi18n("SMTP User");?></td>\r\n		<td><input type="text" name="<?php echo "CMS_VAR[6]";?>" value="<?php echo "CMS_VALUE[6]"; ?>"></td>\r\n	</tr>\r\n	<tr>\r\n		<td><?php echo mi18n("SMTP Passwort");?></td>\r\n		<td><input type="text" name="<?php echo "CMS_VAR[7]";?>" value="<?php echo "CMS_VALUE[7]"; ?>"></td>\r\n	</tr>\r\n</table>\r\n<?php', '<?php\r\n/***********************************************\r\n* CONTENIDO MODUL - OUTPUT\r\n*\r\n* Modulname  :      Contact form\r\n* Author(s)   :     Andreas Lindner\r\n* Copyright   :     Contenido - four for business\r\n* Created     :     12.08.2005\r\n************************************************/\r\n\r\n#Includes\r\ncInclude("classes", "class.phpmailer.php");\r\n\r\nif (!isset ($_POST[''send''])) {\r\n	#Form has not been sent yet\r\n	cInclude(''classes'', ''class.article.php'');\r\n	cInclude(''classes'', ''class.template.php'');\r\n\r\n	#Create contact form\r\n	echo ''<div class="kontaktformular"/>'';\r\n	echo ''<form name="kontaktform" id="kontaktform" method="post" action="''.$sess->url("front_content.php?idcat=$idcat&idart=$idart&parentid=$parentid").''">''."\\n";\r\n	echo ''<input type="hidden" name="send" value="1">'';\r\n\r\n	if (!is_object($tpl)) {\r\n		$tpl = new Template;\r\n	}\r\n	$tpl->set("s", "ANREDE", mi18n("Anrede"));\r\n	$tpl->set("s", "ANREDE_OPTION1", mi18n("Herr"));\r\n	$tpl->set("s", "ANREDE_OPTION2", mi18n("Frau"));\r\n	$tpl->set("s", "NACHNAME", mi18n("Name"));\r\n	$tpl->set("s", "VORNAME", mi18n("Vorname"));\r\n	$tpl->set("s", "FIRMA", mi18n("Firma"));\r\n	$tpl->set("s", "STRASSE", mi18n("Straße/Nr."));\r\n	$tpl->set("s", "PLZORT", mi18n("PLZ/Ort"));\r\n	$tpl->set("s", "TELEFON", mi18n("Telefon"));\r\n	$tpl->set("s", "EMAIL", mi18n("eMail"));\r\n	$tpl->set("s", "ANLIEGEN", mi18n("Nachricht"));\r\n	$tpl->set("s", "PFLICHTFELDER", mi18n("Pflichtfelder"));\r\n	$tpl->set("s", "ABSCHICKEN", mi18n("Abschicken"));\r\n	$tpl->set("s", "LOESCHEN", mi18n("Löschen"));\r\n\r\n	$tpl->generate($cfgClient[$client]["path"]["frontend"]."templates/kontaktformular.html");\r\n	echo ''</form>'';\r\n	echo ''</div>'';\r\n} elseif ($_POST[''send''] == 1) {\r\n	#Form has been sent\r\n\r\n	#Check user input\r\n	$noerrors = true;\r\n	$msg = '''';\r\n	if ($_POST[''Vorname''] == '''') {\r\n		$noerrors = false;\r\n		$msg .= mi18n("Bitte geben Sie Ihren Vornamen ein!")."<br/>";\r\n	}\r\n	if ($_POST[''Nachname''] == '''') {\r\n		$noerrors = false;\r\n		$msg .= mi18n("Bitte geben Sie Ihren Namen ein!")."''<br/>";\r\n	}\r\n	if ($_POST[''EMail''] == '''') {\r\n		$noerrors = false;\r\n		$msg .= mi18n("Bitte geben Sie Ihre E-Mail-Adresse ein!")."<br/>";\r\n	}\r\n	if ($_POST[''Strasse''] == '''') {\r\n		$noerrors = false;\r\n		$msg .= mi18n("Bitte geben Sie Ihre Stra&szlig;e ein!")."<br/>";\r\n	}\r\n	if ($_POST[''PLZOrt''] == '''') {\r\n		$noerrors = false;\r\n		$msg .= mi18n("Bitte geben Sie Ihre PLZ/Ort ein!")."<br/>";\r\n	}\r\n\r\n	if ($noerrors == false) {\r\n		echo "<p>";\r\n		#Errors have been found\r\n		echo "<strong>".mi18n("Beim Versenden sind folgende Fehler aufgetreten:")."</strong><br/>";\r\n		echo $msg.''<br/>'';\r\n		echo ''<a href="javascript:history.back();">&lsaquo; ''.mi18n("zur&uuml;ck").''</a>'';\r\n	} else {\r\n		#No errors, create and send mail\r\n		$mail = new phpmailer;\r\n		$mail_body = ''<html><head></head><body bgcolor="#ffffff"><table cellspacing="0" cellpadding="2" border="0">'';\r\n\r\n		if (is_array($_POST)) {\r\n			foreach ($_POST as $key => $value) {\r\n				if ($key != ''send'') {\r\n					$mail_body .= "<tr><td>$key</td><td>$value</td></tr>";\r\n				}\r\n			}\r\n		}\r\n\r\n		$mail_body .= ''</table></bo''.''dy></html>'';\r\n		$mail->Host = "localhost";\r\n		$mail->IsHTML(true);\r\n\r\n		#Get mailer from settings\r\n		switch (strtolower("CMS_VALUE[4]")) {\r\n			case "smtp" :\r\n				$mail->IsSMTP();\r\n				$host = "CMS_VALUE[5]";\r\n				$user = "CMS_VALUE[6]";\r\n				$password = "CMS_VALUE[7]";\r\n				if (($host != '''') && ($user != '''') && ($password != '''')) {\r\n					$mail-> $SMTPAuth = true;\r\n					$mail->Host = $host;\r\n					$mail->Username = $user;\r\n					$mail->Password = $password;\r\n				}\r\n				break;\r\n			case "mail" :\r\n				$mail->IsMail();\r\n				break;\r\n			case "sendmail" :\r\n				$mail->IsSendmail();\r\n				break;\r\n			case "qmail" :\r\n				$mail->IsQmail();\r\n				break;\r\n			default :\r\n				}\r\n		$mail->From = "CMS_VALUE[0]";\r\n		$mail->FromName = "CMS_VALUE[2]";\r\n		$mail->AddAddress("CMS_VALUE[1]", "");\r\n		$mail->Subject = "CMS_VALUE[3]";\r\n		$mail->Body = $mail_body;\r\n		$mail->WordWrap = 50;\r\n		$mail->Send();\r\n	\r\n		#Display message after mail is sent\r\n		echo mi18n("Ihr Anliegen wurde uns übermittelt. Vielen Dank!")."<br/>";\r\n	}\r\n}\r\n?>\r\n\r\n\r\n', '', '0', '', '', 'sysadmin', '2005-06-27 17:28:09', '2005-09-30 13:43:36');
INSERT INTO !PREFIX!_mod VALUES('38', '1', 'Sucheingabe', 'Navigation', 'none', 'Sucheingabefeld erzeugen\r\n\r\nAuthor: Andreas Lindner\r\nVersion:1.0', '0', '', '<?php\r\n/***********************************************\r\n* CONTENIDO MODUL - OUTPUT\r\n*\r\n* Modulname  :      Sucheingabe\r\n* Author(s)   :     Andreas Lindner\r\n* Copyright   :     Contenido - four for business, Andreas Lindner\r\n* Created     :     09.08.2005\r\n************************************************/\r\n\r\n#Includes\r\ncInclude(''classes'', ''class.template.php'');\r\n\r\n#Settings\r\n$template = ''sucheingabe.html'';\r\n$cApiClient = new cApiClient($client);\r\n$selected = $cApiClient->getProperty("search","resultpage");\r\n\r\nif ( !is_object($tpl) ) {\r\n    $tpl = new Template;\r\n}\r\n$tpl->reset();\r\n\r\n$url = $sess->url("front_content.php?idcat=".$selected);\r\n\r\nif($_POST[''searchterm'']!=''''){\r\n	$searchterm = $_POST[''searchterm''];\r\n}else{\r\n	$searchterm = $_GET[''searchterm''];\r\n}\r\n\r\n$tpl->set(''s'', ''SEARCH_TITLE'', mi18n("Suche"));	\r\n$tpl->set(''s'', ''SEARCH_URL'', $url);	\r\n$tpl->set(''s'', ''SEARCH_START'', mi18n("Go"));	\r\n\r\n$tpl->generate(''templates/''.$template);\r\n\r\n?>', '', '0', '', '', 'sysadmin', '2005-08-08 15:21:06', '2005-10-25 13:32:17');
INSERT INTO !PREFIX!_mod VALUES('40', '1', 'RSS Reader', 'Content', 'none', '', '0', '?><?php\r\n/***********************************************\r\n* CONTENIDO MODUL - INPUT\r\n*\r\n* Modulname  :     Insert RSS feed\r\n* Copyright  :     Contenido - four for business\r\n* Authors:	 :	   Timo Hummel, Andreas Lindner\r\n* Created    :     30.09.2005\r\n************************************************/\r\n\r\necho ''<table>'';\r\necho ''<tr><td>''.mi18n("URL").''</td><td><input type="text" name="''."CMS_VAR[0]".''" value="''."CMS_VALUE[0]".''" style="width: 320px"></td></tr>'';\r\necho ''<tr><td>'';\r\necho mi18n("RSS-Template auswählen").'':</td><td><select name="CMS_VAR[1]" size="1" style="width: 320px">\r\n<option value="">Nichts ausgewählt</option>'';\r\n$strPath_fs = $cfgClient[$client]["path"]["frontend"].''templates/'';\r\n$handle = opendir($strPath_fs);\r\nwhile ($entryName = readdir($handle)) {\r\n	if (is_file($strPath_fs.$entryName)) { \r\n		if ("CMS_VALUE[1]"==$entryName) {\r\n			echo ''<option selected value="''.$entryName.''">''.$entryName.''</option>'';\r\n		} else {\r\n			echo ''<option value="''.$entryName.''">''.$entryName.''</option>'';\r\n		}\r\n	}\r\n}\r\necho ''</select></td></tr>'';\r\n\r\necho ''<tr><td>''.mi18n("Anzahl Einträge").''</td><td><input type="text" name="''."CMS_VAR[2]".''" value="''."CMS_VALUE[2]".''"</td></tr>'';\r\n\r\necho ''</table>'';\r\n\r\n?><?php', '<?php\r\n/***********************************************\r\n* CONTENIDO MODUL - OUTPUT\r\n*\r\n* Modulname   :     Insert RSS feed\r\n* Authors:	  :	    Timo Hummel, Andreas Lindner\r\n* Copyright   :     Contenido - four for business\r\n* Created     :     30.09.2005\r\n************************************************/\r\n\r\ncInclude("pear", "XML/Parser.php");\r\ncInclude("pear", "XML/RSS.php");\r\n\r\nif ("CMS_VALUE[0]" == "")\r\n{\r\n  $sFeed = "http://www.contenido.org/rss/de/news";\r\n} else {\r\n  $sFeed = "CMS_VALUE[0]";\r\n}\r\n\r\nif ("CMS_VALUE[2]" == "")\r\n{\r\n  $FeedMaxItems = 999;\r\n} else {\r\n	$FeedMaxItems = intval("CMS_VALUE[2]");\r\n}\r\n\r\n/* Preparse feed for an encoding due to the poorly designed\r\n   PHP XML parser */\r\n$sFeedContent = substr(@file_get_contents($sFeed),0,1024);\r\n\r\n$regExp = "/<\\?xml.*encoding=[\\"\\''](.*)[\\"\\'']\\?>/i";\r\n		\r\npreg_match($regExp,trim($sFeedContent),$matches);\r\n\r\nif ($matches[1])\r\n{\r\n  $rss =& new XML_RSS($sFeed, $matches[1]);\r\n} else {\r\n  $rss =& new XML_RSS($sFeed);\r\n}\r\n\r\n$rss->parse();\r\n\r\n$tpl = new Template;\r\n\r\n$i = 0;\r\nforeach ($rss->getItems() as $item)\r\n{\r\n	if ($i < $FeedMaxItems) {\r\n	    $tpl->set("d", "TITLE", htmlentities($item[''title''],ENT_QUOTES));\r\n    	$tpl->set("d", "LINK", htmlentities($item[''link''],ENT_QUOTES));\r\n    	$tpl->set("d", "DESCRIPTION", htmlentities($item[''description''],ENT_QUOTES));\r\n    	$tpl->set("d", "READ_ON", mi18n("weiterlesen"));\r\n	    $tpl->next();\r\n	}\r\n	$i++;\r\n}\r\n\r\n$tpl->generate($cfgClient[$client]["path"]["frontend"]."templates/"."CMS_VALUE[1]");\r\n?>', '', '0', '', '', 'sysadmin', '2005-08-11 12:05:27', '2005-10-28 17:28:04');
INSERT INTO !PREFIX!_mod VALUES('43', '1', 'Suchausgabe', 'Content', 'none', 'Suchergebnisse anzeigen\r\n\r\nAuthor: Willi Man, Andreas Lindner\r\nVersion:1.0', '0', '', '<?php\r\n/***********************************************\r\n* Suchausgabe Output\r\n*\r\n* Author      :     Willi Man\r\n* Copyright   :     four for business AG\r\n* Created     :     05-04-2004\r\n* Modified    :     12-07-2005, Andreas Lindner\r\n************************************************/\r\n\r\n#System properties in use:\r\n#Type: searchrange, Name: include\r\n#Contains comma-separated list of cats to be included into search (sub-cats are included automatically)\r\n\r\n#Logical combination of search terms with AND or OR\r\n\r\n#Includes\r\ncInclude(''classes'', ''class.search.php'');\r\ncInclude(''classes'', ''class.artspec.php'');\r\ncInclude(''classes'', ''class.template.php'');\r\ncInclude(''includes'', ''functions.api.string.php'');\r\ncInclude("frontend", "includes/functions.navigation.php");\r\ncInclude(''classes'', ''class.article.php'');\r\n\r\n#Initiliaze template object\r\nif (!is_object($tpl)) {\r\n	$tpl = new Template;\r\n}\r\n$tpl->reset();\r\n\r\n#Settings\r\n$oArticleProp = new Article_Property($db, $cfg);\r\n$iArtspecReference = 2;\r\n\r\n$cApiClient = new cApiClient($client);\r\n$sSearchRange = $cApiClient->getProperty(''searchrange'', ''include'');\r\n$aSearchRange = explode('','', $sSearchRange);\r\n\r\n#Multilingual settings\r\n$sYourSearchFor = mi18n("Ihre Suche nach");\r\n$sMore = mi18n("weiter");\r\n\r\n#Get search term and pre-process it\r\nif (isset ($_GET[''searchterm''])) {\r\n	$searchterm = urldecode(strip_tags(htmlentities(stripslashes($_GET[''searchterm'']))));\r\n}\r\nelseif (isset ($_POST[''searchterm''])) {\r\n	$searchterm = urldecode(strip_tags(htmlentities(stripslashes($_POST[''searchterm'']))));\r\n}\r\n$searchterm = str_replace('' + '', '' AND '', $searchterm);\r\n$searchterm = str_replace('' - '', '' NOT '', $searchterm);\r\n$searchterm_display = $searchterm;\r\n\r\n#Get all article specs\r\n$sql = "SELECT\r\n		idartspec, artspec\r\n	FROM\r\n		".$cfg[''tab''][''art_spec'']."\r\n	WHERE\r\n		client=$client AND\r\n		lang=$lang AND\r\n		online=1";\r\n\r\n$db->query($sql);\r\n$rows = $db->num_rows();\r\n$aArtspecOnline = array ();\r\n$aArtSpecs = array ();\r\n$c = 1;\r\n$d = 1;\r\n$e = 1;\r\nwhile ($db->next_record()) {\r\n	$aArtSpecs[] = $db->f(''idartspec'');\r\n}\r\n$aArtSpecs[] = 0;\r\n\r\n$action = $sess->url(''front_content.php'');\r\n\r\nif (strlen(trim($searchterm)) > 0) {\r\n	#Fix for PHP < 4.3\r\n	if( !function_exists( ''html_entity_decode'' ) )\r\n	{\r\n		function html_entity_decode( $given_html, $quote_style = ENT_QUOTES )\r\n		{\r\n			$trans_table = array_flip(get_html_translation_table( HTML_SPECIALCHARS, $quote_style ));\r\n			$trans_table[''&#39;''] = "''";\r\n			return ( strtr( $given_html, $trans_table ) );\r\n		}\r\n	}\r\n\r\n	#Parse search term and set search options\r\n	$searchterm = html_entity_decode($searchterm);\r\n\r\n	if (stristr($searchterm, '' or '') === FALSE) {\r\n		$combine = ''and'';\r\n	} else {\r\n		$combine = ''or'';\r\n	}\r\n	$searchterm = str_replace('' and '', '' '', strtolower($searchterm));\r\n	$searchterm = str_replace('' or '', '' '', strtolower($searchterm));\r\n\r\n		$options = array (''db'' => ''regexp'', // use db function regexp\r\n		''combine'' => $combine, // combine searchterms with and\r\n		''exclude'' => false, // => searchrange specified in ''cat_tree'', ''categories'' and ''articles'' is excluded, otherwise included (exclusive)\r\n		''cat_tree'' => $aSearchRange, // searchrange \r\n		''artspecs'' => $aArtSpecs, // array of article specifications => search only articles with these artspecs\r\n	''protected'' => true); // => do not search articles or articles in categories which are offline or protected\r\n\r\n	$search = new Search($options);\r\n\r\n	$cms_options = array ("head", "html", "htmlhead", "htmltext", "text"); // search only in these cms-types\r\n	$search->setCmsOptions($cms_options);\r\n\r\n	#Execute search\r\n	$aSearchResults = $search->searchIndex($searchterm, ''''); \r\n\r\n	#Build results page\r\n	if (count($aSearchResults) > 0) {\r\n		$tpl->set(''s'', ''result_page'', mi18n("Ergebnis-Seite").'':'');\r\n\r\n		#Build meessage\r\n		$message = $sYourSearchFor." ''".htmlspecialchars(strip_tags($searchterm_display))."'' ".mi18n("hat $$$ Treffer ergeben").":";\r\n		$message = str_replace(''$$$'', count($aSearchResults), $message);\r\n		$tpl->set(''s'', ''MESSAGE'', $message);\r\n\r\n		#Number of results per page\r\n		$number_of_results = 10;\r\n		$oSearchResults = new SearchResult($aSearchResults, $number_of_results);\r\n\r\n		$num_res = $oSearchResults->getNumberOfResults() + $pdf_count;\r\n		$num_pages = $oSearchResults->getNumberOfPages();\r\n		$oSearchResults->setReplacement(''<strong>'', ''</strong>''); // html-tags to emphasize the located searchterms\r\n\r\n		#Get current result page\r\n		if (isset ($_GET[''page'']) && is_numeric($_GET[''page'']) && $_GET[''page''] > 0) {\r\n			$page = $_GET[''page''];\r\n			$res_page = $oSearchResults->getSearchResultPage($page);\r\n		} else {\r\n			$page = 1;\r\n			$res_page = $oSearchResults->getSearchResultPage($page);\r\n		}\r\n\r\n		#Build links to other result pages\r\n		for ($i = 1; $i <= $num_pages; $i ++) {\r\n			$nextlink = $sess->url(''front_content.php?idcat=''.$idcat.''&idart=''.$idart.''&searchterm=''.$searchterm_display.''&page=''.$i.$sArtSpecs);\r\n			if ($i == $page) {\r\n				$nextlinks .= ''<nobr>&nbsp<strong>''.$i.''</strong>&nbsp;</nobr>'';\r\n			} else {\r\n				$nextlinks .= ''<nobr>&nbsp;<a href="''.$nextlink.''" title="''.$i.''. ''.mi18n("Ergebnisseite anzeigen").''">''.$i.''</a>&nbsp;</nobr>'';\r\n			}\r\n		}\r\n		$tpl->set(''s'', ''PAGES'', $nextlinks);\r\n\r\n		#Build link to next result page\r\n		if ($page < $num_pages) {\r\n			$n = $page +1;\r\n			$next = $sess->url(''front_content.php?idcat=''.$idcat.''&idart=''.$idart.''&searchterm=''.$searchterm.''&page=''.$n.$sArtSpecs);\r\n			$nextpage .= ''&nbsp;<a href="''.$next.''" title="''.mi18n("nächste Ergebnisseite anzeigen").''">''.mi18n("vor").'' ></a>'';\r\n			$tpl->set(''s'', ''NEXT'', $nextpage);\r\n		} else {\r\n			$tpl->set(''s'', ''NEXT'', '''');\r\n		}\r\n\r\n		#Build link to previous result page\r\n		if ($page > 1) {\r\n			$p = $page -1;\r\n			//$pre = $sess->url(''index-c-''.$idcat.''-''.$p.''-0.html'');\r\n			$pre = $sess->url(''front_content.php?idcat=''.$idcat.''&idart=''.$idart.''&searchterm=''.$searchterm.''&page=''.$p.$sArtSpecs);\r\n			$prevpage .= ''<a href="''.$pre.''" title="''.mi18n("vorherige Ergebnisseite anzeigen").''">< ''.mi18n("zurück").''</a>&nbsp;'';\r\n			$tpl->set(''s'', ''PREV'', $prevpage);\r\n		} else {\r\n			$tpl->set(''s'', ''PREV'', '''');\r\n		}\r\n\r\n		if (count($res_page) > 0) {\r\n			$i = 1;\r\n			#Build single search result on result page\r\n			foreach ($res_page as $key => $val) {\r\n				$num = $i + (($page -1) * $number_of_results);\r\n				$oArt = new Article($key, $client, $lang);\r\n				#Get publishing date of article\r\n				$pub_system = $oArt->getField(''published'');\r\n				$pub_user = trim(strip_tags($oArt->getContent(''HEAD'', 90)));\r\n				if ($pub_user != '''') {\r\n					$show_pub_date = "[".$pub_user."]";\r\n				} else {\r\n					$show_pub_date = '''';\r\n					if ($pub_system[8] != ''0'') {\r\n						$show_pub_date .= $pub_system[8];\r\n					}\r\n					$show_pub_date .= $pub_system[9].''.'';\r\n					if ($pub_system[5] != ''0'') {\r\n						$show_pub_date .= $pub_system[5];\r\n					}\r\n					$show_pub_date .= $pub_system[6].".".$pub_system[0].$pub_system[1].$pub_system[2].$pub_system[3]."]";\r\n					$show_pub_date = "[".$show_pub_date;\r\n				}\r\n			\r\n				#Get text and headline of current article\r\n				$iCurrentArtSpec = $oArticleProp->getArticleSpecification($key, $lang);\r\n				$aHeadline = $oSearchResults->getSearchContent($key, ''HTMLHEAD'', 1);\r\n				$aSubheadline = $oSearchResults->getSearchContent($key, ''HTMLHEAD'', 2);\r\n				$text = $oSearchResults->getSearchContent($key, ''HTML'', 1);\r\n				$text = capiStrTrimAfterWord($text[0], 200);\r\n				$headline = capiStrTrimAfterWord($aHeadline[0], 200); # conflict with capiStrTrimAfterWord and setReplacement(''<strong>'', ''</strong>'')\r\n				$subheadline = capiStrTrimAfterWord($aSubheadline[0], 200);\r\n\r\n				$cat_id = $oSearchResults->getArtCat($key);\r\n				$sCatName = getCategoryName($cat_id, $db);\r\n				$similarity = $oSearchResults->getSimilarity($key);\r\n\r\n				$similarity = sprintf("%.0f", $similarity);\r\n\r\n				#Send output to template\r\n				$href = $sess->url("front_content.php?idcat=$cat_id&idart=$key");\r\n				$tpl->set(''d'', ''more'', $sMore);\r\n				$tpl->set(''d'', ''HREF'', $href);\r\n				$tpl->set(''d'', ''TITLE'', mi18n("Link zu Suchergebnis").'' ''.$i);\r\n				$tpl->set(''d'', ''NUM'', $num);\r\n				$tpl->set(''d'', ''CATNAME'', $headline);\r\n				$tpl->set(''d'', ''HEADLINE'', $text);\r\n				$tpl->set(''d'', ''SUBHEADLINE'', $subheadline);\r\n				$tpl->set(''d'', ''SIMILARITY'', $similarity);\r\n				$tpl->set(''d'', ''TARGET'', ''_self'');\r\n				$tpl->set(''d'', ''PUB_DATE'', $show_pub_date);\r\n				$tpl->next();\r\n				$i ++;\r\n\r\n			}\r\n			$tpl->generate(''templates/suchausgabe.html'');\r\n		}\r\n	} else {\r\n		#No results\r\n		$tpl->set(''s'', ''MESSAGE'', $sYourSearchFor." ''".htmlspecialchars(strip_tags($searchterm))."'' ".mi18n("hat leider keine Treffer ergeben").".");\r\n		$tpl->set(''s'', ''NEXT'', '''');\r\n		$tpl->set(''s'', ''PREV'', '''');\r\n		$tpl->set(''s'', ''PAGES'', '''');\r\n		$tpl->set(''s'', ''result_page'', '''');\r\n		$tpl->generate(''templates/suchausgabe.html'');\r\n	}\r\n\r\n}\r\n\r\nclass Article_Property {\r\n	var $globalConfig;\r\n	var $oDBInstance;\r\n\r\n	/**\r\n	 * Constructor\r\n	 * Hint: Call constructor with Article_Property($db, $cfg);\r\n	 * @param  oDBInstance instance of class DB_Contenido\r\n	 * @param  globalConfig \r\n	 */\r\n	function Article_Property($oDBInstance, $globalConfig) {\r\n		$this->globalConfig = $globalConfig;\r\n		$this->oDBInstance = $oDBInstance;\r\n	}\r\n\r\n	/**\r\n	 * Get specification of an article\r\n	 * \r\n	 * @param  	$iArticleId\r\n	 * @return  id of article specification \r\n	 */\r\n	function getArticleSpecification($iArticleId, $iLangId) {\r\n\r\n		$sqlString = "   \r\n			  		SELECT \r\n		            	artspec\r\n		            FROM \r\n		            	".$this->globalConfig[''tab''][''art_lang'']."\r\n		            WHERE\r\n		            	idart = ''".$iArticleId."'' AND\r\n						idlang = ''".$iLangId."''\r\n		            ";\r\n\r\n		#echo "<pre>$sqlString</pre>";\r\n		$this->oDBInstance->query($sqlString);\r\n\r\n		if ($this->oDBInstance->next_record()) {\r\n			return $this->oDBInstance->f(''artspec'');\r\n		} else {\r\n			return false;\r\n		}\r\n	}\r\n}\r\n?> ', '', '0', '', '', 'sysadmin', '2005-08-16 13:46:48', '2005-10-25 13:31:56');
INSERT INTO !PREFIX!_mod VALUES('44', '1', 'RSS Feed Creator', 'Function', 'none', 'RSS feed aus den Artikeln einer Kategorie erzeugen\r\n\r\nAuthor: Andreas Lindner\r\nVersion:1.0', '0', '?><?php\r\n/***********************************************\r\n* CONTENIDO MODUL - INPUT\r\n*\r\n* Modulname  :      RSS Feed generator\r\n* Author(s)   :     Andreas Lindner, 4fb\r\n* Copyright   :     Contenido - four for business, Andreas Lindner\r\n* Created     :     12.08.2005\r\n************************************************/\r\n\r\n#Selected category\r\n$selected = "CMS_VALUE[0]";\r\n\r\necho "<table cellspacing=\\"0\\" cellpadding=\\"10\\" border=\\"0\\">\r\n"."  <tr valign=\\"top\\">\r\n"."    <td>".mi18n("Kategorie wählen").":</td>\r\n"."    <td>\r\n"."      <select name=\\"CMS_VAR[0]\\" style=\\"width:300px;\\">\r\n"."        <option value=''''>---".mi18n("Kein")."---</option>\r\n";\r\n\r\n#Fetch all categories\r\n$query = "SELECT A.idcat, A.level, C.name FROM ".$cfg["tab"]["cat_tree"]." AS A, ".$cfg["tab"]["cat"]." AS B, ".$cfg["tab"]["cat_lang"]." AS C WHERE A.idcat=B.idcat "."AND B.idcat=C.idcat AND C.idlang=''$lang'' AND B.idclient=''$client'' "."AND C.visible=1 ORDER BY A.idtree";\r\n\r\n#Execute query\r\n$db->query($query);\r\n\r\n#Loop result and build the options\r\nwhile ($db->next_record()) {\r\n	#Indent spacer\r\n	$spaces = "";\r\n\r\n	#How many levels\r\n	$levels = $db->f("level");\r\n	$spaces = '''';\r\n	for ($i = 0; $i <= $levels; $i ++) {\r\n		$spaces .= "|->";\r\n	}\r\n\r\n	if ($selected == $db->f("idcat")) {\r\n		#Selected category\r\n		echo "<option selected=\\"selected\\" value=\\"".$db->f("idcat")."\\">".$spaces.$db->f("name")."</option>\r\n";\r\n	} else {\r\n		#Category\r\n		echo "<option value=\\"".$db->f("idcat")."\\">".$spaces.$db->f("name")."</option>\r\n";\r\n	}\r\n\r\n}\r\necho "</select></td></tr>";\r\n\r\n#Set default values\r\nif ("CMS_VALUE[1]" == '''') {\r\n	$rss_sortby = ''created'';\r\n} else {\r\n	$rss_sortby = "CMS_VALUE[1]";\r\n}\r\n\r\nif ("CMS_VALUE[2]" == '''') {\r\n	$rss_sortorder = ''desc'';\r\n} else {\r\n	$rss_sortorder = "CMS_VALUE[2]";\r\n}\r\n\r\nif ("CMS_VALUE[3]" == '''') {\r\n	$rss_include_start_article = '''';\r\n} else {\r\n	$rss_include_start_article = '' checked'';\r\n}\r\n\r\n$rss_title = "CMS_VALUE[4]";\r\n\r\nif ("CMS_VALUE[5]" == '''') {\r\n	$rss_link = $cfgClient[$client][''path''][''htmlpath''];\r\n} else {\r\n	$rss_link = "CMS_VALUE[5]";\r\n}\r\n\r\n$rss_description = "CMS_VALUE[6]";\r\n\r\nif ("CMS_VALUE[7]" == '''') {\r\n	$rss_language = ''de'';\r\n} else {\r\n	$rss_language = "CMS_VALUE[7]";\r\n}\r\n\r\n$rss_copyright = "CMS_VALUE[8]";\r\n\r\n$rss_image_title = "CMS_VALUE[9]";\r\n\r\n$rss_image_url = "CMS_VALUE[10]";\r\n\r\n$rss_image_link = "CMS_VALUE[11]";\r\n\r\n$rss_managingEditor = "CMS_VALUE[12]";\r\n\r\n$rss_webMaster = "CMS_VALUE[13]";\r\n\r\n$rss_maxCount = "CMS_VALUE[14]";\r\n\r\n$rss_ttl = "CMS_VALUE[15]";\r\n\r\n$rss_description_length = "CMS_VALUE[16]";\r\n\r\n$arrSortBy[''created''] = mi18n("Erstellungsdatum");\r\n$arrSortBy[''published''] = mi18n("Publizierungsungsdatum");\r\n$arrSortBy[''artsort''] = mi18n("Sortier-Reihenfolge");\r\n$arrSortBy[''lastmodified''] = mi18n("Änderungsdatum");\r\n$arrSortBy[''name''] = mi18n("Alphabetisch");\r\n\r\n#Sort by\r\necho "  <tr valign=\\"top\\">\r\n"."    <td>".mi18n("Sortieren nach").":</td>\r\n"."    <td><select name=\\"CMS_VAR[1]\\" style=\\"width:300px;\\">\r\n";\r\nforeach ($arrSortBy as $key => $value) {\r\n	if ($key == $rss_sortby) {\r\n		echo "<option value=\\"$key\\" selected=\\"selected\\">$value\r\n";\r\n	} else {\r\n		echo "<option value=\\"$key\\">$value\r\n";\r\n	}\r\n}\r\necho "    </select></td></tr>\r\n";\r\n\r\n#Sort order\r\n$arrSortOrder[''asc''] = mi18n("aufsteigend");\r\n$arrSortOrder[''desc''] = mi18n("absteigend");\r\n\r\necho "  <tr valign=\\"top\\">\r\n"."    <td>".mi18n("Sortier-Reihenfolge").":</td>\r\n"."    <td><select name=\\"CMS_VAR[2]\\" style=\\"width:300px;\\">\r\n";\r\nforeach ($arrSortOrder as $key => $value) {\r\n	if ($key == $rss_sortorder) {\r\n		echo "<option value=\\"$key\\" selected=\\"selected\\">$value\r\n";\r\n	} else {\r\n		echo "<option value=\\"$key\\">$value\r\n";\r\n	}\r\n}\r\necho "    </select></td></tr>\r\n";\r\n\r\n#Include start article?\r\necho "  <tr valign=\\"top\\">\r\n"."    <td>".mi18n("Startartikel einbeziehen").":</td>\r\n"."    <td><input type=\\"checkbox\\" name=\\"CMS_VAR[3]\\" value=\\"yes\\"$rss_include_start_article></td></tr>\r\n";\r\n\r\n#Title\r\necho "  <tr valign=\\"top\\">\r\n"."    <td>".mi18n("Titel").":</td>\r\n"."    <td><input type=\\"text\\" maxlength=\\"200\\" style=\\"width:300px;\\" name=\\"CMS_VAR[4]\\" value=\\"".$rss_title."\\">\r\n"."    </td>\r\n"."  </tr>\r\n";\r\n\r\n#Link\r\necho "  <tr valign=\\"top\\">\r\n"."    <td>".mi18n("Link").":</td>\r\n"."    <td><input type=\\"text\\" maxlength=\\"200\\" style=\\"width:300px;\\" name=\\"CMS_VAR[5]\\" value=\\"".$rss_link."\\">\r\n"."    </td>\r\n"."  </tr>\r\n";\r\n\r\n#Description\r\necho "  <tr valign=\\"top\\">\r\n"."    <td>".mi18n("Beschreibung").":</td>\r\n"."    <td><input type=\\"text\\" maxlength=\\"200\\" style=\\"width:300px;\\" name=\\"CMS_VAR[6]\\" value=\\"".$rss_description."\\">\r\n"."    </td>\r\n"."  </tr>\r\n";\r\n\r\n#Language\r\n$arrLanguages[''de''] = mi18n("deutsch");\r\n$arrLanguages[''en''] = mi18n("englisch");\r\n$arrLanguages[''fr''] = mi18n("französisch");\r\n$arrLanguages[''it''] = mi18n("italienisch");\r\n$arrLanguages[''es''] = mi18n("spanisch");\r\n$arrLanguages[''nl''] = mi18n("niederländisch");\r\n$arrLanguages[''el''] = mi18n("griechisch");\r\n$arrLanguages[''pt''] = mi18n("portugiesisch");\r\n\r\necho "  <tr valign=\\"top\\">\r\n"."    <td>".mi18n("Sprache").":</td>\r\n"."    <td><select name=\\"CMS_VAR[7]\\" style=\\"width:300px;\\">\r\n";\r\nforeach ($arrLanguages as $key => $value) {\r\n	if ($key == $rss_language) {\r\n		echo "<option value=\\"$key\\" selected=\\"selected\\">$value\r\n";\r\n	} else {\r\n		echo "<option value=\\"$key\\">$value\r\n";\r\n	}\r\n}\r\necho "    </select></td></tr>\r\n";\r\n\r\n#Copyright\r\necho "  <tr valign=\\"top\\">\r\n"."    <td>".mi18n("Copyright").":</td>\r\n"."    <td><input type=\\"text\\" maxlength=\\"200\\" style=\\"width:300px;\\" name=\\"CMS_VAR[8]\\" value=\\"".$rss_copyright."\\">\r\n"."    </td>\r\n"."  </tr>\r\n";\r\n\r\n#Image title\r\necho "  <tr valign=\\"top\\">\r\n"."    <td>".mi18n("Bildtitel").":</td>\r\n"."    <td><input type=\\"text\\" maxlength=\\"200\\" style=\\"width:300px;\\" name=\\"CMS_VAR[9]\\" value=\\"".$rss_image_title."\\">\r\n"."    </td>\r\n"."  </tr>\r\n";\r\n\r\n#Image\r\n$sql = "SELECT * FROM ".$cfg[''tab''][''upl'']." WHERE (filetype=''jpg'') OR (filetype=''jpeg'') OR (filetype=''gif'') OR (filetype=''png'') ORDER BY dirname,filename";\r\n$db->query($sql);\r\necho ''<tr><td>''.mi18n("Bild").'':</td><td><select name="CMS_VAR[10]" size="1" style="width:300px;">'';\r\n$selected = false;\r\n$img_display = '''';\r\n\r\nwhile ($db->next_record()) {\r\n	$path = $db->f("dirname").$db->f("filename");\r\n	if ($db->f("idupl") == $rss_image_url) {\r\n		echo ''<option selected="selected" value="''.$db->f("idupl").''">''.$path.''</option>'';\r\n		$img_display = $path;\r\n		$selected = true;\r\n	} else {\r\n		echo ''<option value="''.$db->f("idupl").''">''.$path.''</option>'';\r\n	}\r\n}\r\n\r\nif ($selected) {\r\n	echo ''<option value="">''.mi18n("Nichts ausgewählt.").''</option>'';\r\n} else {\r\n	echo ''<option selected="selected" value="">''.mi18n("Nichts ausgewählt.").''</option>'';\r\n}\r\necho "</select></td></tr>\r\n";\r\n\r\n#Image link\r\necho "  <tr valign=\\"top\\">\r\n"."    <td>".mi18n("Link (bei Klick auf das Bild)").":</td>\r\n"."    <td><input type=\\"text\\" maxlength=\\"200\\" style=\\"width:300px;\\" name=\\"CMS_VAR[11]\\" value=\\"".$rss_image_link."\\">\r\n"."    </td>\r\n"."  </tr>\r\n";\r\n\r\n#Editor\r\necho "  <tr valign=\\"top\\">\r\n"."    <td>".mi18n("EMail-Adresse Herausgeber").":</td>\r\n"."    <td><input type=\\"text\\" maxlength=\\"200\\" style=\\"width:300px;\\" name=\\"CMS_VAR[12]\\" value=\\"".$rss_managingEditor."\\">\r\n"."    </td>\r\n"."  </tr>\r\n";\r\n\r\n#EMail Webmaster\r\necho "  <tr valign=\\"top\\">\r\n"."    <td>".mi18n("EMail-Adresse Webmaster").":</td>\r\n"."    <td><input type=\\"text\\" maxlength=\\"200\\" style=\\"width:300px;\\" name=\\"CMS_VAR[13]\\" value=\\"".$rss_webMaster."\\">\r\n"."    </td>\r\n"."  </tr>\r\n";\r\n\r\n#Max. number of articles\r\necho "  <tr valign=\\"top\\">\r\n"."    <td>".mi18n("maximale Anzahl Artikel").":</td>\r\n"."    <td><input type=\\"text\\" maxlength=\\"200\\" style=\\"width:300px;\\" name=\\"CMS_VAR[14]\\" value=\\"".$rss_maxCount."\\">\r\n"."    </td>\r\n"."  </tr>\r\n";\r\n\r\n#TTL\r\necho "  <tr valign=\\"top\\">\r\n"."    <td>".mi18n("TTL (Minuten)").":</td>\r\n"."    <td><input type=\\"text\\" maxlength=\\"200\\" style=\\"width:300px;\\" name=\\"CMS_VAR[15]\\" value=\\"".$rss_ttl."\\">\r\n"."    </td>\r\n"."  </tr>\r\n";\r\n\r\n#Description length\r\necho "  <tr valign=\\"top\\">\r\n"."    <td>".mi18n("max. Länge der Beschreibung").":</td>\r\n"."    <td><input type=\\"text\\" maxlength=\\"200\\" style=\\"width:300px;\\" name=\\"CMS_VAR[16]\\" value=\\"".$rss_description_length."\\">\r\n"."    </td>\r\n"."  </tr>\r\n";\r\n\r\necho "</table>\r\n";\r\n?><?php\r\n', '<?php\r\n/***********************************************\r\n* CONTENIDO MODUL - INPUT\r\n*\r\n* Modulname  :      RSS Feed generator\r\n* Author(s)   :     Andreas Lindner, 4fb\r\n* Copyright   :     Contenido - four for business, Andreas Lindner\r\n* Created     :     12.08.2005\r\n************************************************/\r\n\r\n#Includes\r\ncInclude(''classes'', ''class.article.php'');\r\n\r\n#Get settings\r\n$rss_cat = "CMS_VALUE[0]";\r\n$rss_sortby = "CMS_VALUE[1]";\r\n$rss_sortorder = "CMS_VALUE[2]";\r\n$rss_include_start_article = "CMS_VALUE[3]";\r\n$rss_title = "CMS_VALUE[4]";\r\n$rss_link = "CMS_VALUE[5]";\r\n$rss_description = "CMS_VALUE[6]";\r\n$rss_language = "CMS_VALUE[7]";\r\n$rss_copyright = "CMS_VALUE[8]";\r\n$rss_image_title = "CMS_VALUE[9]";\r\n$rss_image_url = "CMS_VALUE[10]";\r\n$rss_image_link = "CMS_VALUE[11]";\r\n$rss_managingEditor = "CMS_VALUE[12]";\r\n$rss_webMaster = "CMS_VALUE[13]";\r\n$rss_maxCount = "CMS_VALUE[14]";\r\n$rss_ttl = "CMS_VALUE[15]";\r\n$rss_description_length = "CMS_VALUE[16]";\r\n\r\n#Check settings\r\nif ($rss_maxCount == '''') {\r\n	$rss_maxCount = 999;\r\n}\r\n\r\nif ($rss_description_length=='''') {\r\n	$rss_description_length = 200;\r\n}\r\n\r\n#Get feed image\r\nif ($rss_image_link != '''') {\r\n	if (substr(strtolower($rss_image_link), 0, 7) != ''http://'') {\r\n		$rss_image_link = ''http://''.$rss_image_link;\r\n	}\r\n}\r\n\r\nif ($rss_image_url != '''') {\r\n	$sql = "SELECT * FROM ".$cfg[''tab''][''upl'']." WHERE idupl = ".$rss_image_url;\r\n	$db->query($sql);\r\n	if ($db->next_record()) {\r\n		$rss_image_url = $cfgClient[$client][''path''][''htmlpath''].$cfgClient[$client][''upl''][''frontendpath''].$db->f("dirname").$db->f("filename");\r\n		$rss_image_fs = $cfgClient[$client][''path''][''frontend''].$cfgClient[$client][''upl''][''frontendpath''].$db->f("dirname").$db->f("filename");\r\n	}\r\n}\r\n\r\n#Output feed header\r\nheader("Content-type: text/xml");\r\necho "<?xml version=\\"1.0\\" encoding=\\"iso-8859-1\\"?>\r\n";\r\necho "<rss version=\\"2.0\\">\r\n";\r\necho "<channel>\r\n";\r\n\r\necho "<title>".prepareStringForOutput($rss_title)."</title>\r\n";\r\necho "<copyright>".prepareStringForOutput($rss_copyright)."</copyright>\r\n";\r\necho "<link>".prepareStringForOutput($rss_link)."</link>\r\n";\r\necho "<description>".prepareStringForOutput($rss_description)."</description>\r\n";\r\necho "<language>".prepareStringForOutput($rss_language)."</language>\r\n";\r\necho "<lastBuildDate>".date(''D, d M Y H:i:s T'')."</lastBuildDate>\r\n";\r\necho "<pubDate>".date(''D, d M Y H:i:s T'')."</pubDate>\r\n";\r\necho "<generator>Contenido CMS</generator>\r\n";\r\necho "<managingEditor>".$rss_managingEditor."</managingEditor>\r\n";\r\necho "<webMaster>".$rss_webMaster."</webMaster>\r\n";\r\necho "<ttl>".$rss_ttl."</ttl>\r\n";\r\necho "<image>\r\n";\r\necho "<title>".prepareStringForOutput($rss_image_title)."</title>\r\n";\r\nlist ($width, $height, $type, $attr) = getimagesize($rss_image_fs);\r\necho "<width>".$width."</width>\r\n";\r\necho "<height>".$height."</height>\r\n";\r\necho "<url>".prepareStringForOutput($rss_image_url)."</url>\r\n";\r\necho "<link>".prepareStringForOutput($rss_image_link)."</link>\r\n";\r\necho "</image>\r\n";\r\n\r\n#Output articles\r\nif ($rss_cat != '''') {\r\n	if ($rss_include_start_article != '''') {\r\n		$b_include_start_article = true;\r\n	} else {\r\n		$b_include_start_article = false;\r\n	}\r\n	$options = array (''idcat'' => $rss_cat, "start" => $b_include_start_article, "order" => $rss_sortby, "direction" => $rss_sortorder);\r\n	$list = new ArticleCollection($options);\r\n	$count = $list->count;\r\n\r\n	if ($count > 0) {\r\n		$aArticleList = array ();\r\n		$aArticleList = $list->articles;\r\n		$aTmpArticleList = array ();\r\n		$index = 1;\r\n		foreach ($aArticleList as $value) {\r\n			if ($index <= $rss_maxCount) {\r\n				$tmp_article = new Article($value, $client, $lang);\r\n				$headline = '''';\r\n				$i = 1;\r\n				while (($i<20) && (is_empty($headline))) {\r\n					$headline = strip_tags($tmp_article->getContent(''CMS_HTMLHEAD'', $i));\r\n					$i++;\r\n				}\r\n					\r\n				$i = 1;\r\n				while (($i<20) && (is_empty($headline))) {\r\n					$headline = strip_tags($tmp_article->getContent(''CMS_TEXT'', $i));\r\n					$i++;\r\n				}\r\n				\r\n				$description = '''';\r\n				$i = 1;\r\n				while (($i<20) && (is_empty($description))) {\r\n					$description = strip_tags($tmp_article->getContent(''CMS_HTML'', $i));\r\n					$i++;\r\n				}\r\n\r\n				$description = capiStrTrimAfterWord($description, $rss_description_length);\r\n\r\n				$pub_date = $tmp_article->getField("created");\r\n				$pub_date = strtotime($pub_date);\r\n				$pub_date = date(''r'', $pub_date);\r\n				if ($headline != '''') {\r\n					$headline = prepareStringForOutput($headline);\r\n					$link = str_replace(''&'',''&amp;'',$cfgClient[$client][''path''][''htmlpath'']."front_content.php?idcat=$rss_cat&idart=$value&client=$client&lang=$lang");\r\n					echo "<item>\r\n";\r\n					echo "<title>".prepareStringForOutput($headline)."</title>\r\n";\r\n					echo "<description>".prepareStringForOutput($description)."</description>\r\n";\r\n					echo "<link>".$link."</link>\r\n";\r\n					echo "<pubDate>".$pub_date."</pubDate>\r\n";\r\n					$t1 = $cfg["tab"]["art_lang"];\r\n					$t2 = $cfg["tab"]["phplib_auth_user_md5"];\r\n					$sql = "SELECT ".$t2.".realname FROM ".$t1." INNER JOIN ".$t2." ON ".$t1.".author = ".$t2.".username WHERE (".$t1.".idart=$value) AND (".$t1.".idlang=$lang)";\r\n					$db->query($sql);\r\n					\r\n					if ($db->next_record()) {\r\n						$author = prepareStringForOutput($db->f("realname"));\r\n					} else {\r\n						$author = '''';\r\n					}\r\n					echo "<author>".$author."</author>\r\n";\r\n					echo "</item>\r\n";\r\n				}\r\n			}\r\n			$index ++;\r\n		}\r\n	}\r\n}\r\n\r\necho "</channel>\r\n";\r\necho "</rss>\r\n";\r\n\r\nfunction is_empty($in_str) {\r\n\r\n	$tmp = trim($in_str);\r\n	$tmp = strip_tags($tmp);\r\n	$tmp = str_replace(chr(13).chr(10), '''', $tmp);\r\n	$tmp = str_replace(''&nbsp;'', '''', $tmp);\r\n\r\n	if ($tmp == '''') {\r\n		return true;\r\n	} else {\r\n		return false;\r\n	}\r\n}\r\n\r\nfunction prepareStringForOutput($sIn) {\r\n\r\n	$sIn = str_replace(''&amp;nbsp;'','' '',$sIn);\r\n	$sIn = str_replace(''&nbsp;'','' '',$sIn);\r\n	#$sIn = str_replace(chr(13).chr(10),'' '',$sIn);\r\n	#return htmlspecialchars($sIn, ENT_QUOTES);\r\n	#return htmlnumericalentities(html_entity_decode($sIn));\r\n    return str_replace(''&#38;'',''&'',htmlnumericalentities($sIn));\r\n}\r\n\r\nfunction htmlnumericalentities($str) {\r\n\r\n	return preg_replace(''/[^!-%\\x27-;=?-~ ]/e'', ''"&#".ord("$0").chr(59)'', $str);\r\n}\r\n?>', '', '0', '', '', 'sysadmin', '2005-08-17 14:39:22', '2005-10-20 12:59:08');
INSERT INTO !PREFIX!_mod VALUES('46', '1', 'Newsletter Form', 'Navigation', 'none', 'Newsletter Subscription Module V4.0.0 (for text and HTML newsletters)\r\n\r\nProvides multilanguage form for newsletter subscribing and cancellation.\r\n\r\nBased on the work of 4fb, www.x28.de, HerrB, 01.06.2007\r\n\r\nNotes:\r\n- The default language is english. Use the translation functionality to translate the module in other languages\r\n- Create a template which includes this module and create an article using that template.\r\n- Configure category/arcticle specifying handler article id', '0', '   // Includes\r\n   cInclude(''classes'',  ''class.htmlelements.php'');\r\n   cInclude(''classes'',  ''contenido/class.clientslang.php'');\r\n   cInclude(''classes'',  ''class.newsletter.groups.php'');\r\n   cInclude(''frontend'', ''includes/class.input.helper.php''); # Note, this file is located in <client-path>/includes!\r\n\r\n   // Initialisation\r\n   $oClientLang = new cApiClientLanguage(false, $client, $lang);\r\n\r\n   /*\r\n   *  Used variables:\r\n   *  JoinSel:         Selection, which group will be joined (Default, Selected, UserSelected)\r\n   *  JoinMultiple:    If JoinSel = UserSelected then: If more than one group has been specified, select more than one\r\n   *  JoinGroups:      Selected group(s)\r\n   *  JoinMessageType: Message type for new recipients: User select (user), text or html\r\n   *  OptNewWindow:    Open handler window in new browser window?\r\n   */\r\n   $aSettings   = array();\r\n   $aSettings[''JoinSel'']         = $oClientLang->getProperty(''newsletter'', ''joinsel'');\r\n   $aSettings[''JoinMultiple'']    = $oClientLang->getProperty(''newsletter'', ''joinmultiple'');\r\n   $aSettings[''JoinGroups'']      = $oClientLang->getProperty(''newsletter'', ''joingroups'');\r\n   $aSettings[''JoinMessageType''] = $oClientLang->getProperty(''newsletter'', ''joinmessagetype'');\r\n   $aSettings[''OptNewWindow'']    = "CMS_VALUE[4]";\r\n   \r\n   // Setting default values\r\n   /*\r\n   *  If nothing is set or if the option "UserSelected" has been activated, but no groups\r\n   *  have been selected, set option "Default". Note, that requiring to select groups when option\r\n   *  "Selected" has been activated doesn''t make so much sense here (even, as it is possible to do).\r\n   *  Why? Because the groups to be joined have to be specified on the handler page, not here...\r\n   *  To prevent users to select a group (or not to save the selection) when the option "Selected" is\r\n   *  active should make more problems than just to ignore the selection in the Output area\r\n   */\r\n   \r\n   if ($aSettings[''JoinSel''] == '''' || ($aSettings[''JoinSel''] == ''UserSelected'' && $aSettings[''JoinGroups''] == '''')) {\r\n      $aSettings[''JoinSel''] = ''Default'';\r\n   }\r\n   if (!is_numeric($_REQUEST[''selHandlerCatArt''.$cnumber]) || $_REQUEST[''selHandlerCatArt''.$cnumber] < 0) {\r\n      $_REQUEST[''selHandlerCatArt''.$cnumber] = 0;\r\n   }\r\n   \r\n   // Saving changes, if any\r\n   if ($_REQUEST[''hidAction''.$cnumber] == ''save'')\r\n   {\r\n      if ($_REQUEST[''radJoin''.$cnumber] != '''' && $_REQUEST[''radJoin''.$cnumber] != $aSettings[''JoinSel''])\r\n      {\r\n         $aSettings[''JoinSel''] = $_REQUEST[''radJoin''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joinsel'', $aSettings[''JoinSel'']);\r\n      }\r\n      if ($_REQUEST[''ckbJoinMultiple''.$cnumber] != $aSettings[''JoinMultiple''])\r\n      {\r\n         $aSettings[''JoinMultiple''] = $_REQUEST[''ckbJoinMultiple''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joinmultiple'', $aSettings[''JoinMultiple'']);\r\n      }\r\n      if ($_REQUEST[''hidJoinGroups''.$cnumber] != '''' && $_REQUEST[''hidJoinGroups''.$cnumber] != $aSettings[''JoinGroups''])\r\n      {\r\n         $aSettings[''JoinGroups''] = $_REQUEST[''hidJoinGroups''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joingroups'', $aSettings[''JoinGroups'']);\r\n      }\r\n      if ($_REQUEST[''selMessageType''.$cnumber] != $aSettings[''JoinMessageType''])\r\n      {\r\n         $aSettings[''JoinMessageType''] = $_REQUEST[''selMessageType''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joinmessagetype'', $aSettings[''JoinMessageType'']);\r\n      }\r\n   \r\n      if ($_REQUEST[''ckbUpdateHandlerID''.$cnumber] == ''enabled'')\r\n      {\r\n         // Trick: If UpdateHandlerID is enabled, save id as client setting\r\n         $iHandlerCatArt = $_REQUEST[''selHandlerCatArt''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''idcatart'', $iHandlerCatArt);\r\n      }\r\n   }\r\n   // Getting current handler article id\r\n   $iHandlerCatArt = $oClientLang->getProperty(''newsletter'', ''idcatart'');\r\n   unset ($oClientLang);\r\n   \r\n   // Showing options\r\n   $oCfgTable = new UI_Config_Table;\r\n   \r\n   $oHidAction        = new cHTMLHiddenField(''hidAction''.$cnumber, ''save'');\r\n   \r\n   $oSelHandlerCatArt = new cHTMLInputSelectElement(''selHandlerCatArt''.$cnumber, 1, '''', true);\r\n   $oOption           = new cHTMLOptionElement(mi18n("- Please select -"), '''');\r\n   $oSelHandlerCatArt->addOptionElement(0, $oOption);\r\n   $oSelHandlerCatArt->addCategories(0, true, false, false, true, true);\r\n   $oSelHandlerCatArt->setDefault($iHandlerCatArt);\r\n   \r\n   $oCkbUpdate        = new cHTMLCheckbox(''ckbUpdateHandlerID''.$cnumber, ''enabled'');\r\n   $oCkbUpdate->setEvent(''click'', ''if (this.checked) {document.forms[0].selHandlerCatArt''.$cnumber.''.disabled = false;} else {document.forms[0].selHandlerCatArt''.$cnumber.''.disabled = true;}'');\r\n   \r\n   $oCfgTable->setCell(''handler'', 0, mi18n("Handler Article:"));\r\n   $oCfgTable->setCell(''handler'', 1, $oHidAction->render().$oSelHandlerCatArt->render()."\\n&nbsp;".$oCkbUpdate->toHTML(false).mi18n("Update"));\r\n   \r\n   // Getting newsletter groups (if any)\r\n   $oRcpGroups = new RecipientGroupCollection;\r\n   $oRcpGroups->setWhere(''idclient'', $client);\r\n   $oRcpGroups->setWhere(''idlang'',   $lang);\r\n   $oRcpGroups->setWhere(''defaultgroup'', ''0'');\r\n   $oRcpGroups->setOrder(''defaultgroup DESC, groupname ASC'');\r\n   $oRcpGroups->query();\r\n   \r\n   // Join options\r\n   // If newsletter groups are available, provide group options, otherwise show only\r\n   // ''Default'' option. This is necessary, as there may have been groups specified (and used)\r\n   // but they have been deleted, later on.\r\n   \r\n   $oCfgTable->setCell(''join_01'', 0, mi18n("Join:"));\r\n   \r\n   if ($oRcpGroups->Count() == 0) {\r\n      // No groups available, only default group possible\r\n   \r\n      $oRadJoinDefault = new cHTMLRadioButton (''radJoin''.$cnumber, ''Default'', '''', true);\r\n      $oCfgTable->setCell(''join_01'', 1, $oRadJoinDefault->toHTML(false).mi18n("default group"));\r\n   } else {\r\n      // Groups available, show different group join options\r\n   \r\n      // Join default group only\r\n      if ($aSettings[''JoinSel''] == ''Default'') {\r\n         $oRadJoinDefault = new cHTMLRadioButton (''radJoin''.$cnumber, ''Default'', '''', true);\r\n      } else {\r\n         $oRadJoinDefault = new cHTMLRadioButton (''radJoin''.$cnumber, ''Default'');\r\n      }\r\n      $oRadJoinDefault->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = true; document.forms[0].selGroup".$cnumber.".disabled = true;");\r\n      $oCfgTable->setCell(''join_01'', 1, $oRadJoinDefault->toHTML(false).mi18n("default group"));\r\n      $oCfgTable->setRowBgColor(''join_01'', $cfg["color"]["table_light"]);\r\n   \r\n      // Join admin selected groups automatically\r\n      if ($aSettings[''JoinSel''] == ''Selected'') {\r\n         $oRadJoinSelected = new cHTMLRadioButton (''radJoin''.$cnumber, ''Selected'', '''', true);\r\n      } else {\r\n         $oRadJoinSelected = new cHTMLRadioButton (''radJoin''.$cnumber, ''Selected'');\r\n      }\r\n      $oRadJoinSelected->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = false; document.forms[0].selGroup".$cnumber.".disabled = false;");\r\n      $oCfgTable->setCell(''join_02'', 0, '''');\r\n      $oCfgTable->setCell(''join_02'', 1, $oRadJoinSelected->toHTML(false).mi18n("selected group(s)"));\r\n      $oCfgTable->setRowBgColor(''join_02'', $cfg["color"]["table_light"]);\r\n   \r\n      // Join the groups the user has selected (-> provide a list for the user), optionally, the user may select more than one group\r\n      if ($aSettings[''JoinSel''] == ''UserSelected'')\r\n      {\r\n         $oRadJoinUserSel  = new cHTMLRadioButton (''radJoin''.$cnumber, ''UserSelected'', '''', true);\r\n         $oCkbJoinMultiple = new cHTMLCheckbox (''ckbJoinMultiple''.$cnumber, ''enabled'', '''', $aSettings[''JoinMultiple'']);\r\n      } else {\r\n         $oRadJoinUserSel  = new cHTMLRadioButton (''radJoin''.$cnumber, ''UserSelected'');\r\n         $oCkbJoinMultiple = new cHTMLCheckbox (''ckbJoinMultiple''.$cnumber, ''enabled'', '''', false, true);\r\n      }\r\n      $oRadJoinUserSel->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = false; document.forms[0].selGroup".$cnumber.".disabled = false;");\r\n      $oCfgTable->setCell(''join_03'', 0, '''');\r\n      $oCfgTable->setCell(''join_03'', 1, $oRadJoinUserSel->toHTML(false).mi18n("group(s) as selected by user").''<br />''."\\n".$oCkbJoinMultiple->toHTML(false).mi18n("Multiple group selection allowed"));\r\n      $oCfgTable->setRowBgColor(''join_03'', $cfg["color"]["table_light"]);\r\n   \r\n      $oCfgTable->setCell(''groups'', 0, mi18n("Select group(s):"));\r\n   \r\n      // Show groups\r\n      // Trick: To save multiple selections in <select>-Element, add some JS which saves the\r\n      // selection, comma separated in a hidden input field on change.\r\n      $sSkript = ''              <script type="text/javascript"><!--''."\\n".\r\n                 ''                  function fncUpdateSel() {''."\\n".\r\n                 ''                     var strSel = "";''."\\n".\r\n                 ''                     for(i = 0; i < document.forms[0].selGroup''.$cnumber.''.length; i++) {''."\\n".\r\n                 ''                        if(document.forms[0].selGroup''.$cnumber.''.options[i].selected == true) {''."\\n".\r\n                 ''                           if (strSel != "")''."\\n".\r\n                 ''                              strSel = strSel + ",";''."\\n".\r\n                 ''                           strSel = strSel + document.forms[0].selGroup''.$cnumber.''.options[i].value;''."\\n".\r\n                 ''                        }''."\\n".\r\n                 ''                     }''."\\n".\r\n                 ''                     document.forms[0].elements["hidJoinGroups''.$cnumber.''"].value = strSel;''."\\n".\r\n                 ''                  }''."\\n".\r\n                 ''                  //--></script>''."\\n";\r\n\r\n      if ($aSettings[''JoinSel''] == ''Default'') {\r\n         $oSelGroup = new cHTMLSelectElement (''selGroup''.$cnumber, '''', '''', true);\r\n      } else {\r\n         $oSelGroup = new cHTMLSelectElement (''selGroup''.$cnumber, '''');\r\n      }\r\n      $oSelGroup->setSize(5);\r\n      $oSelGroup->setMultiselect();\r\n      $oSelGroup->setEvent(''change'', "fncUpdateSel()");\r\n\r\n      $aGroups = explode('','', $aSettings[''JoinGroups'']);\r\n      while ($oRcpGroup = $oRcpGroups->next()) {\r\n         $iID = $oRcpGroup->get(''idnewsgroup'');\r\n         if (in_array ($iID, $aGroups)) {\r\n            $oOption = new cHTMLOptionElement($oRcpGroup->get(''groupname''), $iID, true);\r\n         } else {\r\n            $oOption = new cHTMLOptionElement($oRcpGroup->get(''groupname''), $iID, false);\r\n         }\r\n         $oSelGroup->addOptionElement($iID, $oOption);\r\n      }\r\n   \r\n      $oHidGroups = new cHTMLHiddenField (''hidJoinGroups''.$cnumber, $aSettings[''JoinGroups'']);\r\n      $oCfgTable->setCell(''groups'', 1, $sSkript.$oSelGroup->render().$oHidGroups->render());\r\n   }\r\n   \r\n   // Options: Message type (user [->selectbox], text or html)\r\n   $oCfgTable->setCell(''options_01'', 0, mi18n("Options:"));\r\n\r\n   $oSelMsgType = new cHTMLSelectElement (''selMessageType''.$cnumber);\r\n   $oOption = new cHTMLOptionElement(mi18n("User selected"), "user");\r\n   $oSelMsgType->addOptionElement(0, $oOption);\r\n   $oOption = new cHTMLOptionElement(mi18n("Text only"), "text");\r\n   $oSelMsgType->addOptionElement(1, $oOption);\r\n   $oOption = new cHTMLOptionElement(mi18n("HTML and text"), "html");\r\n   $oSelMsgType->addOptionElement(2, $oOption);\r\n   $oSelMsgType->setDefault($aSettings[''JoinMessageType'']);\r\n\r\n   $oCfgTable->setCell(''options_01'', 1, mi18n("Default message type:").''&nbsp;''.$oSelMsgType->render());\r\n   \r\n   // Options: Open handler article in new window?\r\n   $oCfgTable->setCell(''options_02'', 0, '''');\r\n   $oCkbNewWindow = new cHTMLCheckbox("CMS_VAR[4]", ''enabled'', '''', "CMS_VALUE[4]");\r\n   $oCfgTable->setCell(''options_02'', 1, $oCkbNewWindow->toHTML(false).mi18n("Open handler article in new window"));\r\n   $oCfgTable->setRowBgColor(''options_02'', $cfg["color"]["table_light"]);\r\n   \r\n   $oCfgTable->render(true);', '<?php\r\n   // Includes\r\n   cInclude(''classes'', ''contenido/class.clientslang.php'');\r\n   cInclude(''classes'', ''class.htmlelements.php'');\r\n   cInclude(''classes'', ''class.template.php'');\r\n\r\n   // Initialisation\r\n   $oClientLang = new cApiClientLanguage(false, $client, $lang);\r\n\r\n   /*\r\n   *  Used variables:\r\n   *  JoinSel:         Selection, which group will be joined (Default, Selected, UserSelected)\r\n   *  JoinMultiple:    If JoinSel = UserSelected then: If more than one group has been specified, select more than one\r\n   *  JoinGroups:      Selected group(s)\r\n   *  JoinMessageType: Message type for new recipients: User select (user), text or html\r\n   *  OptNewWindow:    Open handler window in new browser window?\r\n   */\r\n   $aSettings   = array();\r\n   $aSettings[''JoinSel'']         = $oClientLang->getProperty(''newsletter'', ''joinsel'');\r\n   $aSettings[''JoinMultiple'']    = $oClientLang->getProperty(''newsletter'', ''joinmultiple'');\r\n   $aSettings[''JoinGroups'']      = $oClientLang->getProperty(''newsletter'', ''joingroups'');\r\n   $aSettings[''JoinMessageType''] = $oClientLang->getProperty(''newsletter'', ''joinmessagetype'');\r\n   $aSettings[''OptNewWindow'']    = "CMS_VALUE[4]";\r\n\r\n   $sTemplate = ''newsletter_form.html'';\r\n\r\n   if ($aSettings["JoinSel"] == "" || ($aSettings["JoinSel"] == "UserSelected" && $aSettings["JoinGroups"] == "")) {\r\n      $aSettings["JoinSel"]= "Default";\r\n   }\r\n\r\n   if (!is_object($oPage)) {\r\n      $oPage = new Template;\r\n   }\r\n   $oPage->reset();\r\n\r\n   $oPage->set(''s'', ''FORM_ACTION'', ''front_content.php?changelang=''.$lang.''&amp;idcatart=''.\r\n                                   $oClientLang->getProperty(''newsletter'', ''idcatart''));\r\n   unset ($oClientLang);\r\n\r\n   if ($aSettings["OptNewWindow"]) {\r\n      $oPage->set(''s'', ''FORM_TARGET'', '' target="_blank"'');\r\n   } else {\r\n      $oPage->set(''s'', ''FORM_TARGET'', '''');\r\n   }\r\n   $oPage->set(''s'', ''EMAILNAME'', mi18n("Name"));\r\n   $oPage->set(''s'', ''EMAIL'',     mi18n("E-Mail"));\r\n\r\n   $sTmpHTML = "";\r\n   if ($aSettings["JoinSel"] == "UserSelected") {\r\n      cInclude("classes", "class.newsletter.groups.php"); // Late include to increase performance\r\n\r\n      $oRcpGroups = new RecipientGroupCollection;\r\n      $oRcpGroups->setWhere(''idclient'', $client);\r\n      $oRcpGroups->setWhere(''idlang'',   $lang);\r\n      $oRcpGroups->setWhere(''defaultgroup'', ''0'');\r\n      $oRcpGroups->setWhere(''idnewsgroup'', explode('','', $aSettings["JoinGroups"]), ''IN'');\r\n      $oRcpGroups->setOrder(''groupname ASC'');\r\n      $oRcpGroups->query();\r\n\r\n      #$oRcpGroups->select("idclient = ''$client'' AND idlang = ''$lang'' AND defaultgroup = ''0'' AND idnewsgroup IN (".$aSettings["JoinGroups"].")","", "groupname ASC");\r\n\r\n      if ($oRcpGroups->Count() > 0) {\r\n         $oLblGroupSel = new cHTMLLabel(mi18n("Select"), "selNewsletterGroup");\r\n\r\n         $oSelGroup = new cHTMLSelectElement("selNewsletterGroup[]", "", "selNewsletterGroup");\r\n         $oSelGroup->setSize(2);\r\n         $oSelGroup->setClass("");\r\n\r\n         if ($aSettings["JoinMultiple"] == "enabled") {\r\n            $oSelGroup->setMultiselect();\r\n         }\r\n         \r\n         while ($oRcpGroup = $oRcpGroups->next())\r\n         {\r\n            $iID = $oRcpGroup->get("idnewsgroup");\r\n            $oOption = new cHTMLOptionElement ($oRcpGroup->get("groupname"), $iID);\r\n            $oSelGroup->addOptionElement($iID, $oOption);\r\n         }\r\n\r\n         $sTmpHTML .= ''         ''.$oLblGroupSel->toHTML()."\\n";\r\n         $sTmpHTML .= ''         ''.$oSelGroup->render()."\\n";\r\n         $sTmpHTML .= ''         <br class="y"/>'';\r\n      }\r\n   }\r\n   // You may like to add here additional rows for fields used in recipient- or frontenduser-plugins\r\n   // $sTmpHTML .= ''...'';\r\n\r\n   if ($aSettings[''JoinMessageType''] == ''user'')\r\n   {\r\n         $oLblType = new cHTMLLabel(mi18n("Type"), "selNewsletterType");\r\n\r\n         $oSelType = new cHTMLSelectElement("selNewsletterType", "", "selNewsletterType");\r\n         $oSelType->setSize(1);\r\n         $oSelType->setClass("");\r\n         \r\n         $oOption = new cHTMLOptionElement (mi18n("Text only"), 0);\r\n         $oSelType->addOptionElement(0, $oOption);\r\n         $oOption = new cHTMLOptionElement (mi18n("HTML"), 1);\r\n         $oSelType->addOptionElement(1, $oOption);\r\n\r\n         $sTmpHTML .= ''         ''.$oLblType->toHTML()."\\n";\r\n         $sTmpHTML .= ''         ''.$oSelType->render()."\\n";\r\n         $sTmpHTML .= ''         <br class="y"/>'';\r\n   }\r\n   $oPage->set(''s'', ''EXTRAHTML'', $sTmpHTML);\r\n\r\n   $oPage->set(''s'', ''NEWSLETTER'', mi18n("Newsletter"));\r\n   $oPage->set(''s'', ''SUBSCRIBE'',  mi18n("Subscribe"));\r\n   $oPage->set(''s'', ''DELETE'',     mi18n("Unsubscribe"));\r\n\r\n   $oPage->set(''s'', ''GO'',   mi18n("Go"));\r\n   $oPage->set(''s'', ''JOIN'', mi18n("Join"));\r\n\r\n   $oPage->generate(''templates/''.$sTemplate);\r\n?>', '', '0', '', '', 'sysadmin', '2005-10-24 17:21:20', '2005-11-01 14:28:47');
INSERT INTO !PREFIX!_mod VALUES('47', '1', 'Newsletter Handler', '', 'none', 'Newsletter Handler Module V4.0.0 (for text and HTML newsletters)\r\n\r\nProvides multilanguage handling for newsletter subscribing, cancellation and other features.\r\n\r\nBased on the work of 4fb, www.x28.de, HerrB, 01.05.2007\r\n\r\nNotes:\r\n- The default language is english. Use the translation functionality to translate the module in other languages\r\n- Create a template which includes this module and create an article using that template.\r\n- Configure category/arcticle specifying handler article id', '0', '   cInclude(''classes'',  ''class.htmlelements.php'');\r\n   cInclude(''classes'',  ''contenido/class.clientslang.php'');\r\n   cInclude(''classes'',  ''contenido/class.client.php'');\r\n   cInclude(''classes'',  ''class.newsletter.groups.php'');\r\n   cInclude(''classes'',  ''class.newsletter.recipients.php'');\r\n   cInclude(''frontend'', ''includes/class.input.helper.php''); # Note, this file is located in <client-path>/includes!\r\n\r\n   // Initialisation\r\n   $oClientLang = new cApiClientLanguage(false, $client, $lang);\r\n   $oClient     = new cApiClient($client);\r\n\r\n   /*\r\n   *  Used variables:\r\n   *  JoinSel:         Selection, which group will be joined (Default, Selected, User specified)\r\n   *  JoinMultiple:    If JoinSel = UserSelected then: More than one group may be selected\r\n   *  JoinGroups:      Selected group(s)\r\n   *  JoinMessageType: Message type for new recipients: User select (user), text or html\r\n   *  FrontendLink:    Link to Frontend Users enabled?\r\n   *  FrontendConfirm: Confirmation of newsletter subscription means: Activate frontend account, nothing\r\n   *  FrontendDel:     Cancellation of newsletter subscription means: Delete frontend account, Deactivate account, nothing\r\n   *  SenderEMail:     Sender e-mail address\r\n   *  HandlerID:       ID of handler article\r\n   *  ChangeEMailID:   ID of change e-mail handler article\r\n   */\r\n   $aSettings   = array();\r\n   $aSettings[''JoinSel'']         = $oClientLang->getProperty(''newsletter'', ''joinsel'');\r\n   $aSettings[''JoinMultiple'']    = $oClientLang->getProperty(''newsletter'', ''joinmultiple'');\r\n   $aSettings[''JoinGroups'']      = $oClientLang->getProperty(''newsletter'', ''joingroups'');\r\n   $aSettings[''JoinMessageType''] = $oClientLang->getProperty(''newsletter'', ''joinmessagetype'');\r\n   $aSettings[''FrontendLink'']    = $oClient->getProperty(''newsletter'', ''frontendlink''); # Note: Stored for client, as frontendusers are language independent\r\n   $aSettings[''FrontendConfirm''] = "CMS_VALUE[5]";\r\n   $aSettings[''FrontendDel'']     = "CMS_VALUE[6]";\r\n   $aSettings[''SenderEMail'']     = $oClient->getProperty(''global'', ''sender-email''); # This one could be recycled by other modules...\r\n\r\n   // Setting default values\r\n   // If there is no selection option set or if no groups has been selected, activate option Default\r\n   if ($aSettings[''JoinSel''] == '''' || $aSettings[''JoinGroups''] == '''') {\r\n      $aSettings[''JoinSel''] = "Default";\r\n   }\r\n   if ($aSettings[''FrontendConfirm''] == '''') {\r\n      $aSettings[''FrontendConfirm''] = "ActivateUser";\r\n   }\r\n   if ($aSettings[''FrontendDel''] == '''') {\r\n      $aSettings[''FrontendDel''] = "DeleteUser";\r\n   }\r\n   if (!is_numeric($_REQUEST[''selHandlerCatArt''.$cnumber]) || $_REQUEST[''selHandlerCatArt''.$cnumber] < 0) {\r\n      $_REQUEST[''selHandlerCatArt''.$cnumber] = 0;\r\n   }\r\n\r\n   // Saving changes, if any\r\n   if ($_REQUEST[''hidAction''.$cnumber] == ''save'')\r\n   {\r\n      if ($_REQUEST[''radJoin''.$cnumber] != '''' && $_REQUEST[''radJoin''.$cnumber] != $aSettings[''JoinSel''])\r\n      {\r\n         $aSettings[''JoinSel''] = $_REQUEST[''radJoin''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joinsel'', $aSettings[''JoinSel'']);\r\n      }\r\n      if ($_REQUEST[''ckbJoinMultiple''.$cnumber] != $aSettings[''JoinMultiple''])\r\n      {\r\n         $aSettings[''JoinMultiple''] = $_REQUEST[''ckbJoinMultiple''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joinmultiple'', $aSettings[''JoinMultiple'']);\r\n      }\r\n      if ($_REQUEST[''hidJoinGroups''.$cnumber] != '''' && $_REQUEST[''hidJoinGroups''.$cnumber] != $aSettings[''JoinGroups''])\r\n      {\r\n         $aSettings[''JoinGroups''] = $_REQUEST[''hidJoinGroups''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joingroups'', $aSettings[''JoinGroups'']);\r\n      }\r\n      if ($_REQUEST[''selMessageType''.$cnumber] != $aSettings[''JoinMessageType''])\r\n      {\r\n         $aSettings[''JoinMessageType''] = $_REQUEST[''selMessageType''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joinmessagetype'', $aSettings[''JoinMessageType'']);\r\n      }\r\n      if ($_REQUEST[''ckbFrontendLink''.$cnumber] != $aSettings[''FrontendLink''])\r\n      {\r\n         $aSettings[''FrontendLink''] = $_REQUEST[''ckbFrontendLink''.$cnumber];\r\n         $oClient->setProperty(''newsletter'', ''frontendlink'', $aSettings[''FrontendLink'']);\r\n      }\r\n\r\n      if ($_REQUEST[''ckbUpdateHandlerID''.$cnumber] == ''enabled'')\r\n      {\r\n         // Trick: If UpdateHandlerID is enabled, save id as client setting\r\n         $iHandlerCatArt = $_REQUEST[''selHandlerCatArt''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''idcatart'', $iHandlerCatArt);\r\n      }\r\n      \r\n      if (isValidMail($_REQUEST[''txtSender''.$cnumber]) && $_REQUEST[''txtSender''.$cnumber] != $aSettings[''SenderEMail''])\r\n      {\r\n         $aSettings[''SenderEMail''] = $_REQUEST[''txtSender''.$cnumber];\r\n         $oClient->setProperty(''global'', ''sender-email'', $aSettings[''SenderEMail'']);\r\n      }\r\n   }\r\n\r\n   // Getting current handler article id\r\n   $iHandlerCatArt = $oClientLang->getProperty(''newsletter'', ''idcatart'');\r\n   unset ($oClientLang);\r\n   unset ($oClient);\r\n\r\n   // Show options\r\n   $oCfgTable = new UI_Config_Table;\r\n\r\n   $oHidAction        = new cHTMLHiddenField(''hidAction''.$cnumber, ''save'');\r\n   \r\n   $oTxtSender = new cHTMLTextbox("txtSender".$cnumber, $aSettings[''SenderEMail''], 30);\r\n\r\n   $oCfgTable->setCell(''sender'', 0, mi18n("Sender e-mail:"));\r\n   $oCfgTable->setCell(''sender'', 1, $oHidAction->render().$oTxtSender->render());\r\n\r\n   $oSelHandlerCatArt = new cHTMLInputSelectElement(''selHandlerCatArt''.$cnumber, 1, '''', true);\r\n   $oOption           = new cHTMLOptionElement(mi18n("- Please select -"), '''');\r\n   $oSelHandlerCatArt->addOptionElement(0, $oOption);\r\n   $oSelHandlerCatArt->addCategories(0, true, false, false, true, true);\r\n   $oSelHandlerCatArt->setDefault($iHandlerCatArt);\r\n\r\n   $oCkbUpdate        = new cHTMLCheckbox(''ckbUpdateHandlerID''.$cnumber, ''enabled'');\r\n   $oCkbUpdate->setEvent(''click'', ''if (this.checked) {document.forms[0].selHandlerCatArt''.$cnumber.''.disabled = false;} else {document.forms[0].selHandlerCatArt''.$cnumber.''.disabled = true;}'');\r\n\r\n   $oCfgTable->setCell(''handler'', 0, mi18n("Handler Article:"));\r\n   $oCfgTable->setCell(''handler'', 1, $oSelHandlerCatArt->render()."\\n&nbsp;".$oCkbUpdate->toHTML(false).mi18n("Update"));\r\n\r\n   // Getting newsletter groups (if any)\r\n   $oRcpGroups = new RecipientGroupCollection;\r\n   $oRcpGroups->setWhere(''idclient'', $client);\r\n   $oRcpGroups->setWhere(''idlang'',   $lang);\r\n   $oRcpGroups->setWhere(''defaultgroup'', ''0'');\r\n   $oRcpGroups->setOrder(''defaultgroup DESC, groupname ASC'');\r\n   $oRcpGroups->query();\r\n   \r\n   // Join options\r\n   // If newsletter groups are available, provide group options, otherwise show only\r\n   // ''Default'' option. This is necessary, as there may have been groups specified (and used)\r\n   // but they have been deleted, later on.\r\n   \r\n   $oCfgTable->setCell(''join_01'', 0, mi18n("Join:"));\r\n   \r\n   if ($oRcpGroups->Count() == 0) {\r\n      // No groups available, only default group possible\r\n   \r\n      $oRadJoinDefault = new cHTMLRadioButton (''radJoin''.$cnumber, ''Default'', '''', true);\r\n      $oCfgTable->setCell(''join_01'', 1, $oRadJoinDefault->toHTML(false).mi18n("default group"));\r\n   } else {\r\n      // Groups available, show different group join options\r\n   \r\n      // Join default group only\r\n      if ($aSettings[''JoinSel''] == ''Default'') {\r\n         $oRadJoinDefault = new cHTMLRadioButton (''radJoin''.$cnumber, ''Default'', '''', true);\r\n      } else {\r\n         $oRadJoinDefault = new cHTMLRadioButton (''radJoin''.$cnumber, ''Default'');\r\n      }\r\n      $oRadJoinDefault->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = true; document.forms[0].selGroup".$cnumber.".disabled = true;");\r\n      $oCfgTable->setCell(''join_01'', 1, $oRadJoinDefault->toHTML(false).mi18n("default group"));\r\n      $oCfgTable->setRowBgColor(''join_01'', $cfg["color"]["table_dark"]);\r\n   \r\n      // Join admin selected groups automatically\r\n      if ($aSettings[''JoinSel''] == ''Selected'') {\r\n         $oRadJoinSelected = new cHTMLRadioButton (''radJoin''.$cnumber, ''Selected'', '''', true);\r\n      } else {\r\n         $oRadJoinSelected = new cHTMLRadioButton (''radJoin''.$cnumber, ''Selected'');\r\n      }\r\n      $oRadJoinSelected->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = false; document.forms[0].selGroup".$cnumber.".disabled = false;");\r\n      $oCfgTable->setCell(''join_02'', 0, '''');\r\n      $oCfgTable->setCell(''join_02'', 1, $oRadJoinSelected->toHTML(false).mi18n("selected group(s)"));\r\n      $oCfgTable->setRowBgColor(''join_02'', $cfg["color"]["table_dark"]);\r\n   \r\n      // Join the groups the user has selected (-> provide a list for the user), optionally, the user may select more than one group\r\n      if ($aSettings[''JoinSel''] == ''UserSelected'')\r\n      {\r\n         $oRadJoinUserSel  = new cHTMLRadioButton (''radJoin''.$cnumber, ''UserSelected'', '''', true);\r\n         $oCkbJoinMultiple = new cHTMLCheckbox (''ckbJoinMultiple''.$cnumber, ''enabled'', '''', $aSettings[''JoinMultiple'']);\r\n      } else {\r\n         $oRadJoinUserSel  = new cHTMLRadioButton (''radJoin''.$cnumber, ''UserSelected'');\r\n         $oCkbJoinMultiple = new cHTMLCheckbox (''ckbJoinMultiple''.$cnumber, ''enabled'', '''', false, true);\r\n      }\r\n      $oRadJoinUserSel->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = false; document.forms[0].selGroup".$cnumber.".disabled = false;");\r\n      $oCfgTable->setCell(''join_03'', 0, '''');\r\n      $oCfgTable->setCell(''join_03'', 1, $oRadJoinUserSel->toHTML(false).mi18n("group(s) as selected by user").''<br />''."\\n".$oCkbJoinMultiple->toHTML(false).mi18n("Multiple group selection allowed"));\r\n      $oCfgTable->setRowBgColor(''join_03'', $cfg["color"]["table_dark"]);\r\n   \r\n      $oCfgTable->setCell(''groups'', 0, mi18n("Select group(s):"));\r\n   \r\n      // Show groups\r\n      // Trick: To save multiple selections in <select>-Element, add some JS which saves the\r\n      // selection, comma separated in a hidden input field on change.\r\n      $sSkript = ''              <script type="text/javascript"><!--''."\\n".\r\n                 ''                  function fncUpdateSel() {''."\\n".\r\n                 ''                     var strSel = "";''."\\n".\r\n                 ''                     for(i = 0; i < document.forms[0].selGroup''.$cnumber.''.length; i++) {''."\\n".\r\n                 ''                        if(document.forms[0].selGroup''.$cnumber.''.options[i].selected == true) {''."\\n".\r\n                 ''                           if (strSel != "")''."\\n".\r\n                 ''                              strSel = strSel + ",";''."\\n".\r\n                 ''                           strSel = strSel + document.forms[0].selGroup''.$cnumber.''.options[i].value;''."\\n".\r\n                 ''                        }''."\\n".\r\n                 ''                     }''."\\n".\r\n                 ''                     document.forms[0].elements["hidJoinGroups''.$cnumber.''"].value = strSel;''."\\n".\r\n                 ''                  }''."\\n".\r\n                 ''                  //--></script>''."\\n";\r\n\r\n      if ($aSettings[''JoinSel''] == ''Default'') {\r\n         $oSelGroup = new cHTMLSelectElement (''selGroup''.$cnumber, '''', '''', true);\r\n      } else {\r\n         $oSelGroup = new cHTMLSelectElement (''selGroup''.$cnumber, '''');\r\n      }\r\n      $oSelGroup->setSize(5);\r\n      $oSelGroup->setMultiselect();\r\n      $oSelGroup->setEvent(''change'', "fncUpdateSel()");\r\n\r\n      $aGroups = explode('','', $aSettings[''JoinGroups'']);\r\n      while ($oRcpGroup = $oRcpGroups->next()) {\r\n         $iID = $oRcpGroup->get(''idnewsgroup'');\r\n         if (in_array ($iID, $aGroups)) {\r\n            $oOption = new cHTMLOptionElement($oRcpGroup->get(''groupname''), $iID, true);\r\n         } else {\r\n            $oOption = new cHTMLOptionElement($oRcpGroup->get(''groupname''), $iID, false);\r\n         }\r\n         $oSelGroup->addOptionElement($iID, $oOption);\r\n      }\r\n   \r\n      $oHidGroups = new cHTMLHiddenField (''hidJoinGroups''.$cnumber, $aSettings[''JoinGroups'']);\r\n      $oCfgTable->setCell(''groups'', 1, $sSkript.$oSelGroup->render().$oHidGroups->render());\r\n   }\r\n   \r\n   // Options: Message type (user [->selectbox], text or html)\r\n   $oCfgTable->setCell(''options_01'', 0, mi18n("Options:"));\r\n\r\n   $oSelMsgType = new cHTMLSelectElement (''selMessageType''.$cnumber);\r\n   $oOption = new cHTMLOptionElement(mi18n("User selected"), "user");\r\n   $oSelMsgType->addOptionElement(0, $oOption);\r\n   $oOption = new cHTMLOptionElement(mi18n("Text only"), "text");\r\n   $oSelMsgType->addOptionElement(1, $oOption);\r\n   $oOption = new cHTMLOptionElement(mi18n("HTML and text"), "html");\r\n   $oSelMsgType->addOptionElement(2, $oOption);\r\n   $oSelMsgType->setDefault($aSettings[''JoinMessageType'']);\r\n\r\n   $oCfgTable->setCell(''options_01'', 1, mi18n("Default message type:").''&nbsp;''.$oSelMsgType->render());\r\n\r\n   // Frontend Link\r\n   $oCfgTable->setCell(''link_01'', 0, mi18n("Frontend Users:"));\r\n   $oCkbLink = new cHTMLCheckbox(''ckbFrontendLink''.$cnumber, ''enabled'', '''', $aSettings[''FrontendLink'']);\r\n   \r\n   $sSkript = "if (this.checked) {\r\n                  document.forms[0].elements[''CMS_VAR[5]''][0].disabled = false;\r\n                  document.forms[0].elements[''CMS_VAR[5]''][1].disabled = false;\r\n                  document.forms[0].elements[''CMS_VAR[6]''][0].disabled = false;\r\n                  document.forms[0].elements[''CMS_VAR[6]''][1].disabled = false;\r\n                  document.forms[0].elements[''CMS_VAR[6]''][2].disabled = false;\r\n               } else {\r\n                  document.forms[0].elements[''CMS_VAR[5]''][0].disabled = true;\r\n                  document.forms[0].elements[''CMS_VAR[5]''][1].disabled = true;\r\n                  document.forms[0].elements[''CMS_VAR[6]''][0].disabled = true;\r\n                  document.forms[0].elements[''CMS_VAR[6]''][1].disabled = true;\r\n                  document.forms[0].elements[''CMS_VAR[6]''][2].disabled = true;}";\r\n   $oCkbLink->setEvent("click", $sSkript);\r\n\r\n   $oCfgTable->setCell(''link_01'', 1, $oCkbLink->toHTML(false).mi18n("Activate Link"));\r\n   $oCfgTable->setRowBgColor(''link_01'', $cfg["color"]["table_light"]);\r\n   \r\n   // Link: Activation options\r\n   $oCfgTable->setCell(''link_02'', 0, '''');\r\n   \r\n   switch ($aSettings[''FrontendConfirm''])\r\n   {\r\n      case "Nothing":\r\n         $oRadActivateUser    = new cHTMLRadioButton ("CMS_VAR[5]", "ActivateUser", "", false);\r\n         $oRadActivateNothing = new cHTMLRadioButton ("CMS_VAR[5]", "Nothing",      "", true);\r\n         break;\r\n      default:\r\n         $oRadActivateUser    = new cHTMLRadioButton ("CMS_VAR[5]", "ActivateUser", "", true);\r\n         $oRadActivateNothing = new cHTMLRadioButton ("CMS_VAR[5]", "Nothing",      "", false);\r\n   }\r\n\r\n   switch ($aSettings[''FrontendDel''])\r\n   {\r\n      case "DisableUser":\r\n         $oRadDelDelete  = new cHTMLRadioButton ("CMS_VAR[6]", "DeleteUser",  "", false);\r\n         $oRadDelDisable = new cHTMLRadioButton ("CMS_VAR[6]", "DisableUser", "", true);\r\n         $oRadDelNothing = new cHTMLRadioButton ("CMS_VAR[6]", "Nothing",     "", false);\r\n         break;\r\n      case "Nothing":\r\n         $oRadDelDelete  = new cHTMLRadioButton ("CMS_VAR[6]", "DeleteUser",  "", false);\r\n         $oRadDelDisable = new cHTMLRadioButton ("CMS_VAR[6]", "DisableUser", "", false);\r\n         $oRadDelNothing = new cHTMLRadioButton ("CMS_VAR[6]", "Nothing",     "", true);\r\n         break;\r\n      default:\r\n         $oRadDelDelete  = new cHTMLRadioButton ("CMS_VAR[6]", "DeleteUser",  "", true);\r\n         $oRadDelDisable = new cHTMLRadioButton ("CMS_VAR[6]", "DisableUser", "", false);\r\n         $oRadDelNothing = new cHTMLRadioButton ("CMS_VAR[6]", "Nothing",     "", false);\r\n   }\r\n\r\n   if ($aSettings[''FrontendLink''] == '''')\r\n   {\r\n      $oRadActivateUser->setDisabled(true);\r\n      $oRadActivateNothing->setDisabled(true);\r\n      $oRadDelDelete->setDisabled(true);\r\n      $oRadDelDisable->setDisabled(true);\r\n      $oRadDelNothing->setDisabled(true);\r\n   }\r\n   $oCfgTable->setCell(''link_02'', 1, mi18n("Confirmation means:").''<br />''.\r\n                                     $oRadActivateUser->toHTML(false).mi18n("Activate").\r\n                                     $oRadActivateNothing->toHTML(false).mi18n("No changes"));\r\n   $oCfgTable->setRowBgColor(''link_02'', $cfg["color"]["table_light"]);\r\n\r\n   // Link: Cancellation options\r\n   $oCfgTable->setCell(''link_03'', 0, '''');\r\n\r\n   $oCfgTable->setCell(''link_03'', 1, mi18n("Cancellation means:").''<br />''.\r\n                                     $oRadDelDelete->toHTML(false).mi18n("Delete").\r\n                                     $oRadDelDisable->toHTML(false).mi18n("Disable").\r\n                                     $oRadDelNothing->toHTML(false).mi18n("No changes"));\r\n   $oCfgTable->setRowBgColor(''link_03'', $cfg["color"]["table_light"]);\r\n\r\n   $oCfgTable->render(true);', '<?php\r\n   // Includes\r\n   cInclude(''classes'', ''contenido/class.clientslang.php'');\r\n   cInclude(''classes'', ''contenido/class.client.php'');\r\n   cInclude(''classes'', ''class.template.php'');\r\n   cInclude(''classes'', ''class.newsletter.recipients.php'');\r\n   cInclude(''classes'', ''class.newsletter.php'');\r\n   cInclude(''classes'', ''class.frontend.users.php'');\r\n   cInclude(''classes'', ''class.phpmailer.php'');\r\n\r\n   // Initialisation\r\n   $oClientLang = new cApiClientLanguage(false, $client, $lang);\r\n   $oClient     = new cApiClient($client);\r\n   $oRecipients = new RecipientCollection;\r\n   $sMessage = "&nbsp;";\r\n   unset($recipient); // Unset any existing recipient objects - note, that it must be $recipient for the plugins...\r\n\r\n   $aSettings   = array();\r\n   $aSettings[''JoinSel'']         = $oClientLang->getProperty(''newsletter'', ''joinsel'');\r\n   $aSettings[''JoinMultiple'']    = $oClientLang->getProperty(''newsletter'', ''joinmultiple'');\r\n   $aSettings[''JoinGroups'']      = $oClientLang->getProperty(''newsletter'', ''joingroups'');\r\n   $aSettings[''JoinMessageType''] = $oClientLang->getProperty(''newsletter'', ''joinmessagetype'');\r\n   $aSettings[''FrontendLink'']    = $oClient->getProperty(''newsletter'', ''frontendlink''); # Note: Stored for client, as frontendusers are language independent\r\n   $aSettings[''FrontendConfirm''] = "CMS_VALUE[5]";\r\n   $aSettings[''FrontendDel'']     = "CMS_VALUE[6]";\r\n   $aSettings[''SenderEMail'']     = $oClient->getProperty(''global'', ''sender-email''); # This one could be recycled by other modules...\r\n   $aSettings[''HandlerID'']       = $oClientLang->getProperty(''newsletter'', ''idcatart'');\r\n   \r\n   $sTemplate = ''newsletter_handler.html'';\r\n   \r\n   if (!is_object($oPage)) {\r\n      $oPage = new Template;\r\n   }\r\n   $oPage->reset();\r\n\r\n   // If there is no selection option set or if no groups has been selected, activate option Default\r\n   if ($aSettings[''JoinSel''] == '''' || $aSettings[''JoinGroups''] == '''') {\r\n      $aSettings[''JoinSel''] = "Default";\r\n   }\r\n   if ($aSettings[''FrontendConfirm''] == '''') {\r\n      $aSettings[''FrontendConfirm''] = "ActivateUser";\r\n   }\r\n   if ($aSettings[''FrontendDel''] == '''') {\r\n      $aSettings[''FrontendDel''] = "DeleteUser";\r\n   }\r\n\r\n   if ($_POST[''action''] == "subscribe") {\r\n      if (!isset($_POST[''email'']) || !$_POST[''email'']) {\r\n         $sMessage = mi18n("Please specify an e-mail address.");\r\n      } elseif (!isValidMail($_POST[''email'']) || strpos($_POST[''email''], ",") != false || strpos($_POST[''email''], ";") != false) {\r\n         $sMessage = mi18n("Please specify a valid e-mail address.");\r\n      } elseif ($oRecipients->emailExists($_POST[''email''])) {\r\n         $sMessage = mi18n("This e-mail address has been already registered for the newsletter.");\r\n      } else {\r\n         $sEMail = ereg_replace("\\n", "", stripslashes($_POST[''email'']));\r\n         $sEMail = ereg_replace("\\r", "", $sEMail);\r\n         $sName  = stripslashes($_POST["emailname"]);\r\n\r\n         // Which newsletter type should the recipient receive?\r\n         switch ($aSettings[''JoinMessageType''])\r\n         {\r\n            case "user":\r\n               if ($_POST["selNewsletterType"] == 1) {\r\n                  $iMessageType = 1; // html\r\n               } else {\r\n                  $iMessageType = 0; // text\r\n               }\r\n               break;\r\n            case "html":\r\n               $iMessageType = 1; // html\r\n               break;\r\n            default:\r\n               $iMessageType = 0; // Default: text\r\n         }\r\n\r\n         // Analyze group specification\r\n         switch ($aSettings[''JoinSel''])\r\n         {\r\n            case "Selected":\r\n               $recipient = $oRecipients->create($sEMail, $sName, 0, $aSettings[''JoinGroups''], $iMessageType);\r\n               break;\r\n            case "UserSelected":\r\n               $iSelCount = count($_POST[''selNewsletterGroup'']);\r\n   \r\n               if ($iSelCount == 0) {\r\n                  $recipient = $oRecipients->create($sEMail, $sName, 0, "", $iMessageType); // No group selected\r\n               } else {\r\n                  if ($iSelCount > 1 && $aSettings[''JoinMultiple''] != "enabled") {\r\n                     $sMessage = mi18n("Please select one group, only.");\r\n                  } else {\r\n                     // Recipient wants to join special groups\r\n                     $aGroups = explode(",", $aSettings[''JoinGroups'']);\r\n\r\n                     /* Check, if received data is valid and matches the group selection */\r\n                     $bError = false;\r\n                     foreach ($_POST[''selNewsletterGroup''] as $iIDGroup)\r\n                     {\r\n                        if (!is_numeric($iIDGroup) || !in_array($iIDGroup, $aGroups))\r\n                        {\r\n                           $bError = true;\r\n                           break;\r\n                        }\r\n                     }\r\n\r\n                     if ($bError) {\r\n                        $sMessage = mi18n("There was an error processing your request. Please ask the webmaster for help.");\r\n                     } else {\r\n                        $recipient = $oRecipients->create($sEMail, $sName, 0, implode(",", $_POST[''selNewsletterGroup'']));\r\n                     }\r\n                  }\r\n               }\r\n               break;\r\n            default:\r\n               $recipient = $oRecipients->create($sEMail, $sName, 0, "", $iMessageType);\r\n         }\r\n\r\n         if ($recipient)\r\n         {\r\n            // Add here code, if you like to store additional information per >recipient< (see frontenduser below)\r\n            // Example: $recipient->setProperty("contact", "firstname", $_REQUEST["firstname"]);\r\n            // contact/firstname have to match the values used in the firstname-recipient-plugin\r\n            // $_REQUEST["firstname"] contains the data from the input-field firstname in the\r\n            // Form module (-> there has to be a field with this name)\r\n            // Note: You should check the values you get (safety)!!!\r\n\r\n            $sBody = mi18n("txtMailSubscribe")."\\n".$cfgClient[$client][''path''][''htmlpath'']."front_content.php?changelang=".$lang."&idcatart=".$aSettings[''HandlerID'']."&confirm=".$recipient->get("hash")."\\n\\n";\r\n\r\n            $oMail = new phpmailer();\r\n            $oMail->From     = $aSettings[''SenderEMail''];\r\n            $oMail->FromName = $aSettings[''SenderEMail''];\r\n            $oMail->AddAddress($sEMail);\r\n            $oMail->Mailer   = "mail";\r\n            $oMail->Subject  = mi18n("Newsletter: Confirmation");\r\n            $oMail->Body     = $sBody;\r\n\r\n            if($oMail->Send())\r\n            {\r\n               $sMessage = mi18n("Dear subscriber,<br>your e-mail address is now subscribed for our newsletter. You will now receive an e-mail asking you to confirm your subscription.");\r\n\r\n               if ($aSettings[''FrontendLink''] == "enabled")\r\n               {\r\n                  $oFrontendUsers = new FrontendUserCollection;\r\n\r\n                  if (!$oFrontendUsers->userExists($sEMail))\r\n                  {\r\n                     if ($frontenduser = $oFrontendUsers->create($sEMail)) // it''s "frontenduser" (instead of oFrontendUser) for plugins...\r\n                     {\r\n                        // Add here code, if you like to store additional information per >frontenduser<\r\n                        // Example: $frontenduser->setProperty("contact", "firstname", $_REQUEST["firstname"]);\r\n                        // contact/firstname have to match the values used in the firstname-frontenduser-plugin\r\n                        // $_REQUEST["firstname"] contains the data from the input-field firstname in the\r\n                        // Form module (-> there has to be a field with this name)\r\n                        // Note: You should check the values you get (safety)!!!\r\n\r\n                        if ($aSettings[''FrontendConfirm''] == "ActivateUser")\r\n                        {\r\n                           // Inform about frontend user account creation\r\n                           $sMessage .= mi18n("<br><br>After the confirmation you will also receive a password which you can use with your e-mail address to logon to special areas on this website.");\r\n                        }\r\n                     } else {\r\n                        $sMessage .= mi18n("<br><br>Sorry, there was a problem creating your website account. Please ask the webmaster for help.");\r\n                     }\r\n                  }\r\n               }\r\n            } else {\r\n               $sMessage = mi18n("Sorry, there was a problem sending the confirmation mail to your e-mail address. Please ask the webmaster for help.");\r\n            }\r\n         } else {\r\n            $sMessage = mi18n("Sorry, there was a problem subscribing your e-mail address for the newsletter. Please ask the webmaster for help.");\r\n         }\r\n      }\r\n   } elseif ($_POST[''action''] == "delete") {\r\n      if (!isset($_POST[''email'']) || !$_POST[''email'']) {\r\n         $sMessage = mi18n("Please specify an e-mail address.");\r\n      } elseif (!isValidMail($_POST[''email'']) || strpos($_POST[''email''], ",") != false || strpos($_POST[''email''], ";") != false) {\r\n         $sMessage = mi18n("Please specify a valid e-mail address.");\r\n      } elseif ($recipient = $oRecipients->emailExists($_POST[''email''])) {\r\n         $sBody = mi18n("txtMailDelete")."\\n".$cfgClient[$client][''path''][''htmlpath'']."front_content.php?changelang=".$lang."&idcatart=".$aSettings[''HandlerID'']."&unsubscribe=".$recipient->get("hash")."\\n\\n";\r\n\r\n         $oMail = new phpmailer();\r\n         $oMail->From     = $aSettings[''SenderEMail''];\r\n         $oMail->FromName = $aSettings[''SenderEMail''];\r\n         $oMail->AddAddress($recipient->get("email"));\r\n         $oMail->Mailer   = "mail";\r\n         $oMail->Subject  = mi18n("Newsletter: Cancel subscription");\r\n         $oMail->Body     = $sBody;\r\n\r\n         if($oMail->Send())\r\n         {\r\n            $sMessage = mi18n("Dear subscriber,<br>a mail has been sent to your e-mail address. Please confirm the cancelation of the newsletter subscription.");\r\n         } else {\r\n            $sMessage = mi18n("Sorry, there was a problem sending you the cancelation confirmation e-mail. Please ask the webmaster for help.");\r\n         }\r\n      } else {\r\n         $sMessage = mi18n("Sorry, the e-mail address was not found.");\r\n      }\r\n   } elseif (strlen($_GET[''confirm'']) == 30 && is_alphanumeric($_GET[''confirm''])) {\r\n      $oRecipients->setWhere("idclient", $client);\r\n      $oRecipients->setWhere("idlang", $lang);\r\n      $oRecipients->setWhere("hash", $_GET[''confirm'']);\r\n      $oRecipients->query();\r\n\r\n      if ($recipient = $oRecipients->next())\r\n      {\r\n         $iID    = $recipient->get("idnewsrcp"); // For some reason, $recipient may get invalid later on - save id\r\n         $sEMail = $recipient->get("email");     // ... and email\r\n         $recipient->set("confirmed", 1);\r\n         $recipient->set("confirmeddate", date("Y-m-d H:i:s"), false);\r\n         $recipient->set("deactivated", 0);\r\n         $recipient->store();\r\n\r\n         $sMessage = mi18n("Thank you! You have confirmed your subscription to our newsletter!");\r\n\r\n         $oNewsletters = New NewsletterCollection;\r\n         $oNewsletters->setWhere("idclient", $client);\r\n         $oNewsletters->setWhere("idlang", $lang);\r\n         $oNewsletters->setWhere("welcome", ''1'');\r\n         $oNewsletters->query();\r\n\r\n         if ($oNewsletter = $oNewsletters->next())\r\n         {\r\n            $aRecipients = array(); // Needed, as used by reference\r\n            $oNewsletter->sendDirect($aSettings[''HandlerID''], $iID, false, $aRecipients);\r\n\r\n            $sMessage .= mi18n(" The welcome newsletter is already on the way to you!");\r\n         }\r\n         \r\n         if ($aSettings[''FrontendLink''] == "enabled" && $aSettings[''FrontendConfirm''] == "ActivateUser")\r\n         {\r\n            $oFrontendUsers = new FrontendUserCollection;\r\n            $oFrontendUsers->setWhere("idclient", $client);\r\n            $oFrontendUsers->setWhere("username", $sEMail);\r\n            $oFrontendUsers->query();\r\n\r\n            if ($frontenduser = $oFrontendUsers->next())\r\n            {\r\n               $frontenduser->set("active", 1);\r\n               $sPassword = substr(md5(rand()),0,8); // Generating password\r\n               $frontenduser->set("password", $sPassword);\r\n               $frontenduser->store();\r\n\r\n               $sMessage .= mi18n("<br><br>Additionally, your website account has been activated. You can now use the following username and password to log in to access special areas on our website:<br>");\r\n               $sMessage .= mi18n("Username: ").$sEMail.mi18n("<br>Password: ").$sPassword;\r\n   \r\n               $sBody = mi18n("txtMailPassword")."\\n\\n".mi18n("Username: ").$sEMail."\\n".mi18n("Password: ").$sPassword."\\n\\n".mi18n("Click here to login: ").$cfgClient[$client][''path''][''htmlpath'']."front_content.php?changelang=".$lang;\r\n\r\n               $oMail           = new phpmailer();\r\n               $oMail->From     = $aSettings[''SenderEMail''];\r\n               $oMail->FromName = $aSettings[''SenderEMail''];\r\n               $oMail->AddAddress($sEMail);\r\n               $oMail->Mailer   = "mail";\r\n               $oMail->Subject  = mi18n("Website account");\r\n               $oMail->Body     = $sBody;\r\n\r\n               if($oMail->Send())\r\n               {\r\n                  $sMessage .= mi18n("<br><br>The account details and the password has also been sent to your mail account.");\r\n               } else {\r\n                  $sMessage .= mi18n("<br><br><b>Sorry, there was a problem sending you the account details by mail. Please remember the given password.</b><b>");\r\n               }\r\n            } else {\r\n               $sMessage .= mi18n("<br><br>Sorry, there was a problem activating your website account, also. Please ask the webmaster for help.");\r\n            }\r\n         }\r\n      } else {\r\n         $sMessage = mi18n("Sorry, there was a problem confirming your subscription. Please ask the webmaster for help.");\r\n      }\r\n   } elseif (strlen($_GET[''stop'']) == 30 && is_alphanumeric($_GET[''stop''])) {\r\n      $oRecipients->setWhere("idclient", $client);\r\n      $oRecipients->setWhere("idlang", $lang);\r\n      $oRecipients->setWhere("hash", $_GET[''stop'']);\r\n      $oRecipients->query();\r\n\r\n      if ($recipient = $oRecipients->next())\r\n      {\r\n         $recipient->set("deactivated", 1);\r\n         $recipient->store();\r\n\r\n         $sMessage = mi18n("Your newsletter subscription has been paused.");\r\n      } else {\r\n         $sMessage = mi18n("Sorry, there was a problem pausing your newsletter subscription. Please ask the webmaster for help.");\r\n      }\r\n   } elseif (strlen($_GET[''goon'']) == 30 && is_alphanumeric($_GET[''goon''])) {\r\n      $oRecipients->setWhere("idclient", $client);\r\n      $oRecipients->setWhere("idlang", $lang);\r\n      $oRecipients->setWhere("hash", $_GET[''goon'']);\r\n      $oRecipients->query();\r\n\r\n      if ($recipient = $oRecipients->next())\r\n      {\r\n         $recipient->set("deactivated", 0);\r\n         $recipient->store();\r\n\r\n         $sMessage = mi18n("Newsletter subscription has been resumed.");\r\n      } else {\r\n         $sMessage = mi18n("Sorry, there was a problem resuming your newsletter subscription. Please ask the webmaster for help.");\r\n      }\r\n   } elseif (strlen($_GET[''unsubscribe'']) == 30 && is_alphanumeric($_GET[''unsubscribe''])) {\r\n      $oRecipients->setWhere("idclient", $client);\r\n      $oRecipients->setWhere("idlang", $lang);\r\n      $oRecipients->setWhere("hash", $_GET[''unsubscribe'']);\r\n      $oRecipients->query();\r\n      \r\n      if ($recipient = $oRecipients->next()) {\r\n         $sEMail = $recipient->get("email"); // Saving recipient e-mail address for frontend account\r\n         $oRecipients->delete($recipient->get("idnewsrcp"));\r\n\r\n         $sMessage = mi18n("Your e-mail address has been removed from our list of newsletter recipients.");\r\n\r\n         if ($aSettings[''FrontendLink''] == "enabled")\r\n         {\r\n            $oFrontendUsers = new FrontendUserCollection;\r\n            $oFrontendUsers->setWhere("idclient", $client);\r\n            $oFrontendUsers->setWhere("username", $sEMail);\r\n            $oFrontendUsers->query();\r\n\r\n            if ($frontenduser = $oFrontendUsers->next())\r\n            {\r\n               switch ($aSettings[''FrontendDel''])\r\n               {\r\n                  case "DeleteUser": // Deleting frontend account\r\n                     $oFrontendUsers->delete($frontenduser->get("idfrontenduser"));\r\n                     $sMessage .= mi18n(" Your website account has been deleted.");\r\n                     break;\r\n                  case "DisableUser": // Disabling frontend account\r\n                     $frontenduser->set("active", 0);\r\n                     $frontenduser->store();\r\n                     $sMessage .= mi18n(" Your website account has been disabled.");\r\n                     break;\r\n                  default:\r\n               }\r\n            }\r\n         }\r\n      } else {\r\n         $sMessage = mi18n("Sorry, there was a problem removing your e-mail address. Please ask the webmaster for help.");\r\n      }\r\n   }\r\n\r\n   $oPage->set(''s'', ''CONTENT'', $sMessage);\r\n   $oPage->generate(''templates/''.$sTemplate);\r\n?>', '', '0', '', '', 'sysadmin', '2005-10-24 17:22:10', '2005-11-01 14:27:07');