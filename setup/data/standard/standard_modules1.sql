INSERT INTO !PREFIX!_mod VALUES (1, 1, 'Article_Include', 'article_include','Content', 'none', 'This module includes an article into an other\n\nAuthor: Willi Man, Andreas Lindner, 4fb, B. Behrens\nVersion: 1.1', NULL, '?><?php\n/**\n* $RCSfile$\n*\n* Description: Article Include Input\n*\n* @version 1.0.0\n* @author Willi Man\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2003-12-18\n* modified 2004-01-02\n* modified 2005-08-05 Andreas Lindner\n* }}\n*\n* $Id$\n*/\n\n#Get current settings\n$name         = "CMS_VAR[1]";\n$cms_idcat    = "CMS_VALUE[1]";\n$cms_idcatart = "CMS_VALUE[2]";\n\n#Cat selector\necho buildCategorySelect($name, $cms_idcat);\n\n$bDebug = false;\nif ($bDebug)\n    echo "<pre>cat $cms_idcat catart $cms_idcatart client $client lang $lang <br>webpath ".$cfgClient[$client][''path''][''htmlpath'']."</pre>";\n\necho ''<table cellpadding="0" cellspacing="0" border="0">'';\n\n#Article selector\necho ''\n      <tr><td class="text_medium" style="padding:5px">''.mi18n("Artikel w�hlen").'': </td></tr>\n      <tr><td class="text_medium" style="padding:5px">'';\necho ''<select name="CMS_VAR[2]" style="width:240px">'';\necho ''<option value="" selected>''.i18n("Please choose").''</option>'';\n\nif ($cms_idcat != "0" && strlen($cms_idcat) > 0) {\n    $sql = "SELECT\n                        a.title AS title,\n                        b.idcatart AS idcatart\n                       FROM\n                        ".$cfg["tab"]["art_lang"]." AS a,\n                        ".$cfg["tab"]["cat_art"]." AS b\n                        WHERE\n                        b.idcat = ''".$cms_idcat."'' AND\n                        a.idart = b.idart AND\n                        a.idlang = ''".$lang."''";\n\n    $db->query($sql);\n\n    while ($db->next_record()) {\n\n        $catartid = $db->f(''idcatart'');\n        $title = $db->f(''title'');\n\n        if ($cms_idcatart != $catartid) {\n            echo ''<option value="''.$catartid.''">&nbsp;''.$title.''</option>'';\n        } else {\n            echo ''<option selected="selected" value="''.$catartid.''">&nbsp;''.$title.''</option>'';\n        }\n\n    }\n}\n\necho ''</select>&nbsp;<input type="image" src="images/submit.gif">'';\necho ''</td></tr></table>'';\n?><?php', '<?php\n/**\n* $RCSfile$\n*\n* Description: Article Include Output\n*\n* @version 1.0.0\n* @author Willi Man\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2003-12-18\n* modified 2004-01-02\n* modified 2005-08-05 Andreas Lindner\n* }}\n*\n* $Id$\n*/\n\n#Get current settings\n$cms_idcat    = "CMS_VALUE[1]";\n$cms_idcatart = "CMS_VALUE[2]";\n\n$bDebug = false;\n\n#Check data\n$cms_idcat    = (int)$cms_idcat;\n$cms_idcatart = (int)$cms_idcatart;\n\nif ($bDebug) {\n   echo "<pre> cat $cms_idcat catart $cms_idcatart</pre>";\n}\n\nif ($cms_idcat >= 0 && $cms_idcatart >= 0)\n{\n   $bArticleAvailable = false;\n   # Get idcat, idcatart, idart and lastmodified from the database\n   $sql = "SELECT A.idart AS idart, A.idcat AS idcat, A.createcode AS createcode,\n                  A.idcatart AS idcatart, B.lastmodified AS lastmodified\n           FROM ".$cfg["tab"]["cat_art"]." AS A, ".$cfg["tab"]["art_lang"]." AS B\n           WHERE\n            A.idart = B.idart AND\n            B.online = 1 AND ";\n\n   if ($cms_idcatart == 0)\n   {\n      $sql .= "A.idcat = ''" . $cms_idcat . "'' ORDER BY B.lastmodified DESC"; # Only idcat specified, get latest article of category\n   } else {\n      $sql .= "A.idcatart = ''" . $cms_idcatart . "''"; # Article specified\n   }\n\n   if ($bDebug)\n   {\n      echo "<pre>";\n      print_r($sql);\n      echo "</pre>";\n   }\n   $db->query($sql);\n\n   if ($db->next_record())\n   {\n      $bArticleAvailable = true;\n      $iIDCatArt   = $db->f("idcatart");\n      $iIDCat      = $db->f("idcat");\n      $iIDArt      = $db->f("idart");\n      $iCreateCode = $db->f("createcode");\n      $sModified   = $db->f("lastmodified");\n   }\n\n   $db->free();\n\n   # Check if category is online or protected\n   $sql = "SELECT public, visible\n           FROM " . $cfg["tab"]["cat_lang"] . "\n           WHERE idcat = ''" . $iIDCat . "'' AND idlang = ''" . $lang . "''";\n\n   if ($bDebug)\n   {\n      echo "<pre>";\n      print_r($sql);\n      echo "</pre>";\n   }\n\n   $db->query($sql);\n   $db->next_record();\n\n   $iPublic  = $db->f("public");\n   $iVisible = $db->f("visible");\n\n   $db->free();\n\n   # Check if article is online\n   # Not needed anymore, as only online articles are used\n   /* $sql = "SELECT online FROM " . $cfg["tab"]["art_lang"] . "\n           WHERE idart = ''" . $cms_artid . "'' AND idlang = ''" . $lang . "''";\n\n   if ($bDebug)\n   {\n      echo "<pre>";\n      print_r($sql);\n      echo "</pre>";\n   }\n   $db->query($sql);\n   $db->next_record();\n\n   $online = $db->f("online");\n\n   $db->free(); */\n\n   # If the article is online and the according category is not protected and visible, include the article\n   if ($bArticleAvailable && $iPublic == 1 && $iVisible == 1)\n   {\n      # Check, if code creation is necessary\n      # Note, that createcode may be 0, but no code is available (all code for other languages will be deleted in\n      # front_content, if code for one language will be created). This "bug" may be fixed in future releases.\n      if ($iCreateCode == 0)\n      {\n         $sql = "SELECT count(*) AS CodeCount FROM " . $cfg["tab"]["code"] . "\n                 WHERE idcatart = ''" . $iIDCatArt . "'' AND idlang = ''" . $lang . "''";\n\n         if ($bDebug)\n         {\n            echo "<pre>";\n            print_r($sql);\n            echo "</pre>";\n         }\n\n         $db->query($sql);\n         $db->next_record();\n\n         if ($db->f("CodeCount") == 0) {\n            $iCreateCode = 1;\n         }\n         $db->free();\n      }\n\n      # Create code if necessary\n      if ($iCreateCode == 1)\n      {\n         cInclude(''includes'', ''functions.con.php'');\n         cInclude(''includes'', ''functions.tpl.php'');\n         cInclude(''includes'', ''functions.mod.php'');\n\n         conGenerateCode($iIDCat, $iIDArt, $lang, $client);\n      }\n\n      # Get code from database and execute it\n      $sql = "SELECT code FROM " . $cfg["tab"]["code"] . "\n              WHERE idcatart = ''" . $iIDCatArt . "'' AND idlang = ''" . $lang . "''";\n\n      if ($bDebug)\n      {\n         echo "<pre>";\n         print_r($sql);\n         echo "</pre>";\n      }\n\n      $db->query($sql);\n\n      if ($db->next_record())\n      {\n         $sCode = stripslashes($db->f("code"));\n         $db->free();\n\n         ob_start();\n         eval("?>\n".$sCode."\n<?php\n");\n         $sCode = ob_get_contents();\n\n         # Clean buffer\n         ob_end_clean();\n\n         $iStartPos = strpos($sCode, "<!--start:content-->");\n         $iEndPos   = strpos($sCode, "<!--end:content-->");\n         $iDiffLen  = $iEndPos - $iStartPos;\n\n         $sCode = substr($sCode, $iStartPos, $iDiffLen);\n\n         echo $sCode;\n      } else {\n         echo "<!-- ERROR in module Article Include<pre>no code created for article to include!<br>idcat $cms_catid, idart $cms_artid, idlang $lang, idclient $client</pre>-->";\n      }\n   }\n}\n?>\n', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:49:41', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (2, 1, 'Contact_Form', 'contact_form', 'Content', 'none', 'Dispaying contact form and submitting data via mail\n\nAuthor: Andreas Lindner\nVersion: 1.0.1', NULL, '?><?php\n/**\n * $RCSfile$\n *\n * Description: Contact Form Input\n *\n * @version 1.0.2\n * @author Andreas Lindner\n * @copyright four for business AG <www.4fb.de>\n *\n * {@internal\n *   created 2005-08-12\n *   modified 2010-06-09 Ingo van Peeren\n *   modified 2011-11-09 Murat Purc, added configuration for SMTP port\n * }}\n *\n * $Id$\n */\n\n\n// generate unique id, it''s used for element id/for attributes in module\n$mId = uniqid(''m_'');\n\n?>\n\n<table border="0">\n    <tr>\n        <td><?php echo mi18n("Absender EMail");?></td>\n        <td><input type="text" name="<?php echo "CMS_VAR[0]";?>" value="<?php echo "CMS_VALUE[0]"; ?>"></td>\n    </tr>\n    <tr>\n        <td><?php echo mi18n("Absender Name");?></td>\n        <td><input type="text" name="<?php echo "CMS_VAR[2]";?>" value="<?php echo "CMS_VALUE[2]"; ?>"></td>\n    </tr>\n    <tr>\n        <td><?php echo mi18n("Empf�nger EMail");?></td>\n        <td><input type="text" name="<?php echo "CMS_VAR[1]";?>" value="<?php echo "CMS_VALUE[1]"; ?>"></td>\n    </tr>\n    <tr>\n        <td><?php echo mi18n("Betreff");?></td>\n        <td><input type="text" name="<?php echo "CMS_VAR[3]";?>" value="<?php echo "CMS_VALUE[3]"; ?>"></td>\n    </tr>\n    <?php\n    $c1 = '''';\n    $c2 = '''';\n    $c3 = '''';\n    $c4 = '''';\n    switch (strtolower("CMS_VALUE[4]")) {\n        case "smtp":\n            $c1 = '' checked'';\n            break;\n        case "mail":\n            $c2 = '' checked'';\n            break;\n        case "sendmail":\n            $c3 = '' checked'';\n            break;\n        case "qmail":\n            $c4 = '' checked'';\n            break;\n        default:\n            $c3 = '' checked'';\n    }\n    ?>\n    <tr>\n        <td valign="top"><?php echo mi18n("Mailer");?></td>\n        <td>\n            <input type="radio" name="<?php echo "CMS_VAR[4]";?>" id="<?php echo $mId ?>_mailer_mail" value="mail"<?php echo $c2;?>>\n            <label for="<?php echo $mId ?>_mailer_mail"><?php echo mi18n("mail");?></label><br />\n\n            <input type="radio" name="<?php echo "CMS_VAR[4]";?>" id="<?php echo $mId ?>_mailer_qmail" value="qmail"<?php echo $c4;?>>\n            <label for="<?php echo $mId ?>_mailer_qmail"><?php echo mi18n("qmail");?></label><br />\n\n            <input type="radio" name="<?php echo "CMS_VAR[4]";?>" id="<?php echo $mId ?>_mailer_sendmail" value="sendmail"<?php echo $c3;?>>\n            <label for="<?php echo $mId ?>_mailer_sendmail"><?php echo mi18n("sendmail");?></label><br />\n\n            <input type="radio" name="<?php echo "CMS_VAR[4]";?>" id="<?php echo $mId ?>_mailer_smtp" value="smtp"<?php echo $c1;?>>\n            <label for="<?php echo $mId ?>_mailer_smtp"><?php echo mi18n("smtp");?></label><br />\n        </td>\n    </tr>\n    <tr>\n        <td><?php echo mi18n("SMTP Host");?></td>\n        <td><input type="text" name="<?php echo "CMS_VAR[5]";?>" value="<?php echo "CMS_VALUE[5]"; ?>"></td>\n    </tr>\n    <tr>\n        <td><?php echo mi18n("SMTP User");?></td>\n        <td><input type="text" name="<?php echo "CMS_VAR[6]";?>" value="<?php echo "CMS_VALUE[6]"; ?>"></td>\n    </tr>\n    <tr>\n        <td><?php echo mi18n("SMTP Passwort");?></td>\n        <td><input type="text" name="<?php echo "CMS_VAR[7]";?>" value="<?php echo "CMS_VALUE[7]"; ?>"></td>\n    </tr>\n    <tr>\n        <td><?php echo mi18n("SMTP Port");?></td>\n        <td>\n            <input type="text" name="<?php echo "CMS_VAR[8]";?>" value="<?php echo "CMS_VALUE[8]"; ?>"><br />\n            <small><?php echo mi18n("(Standard Port is 25)");?></small>\n        </td>\n    </tr>\n</table>\n<?php', '<?php\n/**\n * $RCSfile$\n *\n * Description: Contact Form Output\n *\n * @version 1.0.2\n * @author Andreas Lindner\n * @copyright four for business AG <www.4fb.de>\n *\n * {@internal\n *   created 2005-08-12\n *   modified 2008-04-11 Rudi Bieller Changes concerning new layout\n *   modified 2011-08-03 Murat Purc, bugfix [CON-409]\n *   modified 2011-11-09 Murat Purc, added configuration for SMTP port\n * }}\n *\n * $Id$\n */\n\nif (!isset($tpl) || !is_object($tpl)) {\n    $tpl = new Template();\n} else {\n    $tpl->reset();\n}\n\n$isXHTML = getEffectiveSetting(''generator'', ''xhtml'', ''false'');\n$br = $isXHTML ? ''<br />'' : ''<br>'';\n\nif (!isset($_POST[''send''])) {\n    // Form has not been sent yet, create contact form\n\n    $amp = (''true'' == $isXHTML) ? ''&amp;'' : ''&'';\n\n    $formAction = $sess->url("front_content.php?idcat={$idcat}{$amp}idart={$idart}{$amp}parentid={$parentid}");\n    $tpl->set(''s'', ''form_action'', $formAction);\n    $tpl->set(''s'', "ANREDE", mi18n("Anrede"));\n    $tpl->set(''s'', "ANREDE_OPTION1", mi18n("Herr"));\n    $tpl->set(''s'', "ANREDE_OPTION2", mi18n("Frau"));\n    $tpl->set(''s'', "NACHNAME", mi18n("Name"));\n    $tpl->set(''s'', "VORNAME", mi18n("Vorname"));\n    $tpl->set(''s'', "FIRMA", mi18n("Firma"));\n    $tpl->set(''s'', "STRASSE", mi18n("Stra�e/Nr."));\n    $tpl->set(''s'', "PLZORT", mi18n("PLZ/Ort"));\n    $tpl->set(''s'', "TELEFON", mi18n("Telefon"));\n    $tpl->set(''s'', "EMAIL", mi18n("E-Mail"));\n    $tpl->set(''s'', "ANLIEGEN", mi18n("Nachricht"));\n    $tpl->set(''s'', "PFLICHTFELDER", mi18n("Bitte alle Felder ausf�llen"));\n    $tpl->set(''s'', "ABSCHICKEN", mi18n("abschicken"));\n    $tpl->set(''s'', "LOESCHEN", mi18n("l�schen"));\n\n    $tpl->generate($cfgClient[$client][''path''][''frontend''] . ''templates/kontaktformular.html'');\n} elseif ($_POST[''send''] == 1) {\n    // Form has been sent, check user input\n\n    $errorMsg = array();\n    if ($_POST[''Anrede''] == '''') {\n        $errorMsg[] = mi18n("Bitte w&auml;hlen Sie Anrede aus!");\n    }\n    if ($_POST[''Vorname''] == '''') {\n        $errorMsg[] = mi18n("Bitte geben Sie Ihren Vornamen ein!");\n    }\n    if ($_POST[''Nachname''] == '''') {\n        $errorMsg[] = mi18n("Bitte geben Sie Ihren Namen ein!");\n    }\n    if ($_POST[''Firma''] == '''') {\n        $errorMsg[] = mi18n("Bitte geben Sie Ihre Firma ein!");\n    }\n    if ($_POST[''Strasse''] == '''') {\n        $errorMsg[] = mi18n("Bitte geben Sie Ihre Stra&szlig;e ein!");\n    }\n    if ($_POST[''PLZOrt''] == '''') {\n        $errorMsg[] = mi18n("Bitte geben Sie Ihre PLZ/Ort ein!");\n    }\n    if ($_POST[''Telefon''] == '''') {\n        $errorMsg[] = mi18n("Bitte geben Sie Ihre Telefonnummer ein!");\n    }\n    if ($_POST[''EMail''] == '''') {\n        $errorMsg[] = mi18n("Bitte geben Sie Ihre E-Mail-Adresse ein!");\n    }\n    if ($_POST[''Nachricht''] == '''') {\n        $errorMsg[] = mi18n("Bitte geben Sie Ihre Nachricht fur uns ein!");\n    }\n\n    if (count($errorMsg) > 0) {\n        // Errors have been found\n        echo ''<p>''\n           . ''<strong>'' . mi18n("Beim Versenden sind folgende Fehler aufgetreten:") . ''</strong>'' . $br\n           . implode($br, $errorMsg) . $br\n           . ''<a href="javascript:history.back();">&lsaquo; '' . mi18n("zur&uuml;ck") . ''</a>''\n           . ''</p>'';\n    } else {\n        // No errors, create and send mail\n        $mail = new PHPMailer();\n        $mailBody = ''<html><head></head><body bgcolor="#ffffff"><table cellspacing="0" cellpadding="2" border="0">'';\n\n        if (is_array($_POST)) {\n            foreach ($_POST as $key => $value) {\n                if ($key != ''send'') {\n                    $mailBody .= "<tr><td>$key</td><td>$value</td></tr>";\n                }\n            }\n        }\n\n        $mailBody .= ''</table></bo''.''dy></html>'';\n        $mail->Host = "localhost";\n        $mail->IsHTML(true);\n\n        // Get mailer from settings\n        switch (strtolower("CMS_VALUE[4]")) {\n            case "smtp" :\n                $mail->IsSMTP();\n                $host = "CMS_VALUE[5]";\n                $user = "CMS_VALUE[6]";\n                $password = "CMS_VALUE[7]";\n                if (($host != '''') && ($user != '''') && ($password != '''')) {\n                    $mail->SMTPAuth = true;\n                    $mail->Host = $host;\n                    $mail->Username = $user;\n                    $mail->Password = $password;\n                    if (is_numeric("CMS_VALUE[8]")) {\n                        $mail->Port = (int) "CMS_VALUE[8]";\n                    }\n                }\n                break;\n            case "mail" :\n                $mail->IsMail();\n                break;\n            case "sendmail" :\n                $mail->IsSendmail();\n                break;\n            case "qmail" :\n                $mail->IsQmail();\n                break;\n            default :\n                }\n        $mail->From = "CMS_VALUE[0]";\n        $mail->FromName = "CMS_VALUE[2]";\n        $mail->AddAddress("CMS_VALUE[1]", "");\n        $mail->Subject = "CMS_VALUE[3]";\n        $mail->Body = $mailBody;\n        $mail->WordWrap = 50;\n        $mail->Send();\n\n        // Display message after mail is sent\n        echo mi18n("Ihr Anliegen wurde uns �bermittelt. Vielen Dank!") . $br;\n    }\n}\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:52:45', '2011-11-09 21:47:17');
INSERT INTO !PREFIX!_mod VALUES (3, 1, 'Contenido_Header', 'contenido_header', 'Content', 'none', 'Display HTML Comment with Infos about CONTENIDO and the Sample Client.', NULL, '', '<?php\n/**\n* $RCSfile$\n*\n* Description: Display HTML Comment with Infos about CONTENIDO and the Sample Client.\n*\n* @version 1.0.0\n* @author Rudi Bieller\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2008-04-07\n* }}\n*\n* $Id$\n*/\n\nif (!isset($tpl) || !is_object($tpl) || strtolower(get_class($tpl)) != ''template'') {\n    $tpl = new Template();\n}\n$tpl->reset();\n$tpl->generate(''templates/contenido_header.html'');\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:53:21', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (4, 1, 'Footnotes', 'footnotes', 'Content', 'none', 'Display Footnotes at bottom of page.', NULL, '', '<?php\n/**\n* $RCSfile$\n*\n* Description: Display footnotes, fixed output directly from template\n*\n* @version 1.0.0\n* @author Rudi Bieller\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2008-04-11\n* }}\n*\n* $Id$\n*/\n\nif (!isset($tpl) || !is_object($tpl)) {\n    $tpl = new Template();\n}\n\n$tpl->reset();\n$tpl->generate(''templates/footnotes_''.strval($lang).''.html'');\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:53:44', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (5, 1, 'Header', 'header', 'Content', 'none', 'Display Header with CONTENIDO Logo, an image and the current (navigation-) location.', NULL, '', '<?php\n/**\n* $RCSfile$\n*\n* Description: Display Header with CONTENIDO Logo, an image and the current (navigation-) location.\n* If no image is selected, the default one will be used.\n*\n* @version 1.0.0\n* @author Rudi Bieller\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2008-04-07\n* }}\n*\n* $Id$\n*/\n\nif (!isset($tpl) || !is_object($tpl)) {\n    $tpl = new Template();\n}\n\n// get start idcat\n$iIdcatStart = (int) getEffectiveSetting(''navigation'', ''idcat-home'', ''1'');\n\ntry {\n    // get headline\n    $oConCat = new Contenido_Category($db, $cfg);\n    $oConCat->load($idcat, true, $lang);\n    $sImgEdit = "CMS_IMGDESCR[1]";\n    $sImg = "CMS_IMG[1]";\n\n    $sHeadline = $iIdcatStart != intval($idcat)\n                    ? $oConCat->getCategoryLanguage()->getName()\n                    : mi18n("Willkommen!");\n    $sCssStyle = '''';\n    if ($contenido && $edit) {\n        echo ''<div id="modHeaderImgEdit">''.$sImgEdit.''</div>'';\n    }\n    if ($sImg != '''') {\n        $sCssStyle = '' style="background-image:url(''.$sImg.'');"'';\n    }\n    $tpl->reset();\n    $tpl->set(''s'', ''css-style'', $sCssStyle);\n    $tpl->set(''s'', ''url'', ''front_content.php'');\n    $tpl->set(''s'', ''title'', mi18n("Zur CONTENIDO Homepage"));\n    $tpl->set(''s'', ''headline'', $sHeadline);\n    $tpl->generate(''templates/header.html'');\n} catch (InvalidArgumentException $eI) {\n    echo ''Some error occured: '' . $eI->getMessage() . '': '' . $eI->getFile() . '' at line ''.$eI->getLine() . '' (''.$eI->getTraceAsString().'')'';\n} catch (Exception $e) {\n    echo ''Some error occured: '' . $e->getMessage() . '': '' . $e->getFile() . '' at line ''.$e->getLine() . '' (''.$e->getTraceAsString().'')'';\n}\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:53:58', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (6, 1, 'Headline', 'headline', 'Content', 'none', 'Output standard h1 headline', NULL, '', '<?php\n/**\n* $RCSfile$\n*\n* Description: Output standard h1 headline\n*\n* @version 1.0.0\n* @author Rudi Bieller\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2008-04-07\n* modified 2008-11-13, Timo Trautman - fixed XHTML validation error, when module displays empty h1 tag\n* }}\n*\n* $Id$\n*/\n\nif (!isset($tpl) || !is_object($tpl)) {\n    $tpl = new Template();\n}\n\n$sText = "CMS_HTMLHEAD[1]";\n\n$tpl->reset();\nif ($contenido && $edit) {\n    $tpl->set(''s'', ''text'', $sText);\n    $tpl->generate(''templates/headline_h1.html'');\n} else {\n    if ($sText != '''') {\n        $tpl->set(''s'', ''text'', strip_tags($sText));\n        $tpl->generate(''templates/headline_h1.html'');\n    }\n}\n\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:54:15', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (7, 1, 'Login_Form', 'login_form', 'Content', 'none', 'Display login-form.', NULL, '', '<?php\n/**\n* $RCSfile$\n*\n* Description: Display login form\n*\n* @version 1.0.0\n* @author Rudi Bieller\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2008-04-07\n* }}\n*\n* $Id$\n*/\n\nif (!isset($tpl) || !is_object($tpl)) {\n    $tpl = new Template();\n}\n\n$tpl->reset();\n\nif ($auth->auth["uid"] == "nobody") {\n    $sTargetIdcat = getEffectiveSetting(''login'', ''idcat'', ''1'');\n    $sTargetIdart = getEffectiveSetting(''login'', ''idart'', ''1'');\n    $sFormAction = ''front_content.php?idcat=''.$sTargetIdcat.''&amp;idart=''.$sTargetIdart;\n\n    $tpl->set(''s'', ''headline'', mi18n("Geschlossener Bereich Login"));\n    $tpl->set(''s'', ''form_action'', $sFormAction);\n    $tpl->set(''s'', ''label_name'', mi18n("name"));\n    $tpl->set(''s'', ''label_pass'', mi18n("pass"));\n    $tpl->set(''s'', ''label_login'', mi18n("einloggen"));\n    $tpl->generate(''templates/login_form.html'');\n} else {\n    try {\n        $oConCat = new Contenido_Category($db, $cfg);\n        $oConCat->load($idcat, true, $lang);\n        $bCatIsPublic = ($oConCat->getCategoryLanguage()->getVisible() == 1 && $oConCat->getCategoryLanguage()->getPublic() == 1)\n                        ? true : false;\n    } catch (Exception $e) {\n        echo $e->getMessage();\n    }\n    $oFeUserCollection = new cApiFrontendUserCollection();\n    $oFeUser = $oFeUserCollection->loadItem($auth->auth["uid"]);\n    $sText = str_replace(''[uname]'', $oFeUser->get(''username''), mi18n("Willkommen <strong>[uname]</strong>, sch�n, dass Sie wieder bei uns vorbeischauen."));\n    if ($bCatIsPublic === true) {\n        $sUrl = ''front_content.php?idcat=''.$idcat.''&amp;idart=''.$idart.''&logout=true'';\n    } else {\n        $iIdcatHome = (int) getEffectiveSetting(''navigation'', ''idcat-home'', ''1'');\n        $sUrl = ''front_content.php?idcat=''.$iIdcatHome.''&amp;logout=true'';\n    }\n    $tpl->set(''s'', ''headline'', mi18n("Geschlossener Bereich Logout"));\n    $tpl->set(''s'', ''text'', $sText);\n    $tpl->set(''s'', ''url'', $sUrl);\n    $tpl->set(''s'', ''label_logout'', mi18n("ausloggen"));\n    $tpl->generate(''templates/login_form_loggedin.html'');\n}\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:55:09', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (8, 1, 'Logo_Bottom', 'logo_bottom', 'Content', 'none', 'Display logo on bottom of page.', NULL, '', '<?php\n/**\n* $RCSfile$\n*\n* Description: Display Logo on bottom of page\n*\n* @version 1.0.0\n* @author Rudi Bieller\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2008-04-07\n* }}\n*\n* $Id$\n*/\nif (!isset($tpl) || !is_object($tpl)) {\n    $tpl = new Template();\n}\n\n\n$tpl->reset();\n$tpl->generate(''templates/logo_bottom.html'');\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:55:27', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (9, 1, 'Navigation_Breadcrumb', 'navigation_breadcrumb', 'Navigation', 'none', 'Display a breadcrumb navigation.', NULL, '', '<?php\n/**\n* $RCSfile$\n*\n* Description: Build a breadcrumb navigation\n* starting from top idcat (of given level) down to current idcat\n*\n* @version 1.0.0\n* @author Rudi Bieller\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2008-04-08\n* }}\n*\n* $Id$\n*/\n\ntry {\n    $oBreadcrumb = new Contenido_FrontendNavigation_Breadcrumb($db, $cfg, $client, $lang, $cfgClient);\n    $oBreadCategories = $oBreadcrumb->get($idcat, 1); // starting level in this case is 1, not 0\n    if ($oBreadCategories->count() > 0) {\n        foreach ($oBreadCategories as $oBreadCategory) {\n            // please remember, this is a sample - or a live application it''s better to use a template!\n            echo ''&gt; <a href="front_content.php?idcat=''.$oBreadCategory->getIdCat().''">''.\n                        $oBreadCategory->getCategoryLanguage()->getName().\n                ''</a> '';\n        }\n    }\n} catch(Exception $e) {\n    echo ''Shit happens: '' . $e->getMessage() . '': '' . $e->getFile() . '' at line ''.$e->getLine() . '' (''.$e->getTraceAsString().'')'';\n}\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:55:44', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (10, 1, 'Navigation_Main','navigation_main', 'Navigation', 'none', 'Display main navigation on left side.', NULL, '', '<?php\n/**\n* $RCSfile$\n*\n* Description:\n* Main Navigation, displays Navigation from a starting idcat down to the max. level set.\n* For now (as of 2009-01-12) all subcategories are put inside one <ul> and are assigned css classes\n* to distinguish level depth, first/last and active item property.\n*\n* Module requires two client settings:\n* navigation_main_standard | start_idcat\n* navigation_main_standard | level_depth\n*\n* To modify the behaviour of the module (e.g. style of URL, CSS classes, ...), you need to edit Contenido_NavMain_Util::loopCats\n* @see {contenido}/classes/Util/Modules/Contenido_NavMain_Util.class.php\n*\n* @version 1.0.0\n* @author Rudi Bieller\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2009-01-12\n* }}\n*\n* $Id: Navigation_Standard.php 3444 2009-01-19 11:42:59Z rudi.bieller $\n*/\n\nif (!isset($db)) {\n    $db = cRegistry::getDb();\n}\nif (!isset($tpl)) {\n    $tpl = new Template();\n}\n$tpl->reset();\n\ncInclude(''classes'', ''Contenido_FrontendNavigation/Contenido_FrontendNavigation.class.php'');\ncInclude(''classes'', ''Util/Modules/Contenido_NavMain_Util.class.php'');\n\n$iStartIdcat = getEffectiveSetting(''navigation'', ''idcat-home'', 1);\n$iSelectedDepth = getEffectiveSetting(''navigation'', ''level-depth'', 3);\n\nif ($iStartIdcat > 0) {\n    $oFeNav = new Contenido_FrontendNavigation($db, $cfg, $client, $lang, $cfgClient);\n    $oFeNav->setAuth($auth);\n    $oFeNav->setRootCat($iStartIdcat);\n    $oSubCategories = $oFeNav->getSubCategories($iStartIdcat, true, true, 1);\n    // see if there are any subcategories to display\n    if ($oSubCategories->count() > 0) {\n        $aLevelInfo = array();\n        $aDepthInfo = array();\n        $aDepthInfo[0] = 0;\n        $aDepthInfo[1] = $iSelectedDepth;\n        foreach ($oSubCategories as $oSubCategory) {\n            Contenido_NavMain_Util::loopCats($oSubCategory, $oFeNav, $tpl, $cfg, $lang, $aLevelInfo, intval($idcat), $aDepthInfo);\n        }\n        $tpl->generate(''templates/navigation_standard.html'');\n    }\n} else {\n    echo ''<p>Navigation not configured correctly.</p>'';\n}\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:57:42', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (11, 1, 'Navigation_Meta','navigation_meta', 'Navigation', 'none', 'Display meta navigation on bottom of page.', NULL, '', '<?php\n/**\n* $RCSfile$\n*\n* Description: Meta Navigation on bottom of page\n*\n* @version 1.0.0\n* @author Rudi Bieller\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2008-04-07\n* }}\n*\n* $Id$\n*/\n\n// get start idcat\n$iIdcatStart = getEffectiveSetting(''navigation'', ''idcat-meta'', 2);\n\n//check if there is a template instance\nif (!isset($tpl) || !is_object($tpl)) {\n    $tpl = new Template();\n}\n\n// reset template object\n$tpl->reset();\n\n// build navigation\ntry {\n    $oFeNav = new Contenido_FrontendNavigation($db, $cfg, $client, $lang, $cfgClient);\n    $oFeNav->setAuth($auth);\n    $oContenidoCategories = $oFeNav->getSubCategories($iIdcatStart, true);\n    if ($oContenidoCategories->count() > 0) {\n        foreach ($oContenidoCategories as $oContenidoCategory) {\n            // this is just for sample client - modify to your needs!\n            if ($cfg[''url_builder''][''name''] == ''front_content'' || $cfg[''url_builder''][''name''] == ''MR'') {\n                $aParams = array(''lang'' => $lang, ''idcat'' => $oContenidoCategory->getIdCat());\n            } else {\n                $aParams = array(''a'' => $oContenidoCategory->getIdCat(),\n                                ''idcat'' => $oContenidoCategory->getIdCat(), // needed to build category path\n                                ''lang'' => $lang, // needed to build category path\n                                ''level'' => 0); // needed to build category path\n            }\n            try {\n                $tpl->set(''d'', ''url'', Contenido_Url::getInstance()->build($aParams));\n            } catch (InvalidArgumentException $e) {\n                $tpl->set(''d'', ''url'', ''front_content.php?idcat=''.$oContenidoCategory->getIdCat());\n            }\n            $tpl->set(''d'', ''title'', $oContenidoCategory->getCategoryLanguage()->getName());\n            $tpl->set(''d'', ''label'', $oContenidoCategory->getCategoryLanguage()->getName());\n            $tpl->next();\n        }\n        $sItems = $tpl->generate(''templates/navigation_meta_item.html'', true, false);\n        $tpl->reset();\n        $tpl->set(''s'', ''items'', $sItems);\n        $tpl->generate(''templates/navigation_meta_container.html'');\n    }\n} catch (Exception $e) {\n    echo ''Shit happens: '' . $e->getMessage() . '': '' . $e->getFile() . '' at line ''.$e->getLine() . '' (''.$e->getTraceAsString().'')'';\n}\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:57:53', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (12, 1, 'News','news', 'Content', 'none', 'teaser article of a category\nAuthor: Andreas Lindner\nVersion:1.0', NULL, '?><?php\n/**\n* $RCSfile$\n*\n* Description: Newslist / ArticleList. Module "Input".\n*\n* @version 1.0.0\n* @author Andreas Lindner\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2005-08-12\n* }}\n*\n* $Id$\n*/\n\n#Select category\n$cms_idcat = "CMS_VALUE[1]";\n\necho ''<table cellpadding="0" cellspacing="0" border="0">'';\n\necho ''\n        <tr><td class="text_medium" style="padding:5px">Kategorie w&auml;hlen: </td></tr>\n        <tr><td class="text_medium" style="padding:5px">'';\n\necho buildCategorySelect("CMS_VAR[1]", "CMS_VALUE[1]");\necho ''&nbsp;<input type="image" src="images/submit.gif">'';\n\necho ''</td></tr>'';\n\n#Select sort field and sort order\n$sortdate = ''checked'';\n$cms_imgsize = "CMS_VALUE[14]";\n$cms_limit_articles = "CMS_VALUE[15]";\n$cms_sort_direction = "CMS_VALUE[16]";\nif ("CMS_VALUE[17]" != '''') {\n    $cms_include_start_article = '' checked'';\n} else {\n    $cms_include_start_article = '''';\n}\n\nif ("CMS_VALUE[3]" == ''sortdate'') {\n    $sortdate = ''checked'';\n    $sortnum = '''';\n}\nelseif ("CMS_VALUE[3]" == ''sortnum'') {\n    $sortdate = '''';\n    $sortnum = ''checked'';\n}\n\necho ''\n        <tr>\n          <td class="text_medium" style="padding:5px;">''.mi18n("Sortierung nach Datum").'':</td>\n          <td style="padding:5px;"><input type="radio" name="CMS_VAR[3]" value="sortdate" ''.$sortdate.''></td>\n        </tr>\n        <tr>\n          <td class="text_medium" style="padding:5px;">''.mi18n("Sortierung nach Nummer").'':</td>\n          <td style="padding:5px;"><input type="radio" name="CMS_VAR[3]" value="sortnum" ''.$sortnum.''></td>\n        </tr>\n        <tr>\n          <td class="text_medium" style="padding:5px;">''.mi18n("Sortierung aufsteigend").'':</td>\n          <td style="padding:5px;">'';\nif (strtolower($cms_sort_direction) == ''desc'') {\n    echo ''<input type="radio" name="CMS_VAR[16]" value="asc"/>'';\n} else {\n    echo ''<input type="radio" name="CMS_VAR[16]" value="asc" checked/>'';\n}\necho ''</td>\n        </tr>\n        <tr>\n          <td class="text_medium" style="padding:5px;">''.mi18n("Sortierung absteigend").'':</td>\n          <td style="padding:5px;">'';\nif (strtolower($cms_sort_direction) == ''desc'') {\n    echo ''<input type="radio" name="CMS_VAR[16]" value="desc" checked/>'';\n} else {\n    echo ''<input type="radio" name="CMS_VAR[16]" value="desc"/>'';\n}\necho ''</td>\n        </tr>'';\n\n$noimg = '''';\nif ("CMS_VALUE[13]" == ''true'') {\n    $noimg = ''checked'';\n}\n\n#Headline\necho ''\n        <tr><td class="text_medium" style="padding:5px;">''.mi18n("&Uuml;berschrift").'': </td></tr>\n        <tr><td style="padding:5px;"><input type="text" name="CMS_VAR[4]" value="CMS_VALUE[4]"></td></tr>\n        <tr>\n          <td colspan="2" class="text_medium" style="padding:5px;"><b><u>''.mi18n("Bild f&uuml;r Teaser").'':</u></b></td>\n        </tr>\n        <tr>\n          <td colspan="2" class="text_medium" style="padding:5px;">''.mi18n("Es wird das erste Bild des Artikels angezeigt.").''</td>\n        </tr>'';\n#Image width\necho ''\n        <tr><td class="text_medium" style="padding:5px;">''.mi18n("Bildbreite").'': </td></tr>\n        <tr><td style="padding:5px;"><input type="text" name="CMS_VAR[14]" value="''.$cms_imgsize.''" maxlength="3"></td></tr>'';\n#Disable images\necho ''\n        <tr>\n          <td class="text_medium" style="padding:5px;">''.mi18n("Kein Bild anzeigen").'':</td>\n          <td style="padding:5px;"><input type="checkbox" name="CMS_VAR[13]" value="true" ''.$noimg.''></td>\n        </tr>'';\n#Number of articles\necho ''\n        <tr>\n          <td class="text_medium" style="padding:5px;">''.mi18n("Anzahl Artikel begrenzen").'':</td>\n          <td style="padding:5px;"><input type="text" name="CMS_VAR[15]" value="''.$cms_limit_articles.''"></td>\n        </tr>'';\n#Include start article\necho ''\n        <tr>\n          <td class="text_medium" style="padding:5px;">''.mi18n("Startartikel in Liste einbeziehen").'':</td>\n          <td style="padding:5px;"><input type="checkbox" name="CMS_VAR[17]" value="yes"''.$cms_include_start_article.''></td>\n        </tr>'';\n\necho ''</table>'';\n?><?php', '<?php\n/**\n* $RCSfile$\n*\n* Description: Newslist / ArticleList. Module "Output".\n*\n* @version 1.1.0\n* @author Andreas Lindner\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2005-08-12\n* modified 2009-01-16 Rudi Bieller Added new Contenido_Url for creating URLs\n* }}\n*\n* $Id$\n*/\n\ncInclude(''includes'', ''functions.api.string.php'');\ncInclude(''includes'', ''functions.api.images.php'');\n\nif (!isset($tpl) || !is_object($tpl)) {\n    $tpl = new Template();\n}\n\n$tpl->reset();\n\n$htmlpath = $cfgClient[$client][''path''][''htmlpath''];\n$frontendpath = $cfgClient[$client][''path''][''frontend''];\n\n// selected category\n$selcat = "CMS_VALUE[1]";\n$template = "teaser-standard.html";\n// anzahl der zeichen text\n$mxtext = 200;\n\n$limit = "CMS_VALUE[15]";\n\n$cms_sort_direction = "CMS_VALUE[16]";\nif ($cms_sort_direction == '''') {\n    $cms_sort_direction = ''desc'';\n}\n\nif ("CMS_VALUE[3]" == "sortdate") {\n    $order = ''lastmodified'';\n} else {\n    $order = ''artsort'';\n}\n\nif ("CMS_VALUE[17]" != '''') {\n    $with_start = true;\n} else {\n    $with_start = false;\n}\n\n$newsheadline = "CMS_VALUE[4]";\n\n$tpl->set(''s'', ''TITLE'', $newsheadline);\n\nif (strlen($selcat) > 0 && $selcat != ''0'') {\n    $options = array(\n        ''idcat'' => $selcat, ''start'' => $with_start, ''order'' => $order, ''direction'' => $cms_sort_direction\n    );\n\n    $list = new ArticleCollection($options);\n\n    $count = $list->count;\n\n    if ($count > 0) {\n        if (is_numeric($limit) && strlen($limit) > 0) {\n            if ($limit < $list->count) {\n                $limit_art = $limit;\n            } else {\n                $limit_art = $list->count;\n            }\n        } else {\n            $limit_art = $list->count;\n        }\n\n        for ($i = 0; $i < $limit_art; $i ++) {\n\n            $article = $list->nextArticle();\n\n            $article_id = $article->getField(''idart'');\n\n            $teaser_img = '''';\n            if ($noimg != ''true'') {\n                $text_html = $article->getContent(''CMS_HTML'', 1);\n\n                $regEx = "/<img[^>]*?>.*?/i";\n                $match = array();\n                preg_match($regEx, $text_html, $match);\n\n                $regEx = "/(src)(=)([''\\"]?)([^\\"'']*)([''\\"]?)/i";\n                $img = array();\n                preg_match($regEx, $match[0], $img);\n                $img_src = preg_split("/\\//", $img[0]);\n\n                $img_name = $img_src[count($img_src) - 1];\n                $img_name = preg_replace("/\\"/", '''', $img_name);\n                $img_split = preg_split("/\\./", $img_name);\n                $img_type = $img_split[count($img_split) - 1];\n\n                $img_split2 = preg_split("/_/", $img_split[0]);\n\n                $name = $img_name;\n\n                if (count($img_split2) > 1) {\n                    $img_x = $img_split2[count($img_split2) - 1];\n                    $img_y = $img_split2[count($img_split2) - 2];\n\n                    if (is_numeric($img_x) && is_numeric($img_y)) {\n                        $suffix = ''_'' . $img_x . ''_'' . $img_y . ''.'' . $img_type;\n                        $name = preg_replace("/$suffix/", '''', $img_name);\n                        $name = $name . ''.[a-zA-Z]{3}'';\n                    }\n                }\n\n                $img_teaser = '''';\n\n                if (strlen($name) > 0) {\n                    $sql = "SELECT * FROM " . $cfg[''tab''][''upl''] . " WHERE filename REGEXP ''$name''";\n                    //echo "<pre>"; print_r($sql); echo "</pre>";\n                    $db->query($sql);\n                    if ($db->next_record()) {\n                        $filename = $db->f(''filename'');\n                        $dirname = $db->f(''dirname'');\n                    }\n\n                    $img_path = $cfgClient[$client][''upl''][''path''] . $dirname . $filename;\n\n                    $img_size = "CMS_VALUE[14]";\n\n                    $img_teaser = cApiImgScale($img_path, $img_size, $img_size, $crop = false, $expand = false, $cacheTime = 1000, $wantHQ = false);\n                } // end if strlen\n\n                if (strlen($img_teaser) > 0) {\n                    $teaser_img = ''<img src="''.$img_teaser.''" class="teaser_img">'';\n                } else {\n                    $teaser_img = '''';\n                }\n\n            } // end if noimg\n\n            $headline = strip_tags($article->getContent(''CMS_HTMLHEAD'', 1));\n            $headline = str_replace($replace, '' '', $headline);\n\n            /*          $subheadline = strip_tags($article->getContent(''CMS_HTMLHEAD'', 2));\n                        $subheadline = str_replace($replace, " ", $subheadline);*/\n\n            $teaserheadline = /*$subheadline."&nbsp;-&nbsp;".*/\n            $headline;\n            // this is just for sample client - modify to your needs!\n            if ($cfg[''url_builder''][''name''] == ''front_content'' || $cfg[''url_builder''][''name''] == ''MR'') {\n                $aParams = array(''lang'' => $lang, ''idcat'' => $selcat, ''idart'' => $article_id);\n            } else {\n                $aParams = array(''b'' => array(''lang'' => $lang, ''idcat'' => $selcat, ''idart'' => $article_id),\n                                ''idcat'' => $selcat, // needed to build category path\n                                ''lang'' => $lang, // needed to build category path\n                                ''level'' => 1); // needed to build category path\n            }\n            try {\n                $href = Contenido_Url::getInstance()->build($aParams);\n            } catch (InvalidArgumentException $e) {\n                $href = $sess->url("front_content.php?idcat=$selcat&amp;idart=$article_id");\n            }\n            $teasertext = $article->getField(''summary'');\n\n            if (strlen(trim($teasertext)) == 0) {\n                $teasertext = strip_tags($article->getContent(''CMS_HTML'', 1));\n                $teasertext2 = $teasertext;\n                $teasertext = cApiStrTrimAfterWord($teasertext, $mxtext);\n                if ($teasertext != $teasertext2) {\n                    $teasertext .= ''...'';\n                }\n            }\n\n            $teasertext = $teasertext . ''&nbsp;'';\n\n            $tpl->set(''d'', ''HEADLINE'', $teaserheadline);\n            $tpl->set(''d'', ''TEXT'', $teasertext);\n            $tpl->set(''d'', ''HREF'', $href);\n            $tpl->set(''d'', ''IMG'', $teaser_img);\n            $tpl->set(''d'', ''MORE'', mi18n("mehr"));\n\n            $tpl->next();\n\n        } // end for\n\n        $tpl->generate(''templates/''.$template);\n\n    }\n}\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:58:05', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (13, 1, 'Newsletter_Form', 'newsletter_form', 'Content', 'none', 'Newsletter Subscription Module V4.0.0 (for text and HTML newsletters)\n\nProvides multilanguage form for newsletter subscribing and cancellation.\n\nBased on the work of 4fb, www.x28.de, HerrB, 01.06.2007\n\nNotes:\n- The default language is english. Use the translation functionality to translate the module in other languages\n- Create a template which includes this module and create an article using that template.\n- Configure category/arcticle specifying handler article id', NULL, '   // Includes\n   cInclude(''classes'', ''class.input.helper.php''); # Note, this file is located in <client-path>/includes!\n\n   // Initialisation\n   $oClientLang = new cApiClientLanguage(false, $client, $lang);\n\n   /*\n   *  Used variables:\n   *  JoinSel:         Selection, which group will be joined (Default, Selected, UserSelected)\n   *  JoinMultiple:    If JoinSel = UserSelected then: If more than one group has been specified, select more than one\n   *  JoinGroups:      Selected group(s)\n   *  JoinMessageType: Message type for new recipients: User select (user), text or html\n   *  OptNewWindow:    Open handler window in new browser window?\n   */\n   $aSettings   = array();\n   $aSettings[''JoinSel'']         = $oClientLang->getProperty(''newsletter'', ''joinsel'');\n   $aSettings[''JoinMultiple'']    = $oClientLang->getProperty(''newsletter'', ''joinmultiple'');\n   $aSettings[''JoinGroups'']      = $oClientLang->getProperty(''newsletter'', ''joingroups'');\n   $aSettings[''JoinMessageType''] = $oClientLang->getProperty(''newsletter'', ''joinmessagetype'');\n   $aSettings[''OptNewWindow'']    = "CMS_VALUE[4]";\n\n   // Setting default values\n   /*\n   *  If nothing is set or if the option "UserSelected" has been activated, but no groups\n   *  have been selected, set option "Default". Note, that requiring to select groups when option\n   *  "Selected" has been activated doesn''t make so much sense here (even, as it is possible to do).\n   *  Why? Because the groups to be joined have to be specified on the handler page, not here...\n   *  To prevent users to select a group (or not to save the selection) when the option "Selected" is\n   *  active should make more problems than just to ignore the selection in the Output area\n   */\n\n   if ($aSettings[''JoinSel''] == '''' || ($aSettings[''JoinSel''] == ''UserSelected'' && $aSettings[''JoinGroups''] == '''')) {\n      $aSettings[''JoinSel''] = ''Default'';\n   }\n   if (!is_numeric($_REQUEST[''selHandlerCatArt''.$cnumber]) || $_REQUEST[''selHandlerCatArt''.$cnumber] < 0) {\n      $_REQUEST[''selHandlerCatArt''.$cnumber] = 0;\n   }\n\n   // Saving changes, if any\n   if ($_REQUEST[''hidAction''.$cnumber] == ''save'')\n   {\n      if ($_REQUEST[''radJoin''.$cnumber] != '''' && $_REQUEST[''radJoin''.$cnumber] != $aSettings[''JoinSel''])\n      {\n         $aSettings[''JoinSel''] = $_REQUEST[''radJoin''.$cnumber];\n         $oClientLang->setProperty(''newsletter'', ''joinsel'', $aSettings[''JoinSel'']);\n      }\n      if ($_REQUEST[''ckbJoinMultiple''.$cnumber] != $aSettings[''JoinMultiple''])\n      {\n         $aSettings[''JoinMultiple''] = $_REQUEST[''ckbJoinMultiple''.$cnumber];\n         $oClientLang->setProperty(''newsletter'', ''joinmultiple'', $aSettings[''JoinMultiple'']);\n      }\n      if ($_REQUEST[''hidJoinGroups''.$cnumber] != '''' && $_REQUEST[''hidJoinGroups''.$cnumber] != $aSettings[''JoinGroups''])\n      {\n         $aSettings[''JoinGroups''] = $_REQUEST[''hidJoinGroups''.$cnumber];\n         $oClientLang->setProperty(''newsletter'', ''joingroups'', $aSettings[''JoinGroups'']);\n      }\n      if ($_REQUEST[''selMessageType''.$cnumber] != $aSettings[''JoinMessageType''])\n      {\n         $aSettings[''JoinMessageType''] = $_REQUEST[''selMessageType''.$cnumber];\n         $oClientLang->setProperty(''newsletter'', ''joinmessagetype'', $aSettings[''JoinMessageType'']);\n      }\n\n      if ($_REQUEST[''ckbUpdateHandlerID''.$cnumber] == ''enabled'')\n      {\n         // Trick: If UpdateHandlerID is enabled, save id as client setting\n         $iHandlerCatArt = $_REQUEST[''selHandlerCatArt''.$cnumber];\n         $oClientLang->setProperty(''newsletter'', ''idcatart'', $iHandlerCatArt);\n      }\n   }\n   // Getting current handler article id\n   $iHandlerCatArt = $oClientLang->getProperty(''newsletter'', ''idcatart'');\n   unset($oClientLang);\n\n   // Showing options\n   $oCfgTable = new UI_Config_Table();\n\n   $oHidAction        = new cHTMLHiddenField(''hidAction''.$cnumber, ''save'');\n\n   $oSelHandlerCatArt = new cHTMLInputSelectElement(''selHandlerCatArt''.$cnumber, 1, '''', true);\n   $oOption           = new cHTMLOptionElement(mi18n("- Please select -"), '''');\n   $oSelHandlerCatArt->addOptionElement(0, $oOption);\n   $oSelHandlerCatArt->addCategories(0, true, false, false, true, true);\n   $oSelHandlerCatArt->setDefault($iHandlerCatArt);\n\n   $oCkbUpdate        = new cHTMLCheckbox(''ckbUpdateHandlerID''.$cnumber, ''enabled'');\n   $oCkbUpdate->setEvent(''click'', ''if (this.checked) {document.forms[0].selHandlerCatArt''.$cnumber.''.disabled = false;} else {document.forms[0].selHandlerCatArt''.$cnumber.''.disabled = true;}'');\n\n   $oCfgTable->setCell(''handler'', 0, mi18n("Handler Article:"));\n   $oCfgTable->setCell(''handler'', 1, $oHidAction->render().$oSelHandlerCatArt->render()."\\n&nbsp;".$oCkbUpdate->toHTML(false).mi18n("Update"));\n\n   // Getting newsletter groups (if any)\n   $oRcpGroups = new RecipientGroupCollection();\n   $oRcpGroups->setWhere(''idclient'', $client);\n   $oRcpGroups->setWhere(''idlang'',   $lang);\n   $oRcpGroups->setWhere(''defaultgroup'', ''0'');\n   $oRcpGroups->setOrder(''defaultgroup DESC, groupname ASC'');\n   $oRcpGroups->query();\n\n   // Join options\n   // If newsletter groups are available, provide group options, otherwise show only\n   // ''Default'' option. This is necessary, as there may have been groups specified (and used)\n   // but they have been deleted, later on.\n\n   $oCfgTable->setCell(''join_01'', 0, mi18n("Join:"));\n\n   if ($oRcpGroups->Count() == 0) {\n      // No groups available, only default group possible\n\n      $oRadJoinDefault = new cHTMLRadioButton(''radJoin''.$cnumber, ''Default'', '''', true);\n      $oCfgTable->setCell(''join_01'', 1, $oRadJoinDefault->toHTML(false).mi18n("default group"));\n   } else {\n      // Groups available, show different group join options\n\n      // Join default group only\n      if ($aSettings[''JoinSel''] == ''Default'') {\n         $oRadJoinDefault = new cHTMLRadioButton(''radJoin''.$cnumber, ''Default'', '''', true);\n      } else {\n         $oRadJoinDefault = new cHTMLRadioButton(''radJoin''.$cnumber, ''Default'');\n      }\n      $oRadJoinDefault->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = true; document.forms[0].selGroup".$cnumber.".disabled = true;");\n      $oCfgTable->setCell(''join_01'', 1, $oRadJoinDefault->toHTML(false).mi18n("default group"));\n      $oCfgTable->setRowBgColor(''join_01'', $cfg["color"]["table_light"]);\n\n      // Join admin selected groups automatically\n      if ($aSettings[''JoinSel''] == ''Selected'') {\n         $oRadJoinSelected = new cHTMLRadioButton(''radJoin''.$cnumber, ''Selected'', '''', true);\n      } else {\n         $oRadJoinSelected = new cHTMLRadioButton(''radJoin''.$cnumber, ''Selected'');\n      }\n      $oRadJoinSelected->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = false; document.forms[0].selGroup".$cnumber.".disabled = false;");\n      $oCfgTable->setCell(''join_02'', 0, '''');\n      $oCfgTable->setCell(''join_02'', 1, $oRadJoinSelected->toHTML(false).mi18n("selected group(s)"));\n      $oCfgTable->setRowBgColor(''join_02'', $cfg["color"]["table_light"]);\n\n      // Join the groups the user has selected (-> provide a list for the user), optionally, the user may select more than one group\n      if ($aSettings[''JoinSel''] == ''UserSelected'')\n      {\n         $oRadJoinUserSel  = new cHTMLRadioButton(''radJoin''.$cnumber, ''UserSelected'', '''', true);\n         $oCkbJoinMultiple = new cHTMLCheckbox(''ckbJoinMultiple''.$cnumber, ''enabled'', '''', $aSettings[''JoinMultiple'']);\n      } else {\n         $oRadJoinUserSel  = new cHTMLRadioButton(''radJoin''.$cnumber, ''UserSelected'');\n         $oCkbJoinMultiple = new cHTMLCheckbox(''ckbJoinMultiple''.$cnumber, ''enabled'', '''', false, true);\n      }\n      $oRadJoinUserSel->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = false; document.forms[0].selGroup".$cnumber.".disabled = false;");\n      $oCfgTable->setCell(''join_03'', 0, '''');\n      $oCfgTable->setCell(''join_03'', 1, $oRadJoinUserSel->toHTML(false).mi18n("group(s) as selected by user").''<br />''."\\n".$oCkbJoinMultiple->toHTML(false).mi18n("Multiple group selection allowed"));\n      $oCfgTable->setRowBgColor(''join_03'', $cfg["color"]["table_light"]);\n\n      $oCfgTable->setCell(''groups'', 0, mi18n("Select group(s):"));\n\n      // Show groups\n      // Trick: To save multiple selections in <select>-Element, add some JS which saves the\n      // selection, comma separated in a hidden input field on change.\n      $sSkript = ''              <script type="text/javascript"><!--''."\\n".\n                 ''                  function fncUpdateSel() {''."\\n".\n                 ''                     var strSel = "";''."\\n".\n                 ''                     for(i = 0; i < document.forms[0].selGroup''.$cnumber.''.length; i++) {''."\\n".\n                 ''                        if(document.forms[0].selGroup''.$cnumber.''.options[i].selected == true) {''."\\n".\n                 ''                           if (strSel != "")''."\\n".\n                 ''                              strSel = strSel + ",";''."\\n".\n                 ''                           strSel = strSel + document.forms[0].selGroup''.$cnumber.''.options[i].value;''."\\n".\n                 ''                        }''."\\n".\n                 ''                     }''."\\n".\n                 ''                     document.forms[0].elements["hidJoinGroups''.$cnumber.''"].value = strSel;''."\\n".\n                 ''                  }''."\\n".\n                 ''                  //--></script>''."\\n";\n\n      if ($aSettings[''JoinSel''] == ''Default'') {\n         $oSelGroup = new cHTMLSelectElement(''selGroup''.$cnumber, '''', '''', true);\n      } else {\n         $oSelGroup = new cHTMLSelectElement(''selGroup''.$cnumber, '''');\n      }\n      $oSelGroup->setSize(5);\n      $oSelGroup->setMultiselect();\n      $oSelGroup->setEvent(''change'', "fncUpdateSel()");\n\n      $aGroups = explode('','', $aSettings[''JoinGroups'']);\n      while ($oRcpGroup = $oRcpGroups->next()) {\n         $iID = $oRcpGroup->get(''idnewsgroup'');\n         if (in_array($iID, $aGroups)) {\n            $oOption = new cHTMLOptionElement($oRcpGroup->get(''groupname''), $iID, true);\n         } else {\n            $oOption = new cHTMLOptionElement($oRcpGroup->get(''groupname''), $iID, false);\n         }\n         $oSelGroup->addOptionElement($iID, $oOption);\n      }\n\n      $oHidGroups = new cHTMLHiddenField(''hidJoinGroups''.$cnumber, $aSettings[''JoinGroups'']);\n      $oCfgTable->setCell(''groups'', 1, $sSkript.$oSelGroup->render().$oHidGroups->render());\n   }\n\n   // Options: Message type (user [->selectbox], text or html)\n   $oCfgTable->setCell(''options_01'', 0, mi18n("Options:"));\n\n   $oSelMsgType = new cHTMLSelectElement(''selMessageType''.$cnumber);\n   $oOption = new cHTMLOptionElement(mi18n("User selected"), "user");\n   $oSelMsgType->addOptionElement(0, $oOption);\n   $oOption = new cHTMLOptionElement(mi18n("Text only"), "text");\n   $oSelMsgType->addOptionElement(1, $oOption);\n   $oOption = new cHTMLOptionElement(mi18n("HTML and text"), "html");\n   $oSelMsgType->addOptionElement(2, $oOption);\n   $oSelMsgType->setDefault($aSettings[''JoinMessageType'']);\n\n   $oCfgTable->setCell(''options_01'', 1, mi18n("Default message type:").''&nbsp;''.$oSelMsgType->render());\n\n   // Options: Open handler article in new window?\n   $oCfgTable->setCell(''options_02'', 0, '''');\n   $oCkbNewWindow = new cHTMLCheckbox("CMS_VAR[4]", ''enabled'', '''', "CMS_VALUE[4]");\n   $oCfgTable->setCell(''options_02'', 1, $oCkbNewWindow->toHTML(false).mi18n("Open handler article in new window"));\n   $oCfgTable->setRowBgColor(''options_02'', $cfg["color"]["table_light"]);\n\n   $oCfgTable->render(true);', '<?php\n   // Initialisation\n   $oClientLang = new cApiClientLanguage(false, $client, $lang);\n\n   /*\n   *  Used variables:\n   *  JoinSel:         Selection, which group will be joined (Default, Selected, UserSelected)\n   *  JoinMultiple:    If JoinSel = UserSelected then: If more than one group has been specified, select more than one\n   *  JoinGroups:      Selected group(s)\n   *  JoinMessageType: Message type for new recipients: User select (user), text or html\n   *  OptNewWindow:    Open handler window in new browser window?\n   */\n   $aSettings   = array();\n   $aSettings[''JoinSel'']         = $oClientLang->getProperty(''newsletter'', ''joinsel'');\n   $aSettings[''JoinMultiple'']    = $oClientLang->getProperty(''newsletter'', ''joinmultiple'');\n   $aSettings[''JoinGroups'']      = $oClientLang->getProperty(''newsletter'', ''joingroups'');\n   $aSettings[''JoinMessageType''] = $oClientLang->getProperty(''newsletter'', ''joinmessagetype'');\n   $aSettings[''OptNewWindow'']    = "CMS_VALUE[4]";\n\n   $sTemplate = ''newsletter_form.html'';\n\n   if ($aSettings["JoinSel"] == "" || ($aSettings["JoinSel"] == "UserSelected" && $aSettings["JoinGroups"] == "")) {\n      $aSettings["JoinSel"]= "Default";\n   }\n\n   if (!isset($oPage) || !is_object($oPage)) {\n      $oPage = new Template();\n   }\n   $oPage->reset();\n\n   $oPage->set(''s'', ''FORM_ACTION'', ''front_content.php?changelang=''.$lang.''&amp;idcatart=''.\n                                   $oClientLang->getProperty(''newsletter'', ''idcatart''));\n   unset($oClientLang);\n\n   if ($aSettings["OptNewWindow"]) {\n      $oPage->set(''s'', ''FORM_TARGET'', '' target="_blank"'');\n   } else {\n      $oPage->set(''s'', ''FORM_TARGET'', '''');\n   }\n   $oPage->set(''s'', ''EMAILNAME'', mi18n("Name"));\n   $oPage->set(''s'', ''EMAIL'',     mi18n("E-Mail"));\n\n   $sTmpHTML = "";\n   if ($aSettings["JoinSel"] == "UserSelected") {\n      // Late include to increase performance\n\n      $oRcpGroups = new RecipientGroupCollection();\n      $oRcpGroups->setWhere(''idclient'', $client);\n      $oRcpGroups->setWhere(''idlang'',   $lang);\n      $oRcpGroups->setWhere(''defaultgroup'', ''0'');\n      $oRcpGroups->setWhere(''idnewsgroup'', explode('','', $aSettings["JoinGroups"]), ''IN'');\n      $oRcpGroups->setOrder(''groupname ASC'');\n      $oRcpGroups->query();\n\n      #$oRcpGroups->select("idclient = ''$client'' AND idlang = ''$lang'' AND defaultgroup = ''0'' AND idnewsgroup IN (".$aSettings["JoinGroups"].")","", "groupname ASC");\n\n      if ($oRcpGroups->Count() > 0) {\n         $oLblGroupSel = new cHTMLLabel(mi18n("Select"), "selNewsletterGroup");\n\n         $oSelGroup = new cHTMLSelectElement("selNewsletterGroup[]", "", "selNewsletterGroup");\n         $oSelGroup->setSize(2);\n         $oSelGroup->setClass("");\n\n         if ($aSettings["JoinMultiple"] == "enabled") {\n            $oSelGroup->setMultiselect();\n         }\n\n         while ($oRcpGroup = $oRcpGroups->next())\n         {\n            $iID = $oRcpGroup->get("idnewsgroup");\n            $oOption = new cHTMLOptionElement($oRcpGroup->get("groupname"), $iID);\n            $oSelGroup->addOptionElement($iID, $oOption);\n         }\n\n         $sTmpHTML .= ''         ''.$oLblGroupSel->toHTML()."\\n";\n         $sTmpHTML .= ''         ''.$oSelGroup->render()."\\n";\n         $sTmpHTML .= ''         <br class="y"/>'';\n      }\n   }\n   // You may like to add here additional rows for fields used in recipient- or frontenduser-plugins\n   // $sTmpHTML .= ''...'';\n\n   if ($aSettings[''JoinMessageType''] == ''user'')\n   {\n         $oLblType = new cHTMLLabel(mi18n("Type"), "selNewsletterType");\n\n         $oSelType = new cHTMLSelectElement("selNewsletterType", "", "selNewsletterType");\n         $oSelType->setSize(1);\n         $oSelType->setClass("");\n\n         $oOption = new cHTMLOptionElement(mi18n("Text only"), 0);\n         $oSelType->addOptionElement(0, $oOption);\n         $oOption = new cHTMLOptionElement(mi18n("HTML"), 1);\n         $oSelType->addOptionElement(1, $oOption);\n\n         //$sTmpHTML .= ''         ''.$oLblType->toHTML()."\\n";\n         $sTmpHTML .= ''         ''.$oSelType->render()."\\n";\n         $sTmpHTML .= ''         <br class="y"/>'';\n   }\n   $oPage->set(''s'', ''EXTRAHTML'', $sTmpHTML);\n\n   $oPage->set(''s'', ''NEWSLETTER'', mi18n("Newsletter"));\n   $oPage->set(''s'', ''SUBSCRIBE'',  mi18n("Subscribe"));\n   $oPage->set(''s'', ''DELETE'',     mi18n("Unsubscribe"));\n\n   $oPage->set("s", "ABSCHICKEN", mi18n("submit"));\n   $oPage->set("s", "LOESCHEN", mi18n("delete"));\n   $oPage->set(''s'', ''JOIN'', mi18n("Join"));\n\n   $oPage->generate(''templates/''.$sTemplate);\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:58:33', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (14, 1, 'Newsletter_Handler', 'newsletter_handler', 'Content', 'none', 'Newsletter Handler Module V4.0.1 (for text and HTML newsletters)\n\nProvides multilanguage handling for newsletter subscribing, cancellation and other features.\n\nBased on the work of 4fb, www.x28.de, HerrB, 01.05.2007\n\nNotes:\n- The default language is english. Use the translation functionality to translate the module in other languages\n- Create a template which includes this module and create an article using that template.\n- Configure category/arcticle specifying handler article id', NULL, '   cInclude(''classes'', ''class.input.helper.php''); # Note, this file is located in <client-path>/includes!\n\n   // Initialisation\n   $oClientLang = new cApiClientLanguage(false, $client, $lang);\n   $oClient     = new cApiClient($client);\n\n   /*\n   *  Used variables:\n   *  JoinSel:         Selection, which group will be joined (Default, Selected, User specified)\n   *  JoinMultiple:    If JoinSel = UserSelected then: More than one group may be selected\n   *  JoinGroups:      Selected group(s)\n   *  JoinMessageType: Message type for new recipients: User select (user), text or html\n   *  FrontendLink:    Link to Frontend Users enabled?\n   *  FrontendConfirm: Confirmation of newsletter subscription means: Activate frontend account, nothing\n   *  FrontendDel:     Cancellation of newsletter subscription means: Delete frontend account, Deactivate account, nothing\n   *  SenderEMail:     Sender e-mail address\n   *  HandlerID:       ID of handler article\n   *  ChangeEMailID:   ID of change e-mail handler article\n   */\n   $aSettings   = array();\n   $aSettings[''JoinSel'']         = $oClientLang->getProperty(''newsletter'', ''joinsel'');\n   $aSettings[''JoinMultiple'']    = $oClientLang->getProperty(''newsletter'', ''joinmultiple'');\n   $aSettings[''JoinGroups'']      = $oClientLang->getProperty(''newsletter'', ''joingroups'');\n   $aSettings[''JoinMessageType''] = $oClientLang->getProperty(''newsletter'', ''joinmessagetype'');\n   $aSettings[''FrontendLink'']    = $oClient->getProperty(''newsletter'', ''frontendlink''); # Note: Stored for client, as frontendusers are language independent\n   $aSettings[''FrontendConfirm''] = "CMS_VALUE[5]";\n   $aSettings[''FrontendDel'']     = "CMS_VALUE[6]";\n   $aSettings[''SenderEMail'']     = $oClient->getProperty(''global'', ''sender-email''); # This one could be recycled by other modules...\n\n   // Setting default values\n   // If there is no selection option set or if no groups has been selected, activate option Default\n   if ($aSettings[''JoinSel''] == '''' || $aSettings[''JoinGroups''] == '''') {\n      $aSettings[''JoinSel''] = "Default";\n   }\n   if ($aSettings[''FrontendConfirm''] == '''') {\n      $aSettings[''FrontendConfirm''] = "ActivateUser";\n   }\n   if ($aSettings[''FrontendDel''] == '''') {\n      $aSettings[''FrontendDel''] = "DeleteUser";\n   }\n   if (!is_numeric($_REQUEST[''selHandlerCatArt''.$cnumber]) || $_REQUEST[''selHandlerCatArt''.$cnumber] < 0) {\n      $_REQUEST[''selHandlerCatArt''.$cnumber] = 0;\n   }\n\n   // Saving changes, if any\n   if ($_REQUEST[''hidAction''.$cnumber] == ''save'')\n   {\n      if ($_REQUEST[''radJoin''.$cnumber] != '''' && $_REQUEST[''radJoin''.$cnumber] != $aSettings[''JoinSel''])\n      {\n         $aSettings[''JoinSel''] = $_REQUEST[''radJoin''.$cnumber];\n         $oClientLang->setProperty(''newsletter'', ''joinsel'', $aSettings[''JoinSel'']);\n      }\n      if ($_REQUEST[''ckbJoinMultiple''.$cnumber] != $aSettings[''JoinMultiple''])\n      {\n         $aSettings[''JoinMultiple''] = $_REQUEST[''ckbJoinMultiple''.$cnumber];\n         $oClientLang->setProperty(''newsletter'', ''joinmultiple'', $aSettings[''JoinMultiple'']);\n      }\n      if ($_REQUEST[''hidJoinGroups''.$cnumber] != '''' && $_REQUEST[''hidJoinGroups''.$cnumber] != $aSettings[''JoinGroups''])\n      {\n         $aSettings[''JoinGroups''] = $_REQUEST[''hidJoinGroups''.$cnumber];\n         $oClientLang->setProperty(''newsletter'', ''joingroups'', $aSettings[''JoinGroups'']);\n      }\n      if ($_REQUEST[''selMessageType''.$cnumber] != $aSettings[''JoinMessageType''])\n      {\n         $aSettings[''JoinMessageType''] = $_REQUEST[''selMessageType''.$cnumber];\n         $oClientLang->setProperty(''newsletter'', ''joinmessagetype'', $aSettings[''JoinMessageType'']);\n      }\n      if ($_REQUEST[''ckbFrontendLink''.$cnumber] != $aSettings[''FrontendLink''])\n      {\n         $aSettings[''FrontendLink''] = $_REQUEST[''ckbFrontendLink''.$cnumber];\n         $oClient->setProperty(''newsletter'', ''frontendlink'', $aSettings[''FrontendLink'']);\n      }\n\n      if ($_REQUEST[''ckbUpdateHandlerID''.$cnumber] == ''enabled'')\n      {\n         // Trick: If UpdateHandlerID is enabled, save id as client setting\n         $iHandlerCatArt = $_REQUEST[''selHandlerCatArt''.$cnumber];\n         $oClientLang->setProperty(''newsletter'', ''idcatart'', $iHandlerCatArt);\n      }\n\n      if (isValidMail($_REQUEST[''txtSender''.$cnumber]) && $_REQUEST[''txtSender''.$cnumber] != $aSettings[''SenderEMail''])\n      {\n         $aSettings[''SenderEMail''] = $_REQUEST[''txtSender''.$cnumber];\n         $oClient->setProperty(''global'', ''sender-email'', $aSettings[''SenderEMail'']);\n      }\n   }\n\n   // Getting current handler article id\n   $iHandlerCatArt = $oClientLang->getProperty(''newsletter'', ''idcatart'');\n   unset($oClientLang);\n   unset($oClient);\n\n   // Show options\n   $oCfgTable = new UI_Config_Table();\n\n   $oHidAction        = new cHTMLHiddenField(''hidAction''.$cnumber, ''save'');\n\n   $oTxtSender = new cHTMLTextbox("txtSender".$cnumber, $aSettings[''SenderEMail''], 30);\n\n   $oCfgTable->setCell(''sender'', 0, mi18n("Sender e-mail:"));\n   $oCfgTable->setCell(''sender'', 1, $oHidAction->render().$oTxtSender->render());\n\n   $oSelHandlerCatArt = new cHTMLInputSelectElement(''selHandlerCatArt''.$cnumber, 1, '''', true);\n   $oOption           = new cHTMLOptionElement(mi18n("- Please select -"), '''');\n   $oSelHandlerCatArt->addOptionElement(0, $oOption);\n   $oSelHandlerCatArt->addCategories(0, true, false, false, true, true);\n   $oSelHandlerCatArt->setDefault($iHandlerCatArt);\n\n   $oCkbUpdate        = new cHTMLCheckbox(''ckbUpdateHandlerID''.$cnumber, ''enabled'');\n   $oCkbUpdate->setEvent(''click'', ''if (this.checked) {document.forms[0].selHandlerCatArt''.$cnumber.''.disabled = false;} else {document.forms[0].selHandlerCatArt''.$cnumber.''.disabled = true;}'');\n\n   $oCfgTable->setCell(''handler'', 0, mi18n("Handler Article:"));\n   $oCfgTable->setCell(''handler'', 1, $oSelHandlerCatArt->render()."\\n&nbsp;".$oCkbUpdate->toHTML(false).mi18n("Update"));\n\n   // Getting newsletter groups (if any)\n   $oRcpGroups = new RecipientGroupCollection();\n   $oRcpGroups->setWhere(''idclient'', $client);\n   $oRcpGroups->setWhere(''idlang'',   $lang);\n   $oRcpGroups->setWhere(''defaultgroup'', ''0'');\n   $oRcpGroups->setOrder(''defaultgroup DESC, groupname ASC'');\n   $oRcpGroups->query();\n\n   // Join options\n   // If newsletter groups are available, provide group options, otherwise show only\n   // ''Default'' option. This is necessary, as there may have been groups specified (and used)\n   // but they have been deleted, later on.\n\n   $oCfgTable->setCell(''join_01'', 0, mi18n("Join:"));\n\n   if ($oRcpGroups->Count() == 0) {\n      // No groups available, only default group possible\n\n      $oRadJoinDefault = new cHTMLRadioButton(''radJoin''.$cnumber, ''Default'', '''', true);\n      $oCfgTable->setCell(''join_01'', 1, $oRadJoinDefault->toHTML(false).mi18n("default group"));\n   } else {\n      // Groups available, show different group join options\n\n      // Join default group only\n      if ($aSettings[''JoinSel''] == ''Default'') {\n         $oRadJoinDefault = new cHTMLRadioButton(''radJoin''.$cnumber, ''Default'', '''', true);\n      } else {\n         $oRadJoinDefault = new cHTMLRadioButton(''radJoin''.$cnumber, ''Default'');\n      }\n      $oRadJoinDefault->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = true; document.forms[0].selGroup".$cnumber.".disabled = true;");\n      $oCfgTable->setCell(''join_01'', 1, $oRadJoinDefault->toHTML(false).mi18n("default group"));\n      $oCfgTable->setRowBgColor(''join_01'', $cfg["color"]["table_dark"]);\n\n      // Join admin selected groups automatically\n      if ($aSettings[''JoinSel''] == ''Selected'') {\n         $oRadJoinSelected = new cHTMLRadioButton(''radJoin''.$cnumber, ''Selected'', '''', true);\n      } else {\n         $oRadJoinSelected = new cHTMLRadioButton(''radJoin''.$cnumber, ''Selected'');\n      }\n      $oRadJoinSelected->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = false; document.forms[0].selGroup".$cnumber.".disabled = false;");\n      $oCfgTable->setCell(''join_02'', 0, '''');\n      $oCfgTable->setCell(''join_02'', 1, $oRadJoinSelected->toHTML(false).mi18n("selected group(s)"));\n      $oCfgTable->setRowBgColor(''join_02'', $cfg["color"]["table_dark"]);\n\n      // Join the groups the user has selected (-> provide a list for the user), optionally, the user may select more than one group\n      if ($aSettings[''JoinSel''] == ''UserSelected'')\n      {\n         $oRadJoinUserSel  = new cHTMLRadioButton(''radJoin''.$cnumber, ''UserSelected'', '''', true);\n         $oCkbJoinMultiple = new cHTMLCheckbox(''ckbJoinMultiple''.$cnumber, ''enabled'', '''', $aSettings[''JoinMultiple'']);\n      } else {\n         $oRadJoinUserSel  = new cHTMLRadioButton(''radJoin''.$cnumber, ''UserSelected'');\n         $oCkbJoinMultiple = new cHTMLCheckbox (''ckbJoinMultiple''.$cnumber, ''enabled'', '''', false, true);\n      }\n      $oRadJoinUserSel->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = false; document.forms[0].selGroup".$cnumber.".disabled = false;");\n      $oCfgTable->setCell(''join_03'', 0, '''');\n      $oCfgTable->setCell(''join_03'', 1, $oRadJoinUserSel->toHTML(false).mi18n("group(s) as selected by user").''<br />''."\\n".$oCkbJoinMultiple->toHTML(false).mi18n("Multiple group selection allowed"));\n      $oCfgTable->setRowBgColor(''join_03'', $cfg["color"]["table_dark"]);\n\n      $oCfgTable->setCell(''groups'', 0, mi18n("Select group(s):"));\n\n      // Show groups\n      // Trick: To save multiple selections in <select>-Element, add some JS which saves the\n      // selection, comma separated in a hidden input field on change.\n      $sSkript = ''              <script type="text/javascript"><!--''."\\n".\n                 ''                  function fncUpdateSel() {''."\\n".\n                 ''                     var strSel = "";''."\\n".\n                 ''                     for(i = 0; i < document.forms[0].selGroup''.$cnumber.''.length; i++) {''."\\n".\n                 ''                        if(document.forms[0].selGroup''.$cnumber.''.options[i].selected == true) {''."\\n".\n                 ''                           if (strSel != "")''."\\n".\n                 ''                              strSel = strSel + ",";''."\\n".\n                 ''                           strSel = strSel + document.forms[0].selGroup''.$cnumber.''.options[i].value;''."\\n".\n                 ''                        }''."\\n".\n                 ''                     }''."\\n".\n                 ''                     document.forms[0].elements["hidJoinGroups''.$cnumber.''"].value = strSel;''."\\n".\n                 ''                  }''."\\n".\n                 ''                  //--></script>''."\\n";\n\n      if ($aSettings[''JoinSel''] == ''Default'') {\n         $oSelGroup = new cHTMLSelectElement(''selGroup''.$cnumber, '''', '''', true);\n      } else {\n         $oSelGroup = new cHTMLSelectElement(''selGroup''.$cnumber, '''');\n      }\n      $oSelGroup->setSize(5);\n      $oSelGroup->setMultiselect();\n      $oSelGroup->setEvent(''change'', "fncUpdateSel()");\n\n      $aGroups = explode('','', $aSettings[''JoinGroups'']);\n      while ($oRcpGroup = $oRcpGroups->next()) {\n         $iID = $oRcpGroup->get(''idnewsgroup'');\n         if (in_array($iID, $aGroups)) {\n            $oOption = new cHTMLOptionElement($oRcpGroup->get(''groupname''), $iID, true);\n         } else {\n            $oOption = new cHTMLOptionElement($oRcpGroup->get(''groupname''), $iID, false);\n         }\n         $oSelGroup->addOptionElement($iID, $oOption);\n      }\n\n      $oHidGroups = new cHTMLHiddenField(''hidJoinGroups''.$cnumber, $aSettings[''JoinGroups'']);\n      $oCfgTable->setCell(''groups'', 1, $sSkript.$oSelGroup->render().$oHidGroups->render());\n   }\n\n   // Options: Message type (user [->selectbox], text or html)\n   $oCfgTable->setCell(''options_01'', 0, mi18n("Options:"));\n\n   $oSelMsgType = new cHTMLSelectElement(''selMessageType''.$cnumber);\n   $oOption = new cHTMLOptionElement(mi18n("User selected"), "user");\n   $oSelMsgType->addOptionElement(0, $oOption);\n   $oOption = new cHTMLOptionElement(mi18n("Text only"), "text");\n   $oSelMsgType->addOptionElement(1, $oOption);\n   $oOption = new cHTMLOptionElement(mi18n("HTML and text"), "html");\n   $oSelMsgType->addOptionElement(2, $oOption);\n   $oSelMsgType->setDefault($aSettings[''JoinMessageType'']);\n\n   $oCfgTable->setCell(''options_01'', 1, mi18n("Default message type:").''&nbsp;''.$oSelMsgType->render());\n\n   // Frontend Link\n   $oCfgTable->setCell(''link_01'', 0, mi18n("Frontend Users:"));\n   $oCkbLink = new cHTMLCheckbox(''ckbFrontendLink''.$cnumber, ''enabled'', '''', $aSettings[''FrontendLink'']);\n\n   $sSkript = "if (this.checked) {\n                  document.forms[0].elements[''CMS_VAR[5]''][0].disabled = false;\n                  document.forms[0].elements[''CMS_VAR[5]''][1].disabled = false;\n                  document.forms[0].elements[''CMS_VAR[6]''][0].disabled = false;\n                  document.forms[0].elements[''CMS_VAR[6]''][1].disabled = false;\n                  document.forms[0].elements[''CMS_VAR[6]''][2].disabled = false;\n               } else {\n                  document.forms[0].elements[''CMS_VAR[5]''][0].disabled = true;\n                  document.forms[0].elements[''CMS_VAR[5]''][1].disabled = true;\n                  document.forms[0].elements[''CMS_VAR[6]''][0].disabled = true;\n                  document.forms[0].elements[''CMS_VAR[6]''][1].disabled = true;\n                  document.forms[0].elements[''CMS_VAR[6]''][2].disabled = true;}";\n   $oCkbLink->setEvent("click", $sSkript);\n\n   $oCfgTable->setCell(''link_01'', 1, $oCkbLink->toHTML(false).mi18n("Activate Link"));\n   $oCfgTable->setRowBgColor(''link_01'', $cfg["color"]["table_light"]);\n\n   // Link: Activation options\n   $oCfgTable->setCell(''link_02'', 0, '''');\n\n   switch ($aSettings[''FrontendConfirm''])\n   {\n      case "Nothing":\n         $oRadActivateUser    = new cHTMLRadioButton("CMS_VAR[5]", "ActivateUser", "", false);\n         $oRadActivateNothing = new cHTMLRadioButton("CMS_VAR[5]", "Nothing",      "", true);\n         break;\n      default:\n         $oRadActivateUser    = new cHTMLRadioButton("CMS_VAR[5]", "ActivateUser", "", true);\n         $oRadActivateNothing = new cHTMLRadioButton("CMS_VAR[5]", "Nothing",      "", false);\n   }\n\n   switch ($aSettings[''FrontendDel''])\n   {\n      case "DisableUser":\n         $oRadDelDelete  = new cHTMLRadioButton("CMS_VAR[6]", "DeleteUser",  "", false);\n         $oRadDelDisable = new cHTMLRadioButton("CMS_VAR[6]", "DisableUser", "", true);\n         $oRadDelNothing = new cHTMLRadioButton("CMS_VAR[6]", "Nothing",     "", false);\n         break;\n      case "Nothing":\n         $oRadDelDelete  = new cHTMLRadioButton("CMS_VAR[6]", "DeleteUser",  "", false);\n         $oRadDelDisable = new cHTMLRadioButton("CMS_VAR[6]", "DisableUser", "", false);\n         $oRadDelNothing = new cHTMLRadioButton("CMS_VAR[6]", "Nothing",     "", true);\n         break;\n      default:\n         $oRadDelDelete  = new cHTMLRadioButton("CMS_VAR[6]", "DeleteUser",  "", true);\n         $oRadDelDisable = new cHTMLRadioButton("CMS_VAR[6]", "DisableUser", "", false);\n         $oRadDelNothing = new cHTMLRadioButton("CMS_VAR[6]", "Nothing",     "", false);\n   }\n\n   if ($aSettings[''FrontendLink''] == '''')\n   {\n      $oRadActivateUser->setDisabled(true);\n      $oRadActivateNothing->setDisabled(true);\n      $oRadDelDelete->setDisabled(true);\n      $oRadDelDisable->setDisabled(true);\n      $oRadDelNothing->setDisabled(true);\n   }\n   $oCfgTable->setCell(''link_02'', 1, mi18n("Confirmation means:").''<br />''.\n                                     $oRadActivateUser->toHTML(false).mi18n("Activate").\n                                     $oRadActivateNothing->toHTML(false).mi18n("No changes"));\n   $oCfgTable->setRowBgColor(''link_02'', $cfg["color"]["table_light"]);\n\n   // Link: Cancellation options\n   $oCfgTable->setCell(''link_03'', 0, '''');\n\n   $oCfgTable->setCell(''link_03'', 1, mi18n("Cancellation means:").''<br />''.\n                                     $oRadDelDelete->toHTML(false).mi18n("Delete").\n                                     $oRadDelDisable->toHTML(false).mi18n("Disable").\n                                     $oRadDelNothing->toHTML(false).mi18n("No changes"));\n   $oCfgTable->setRowBgColor(''link_03'', $cfg["color"]["table_light"]);\n\n   $oCfgTable->render(true);', '<?php\n   // Initialisation\n   $oClientLang = new cApiClientLanguage(false, $client, $lang);\n   $oClient     = new cApiClient($client);\n   $oRecipients = new RecipientCollection;\n   $sMessage = "&nbsp;";\n   unset($recipient); // Unset any existing recipient objects - note, that it must be $recipient for the plugins...\n\n   $aSettings   = array();\n   $aSettings[''JoinSel'']         = $oClientLang->getProperty(''newsletter'', ''joinsel'');\n   $aSettings[''JoinMultiple'']    = $oClientLang->getProperty(''newsletter'', ''joinmultiple'');\n   $aSettings[''JoinGroups'']      = $oClientLang->getProperty(''newsletter'', ''joingroups'');\n   $aSettings[''JoinMessageType''] = $oClientLang->getProperty(''newsletter'', ''joinmessagetype'');\n   $aSettings[''FrontendLink'']    = $oClient->getProperty(''newsletter'', ''frontendlink''); # Note: Stored for client, as frontendusers are language independent\n   $aSettings[''FrontendConfirm''] = "CMS_VALUE[5]";\n   $aSettings[''FrontendDel'']     = "CMS_VALUE[6]";\n   $aSettings[''SenderEMail'']     = $oClient->getProperty(''global'', ''sender-email''); # This one could be recycled by other modules...\n   $aSettings[''HandlerID'']       = $oClientLang->getProperty(''newsletter'', ''idcatart'');\n\n   $sTemplate = ''newsletter_handler.html'';\n\n   if (!isset($oPage) || !is_object($oPage)) {\n      $oPage = new Template();\n   }\n   $oPage->reset();\n\n   // If there is no selection option set or if no groups has been selected, activate option Default\n   if ($aSettings[''JoinSel''] == '''' || $aSettings[''JoinGroups''] == '''') {\n      $aSettings[''JoinSel''] = "Default";\n   }\n   if ($aSettings[''FrontendConfirm''] == '''') {\n      $aSettings[''FrontendConfirm''] = "ActivateUser";\n   }\n   if ($aSettings[''FrontendDel''] == '''') {\n      $aSettings[''FrontendDel''] = "DeleteUser";\n   }\n\n   if ($_POST[''action''] == "subscribe") {\n      if (!isset($_POST[''email'']) || !$_POST[''email'']) {\n         $sMessage = mi18n("Please specify an e-mail address.");\n      } elseif (!isValidMail($_POST[''email'']) || strpos($_POST[''email''], ",") != false || strpos($_POST[''email''], ";") != false) {\n         $sMessage = mi18n("Please specify a valid e-mail address.");\n      } elseif ($oRecipients->emailExists($_POST[''email''])) {\n         $sMessage = mi18n("This e-mail address has been already registered for the newsletter.");\n      } else {\n         $sEMail = preg_replace(''/[\\r\\n]+/'', '''', stripslashes($_POST[''email'']));\n         $sName  = stripslashes($_POST["emailname"]);\n\n         // Which newsletter type should the recipient receive?\n         switch ($aSettings[''JoinMessageType''])\n         {\n            case "user":\n               if ($_POST["selNewsletterType"] == 1) {\n                  $iMessageType = 1; // html\n               } else {\n                  $iMessageType = 0; // text\n               }\n               break;\n            case "html":\n               $iMessageType = 1; // html\n               break;\n            default:\n               $iMessageType = 0; // Default: text\n         }\n\n         // Analyze group specification\n         switch ($aSettings[''JoinSel''])\n         {\n            case "Selected":\n               $recipient = $oRecipients->create($sEMail, $sName, 0, $aSettings[''JoinGroups''], $iMessageType);\n               break;\n            case "UserSelected":\n               $iSelCount = count($_POST[''selNewsletterGroup'']);\n\n               if ($iSelCount == 0) {\n                  $recipient = $oRecipients->create($sEMail, $sName, 0, "", $iMessageType); // No group selected\n               } else {\n                  if ($iSelCount > 1 && $aSettings[''JoinMultiple''] != "enabled") {\n                     $sMessage = mi18n("Please select one group, only.");\n                  } else {\n                     // Recipient wants to join special groups\n                     $aGroups = explode(",", $aSettings[''JoinGroups'']);\n\n                     /* Check, if received data is valid and matches the group selection */\n                     $bError = false;\n                     foreach ($_POST[''selNewsletterGroup''] as $iIDGroup)\n                     {\n                        if (!is_numeric($iIDGroup) || !in_array($iIDGroup, $aGroups))\n                        {\n                           $bError = true;\n                           break;\n                        }\n                     }\n\n                     if ($bError) {\n                        $sMessage = mi18n("There was an error processing your request. Please ask the webmaster for help.");\n                     } else {\n                        $recipient = $oRecipients->create($sEMail, $sName, 0, implode(",", $_POST[''selNewsletterGroup'']));\n                     }\n                  }\n               }\n               break;\n            default:\n               $recipient = $oRecipients->create($sEMail, $sName, 0, "", $iMessageType);\n         }\n\n         if ($recipient)\n         {\n            // Add here code, if you like to store additional information per >recipient< (see frontenduser below)\n            // Example: $recipient->setProperty("contact", "firstname", $_REQUEST["firstname"]);\n            // contact/firstname have to match the values used in the firstname-recipient-plugin\n            // $_REQUEST["firstname"] contains the data from the input-field firstname in the\n            // Form module (-> there has to be a field with this name)\n            // Note: You should check the values you get (safety)!!!\n\n            $sBody = mi18n("txtMailSubscribe")."\\n".$cfgClient[$client][''path''][''htmlpath'']."front_content.php?changelang=".$lang."&idcatart=".$aSettings[''HandlerID'']."&confirm=".$recipient->get("hash")."\\n\\n";\n\n            $oMail = new PHPMailer();\n            $oMail->From     = $aSettings[''SenderEMail''];\n            $oMail->FromName = $aSettings[''SenderEMail''];\n            $oMail->AddAddress($sEMail);\n            $oMail->Mailer   = "mail";\n            $oMail->Subject  = mi18n("Newsletter: Confirmation");\n            $oMail->Body     = $sBody;\n\n            if($oMail->Send())\n            {\n               $sMessage = mi18n("Dear subscriber,<br>your e-mail address is now subscribed for our newsletter. You will now receive an e-mail asking you to confirm your subscription.");\n\n               if ($aSettings[''FrontendLink''] == "enabled")\n               {\n                  $oFrontendUsers = new cApiFrontendUserCollection();\n\n                  if (!$oFrontendUsers->userExists($sEMail))\n                  {\n                     if ($frontenduser = $oFrontendUsers->create($sEMail)) // it''s "frontenduser" (instead of oFrontendUser) for plugins...\n                     {\n                        // Add here code, if you like to store additional information per >frontenduser<\n                        // Example: $frontenduser->setProperty("contact", "firstname", $_REQUEST["firstname"]);\n                        // contact/firstname have to match the values used in the firstname-frontenduser-plugin\n                        // $_REQUEST["firstname"] contains the data from the input-field firstname in the\n                        // Form module (-> there has to be a field with this name)\n                        // Note: You should check the values you get (safety)!!!\n\n                        if ($aSettings[''FrontendConfirm''] == "ActivateUser")\n                        {\n                           // Inform about frontend user account creation\n                           $sMessage .= mi18n("<br><br>After the confirmation you will also receive a password which you can use with your e-mail address to logon to special areas on this website.");\n                        }\n                     } else {\n                        $sMessage .= mi18n("<br><br>Sorry, there was a problem creating your website account. Please ask the webmaster for help.");\n                     }\n                  }\n               }\n            } else {\n               $sMessage = mi18n("Sorry, there was a problem sending the confirmation mail to your e-mail address. Please ask the webmaster for help.");\n            }\n         } else {\n            $sMessage = mi18n("Sorry, there was a problem subscribing your e-mail address for the newsletter. Please ask the webmaster for help.");\n         }\n      }\n   } elseif ($_POST[''action''] == "delete") {\n      if (!isset($_POST[''email'']) || !$_POST[''email'']) {\n         $sMessage = mi18n("Please specify an e-mail address.");\n      } elseif (!isValidMail($_POST[''email'']) || strpos($_POST[''email''], ",") != false || strpos($_POST[''email''], ";") != false) {\n         $sMessage = mi18n("Please specify a valid e-mail address.");\n      } elseif ($recipient = $oRecipients->emailExists($_POST[''email''])) {\n         $sBody = mi18n("txtMailDelete")."\\n".$cfgClient[$client][''path''][''htmlpath'']."front_content.php?changelang=".$lang."&idcatart=".$aSettings[''HandlerID'']."&unsubscribe=".$recipient->get("hash")."\\n\\n";\n\n         $oMail = new PHPMailer();\n         $oMail->From     = $aSettings[''SenderEMail''];\n         $oMail->FromName = $aSettings[''SenderEMail''];\n         $oMail->AddAddress($recipient->get("email"));\n         $oMail->Mailer   = "mail";\n         $oMail->Subject  = mi18n("Newsletter: Cancel subscription");\n         $oMail->Body     = $sBody;\n\n         if($oMail->Send())\n         {\n            $sMessage = mi18n("Dear subscriber,<br>a mail has been sent to your e-mail address. Please confirm the cancelation of the newsletter subscription.");\n         } else {\n            $sMessage = mi18n("Sorry, there was a problem sending you the cancelation confirmation e-mail. Please ask the webmaster for help.");\n         }\n      } else {\n         $sMessage = mi18n("Sorry, the e-mail address was not found.");\n      }\n   } elseif (strlen($_GET[''confirm'']) == 30 && isAlphanumeric($_GET[''confirm''])) {\n      $oRecipients->setWhere("idclient", $client);\n      $oRecipients->setWhere("idlang", $lang);\n      $oRecipients->setWhere("hash", $_GET[''confirm'']);\n      $oRecipients->query();\n\n      if ($recipient = $oRecipients->next())\n      {\n         $iID    = $recipient->get("idnewsrcp"); // For some reason, $recipient may get invalid later on - save id\n         $sEMail = $recipient->get("email");     // ... and email\n         $recipient->set("confirmed", 1);\n         $recipient->set("confirmeddate", date("Y-m-d H:i:s"), false);\n         $recipient->set("deactivated", 0);\n         $recipient->store();\n\n         $sMessage = mi18n("Thank you! You have confirmed your subscription to our newsletter!");\n\n         $oNewsletters = New NewsletterCollection;\n         $oNewsletters->setWhere("idclient", $client);\n         $oNewsletters->setWhere("idlang", $lang);\n         $oNewsletters->setWhere("welcome", ''1'');\n         $oNewsletters->query();\n\n         if ($oNewsletter = $oNewsletters->next())\n         {\n            $aRecipients = array(); // Needed, as used by reference\n            $oNewsletter->sendDirect($aSettings[''HandlerID''], $iID, false, $aRecipients);\n\n            $sMessage .= mi18n(" The welcome newsletter is already on the way to you!");\n         }\n\n         if ($aSettings[''FrontendLink''] == "enabled" && $aSettings[''FrontendConfirm''] == "ActivateUser")\n         {\n            $oFrontendUsers = new cApiFrontendUserCollection();\n            $oFrontendUsers->setWhere("idclient", $client);\n            $oFrontendUsers->setWhere("username", $sEMail);\n            $oFrontendUsers->query();\n\n            if ($frontenduser = $oFrontendUsers->next())\n            {\n               $frontenduser->set("active", 1);\n               $sPassword = substr(md5(rand()),0,8); // Generating password\n               $frontenduser->set("password", $sPassword);\n               $frontenduser->store();\n\n               $sMessage .= mi18n("<br><br>Additionally, your website account has been activated. You can now use the following username and password to log in to access special areas on our website:<br>");\n               $sMessage .= mi18n("Username: ").$sEMail.mi18n("<br>Password: ").$sPassword;\n\n               $sBody = mi18n("txtMailPassword")."\\n\\n".mi18n("Username: ").$sEMail."\\n".mi18n("Password: ").$sPassword."\\n\\n".mi18n("Click here to login: ").$cfgClient[$client][''path''][''htmlpath'']."front_content.php?changelang=".$lang;\n\n               $oMail           = new PHPMailer();\n               $oMail->From     = $aSettings[''SenderEMail''];\n               $oMail->FromName = $aSettings[''SenderEMail''];\n               $oMail->AddAddress($sEMail);\n               $oMail->Mailer   = "mail";\n               $oMail->Subject  = mi18n("Website account");\n               $oMail->Body     = $sBody;\n\n               if($oMail->Send())\n               {\n                  $sMessage .= mi18n("<br><br>The account details and the password has also been sent to your mail account.");\n               } else {\n                  $sMessage .= mi18n("<br><br><b>Sorry, there was a problem sending you the account details by mail. Please remember the given password.</b><b>");\n               }\n            } else {\n               $sMessage .= mi18n("<br><br>Sorry, there was a problem activating your website account, also. Please ask the webmaster for help.");\n            }\n         }\n      } else {\n         $sMessage = mi18n("Sorry, there was a problem confirming your subscription. Please ask the webmaster for help.");\n      }\n   } elseif (strlen($_GET[''stop'']) == 30 && isAlphanumeric($_GET[''stop''])) {\n      $oRecipients->setWhere("idclient", $client);\n      $oRecipients->setWhere("idlang", $lang);\n      $oRecipients->setWhere("hash", $_GET[''stop'']);\n      $oRecipients->query();\n\n      if ($recipient = $oRecipients->next())\n      {\n         $recipient->set("deactivated", 1);\n         $recipient->store();\n\n         $sMessage = mi18n("Your newsletter subscription has been paused.");\n      } else {\n         $sMessage = mi18n("Sorry, there was a problem pausing your newsletter subscription. Please ask the webmaster for help.");\n      }\n   } elseif (strlen($_GET[''goon'']) == 30 && isAlphanumeric($_GET[''goon''])) {\n      $oRecipients->setWhere("idclient", $client);\n      $oRecipients->setWhere("idlang", $lang);\n      $oRecipients->setWhere("hash", $_GET[''goon'']);\n      $oRecipients->query();\n\n      if ($recipient = $oRecipients->next())\n      {\n         $recipient->set("deactivated", 0);\n         $recipient->store();\n\n         $sMessage = mi18n("Newsletter subscription has been resumed.");\n      } else {\n         $sMessage = mi18n("Sorry, there was a problem resuming your newsletter subscription. Please ask the webmaster for help.");\n      }\n   } elseif (strlen($_GET[''unsubscribe'']) == 30 && isAlphanumeric($_GET[''unsubscribe''])) {\n      $oRecipients->setWhere("idclient", $client);\n      $oRecipients->setWhere("idlang", $lang);\n      $oRecipients->setWhere("hash", $_GET[''unsubscribe'']);\n      $oRecipients->query();\n\n      if ($recipient = $oRecipients->next()) {\n         $sEMail = $recipient->get("email"); // Saving recipient e-mail address for frontend account\n         $oRecipients->delete($recipient->get("idnewsrcp"));\n\n         $sMessage = mi18n("Your e-mail address has been removed from our list of newsletter recipients.");\n\n         if ($aSettings[''FrontendLink''] == "enabled")\n         {\n            $oFrontendUsers = new cApiFrontendUserCollection();\n            $oFrontendUsers->setWhere("idclient", $client);\n            $oFrontendUsers->setWhere("username", $sEMail);\n            $oFrontendUsers->query();\n\n            if ($frontenduser = $oFrontendUsers->next())\n            {\n               switch ($aSettings[''FrontendDel''])\n               {\n                  case "DeleteUser": // Deleting frontend account\n                     $oFrontendUsers->delete($frontenduser->get("idfrontenduser"));\n                     $sMessage .= mi18n(" Your website account has been deleted.");\n                     break;\n                  case "DisableUser": // Disabling frontend account\n                     $frontenduser->set("active", 0);\n                     $frontenduser->store();\n                     $sMessage .= mi18n(" Your website account has been disabled.");\n                     break;\n                  default:\n               }\n            }\n         }\n      } else {\n         $sMessage = mi18n("Sorry, there was a problem removing your e-mail address. Please ask the webmaster for help.");\n      }\n   }\n\n   $oPage->set(''s'', ''CONTENT'', $sMessage);\n   $oPage->generate(''templates/''.$sTemplate);\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:58:52', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (15, 1, 'Picture_Gallery', 'picture_gallery', 'Content', 'none', 'Displays a picture gallery by files in upload directory', NULL, '?><?php\n/***********************************************\n* Bildergalerie Input\n*\n* Author      :     Timo A. Hummel\n* Copyright   :     four for business AG\n* Created     :     30-09-2005\n************************************************/?>\n\n<table>\n  <tr>\n    <td><?php echo mi18n("Breite");?></td>\n    <td><input type="text" name="<?php echo "CMS_VAR[0]"; ?>" value="<?php echo "CMS_VALUE[0]"; ?>"></td>\n  </tr>\n  <tr>\n    <td><?php echo mi18n("H&ouml;he");?></td>\n    <td><input type="text" name="<?php echo "CMS_VAR[1]"; ?>" value="<?php echo "CMS_VALUE[1]"; ?>"></td>\n  </tr>\n  <tr>\n    <td><?php echo mi18n("Spalten");?></td>\n    <td><input type="text" name="<?php echo "CMS_VAR[2]"; ?>" value="<?php echo "CMS_VALUE[2]"; ?>"></td>\n  </tr>\n  <tr>\n    <td><?php echo mi18n("Zeilen");?></td>\n    <td><input type="text" name="<?php echo "CMS_VAR[3]"; ?>" value="<?php echo "CMS_VALUE[3]"; ?>"></td>\n  </tr>\n  <tr>\n    <td><?php echo mi18n("Breite Detailansicht");?></td>\n    <td><input type="text" name="<?php echo "CMS_VAR[4]"; ?>" value="<?php echo "CMS_VALUE[4]"; ?>"></td>\n  </tr>\n  <?php\n  $sql = "SELECT DISTINCT dirname FROM ".$cfg[''tab''][''upl'']." ORDER BY dirname";\n  $db->query($sql);\n  echo ''<tr><td>''.mi18n("Verzeichnis ausw&auml;hlen").''</td><td>\n        <select name="CMS_VAR[5]" size="1" style="width: 320px">\n            <option value="">''.mi18n("Nichts ausgew&auml;hlt").''</option>'';\n            while ($db->next_record()) {\n                if ( stristr($db->f("dirname"),''CVS/'') === FALSE ) {\n                    if ($db->f("dirname")=="CMS_VALUE[5]") {\n                        echo ''<option value="''.$db->f("dirname").''" selected="selected">''.$db->f("dirname").''</option>'';\n                    } else {\n                        echo ''<option value="''.$db->f("dirname").''">''.$db->f("dirname").''</option>'';\n                    }\n                }\n            }\n    echo ''</select></td></tr>'';?>\n</table>\n<?php\n', '<?php\n\n\n/***********************************************\n* Bildergalerie Output\n*\n* Author      :     Timo A. Hummel\n* Copyright   :     four for business AG\n* Created     :     30-09-2005\n* Modified    :     10-04-2008 by Bilal Arslan added new Bottom Navigation and change style\n* Modified    :     22-04-2009 by Timo Trautmann, fixed parse error bug, when picture gallery has only one page\n************************************************/\n\ncInclude("includes", "functions.api.images.php");\n\ncInclude("includes", "functions.file.php");\n\n/* Gallery variables */\n$bRecursive= false;\n\n/* mi18n variables */\n$sSeeImage= mi18n("Bildvorschau");\n$sDownImage= mi18n("Bild herunterladen");\n\n$sPath= "CMS_VALUE[5]";\nif ($sPath == '''') {\n    $sPath= $cfgClient[$client]["path"]["frontend"] . $cfgClient[$client]["upl"]["frontendpath"] . "bildergalerie/";\n} else {\n    $sPath= $cfgClient[$client]["path"]["frontend"] . $cfgClient[$client]["upl"]["frontendpath"] . "CMS_VALUE[5]";\n}\n\n$iRows= "CMS_VALUE[3]";\n\nif ($iRows == 0) {\n    $iRows= 2;\n}\n\n$iColumns= "CMS_VALUE[2]";\n\nif ($iColumns == 0) {\n    $iColumns= 2;\n}\n\n$start= $_REQUEST[''start''];\n\nif (isset ($start) && $start != "") {\n    $iCurrentPage= $start;\n} else {\n    $iCurrentPage= 1;\n    $start= 1;\n}\n\n$iWidth= "CMS_VALUE[0]";\n$iHeight= "CMS_VALUE[1]";\n\nif ($iWidth == 0) {\n    $iWidth= 300;\n}\n\nif ($iHeight == 0) {\n    $iHeight= 300;\n}\n\n$iDetailWidth= "CMS_VALUE[4]";\n\nif ($iDetailWidth == 0) {\n    $iDetailWidth= 300;\n}\n\n$aValidExtensions= array(\n    "jpg",\n    "jpeg",\n    "gif",\n    "png"\n);\n\n$iImagesPerPage= $iRows * $iColumns;\n\nif ($_REQUEST[''view''] == '''') {\n    /* Read all gallery files */\n    $aGalleryFiles= scanDirectory($sPath, $bRecursive);\n\n    if (is_array($aGalleryFiles)) {\n        /* Filter out non-images */\n        foreach ($aGalleryFiles as $key => $aGalleryFile) {\n            $sExtension= strtolower(getFileType($aGalleryFile));\n\n            if (!in_array($sExtension, $aValidExtensions)) {\n                unset($aGalleryFiles[$key]);\n            }\n        }\n\n        /* Calculate effective variables */\n        $iFileCount = count($aGalleryFiles);\n        $iPages = ceil($iFileCount / $iImagesPerPage);\n\n        $aImagesToDisplay = array_slice($aGalleryFiles, ($iCurrentPage -1) * $iImagesPerPage, $iImagesPerPage);\n\n        $oImageTpl = new Template();\n        $oGalleryTpl = new Template();\n        $oEmptyImageTpl = new Template();\n\n        $aRenderedImages = array();\n\n        $iRow = 0;\n        $iImagesRendered = 0;\n        $j = 1;\n        foreach ($aImagesToDisplay as $sImageToDisplay) {\n\n            $sDownloadImage = str_replace($cfgClient[$client][''path''][''frontend''], '''', $sImageToDisplay);\n\n            /* Do Scaling */\n            $sScaledImage= cApiImgScale($sImageToDisplay, $iWidth, $iHeight);\n\n            $link= ''front_content.php?idcatart='' . $idcatart . ''&amp;start='' . $_REQUEST[''start''] . ''&amp;view='' . urlencode(str_replace($cfgClient[$client][''path''][''frontend''], '''', $sImageToDisplay));\n\n            $description= ig_getImageDescription($sImageToDisplay);\n            if ($description == '''') {\n                $description= ''&nbsp;'';\n            }\n\n            $download_link= str_replace($cfgClient[$client][''path''][''frontend''], $cfgClient[$client][''path''][''htmlpath''], $sImageToDisplay);\n\n            $download_size= ig_GetReadableFileSize($sImageToDisplay);\n\n            $oImageTpl->reset();\n            $oImageTpl->set("s", "FILE", $sScaledImage);\n            $oImageTpl->set("s", "WIDTH", $iWidth);\n            $oImageTpl->set("s", "HEIGHT", $iHeight);\n            $oImageTpl->set("s", "LINK", $link);\n            $oImageTpl->set("s", "DESCRIPTION", $description);\n            $oImageTpl->set("s", "DOWNLOAD_LINK", $download_link);\n            $oImageTpl->set("s", "DOWNLOAD_SIZE", $download_size);\n            $oImageTpl->set("s", "DOWNLOAD_CAPTION", mi18n("Bild herunterladen"));\n            $oImageTpl->set("s", "PREVIEW_CAPTION", mi18n("Bildvorschau"));\n            $oImageTpl->set("s", "LINK_DOWN", $sDownloadImage); // a href\n            $oImageTpl->set("s", "LINKDESCRIPTION", '''');\n            $oImageTpl->set("s", "SEE_IMAGE", $sSeeImage);\n            $oImageTpl->set("s", "DOWN_IMAGE", $sDownImage);\n            $oImageTpl->set("s", "", $sDownImage);\n\n            #style links rechts\n            $sStyle= "";\n            $sStyle2 = '''';\n\n            if (($j % 2) == 0) {\n                $sStyle= ''text-align:right'';\n                $sStyle2 = ''padding-left:65px'';\n            } else {\n                $sStyle= ''text-align:left'';\n                $sStyle2 = '''';\n            }\n            $j++;\n            $oImageTpl->set("s", "style", $sStyle);\n            $oImageTpl->set("s", "style_2", $sStyle2);\n\n\n            $aRenderedImages[]= $oImageTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery_image.html", true, false);\n\n            $iImagesRendered++;\n\n            if ($iImagesRendered == $iColumns) {\n                $oGalleryTpl->set("d", "COLUMNS", implode("", $aRenderedImages));\n                $oGalleryTpl->next();\n                $iImagesRendered= 0;\n                $aRenderedImages= array();\n            }\n        }\n\n        if (count($aRenderedImages) < $iColumns && count($aRenderedImages) > 0) {\n            $iEmptyCells= $iColumns -count($aRenderedImages);\n\n            $oEmptyImageTpl->set("s", "WIDTH", $iWidth);\n            $oEmptyImageTpl->set("s", "HEIGHT", $iHeight);\n\n            $sEmptyCells= str_repeat($oEmptyImageTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery_empty.html", true, false), $iEmptyCells);\n\n            $oGalleryTpl->set("d", "COLUMNS", implode("", $aRenderedImages) . $sEmptyCells);\n            $oGalleryTpl->next();\n        }\n\n        //      Begin Navigation Bottom\n        $aLinks= array();\n\n        if ($iCurrentPage == "")\n            $iCurrentPage= 1;\n        $sBack= $cfgClient[$client]["path"]["htmlpath"] . sprintf("front_content.php?idcatart=%s&amp;start=%s", $idcatart, $iCurrentPage -1);\n        $sNext= $cfgClient[$client]["path"]["htmlpath"] . sprintf("front_content.php?idcatart=%s&amp;start=%s", $idcatart, $iCurrentPage +1);\n\n        for ($i= 1; $i <= $iPages; $i++) {\n\n            if ($i == $iCurrentPage) {\n                $aAllLinks[$i]= $i;\n            } else {\n                $aAllLinks[$i]= $cfgClient[$client]["path"]["htmlpath"] . sprintf("front_content.php?idcatart=%s&amp;start=%s", $idcatart, $i);\n            }\n\n        }\n\n        $sHtml= ''<a href="%s" title="%s"> %s </a>''; // Template\n\n        if ($iPages == 1) { // if pages count is = 1\n            $oCurrenTpl= new Template();\n\n            $oCurrenTpl->set("s", "Begin", '''');\n            $oCurrenTpl->set("s", "Body", '''');\n            $oCurrenTpl->set("s", "End", '''');\n            $aLinks[]= $oCurrenTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery_link.html", true, false);\n        }\n\n        if ($iCurrentPage == 1 && $iPages > 1) { // current page=1\n\n            $oTpl1= new Template();\n\n            $sNextButton= sprintf($sHtml, $sNext, mi18n("vor"), mi18n("&nbsp;vor&nbsp;") . ''<img src="images/link_pfeil_klein.gif">'');\n            $oTpl1->set("s", "Begin", '''');\n\n            foreach ($aAllLinks as $key => $value) {\n                #echo ''<br> value: ''.$value;\n                if (strlen($value) > 7) { // longer as url\n                    $sNumber= sprintf($sHtml, $value, $key, $key);\n                } else {\n                    $sNumber= $key;\n                }\n\n                $oTpl1->set(''d'', ''Body'', $sNumber);\n                $oTpl1->next();\n                $sNumber= "";\n            }\n\n            $oTpl1->set("s", "End", $sNextButton);\n            $aLinks[]= $oTpl1->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery_link.html", true, false);\n        }\n\n        if ($iCurrentPage > 1 && ($iPages - $iCurrentPage) != 0) { // body see all\n            $oPreviousTpl= new Template();\n\n            $sBackButton= sprintf($sHtml, $sBack, mi18n("zur&uuml;ck"), "<img src=''images/link_pfeil_klein_links.gif''/>" . mi18n("&nbsp;zur&uuml;ck&nbsp;"));\n            $sNextButton= sprintf($sHtml, $sNext, mi18n("vor"), mi18n("&nbsp;vor&nbsp;") . ''<img src="images/link_pfeil_klein.gif">'');\n\n            $oPreviousTpl->set("s", "Begin", $sBackButton);\n\n            foreach ($aAllLinks as $key => $value) {\n                #filter current page\n                if (strlen($value) > 7) { // longer as url\n                    $sNumber= sprintf($sHtml, $value, $key, $key);\n                } else {\n                    $sNumber= $key;\n                }\n\n                $oPreviousTpl->set(''d'', ''Body'', $sNumber);\n                $oPreviousTpl->next();\n\n            }\n\n            $oPreviousTpl->set("s", "End", $sNextButton);\n\n            $aLinks[]= $oPreviousTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery_link.html", true, false);\n        } else\n            if ($iPages - $iCurrentPage == 0) { // this is end\n                $oNextTpl= new Template();\n                $oNextTpl->reset();\n                $sBackButton= sprintf($sHtml, $sBack, mi18n("zur&uuml;ck"), "<img src=''images/link_pfeil_klein_links.gif''/>" . mi18n("&nbsp;zur&uuml;ck&nbsp;"));\n                $oNextTpl->set("s", "End", '''');\n\n                foreach ($aAllLinks as $key => $value) {\n                    #filter current page\n                    if (strlen($value) > 7) { // longer as url\n                        $sNumber= sprintf($sHtml, $value, $key, $key);\n                    } else {\n                        $sNumber= $key;\n                    }\n\n                    $oNextTpl->set(''d'', ''Body'', $sNumber);\n                    $oNextTpl->next();\n                }\n\n                $oNextTpl->set("s", "Begin", $sBackButton);\n                $aLinks[]= $oNextTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery_link.html", true, false);\n\n            }\n\n        $oGalleryTpl->set("s", "NAVIGATION", implode("", $aLinks));\n        $oGalleryTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery.html", false, false);\n        $oGalleryTpl->reset(); // Navigation end\n        unset($aAllLinks);\n    }\n} else { // See only one Image\n    $sImageToDisplay= $cfgClient[$client][''path''][''frontend''] . $_REQUEST[''view''];\n    $sScaledImage= cApiImgScale($sImageToDisplay, $iDetailWidth, 1000);\n\n    $description= ig_getImageDescription($sImageToDisplay);\n\n    $download_link= str_replace($cfgClient[$client][''path''][''frontend''], $cfgClient[$client][''path''][''htmlpath''], $sImageToDisplay);\n\n    $download_size= ig_GetReadableFileSize($sImageToDisplay);\n\n    $oImageTpl= new Template();\n    $oImageTpl->set("s", "IMG", $sScaledImage);\n    $oImageTpl->set("s", "BACKLINK", ''front_content.php?idcat='' . $idcat . ''&amp;idart='' . $idart . ''&amp;start='' . $_REQUEST[''start'']);\n    $oImageTpl->set("s", "BACKCAPTION", mi18n("&nbsp;zur&uuml;ck"));\n    $oImageTpl->set("s", "DESCRIPTION", $description);\n    $oImageTpl->set("s", "DOWNLOAD_LINK", $download_link);\n    $oImageTpl->set("s", "DOWNLOAD_SIZE", $download_size);\n    $oImageTpl->set("s", "DOWNLOAD_CAPTION", mi18n("Bild herunterladen&nbsp;"));\n\n    $oImageTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery_detail.html", false, false);\n}\n\nfunction ig_getImageDescription($idupl) {\n\n    global $cfg, $cfgClient, $db, $client, $lang;\n\n    $cApiClient= new cApiClient($client);\n    $language_separator= $cApiClient->getProperty(''language'', ''separator'');\n    if ($language_separator == "") {\n        //Sanity, if module used in client without set client setting\n        $language_separator= "???";\n        $cApiClient->setProperty(''language'', ''separator'', $language_separator);\n    }\n    if (is_numeric($idupl)) {\n        //ID is a number\n        $query= "SELECT description FROM " . $cfg["tab"]["upl_meta"] . " WHERE idlang=".$lang." AND idupl = " . $idupl;\n    } else {\n        //ID is a string\n        $path_parts= pathinfo($idupl);\n        $upload= $cfgClient[$client][''upl''][''frontendpath''];\n        $len= strlen($upload);\n        $pos= strpos($idupl, $upload);\n        $dirname= substr($path_parts[''dirname''], $pos + $len) . ''/'';\n        $query= "SELECT b.description FROM " . $cfg["tab"]["upl"] . " a,".$cfg["tab"]["upl_meta"]." b WHERE a.idupl=b.idupl AND b.idlang=".$lang." AND (dirname = ''" . $dirname . "'') AND (filename=''" . $path_parts[''basename''] . "'') AND (filetype=''" . $path_parts[''extension''] . "'')";\n    }\n    $db->query($query);\n    if ($db->next_record()) {\n        return htmlspecialchars(urldecode($db->f("description")));\n    } else {\n        return '''';\n    }\n}\n\nfunction ig_GetReadableFileSize($path) {\n    $filesize= filesize($path);\n    $unit= "bytes";\n\n    if ($filesize > 1024) {\n        $filesize= ($filesize / 1024);\n        $unit= "kB";\n    }\n    if ($filesize > 1024) {\n        $filesize= ($filesize / 1024);\n        $unit= "MB";\n    }\n    if ($filesize > 1024) {\n        $filesize= ($filesize / 1024);\n        $unit= "GB";\n    }\n    if ($filesize > 1024) {\n        $filesize= ($filesize / 1024);\n        $unit= "TB";\n    }\n\n    $filesize= round($filesize, 0);\n    return $filesize . " " . $unit;\n}\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:59:06', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (16, 1, 'RSS_Reader', 'rss_reader', 'Content', 'none', 'Display an RSS Feed.', NULL, '?><?php\n/**\n* $RCSfile$\n*\n* Description: Display an RSS Feed. Module "Input".\n*\n* @version 1.0.0\n* @author Timo Hummel, Andreas Lindner\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2005-09-30\n* }}\n*\n* $Id$\n*/\n\necho ''<table>'';\necho ''<tr><td>''.mi18n("URL").''</td><td><input type="text" name="''."CMS_VAR[0]".''" value="''."CMS_VALUE[0]".''" style="width: 320px"></td></tr>'';\necho ''<tr><td>'';\necho mi18n("RSS-Template ausw�hlen").'':</td><td><select name="CMS_VAR[1]" size="1" style="width: 320px">\n<option value="">Nichts ausgew�hlt</option>'';\n$strPath_fs = $cfgClient[$client]["path"]["frontend"].''templates/'';\n$handle = opendir($strPath_fs);\nwhile ($entryName = readdir($handle)) {\n    if (is_file($strPath_fs.$entryName)) {\n        if ("CMS_VALUE[1]"==$entryName) {\n            echo ''<option selected value="''.$entryName.''">''.$entryName.''</option>'';\n        } else {\n            echo ''<option value="''.$entryName.''">''.$entryName.''</option>'';\n        }\n    }\n}\necho ''</select></td></tr>'';\n\necho ''<tr><td>''.mi18n("Anzahl Eintr�ge").''</td><td><input type="text" name="''."CMS_VAR[2]".''" value="''."CMS_VALUE[2]".''"</td></tr>'';\n\necho ''</table>'';\n\n?><?php', '<?php\n/**\n* $RCSfile$\n*\n* Description: Display an RSS Feed. Module "Output".\n*\n* @version 1.0.0\n* @author Timo Hummel, Andreas Lindner\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2005-09-30\n* }}\n*\n* $Id$\n*/\n\ncInclude("pear", "XML/Parser.php");\ncInclude("pear", "XML/RSS.php");\n\nif ("CMS_VALUE[0]" == "")\n{\n  $sFeed = "http://www.contenido.org/rss/de/news";\n} else {\n  $sFeed = "CMS_VALUE[0]";\n}\n\nif ("CMS_VALUE[2]" == "")\n{\n  $FeedMaxItems = 999;\n} else {\n    $FeedMaxItems = intval("CMS_VALUE[2]");\n}\n\n/* Preparse feed for an encoding due to the poorly designed\n   PHP XML parser */\n$sFeedContent = substr(@file_get_contents($sFeed),0,1024);\n\n$regExp = "/<\\?xml.*encoding=[\\"\\''](.*)[\\"\\'']\\?>/i";\n\npreg_match($regExp,trim($sFeedContent),$matches);\n\nif ($matches[1])\n{\n  $rss = new XML_RSS($sFeed, $matches[1]);\n} else {\n  $rss = new XML_RSS($sFeed);\n}\n\n$rss->parse();\n\nif (!isset($tpl) || !is_object($tpl)) {\n    $tpl = new Template();\n}\n$tpl->reset();\n\n$i = 0;\nforeach ($rss->getItems() as $item)\n{\n    if ($i < $FeedMaxItems) {\n        $tpl->set("d", "TITLE", htmlentities($item[''title''],ENT_QUOTES));\n        $tpl->set("d", "LINK", htmlentities($item[''link''],ENT_QUOTES));\n        $tpl->set("d", "DESCRIPTION", htmlentities($item[''description''],ENT_QUOTES));\n        $tpl->set("d", "READ_ON", mi18n("weiterlesen"));\n        $tpl->next();\n    }\n    $i++;\n}\n\n$tpl->generate($cfgClient[$client]["path"]["frontend"]."templates/"."CMS_VALUE[1]");\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:59:19', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (17, 1, 'Search_Input', 'search_input', 'Content', 'none', 'Search input box', NULL, '', '<?php\n/**\n* $RCSfile$\n*\n* Description: Search input box\n*\n* @version 1.0.0\n* @author Rudi Bieller\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2008-04-07\n* }}\n*\n* $Id$\n*/\n\nif (!isset($tpl) || !is_object($tpl)) {\n    $tpl = new Template();\n}\n$tpl->reset();\n\n$sTargetIdcat = getEffectiveSetting(''search-results'', ''idcat'', ''1'');\n$sTargetIdart = getEffectiveSetting(''search-results'', ''idart'', ''1'');\n$sFormAction = ''front_content.php?idcat=''.$sTargetIdcat.''&amp;idart=''.$sTargetIdart;\n\n$tpl->set(''s'', ''form_action'', $sFormAction);\n$tpl->set(''s'', ''label_search'', mi18n("Suche"));\n$tpl->generate(''templates/search_input.html'');\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:59:48', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (18, 1, 'Search_Output','search_output', 'Content', 'none', 'Search output box', NULL, '', '<?php\n/**\n * $RCSfile$\n *\n * Description: Search output box\n *\n * @version 1.0.2\n * @author Willi Man\n * @copyright four for business AG <www.4fb.de>\n *\n * {@internal\n * created 2004-05-04\n * modified 2005-07-12 Andreas Lindner\n * modified 2008-04-11 Rudi Bieller\n * modified 2008-05-06 Rudi Bieller Added CON_SEARCH_MAXLEN_TEASERTEXT; Fixed <nobr> to be xhtml compliant;\n *                       Removed $action, $sCatName = getCategoryName($cat_id, $db); which was not used at all and\n *                       added a default output in case article/module was called directly (strlen(trim($searchterm)) == 0)\n * }}\n *\n * $Id$\n */\n\n#System properties in use:\n#Type: searchrange, Name: include\n#Contains comma-separated list of cats to be included into search (sub-cats are included automatically)\n\n#Logical combination of search terms with AND or OR\n\ndefine(''CON_SEARCH_ITEMSPERPAGE'', 10);\ndefine(''CON_SEARCH_MAXLEN_TEASERTEXT'', 200);\n\n#Includes\ncInclude(''includes'', ''functions.api.string.php'');\n\n#Initiliaze template object\nif (!is_object($tpl)) {\n    $tpl = new Template();\n}\n$tpl->reset();\n\n#Settings\n$oArticleProp = new Article_Property($db, $cfg);\n$iArtspecReference = 2;\n\n$cApiClient = new cApiClient($client);\n$sSearchRange = $cApiClient->getProperty(''searchrange'', ''include'');\n$aSearchRange = explode('','', $sSearchRange);\n\n#Multilingual settings\n$sYourSearchFor = mi18n("Ihre Suche nach");\n$sMore = mi18n("mehr");\n\n#Get search term and pre-process it\nif (isset ($_GET[''searchterm''])) {\n    $searchterm = urldecode(htmlentities(strip_tags(stripslashes($_GET[''searchterm'']))));\n} elseif (isset ($_POST[''searchterm''])) {\n    $searchterm = urldecode(htmlentities(strip_tags(stripslashes($_POST[''searchterm'']))));\n}\n$searchterm = str_replace('' + '', '' AND '', $searchterm);\n$searchterm = str_replace('' - '', '' NOT '', $searchterm);\n$searchterm_display = $searchterm;\n\n#Get all article specs\n$sql = "SELECT idartspec, artspec FROM " . $cfg[''tab''][''art_spec''] . " WHERE "\n     . "client=$client AND lang=$lang AND online=1";\n\n$db->query($sql);\n$rows = $db->num_rows();\n$aArtspecOnline = array();\n$aArtSpecs = array();\n$c = 1;\n$d = 1;\n$e = 1;\nwhile ($db->next_record()) {\n    $aArtSpecs[] = $db->f(''idartspec'');\n}\n$aArtSpecs[] = 0;\n\nif (strlen(trim($searchterm)) > 0) {\n    #Parse search term and set search options\n    $searchterm = html_entity_decode($searchterm);\n\n    if (stristr($searchterm, '' or '') === false) {\n        $combine = ''and'';\n    } else {\n        $combine = ''or'';\n    }\n    $searchterm = str_replace('' and '', '' '', strtolower($searchterm));\n    $searchterm = str_replace('' or '', '' '', strtolower($searchterm));\n\n    $options = array(\n        ''db'' => ''regexp'', // use db function regexp\n        ''combine'' => $combine, // combine searchterms with and\n        ''exclude'' => false, // => searchrange specified in ''cat_tree'', ''categories'' and ''articles'' is excluded, otherwise included (exclusive)\n        ''cat_tree'' => $aSearchRange, // searchrange\n        ''artspecs'' => $aArtSpecs, // array of article specifications => search only articles with these artspecs\n        ''protected'' => true, // => do not search articles or articles in categories which are offline or protected\n    );\n\n    $search = new Search($options);\n\n    $cms_options = array(''head'', ''html'', ''htmlhead'', ''htmltext'', ''text''); // search only in these cms-types\n    $search->setCmsOptions($cms_options);\n\n    #Execute search\n    $aSearchResults = $search->searchIndex($searchterm, '''');\n\n    #Build results page\n    if (count($aSearchResults) > 0) {\n        $tpl->set(''s'', ''result_page'', mi18n("Ergebnis-Seite").'':'');\n\n        #Build meessage\n        $message = $sYourSearchFor." ''".htmlspecialchars(strip_tags($searchterm_display))."'' ".mi18n("hat $$$ Treffer ergeben").":";\n        $message = str_replace(''$$$'', count($aSearchResults), $message);\n        $tpl->set(''s'', ''MESSAGE'', $message);\n\n        #Number of results per page\n        $number_of_results = CON_SEARCH_ITEMSPERPAGE;\n        $oSearchResults = new cSearchResult($aSearchResults, $number_of_results);\n\n        $num_res = $oSearchResults->getNumberOfResults() + $pdf_count;\n        $num_pages = $oSearchResults->getNumberOfPages();\n        $oSearchResults->setReplacement(''<strong>'', ''</strong>''); // html-tags to emphasize the located searchterms\n\n        #Get current result page\n        if (isset ($_GET[''page'']) && is_numeric($_GET[''page'']) && $_GET[''page''] > 0) {\n            $page = $_GET[''page''];\n            $res_page = $oSearchResults->getSearchResultPage($page);\n        } else {\n            $page = 1;\n            $res_page = $oSearchResults->getSearchResultPage($page);\n        }\n\n        #Build links to other result pages\n        for ($i = 1; $i <= $num_pages; $i ++) {\n            // this is just for sample client - modify to your needs!\n            if ($cfg[''url_builder''][''name''] == ''front_content'' || $cfg[''url_builder''][''name''] == ''MR'') {\n                $aParams = array(\n                    ''lang'' => $lang, ''idcat'' => $idcat, ''idart'' => $idart,\n                    ''searchterm'' => $searchterm_display, ''page'' => ($i.$sArtSpecs)\n                );\n            } else {\n                $aParams = array(\n                    ''search'' => array(''lang'' => $lang, ''idcat'' => $idcat, ''idart'' => $idart,\n                    ''searchterm'' => $searchterm_display, ''page'' => ($i.$sArtSpecs)),\n                    ''idcat'' => $idcat, // needed to build category path\n                    ''lang'' => $lang, // needed to build category path\n                    ''level'' => 1, // needed to build category path\n                );\n            }\n            try {\n                $nextlink = Contenido_Url::getInstance()->build($aParams);\n            } catch (InvalidArgumentException $e) {\n                $nextlink = $sess->url(''front_content.php?idcat=''.$idcat.''&amp;idart=''.$idart.''&amp;searchterm=''.$searchterm_display.''&amp;page=''.$i.$sArtSpecs);\n            }\n            if ($i == $page) {\n                $nextlinks .= ''<span style="white-space:nowrap;">&nbsp;<strong>''.$i.''</strong>&nbsp;</span>'';\n            } else {\n                $nextlinks .= ''<span style="white-space:nowrap;">&nbsp;<a href="''.$nextlink.''" title="''.$i.''. ''.mi18n("Ergebnisseite anzeigen").''">''.$i.''</a>&nbsp;</span>'';\n            }\n        }\n        $tpl->set(''s'', ''PAGES'', $nextlinks);\n\n        #Build link to next result page\n        if ($page < $num_pages) {\n            $n = $page +1;\n            // this is just for sample client - modify to your needs!\n            if ($cfg[''url_builder''][''name''] == ''front_content'' || $cfg[''url_builder''][''name''] == ''MR'') {\n                $aParams = array(\n                    ''lang'' => $lang, ''idcat'' => $idcat, ''idart'' => $idart,\n                    ''searchterm'' => $searchterm_display, ''page'' => ($n.$sArtSpecs)\n                );\n            } else {\n                $aParams = array(\n                    ''search'' => array(''lang'' => $lang, ''idcat'' => $idcat, ''idart'' => $idart,\n                    ''searchterm'' => $searchterm_display, ''page'' => ($n.$sArtSpecs)),\n                    ''idcat'' => $idcat, // needed to build category path\n                    ''lang'' => $lang, // needed to build category path\n                    ''level'' => 1, // needed to build category path\n                );\n            }\n            try {\n                $next = Contenido_Url::getInstance()->build($aParams);\n            } catch (InvalidArgumentException $e) {\n                $next = $sess->url(''front_content.php?idcat=''.$idcat.''&amp;idart=''.$idart.''&amp;searchterm=''.$searchterm.''&amp;page=''.$n.$sArtSpecs);\n            }\n            $nextpage .= ''&nbsp;<a href="''.$next.''" title="''.mi18n("n�chste Ergebnisseite anzeigen").''">''.mi18n("vor").''&nbsp;&nbsp;<img src="images/link_pfeil_klein.gif" alt="" /></a>'';\n            $tpl->set(''s'', ''NEXT'', $nextpage);\n        } else {\n            $tpl->set(''s'', ''NEXT'', '''');\n        }\n\n        #Build link to previous result page\n        if ($page > 1) {\n            $p = $page -1;\n            // this is just for sample client - modify to your needs!\n            if ($cfg[''url_builder''][''name''] == ''front_content'' || $cfg[''url_builder''][''name''] == ''MR'') {\n                $aParams = array(\n                    ''lang'' => $lang, ''idcat'' => $idcat, ''idart'' => $idart,\n                    ''searchterm'' => $searchterm_display, ''page'' => ($p.$sArtSpecs)\n                );\n            } else {\n                $aParams = array(\n                    ''search'' => array(''lang'' => $lang, ''idcat'' => $idcat, ''idart'' => $idart,\n                    ''searchterm'' => $searchterm_display, ''page'' => ($p.$sArtSpecs)),\n                    ''idcat'' => $idcat, // needed to build category path\n                    ''lang'' => $lang, // needed to build category path\n                    ''level'' => 1, // needed to build category path\n                );\n            }\n            try {\n                $pre = Contenido_Url::getInstance()->build($aParams);\n            } catch (InvalidArgumentException $e) {\n                $pre = $sess->url(''front_content.php?idcat=''.$idcat.''&amp;idart=''.$idart.''&amp;searchterm=''.$searchterm.''&amp;page=''.$p.$sArtSpecs);\n            }\n            $prevpage .= ''<a href="''.$pre.''" title="''.mi18n("vorherige Ergebnisseite anzeigen").''"><img src="images/link_pfeil_klein_links.gif" alt="" />&nbsp;&nbsp;''.mi18n("zur�ck").''</a>&nbsp;'';\n            $tpl->set(''s'', ''PREV'', $prevpage);\n        } else {\n            $tpl->set(''s'', ''PREV'', '''');\n        }\n\n        if (count($res_page) > 0) {\n            $i = 1;\n            #Build single search result on result page\n            foreach ($res_page as $key => $val) {\n                $num = $i + (($page -1) * $number_of_results);\n                $oArt = new cApiArticleLanguage();\n                $oArt->loadByArticleAndLanguageId($key, $lang);\n                #Get publishing date of article\n                $pub_system = $oArt->getField(''published'');\n                $pub_user = trim(strip_tags($oArt->getContent(''HEAD'', 90)));\n                if ($pub_user != '''') {\n                    $show_pub_date = "[".$pub_user."]";\n                } else {\n                    $show_pub_date = '''';\n                    if ($pub_system[8] != ''0'') {\n                        $show_pub_date .= $pub_system[8];\n                    }\n                    $show_pub_date .= $pub_system[9].''.'';\n                    if ($pub_system[5] != ''0'') {\n                        $show_pub_date .= $pub_system[5];\n                    }\n                    $show_pub_date .= $pub_system[6].".".$pub_system[0].$pub_system[1].$pub_system[2].$pub_system[3]."]";\n                    $show_pub_date = "[".$show_pub_date;\n                }\n\n                #Get text and headline of current article\n                $iCurrentArtSpec = $oArticleProp->getArticleSpecification($key, $lang);\n                $aHeadline = $oSearchResults->getSearchContent($key, ''HTMLHEAD'', 1);\n                $aSubheadline = $oSearchResults->getSearchContent($key, ''HTMLHEAD'', 2);\n                $text = $oSearchResults->getSearchContent($key, ''HTML'', 1);\n                $text = cApiStrTrimAfterWord($text[0], CON_SEARCH_MAXLEN_TEASERTEXT);\n                $headline = cApiStrTrimAfterWord($aHeadline[0], CON_SEARCH_MAXLEN_TEASERTEXT); # conflict with cApiStrTrimAfterWord and setReplacement(''<strong>'', ''</strong>'')\n                $subheadline = cApiStrTrimAfterWord($aSubheadline[0], CON_SEARCH_MAXLEN_TEASERTEXT);\n\n                $cat_id = $oSearchResults->getArtCat($key);\n                $similarity = $oSearchResults->getSimilarity($key);\n\n                $similarity = sprintf("%.0f", $similarity);\n\n                #Send output to template\n                // this is just for sample client - modify to your needs!\n                if ($cfg[''url_builder''][''name''] == ''front_content'' || $cfg[''url_builder''][''name''] == ''MR'') {\n                    $aParams = array(''lang'' => $lang, ''idcat'' => $cat_id, ''idart'' => $key);\n                } else {\n                    $aParams = array(\n                        ''search'' => array(''lang'' => $lang, ''idcat'' => $cat_id, ''idart'' => $key),\n                        ''idcat'' => $idcat, // needed to build category path\n                        ''lang'' => $lang, // needed to build category path\n                        ''level'' => 1, // needed to build category path\n                    );\n                }\n                try {\n                    $href = Contenido_Url::getInstance()->build($aParams);\n                } catch (InvalidArgumentException $e) {\n                    $href = $sess->url("front_content.php?idcat=$cat_id&amp;idart=$key");\n                }\n                $tpl->set(''d'', ''more'', $sMore);\n                $tpl->set(''d'', ''HREF'', $href);\n                $tpl->set(''d'', ''TITLE'', mi18n("Link zu Suchergebnis").'' ''.$i);\n                $tpl->set(''d'', ''NUM'', $num);\n                $tpl->set(''d'', ''CATNAME'', $headline);\n                $tpl->set(''d'', ''HEADLINE'', $text);\n                $tpl->set(''d'', ''SUBHEADLINE'', $subheadline);\n                $tpl->set(''d'', ''SIMILARITY'', $similarity);\n                $tpl->set(''d'', ''TARGET'', ''_self'');\n                $tpl->set(''d'', ''PUB_DATE'', $show_pub_date);\n                $tpl->next();\n                $i ++;\n\n            }\n            $tpl->generate(''templates/search_output.html'');\n        }\n    } else {\n        #No results\n        $tpl->set(''s'', ''MESSAGE'', $sYourSearchFor." ''".htmlspecialchars(strip_tags($searchterm))."'' ".mi18n("hat leider keine Treffer ergeben").".");\n        $tpl->set(''s'', ''NEXT'', '''');\n        $tpl->set(''s'', ''PREV'', '''');\n        $tpl->set(''s'', ''PAGES'', '''');\n        $tpl->set(''s'', ''result_page'', '''');\n        $tpl->generate(''templates/search_output.html'');\n    }\n\n} else {\n    echo ''<div id="searchResults">'';\n    echo ''<h1>''.mi18n("Keine Suchergebnisse - Bitte suchen Sie �ber das Sucheingabefeld!").''</h1>'';\n    echo ''</div>'';\n}\n\nclass Article_Property {\n    var $globalConfig;\n    var $oDBInstance;\n\n    /**\n     * Constructor\n     * Hint: Call constructor with Article_Property($db, $cfg);\n     * @param  oDBInstance instance of class DB_Contenido\n     * @param  globalConfig\n     */\n    function Article_Property($oDBInstance, $globalConfig) {\n        $this->globalConfig = $globalConfig;\n        $this->oDBInstance = $oDBInstance;\n    }\n\n    /**\n     * Get specification of an article\n     *\n     * @param   $iArticleId\n     * @return  id of article specification\n     */\n    function getArticleSpecification($iArticleId, $iLangId) {\n\n        $sql = "SELECT artspec FROM " . $this->globalConfig[''tab''][''art_lang''] . " WHERE "\n             . "idart=" . (int) $iArticleId . " AND idlang=" . (int) $iLangId;\n\n        #echo "<pre>$sql</pre>";\n        $this->oDBInstance->query($sql);\n\n        if ($this->oDBInstance->next_record()) {\n            return $this->oDBInstance->f(''artspec'');\n        } else {\n            return false;\n        }\n    }\n}\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 16:00:03', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (19, 1, 'Sitemap','sitemap', 'Content', 'none', '', NULL, '?><?php\n/**\n * Project:\n * contenido.org\n *\n * Description:\n * Simple sitemap\n *\n * Requirements:\n * @con_php_req 5.0\n *\n *\n * @version    0.1.0\n * @author     Rudi Bieller\n * @copyright  four for business AG <www.4fb.de>\n * @license    http://www.contenido.org/license/LIZENZ.txt\n * @link       http://www.4fb.de\n * @link       http://www.contenido.org\n * @todo move function to load all categories somewhere else...\n * @todo use some template instead of html in code...\n *\n * {@internal\n *   created 2009-01-05\n *   $Id: Sitemap_Standard_INPUT.php 3410 2009-01-07 15:51:49Z rudi.bieller $\n * }}\n *\n */\n\nif (!isset($db)) {\n    $db = cRegistry::getDb();\n}\n\n$iSelectedCat = intval("CMS_VALUE[1]");\n$iSelectedDepth = intval("CMS_VALUE[2]");\n$iSelectedHtmlOutputStyle = intval("CMS_VALUE[3]");\n$aAllCategories = sitemap_getAllCategories($db, $cfg, $lang, $client);\n$sOptionsCategories = '''';\n$sOptionsDepth = '''';\n$sSelectedHtmlStyle0 = $iSelectedHtmlOutputStyle == 0 ? '' selected="selected"'' : '''';\n$sSelectedHtmlStyle1 = $iSelectedHtmlOutputStyle == 1 ? '' selected="selected"'' : '''';\n\n$sHtmlTable = ''<table border="0" cellpadding="10" cellspacing="0">\n    <tr>\n        <td>''.mi18n("Kategorie w�hlen:").''</td>\n        <td>\n            <select name="'' . "CMS_VAR[1]" . ''">\n                <option value="0">---Alle---</option>\n                [SNIP_CATEGORIES]\n            </select>\n        </td>\n</tr>\n<tr>\n    <td>''.mi18n("Maximale Anzahl Ebenen:").''</td>\n    <td>\n        <select name="'' . "CMS_VAR[2]" . ''">\n            <option value="0">---Select---</option>\n            [SNIP_DEPTH]\n        </select>\n    </td>\n</tr>\n<tr>\n    <td>''.mi18n("HTML Ausgabe:").''</td>\n    <td>\n        <select name="'' . "CMS_VAR[3]" . ''">\n            <option value="0"''.$sSelectedHtmlStyle0.''>&lt;ul&gt;&lt;li&gt;Alle Kategorien in einer Liste&lt;/li&gt;&lt;/ul&gt;</option>\n            <option value="1"''.$sSelectedHtmlStyle1.''>&lt;ul&gt;&lt;li&gt;Alle Hauptkategorien in einer eigenen ul&lt;/li&gt;&lt;/ul&gt;</option>\n        </select>\n    </td>\n</tr>\n</table>\n'';\n\n$iSelectedCat = intval("CMS_VALUE[1]");\n$iSelectedDepth = intval("CMS_VALUE[2]");\n$aAllCategories = sitemap_getAllCategories($db, $cfg, $lang, $client);\n$sOptionsCategories = '''';\n$sOptionsDepth = '''';\n\nfor ($i = 1; $i <= 30; $i++) {\n    $sSelected = $iSelectedDepth == $i ? '' selected="selected"'' : '''';\n    $sOptionsDepth .= ''<option value="''.strval($i).''"''.$sSelected.''>''.strval($i).''</option>'';\n}\n\nif (sizeof($aAllCategories) > 0) {\n    foreach ($aAllCategories as $aCatDetails) {\n        $sSelected = $iSelectedCat == intval($aCatDetails[''idcat'']) ? '' selected="selected"'' : '''';\n        $sSpace = str_repeat(''-'', intval($aCatDetails[''level'']));\n        $sCssLevelZero = intval($aCatDetails[''level'']) == 0 ? '' style="background-color:#F8FDDC;"'' : '''';\n        $sOptionsCategories .= ''<option value="''.strval($aCatDetails[''idcat'']).''"''.$sSelected.$sCssLevelZero.''>''.$sSpace.'' ''.strval($aCatDetails[''name'']).''</option>'';\n    }\n}\n\necho str_replace(array(''[SNIP_CATEGORIES]'', ''[SNIP_DEPTH]''), array($sOptionsCategories, $sOptionsDepth), $sHtmlTable);\n\n\n/**\n * Return array with all info on ALL categories of current client/lang\n *\n * @param unknown_type $oDb\n * @param array $aCfg\n * @param unknown_type $iLang\n * @param unknown_type $iClient\n * @return unknown\n */\nfunction sitemap_getAllCategories($oDb, array $aCfg, $iLang, $iClient) {\n    $aResult = array();\n    $sSql = "SELECT\n            A.idcat,\n            A.level,\n            C.name\n          FROM\n            ".$aCfg[''tab''][''cat_tree'']." AS A,\n            ".$aCfg[''tab''][''cat'']." AS B,\n            ".$aCfg[''tab''][''cat_lang'']." AS C\n          WHERE\n            A.idcat=B.idcat\n            AND B.idcat=C.idcat\n            AND C.idlang=''".intval($iLang)."''\n            AND B.idclient=''".intval($iClient)."''\n            AND C.visible=1\n          ORDER BY A.idtree";\n    $oDb->query($sSql);\n    if ($oDb->Errno == 0 && $oDb->num_rows() > 0) {\n        while($oDb->next_record()) {\n            $aResult[] = array(\n                                ''idcat'' => intval($oDb->f(''idcat'')),\n                                ''level'' => intval($oDb->f(''level'')),\n                                ''name'' => strval($oDb->f(''name''))\n                                );\n        }\n    }\n    return $aResult;\n}', '<?php\n/**\n * Project:\n * contenido.org\n *\n * Description:\n * Simple sitemap.\n * Can output all categories in one list or each main category as separate list\n *\n * To modify the behaviour of the module (e.g. style of URL, CSS classes, ...), you need to edit Contenido_Sitemap_Util::loopCats\n * @see {frontend}/includes/Util/Modules/Contenido_Sitemap_Util.class.php\n *\n * Requirements:\n * @con_php_req 5.0\n *\n *\n * @version    0.1.0\n * @author     Rudi Bieller\n * @copyright  four for business AG <www.4fb.de>\n *\n * {@internal\n *   created 2009-01-05\n *   $Id: Sitemap_Standard.php 3438 2009-01-15 10:54:05Z rudi.bieller $\n * }}\n *\n */\n\nif (!isset($db)) {\n    $db = cRegistry::getDb();\n}\nif (!isset($tpl)) {\n    $tpl = new Template();\n}\n$tpl->reset();\n\ncInclude(''classes'', ''Contenido_FrontendNavigation/Contenido_FrontendNavigation.class.php'');\ncInclude(''classes'', ''Util/Modules/Contenido_Sitemap_Util.class.php'');\n\n$iSelectedCat = intval("CMS_VALUE[1]");\n$iSelectedDepth = intval("CMS_VALUE[2]");\n$iHtmlOutputType = intval("CMS_VALUE[3]");\n$sUrlStyle = $cfg[''url_builder''][''name''];\n\nif ($iSelectedCat > 0 && $iSelectedDepth >= 0) {\n    $oFeNav = new Contenido_FrontendNavigation($db, $cfg, $client, $lang, $cfgClient);\n    $oFeNav->setAuth($auth);\n    $oSubCategories = $oFeNav->getSubCategories($iSelectedCat, true, true, 1);\n    // see if there are any subcategories to display\n    if ($oSubCategories->count() > 0) {\n        $aDepthInfo = array();\n        $aDepthInfo[0] = 0;\n        $aDepthInfo[1] = $iSelectedDepth;\n        if ($iHtmlOutputType == 1) {\n            $sMainCats = '''';\n        }\n        foreach ($oSubCategories as $oSubCategory) {\n            switch($iHtmlOutputType) {\n                case 0:\n                    Contenido_Sitemap_Util::loopCats($oSubCategory, $oFeNav, $tpl, $sUrlStyle, $cfg, $lang, $aDepthInfo);\n                    break;\n                case 1:\n                    $tpl->reset();\n                    Contenido_Sitemap_Util::loopCats($oSubCategory, $oFeNav, $tpl, $sUrlStyle, $cfg, $lang, $aDepthInfo);\n                    $sSubCats = $tpl->generate(''templates/sitemap_standard_li.html'', true);\n                    $tpl->reset();\n                    $tpl->set(''s'', ''list_items'', $sSubCats);\n                    $sMainCats .= $tpl->generate(''templates/sitemap_standard_ul.html'', true);\n                    break;\n                default:\n                    break;\n            }\n        }\n        if ($iHtmlOutputType == 0) {\n            $tpl->generate(''templates/sitemap_standard.html'');\n        } else {\n            echo $sMainCats;\n        }\n    }\n} else {\n    echo ''<p>Sitemap not configured correctly.</p>'';\n}\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 16:00:14', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (20, 1, 'Sub_Headline', 'sub_headline', 'Content', 'none', 'Output standard h2 subheadline', NULL, '', '<?php\n/**\n* $RCSfile$\n*\n* Description: Output standard h2 subheadline\n*\n* @version 1.0.0\n* @author Rudi Bieller\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2008-04-07\n* }}\n*\n* $Id$\n*/\n\n$sText = "CMS_HTMLHEAD[2]";\n\nif (!isset($tpl) || !is_object($tpl)) {\n    $tpl = new Template();\n}\n\n$tpl->reset();\nif ($contenido && $edit) {\n    $tpl->set(''s'', ''text'', $sText);\n    $tpl->generate(''templates/subheadline_h2.html'');\n} else {\n    if ($sText != '''') {\n        $tpl->set(''s'', ''text'', strip_tags($sText));\n        $tpl->generate(''templates/subheadline_h2.html'');\n    }\n}\n\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 16:00:26', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (21, 1, 'Teaser_Right', 'teaser_right', 'Content', 'none', 'Display teaser on right side', NULL, '', '<?php\n/**\n* $RCSfile$\n*\n* Description: Display teaser on right side\n*\n* @version 1.0.0\n* @author Rudi Bieller\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2008-04-07\n* }}\n*\n* $Id$\n*/\n\nif (!isset($tpl) || !is_object($tpl)) {\n    $tpl = new Template();\n}\n\n$tpl->reset();\n$tpl->generate(''templates/teaser_right.html'');\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 16:00:37', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (22, 1, 'Title_Tag', 'title_tag', 'Content', 'none', 'Outputs html tag <title> with navigation path to article.', NULL, '', '<?php\n/**\n* $RCSfile$\n*\n* Description: Print HTML title tag content\n*\n* @version 1.0.0\n* @author Rudi Bieller\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2008-04-07\n* }}\n*\n* $Id$\n*/\n\ntry {\n    $oBread = new Contenido_FrontendNavigation_Breadcrumb($db, $cfg, $client, $lang, $cfgClient);\n    $oBreadCats = $oBread->get($idcat, 1);\n    $sBread = ''CONTENIDO - '';\n    $aBread = array();\n    foreach ($oBreadCats as $oConCat) {\n        $aBread[] = $oConCat->getCategoryLanguage()->getName();\n    }\n    $sBread .= implode('' - '', $aBread);\n    $oArticle = new cApiArticleLanguage();\n    $oArticle->loadByArticleAndLanguageId($idart, $lang);\n    $sHeadline = strip_tags($oArticle->getContent(''CMS_HTMLHEAD'', 1));\n    if ($sHeadline != '''') {\n        $sBread .= '' - ''.$sHeadline;\n    }\n    echo $sBread;\n} catch (InvalidArgumentException $eI) {\n    echo ''CONTENIDO '';\n} catch (Exception $e) {\n    echo ''CONTENIDO '';\n}\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 16:00:53', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (23, 1, 'Text', 'text', 'Content', 'none', 'Displays CMS_HTML Element', NULL, '', '<?php\n/**\n* $RCSfile$\n*\n* Description: Output some HTML text\n*\n* @version 1.0.0\n* @author Rudi Bieller\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2008-04-07\n* }}\n*\n* $Id$\n*/\n\nif (!isset($tpl) || !is_object($tpl)) {\n    $tpl = new Template();\n}\n\n$tpl->reset();\n$tpl->set(''s'', ''text'', "CMS_HTML[1]");\n$tpl->generate(''templates/text_html.html'');\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 16:00:53', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (24, 1, 'Facebook', 'facebook', 'Content', 'none', 'Facebook module', NULL, '', '', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2012-02-06 09:54:15', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (25, 1, 'GooglePlus', 'googleplus', 'Content', 'none', 'Googleplus module', NULL, '', '', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2012-02-06 09:54:15', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (26, 1, 'Twitter', 'twitter', 'Content', 'none', 'Twitter module', NULL, '', '', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2012-02-06 09:54:15', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (27, 1, 'Xing', 'xing', 'Content', 'none', 'Xing module', NULL, '', '', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2012-02-06 09:54:15', '0000-00-00 00:00:00');

INSERT INTO !PREFIX!_mod VALUES (28, 1, 'GoogleAnalytics', 'googleanalytics', 'Content', 'none', 'GoogleAnalytics module', NULL, '', '', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2012-02-06 09:54:15', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (29, 1, 'Piwik', 'piwik', 'Content', 'none', 'Piwik module', NULL, '', '', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2012-02-06 09:54:15', '0000-00-00 00:00:00');