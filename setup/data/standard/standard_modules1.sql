INSERT INTO !PREFIX!_mod VALUES (1, 1, 'Article_Include', 'Content', 'none', 'This module includes an article into an other\r\n\r\nAuthor: Willi Man, Andreas Lindner, 4fb, B. Behrens\r\nVersion: 1.1', NULL, '?><?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Article Include Input\r\n*\r\n* @version 1.0.0\r\n* @author Willi Man\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2003-12-18\r\n* modified 2004-01-02\r\n* modified 2005-08-05 Andreas Lindner\r\n* }}\r\n*\r\n* $Id$\r\n*/\r\n\r\n#Get current settings\r\n$name         = "CMS_VAR[1]";\r\n$cms_idcat    = "CMS_VALUE[1]";\r\n$cms_idcatart = "CMS_VALUE[2]";\r\n\r\n#Cat selector\r\necho buildCategorySelect($name, $cms_idcat);\r\n\r\n$bDebug = false;\r\nif ($bDebug)\r\n	echo "<pre>cat $cms_idcat catart $cms_idcatart client $client lang $lang <br>webpath ".$cfgClient[$client][''path''][''htmlpath'']."</pre>";\r\n\r\necho ''<table cellpadding="0" cellspacing="0" border="0">'';\r\n\r\n#Article selector\r\necho ''\r\n	  <tr><td class="text_medium" style="padding:5px">''.mi18n("Artikel w�hlen").'': </td></tr>\r\n	  <tr><td class="text_medium" style="padding:5px">'';\r\necho ''<select name="CMS_VAR[2]" style="width:240px">'';\r\necho ''<option value="" selected>''.i18n("Please choose").''</option>'';\r\n\r\nif ($cms_idcat != "0" && strlen($cms_idcat) > 0) {\r\n	$sql = "SELECT\r\n						a.title AS title,\r\n						b.idcatart AS idcatart\r\n			   		FROM\r\n	            		".$cfg["tab"]["art_lang"]." AS a,\r\n	            		".$cfg["tab"]["cat_art"]." AS b\r\n						WHERE\r\n						b.idcat = ''".$cms_idcat."'' AND\r\n						a.idart = b.idart AND\r\n						a.idlang = ''".$lang."''";\r\n\r\n	$db->query($sql);\r\n\r\n	while ($db->next_record()) {\r\n\r\n		$catartid = $db->f(''idcatart'');\r\n		$title = $db->f(''title'');\r\n\r\n		if ($cms_idcatart != $catartid) {\r\n			echo ''<option value="''.$catartid.''">&nbsp;''.$title.''</option>'';\r\n		} else {\r\n			echo ''<option selected="selected" value="''.$catartid.''">&nbsp;''.$title.''</option>'';\r\n		}\r\n\r\n	}\r\n}\r\n\r\necho ''</select>&nbsp;<input type="image" src="images/submit.gif">'';\r\necho ''</td></tr></table>'';\r\n?><?php', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Article Include Output\r\n*\r\n* @version 1.0.0\r\n* @author Willi Man\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2003-12-18\r\n* modified 2004-01-02\r\n* modified 2005-08-05 Andreas Lindner\r\n* }}\r\n*\r\n* $Id$\r\n*/\r\n\r\n#Get current settings\r\n$cms_idcat    = "CMS_VALUE[1]";\r\n$cms_idcatart = "CMS_VALUE[2]";\r\n\r\n$bDebug = false;\r\n\r\n#Check data\r\n$cms_idcat    = (int)$cms_idcat;\r\n$cms_idcatart = (int)$cms_idcatart;\r\n\r\nif ($bDebug) {\r\n   echo "<pre> cat $cms_idcat catart $cms_idcatart</pre>";\r\n}\r\n\r\nif ($cms_idcat >= 0 && $cms_idcatart >= 0)\r\n{\r\n   $bArticleAvailable = false;\r\n   # Get idcat, idcatart, idart and lastmodified from the database\r\n   $sql = "SELECT A.idart AS idart, A.idcat AS idcat, A.createcode AS createcode,\r\n                  A.idcatart AS idcatart, B.lastmodified AS lastmodified\r\n           FROM ".$cfg["tab"]["cat_art"]." AS A, ".$cfg["tab"]["art_lang"]." AS B\r\n           WHERE\r\n            A.idart = B.idart AND\r\n            B.online = 1 AND ";\r\n\r\n   if ($cms_idcatart == 0)\r\n   {\r\n      $sql .= "A.idcat = ''" . $cms_idcat . "'' ORDER BY B.lastmodified DESC"; # Only idcat specified, get latest article of category\r\n   } else {\r\n      $sql .= "A.idcatart = ''" . $cms_idcatart . "''"; # Article specified\r\n   }\r\n\r\n   if ($bDebug)\r\n   {\r\n      echo "<pre>";\r\n      print_r($sql);\r\n      echo "</pre>";\r\n   }\r\n   $db->query($sql);\r\n\r\n   if ($db->next_record())\r\n   { \r\n      $bArticleAvailable = true; \r\n      $iIDCatArt   = $db->f("idcatart"); \r\n      $iIDCat      = $db->f("idcat"); \r\n      $iIDArt      = $db->f("idart"); \r\n      $iCreateCode = $db->f("createcode"); \r\n      $sModified   = $db->f("lastmodified"); \r\n   } \r\n\r\n   $db->free();\r\n\r\n   # Check if category is online or protected\r\n   $sql = "SELECT public, visible \r\n           FROM " . $cfg["tab"]["cat_lang"] . " \r\n           WHERE idcat = ''" . $iIDCat . "'' AND idlang = ''" . $lang . "''";\r\n   \r\n   if ($bDebug)\r\n   {\r\n      echo "<pre>";\r\n      print_r($sql);\r\n      echo "</pre>";\r\n   }\r\n   \r\n   $db->query($sql);\r\n   $db->next_record();\r\n\r\n   $iPublic  = $db->f("public");\r\n   $iVisible = $db->f("visible"); \r\n\r\n   $db->free(); \r\n\r\n   # Check if article is online\r\n   # Not needed anymore, as only online articles are used\r\n   /* $sql = "SELECT online FROM " . $cfg["tab"]["art_lang"] . "\r\n           WHERE idart = ''" . $cms_artid . "'' AND idlang = ''" . $lang . "''";\r\n\r\n   if ($bDebug)\r\n   {\r\n      echo "<pre>";\r\n      print_r($sql);\r\n      echo "</pre>";\r\n   }\r\n   $db->query($sql);\r\n   $db->next_record();\r\n\r\n   $online = $db->f("online");\r\n\r\n   $db->free(); */\r\n\r\n   # If the article is online and the according category is not protected and visible, include the article\r\n   if ($bArticleAvailable && $iPublic == 1 && $iVisible == 1) \r\n   { \r\n      # Check, if code creation is necessary \r\n      # Note, that createcode may be 0, but no code is available (all code for other languages will be deleted in \r\n      # front_content, if code for one language will be created). This "bug" may be fixed in future releases. \r\n      if ($iCreateCode == 0) \r\n      { \r\n         $sql = "SELECT count(*) AS CodeCount FROM " . $cfg["tab"]["code"] . " \r\n                 WHERE idcatart = ''" . $iIDCatArt . "'' AND idlang = ''" . $lang . "''";\r\n         \r\n         if ($bDebug)\r\n         {\r\n            echo "<pre>";\r\n            print_r($sql);\r\n            echo "</pre>";\r\n         }\r\n\r\n         $db->query($sql);\r\n         $db->next_record();\r\n\r\n         if ($db->f("CodeCount") == 0) {\r\n            $iCreateCode = 1;\r\n         }\r\n         $db->free();\r\n      }\r\n\r\n      # Create code if necessary\r\n      if ($iCreateCode == 1)\r\n      {\r\n         cInclude(''includes'', ''functions.con.php'');\r\n         cInclude(''includes'', ''functions.tpl.php'');\r\n         cInclude(''includes'', ''functions.mod.php'');\r\n\r\n         conGenerateCode($iIDCat, $iIDArt, $lang, $client);\r\n      } \r\n\r\n      # Get code from database and execute it \r\n      $sql = "SELECT code FROM " . $cfg["tab"]["code"] . " \r\n              WHERE idcatart = ''" . $iIDCatArt . "'' AND idlang = ''" . $lang . "''";\r\n\r\n      if ($bDebug)\r\n      {\r\n         echo "<pre>"; \r\n         print_r($sql); \r\n         echo "</pre>"; \r\n      } \r\n\r\n      $db->query($sql); \r\n\r\n      if ($db->next_record()) \r\n      {\r\n         $sCode = stripslashes($db->f("code")); \r\n         $db->free(); \r\n\r\n         ob_start();\r\n         eval("?>\r\n".$sCode."\r\n<?php\r\n");\r\n         $sCode = ob_get_contents();\r\n\r\n         # Clean buffer\r\n         ob_end_clean();\r\n\r\n         $iStartPos = strpos($sCode, "<!--start:content-->");\r\n         $iEndPos   = strpos($sCode, "<!--end:content-->");\r\n         $iDiffLen  = $iEndPos - $iStartPos;\r\n\r\n         $sCode = substr($sCode, $iStartPos, $iDiffLen);\r\n\r\n         echo $sCode;\r\n      } else {\r\n         echo "<!-- ERROR in module Article Include<pre>no code created for article to include!<br>idcat $cms_catid, idart $cms_artid, idlang $lang, idclient $client</pre>-->";\r\n      }\r\n   }\r\n}\r\n?>\r\n', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:49:41', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (2, 1, 'Contact_Form', 'Content', 'none', 'Dispaying contact form and submitting data via mail\r\n\r\nAuthor: Andreas Lindner\r\nVersion:1.0', NULL, '?><?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Contact Form Input\r\n*\r\n* @version 1.0.1\r\n* @author Andreas Lindner\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2005-08-12\r\n* modified 2010-06-09 Ingo van Peeren\r\n* }}\r\n*\r\n* $Id$\r\n*/\r\n?>\r\n\r\n<table border="0">\r\n	<tr>\r\n		<td><?php echo mi18n("Absender EMail");?></td>\r\n		<td><input type="text" name="<?php echo "CMS_VAR[0]";?>" value="<?php echo "CMS_VALUE[0]"; ?>"></td>\r\n	</tr>\r\n	<tr>\r\n		<td><?php echo mi18n("Absender Name");?></td>\r\n		<td><input type="text" name="<?php echo "CMS_VAR[2]";?>" value="<?php echo "CMS_VALUE[2]"; ?>"></td>\r\n	</tr>\r\n	<tr>\r\n		<td><?php echo mi18n("Empf�nger EMail");?></td>\r\n		<td><input type="text" name="<?php echo "CMS_VAR[1]";?>" value="<?php echo "CMS_VALUE[1]"; ?>"></td>\r\n	</tr>\r\n	<tr>\r\n		<td><?php echo mi18n("Betreff");?></td>\r\n		<td><input type="text" name="<?php echo "CMS_VAR[3]";?>" value="<?php echo "CMS_VALUE[3]"; ?>"></td>\r\n	</tr>\r\n	<?php\r\n	$c1 = '''';\r\n	$c2 = '''';\r\n	$c3 = '''';\r\n	$c4 = '''';\r\n	switch (strtolower("CMS_VALUE[4]")) {\r\n		case "smtp" :\r\n			$c1 = '' checked'';\r\n			break;\r\n		case "mail" :\r\n			$c2 = '' checked'';\r\n			break;\r\n		case "sendmail" :\r\n			$c3 = '' checked'';\r\n			break;\r\n		case "qmail" :\r\n			$c4 = '' checked'';\r\n			break;\r\n		default :\r\n			$c3 = '' checked'';\r\n	}\r\n	?>\r\n	<tr>\r\n		<td valign="top"><?php echo mi18n("Mailer");?></td>\r\n		<td>\r\n			<input type="radio" name="<?php echo "CMS_VAR[4]";?>" value="mail"<?php echo $c2;?>>&nbsp;<?php echo mi18n("mail");?><br/>\r\n			<input type="radio" name="<?php echo "CMS_VAR[4]";?>" value="qmail"<?php echo $c4;?>>&nbsp;<?php echo mi18n("qmail");?><br/>\r\n			<input type="radio" name="<?php echo "CMS_VAR[4]";?>" value="sendmail"<?php echo $c3;?>>&nbsp;<?php echo mi18n("sendmail");?><br/>\r\n			<input type="radio" name="<?php echo "CMS_VAR[4]";?>" value="smtp"<?php echo $c1;?>>&nbsp;<?php echo mi18n("smtp");?><br/>\r\n		</td>\r\n	</tr>\r\n	<tr>\r\n		<td><?php echo mi18n("SMTP Host");?></td>\r\n		<td><input type="text" name="<?php echo "CMS_VAR[5]";?>" value="<?php echo "CMS_VALUE[5]"; ?>"></td>\r\n	</tr>\r\n	<tr>\r\n		<td><?php echo mi18n("SMTP User");?></td>\r\n		<td><input type="text" name="<?php echo "CMS_VAR[6]";?>" value="<?php echo "CMS_VALUE[6]"; ?>"></td>\r\n	</tr>\r\n	<tr>\r\n		<td><?php echo mi18n("SMTP Passwort");?></td>\r\n		<td><input type="text" name="<?php echo "CMS_VAR[7]";?>" value="<?php echo "CMS_VALUE[7]"; ?>"></td>\r\n	</tr>\r\n</table>\r\n<?php', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Contact Form Output\r\n*\r\n* @version 1.0.0\r\n* @author Andreas Lindner\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2005-08-12\r\n* modified 2008-04-11 Rudi Bieller Changes concerning new layout\r\n* }}\r\n*\r\n* $Id$\r\n*/\r\n\r\nif (!isset($tpl) || !is_object($tpl)) {\r\n    $tpl = new Template();\r\n}\r\nelse\r\n{\r\n    $tpl->reset();\r\n}\r\n\r\nif (!isset ($_POST[''send''])) {\r\n	#Form has not been sent yet\r\n	#Create contact form\r\n    $sFormAction = $sess->url("front_content.php?idcat=$idcat&idart=$idart&parentid=$parentid");\r\n    $tpl->set("s", ''form_action'', $sFormAction);\r\n	$tpl->set("s", "ANREDE", mi18n("Anrede"));\r\n	$tpl->set("s", "ANREDE_OPTION1", mi18n("Herr"));\r\n	$tpl->set("s", "ANREDE_OPTION2", mi18n("Frau"));\r\n	$tpl->set("s", "NACHNAME", mi18n("Name"));\r\n	$tpl->set("s", "VORNAME", mi18n("Vorname"));\r\n	$tpl->set("s", "FIRMA", mi18n("Firma"));\r\n	$tpl->set("s", "STRASSE", mi18n("Stra�e/Nr."));\r\n	$tpl->set("s", "PLZORT", mi18n("PLZ/Ort"));\r\n	$tpl->set("s", "TELEFON", mi18n("Telefon"));\r\n	$tpl->set("s", "EMAIL", mi18n("E-Mail"));\r\n	$tpl->set("s", "ANLIEGEN", mi18n("Nachricht"));\r\n	$tpl->set("s", "PFLICHTFELDER", mi18n("Bitte alle Felder ausf�llen"));\r\n	$tpl->set("s", "ABSCHICKEN", mi18n("abschicken"));\r\n	$tpl->set("s", "LOESCHEN", mi18n("l�schen"));\r\n\r\n	$tpl->generate($cfgClient[$client]["path"]["frontend"]."templates/kontaktformular.html");\r\n} elseif ($_POST[''send''] == 1) {\r\n	#Form has been sent\r\n\r\n	#Check user input\r\n	$noerrors = true;\r\n	$msg = '''';\r\n	if ($_POST[''Vorname''] == '''') {\r\n		$noerrors = false;\r\n		$msg .= mi18n("Bitte geben Sie Ihren Vornamen ein!")."<br/>";\r\n	}\r\n	if ($_POST[''Nachname''] == '''') {\r\n		$noerrors = false;\r\n		$msg .= mi18n("Bitte geben Sie Ihren Namen ein!")."''<br/>";\r\n	}\r\n	if ($_POST[''EMail''] == '''') {\r\n		$noerrors = false;\r\n		$msg .= mi18n("Bitte geben Sie Ihre E-Mail-Adresse ein!")."<br/>";\r\n	}\r\n	if ($_POST[''Strasse''] == '''') {\r\n		$noerrors = false;\r\n		$msg .= mi18n("Bitte geben Sie Ihre Stra&szlig;e ein!")."<br/>";\r\n	}\r\n	if ($_POST[''PLZOrt''] == '''') {\r\n		$noerrors = false;\r\n		$msg .= mi18n("Bitte geben Sie Ihre PLZ/Ort ein!")."<br/>";\r\n	}\r\n\r\n	if ($noerrors == false) {\r\n		echo "<p>";\r\n		#Errors have been found\r\n		echo "<strong>".mi18n("Beim Versenden sind folgende Fehler aufgetreten:")."</strong><br/>";\r\n		echo $msg.''<br/>'';\r\n		echo ''<a href="javascript:history.back();">&lsaquo; ''.mi18n("zur&uuml;ck").''</a>'';\r\n	} else {\r\n		#No errors, create and send mail\r\n		$mail = new PHPMailer;\r\n		$mail_body = ''<html><head></head><body bgcolor="#ffffff"><table cellspacing="0" cellpadding="2" border="0">'';\r\n\r\n		if (is_array($_POST)) {\r\n			foreach ($_POST as $key => $value) {\r\n				if ($key != ''send'') {\r\n					$mail_body .= "<tr><td>$key</td><td>$value</td></tr>";\r\n				}\r\n			}\r\n		}\r\n\r\n		$mail_body .= ''</table></bo''.''dy></html>'';\r\n		$mail->Host = "localhost";\r\n		$mail->IsHTML(true);\r\n\r\n		#Get mailer from settings\r\n		switch (strtolower("CMS_VALUE[4]")) {\r\n			case "smtp" :\r\n				$mail->IsSMTP();\r\n				$host = "CMS_VALUE[5]";\r\n				$user = "CMS_VALUE[6]";\r\n				$password = "CMS_VALUE[7]";\r\n				if (($host != '''') && ($user != '''') && ($password != '''')) {\r\n					$mail->SMTPAuth = true;\r\n					$mail->Host = $host;\r\n					$mail->Username = $user;\r\n					$mail->Password = $password;\r\n				}\r\n				break;\r\n			case "mail" :\r\n				$mail->IsMail();\r\n				break;\r\n			case "sendmail" :\r\n				$mail->IsSendmail();\r\n				break;\r\n			case "qmail" :\r\n				$mail->IsQmail();\r\n				break;\r\n			default :\r\n				}\r\n		$mail->From = "CMS_VALUE[0]";\r\n		$mail->FromName = "CMS_VALUE[2]";\r\n		$mail->AddAddress("CMS_VALUE[1]", "");\r\n		$mail->Subject = "CMS_VALUE[3]";\r\n		$mail->Body = $mail_body;\r\n		$mail->WordWrap = 50;\r\n		$mail->Send();\r\n	\r\n		#Display message after mail is sent\r\n		echo mi18n("Ihr Anliegen wurde uns �bermittelt. Vielen Dank!")."<br/>";\r\n	}\r\n}\r\n?>\r\n\r\n\r\n', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:52:45', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (3, 1, 'Contenido_Header', 'Content', 'none', 'Display HTML Comment with Infos about Contenido and the Sample Client.', NULL, '', '<?php\n/**\n* $RCSfile$\n*\n* Description: Display HTML Comment with Infos about Contenido and the Sample Client.\n*\n* @version 1.0.0\n* @author Rudi Bieller\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2008-04-07\n* }}\n*\n* $Id$\n*/\n\nif (!isset($tpl) || !is_object($tpl) || strtolower(get_class($tpl)) != ''template'') {\n    $tpl = new Template();\n}\n$tpl->reset();\n$tpl->generate(''templates/contenido_header.html'');\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:53:21', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (4, 1, 'Footnotes', 'Content', 'none', 'Display Footnotes at bottom of page.', NULL, '', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Display footnotes, fixed output directly from template\r\n*\r\n* @version 1.0.0\r\n* @author Rudi Bieller\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2008-04-11\r\n* }}\r\n*\r\n* $Id$\r\n*/\r\n\r\nif (!isset($tpl) || !is_object($tpl)) {\r\n    $tpl = new Template();\r\n}\r\n\r\n$tpl->reset();\r\n$tpl->generate(''templates/footnotes_''.strval($lang).''.html'');\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:53:44', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (5, 1, 'Header', 'Content', 'none', 'Display Header with Contenido Logo, an image and the current (navigation-) location.', NULL, '', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Display Header with Contenido Logo, an image and the current (navigation-) location.\r\n* If no image is selected, the default one will be used.\r\n*\r\n* @version 1.0.0\r\n* @author Rudi Bieller\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2008-04-07\r\n* }}\r\n*\r\n* $Id$\r\n*/\r\n\r\nif (!isset($tpl) || !is_object($tpl)) {\r\n    $tpl = new Template();\r\n}\r\n\r\n// get start idcat\r\n$iIdcatStart = (int) getEffectiveSetting(''navigation'', ''idcat-home'', ''1'');\r\n\r\ntry {\r\n	// get headline\r\n    $oConCat = new Contenido_Category($db, $cfg);\r\n	$oConCat->load($idcat, true, $lang);\r\n	$sImgEdit = "CMS_IMGDESCR[1]";\r\n	$sImg = "CMS_IMG[1]";\r\n	\r\n	$sHeadline = $iIdcatStart != intval($idcat) \r\n	                ? $oConCat->getCategoryLanguage()->getName() \r\n	                : mi18n("Willkommen!");\r\n	$sCssStyle = '''';\r\n	if ($contenido && $edit) {\r\n	    echo ''<div id="modHeaderImgEdit">''.$sImgEdit.''</div>'';\r\n	}\r\n    if ($sImg != '''') {\r\n        $sCssStyle = '' style="background-image:url(''.$sImg.'');"'';\r\n    }\r\n	$tpl->reset();\r\n	$tpl->set(''s'', ''css-style'', $sCssStyle);\r\n	$tpl->set(''s'', ''url'', ''front_content.php'');\r\n	$tpl->set(''s'', ''title'', mi18n("Zur Contenido Homepage"));\r\n	$tpl->set(''s'', ''headline'', $sHeadline);\r\n	$tpl->generate(''templates/header.html'');\r\n} catch (InvalidArgumentException $eI) {\r\n    echo ''Some error occured: '' . $eI->getMessage() . '': '' . $eI->getFile() . '' at line ''.$eI->getLine() . '' (''.$eI->getTraceAsString().'')'';\r\n} catch (Exception $e) {\r\n    echo ''Some error occured: '' . $e->getMessage() . '': '' . $e->getFile() . '' at line ''.$e->getLine() . '' (''.$e->getTraceAsString().'')'';\r\n}\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:53:58', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (6, 1, 'Headline', 'Content', 'none', 'Output standard h1 headline', NULL, '', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Output standard h1 headline\r\n*\r\n* @version 1.0.0\r\n* @author Rudi Bieller\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2008-04-07\r\n* modified 2008-11-13, Timo Trautman - fixed XHTML validation error, when module displays empty h1 tag\r\n* }}\r\n*\r\n* $Id$\r\n*/\r\n\r\nif (!isset($tpl) || !is_object($tpl)) {\r\n    $tpl = new Template();\r\n}\r\n\r\n$sText = "CMS_HTMLHEAD[1]";\r\n\r\n$tpl->reset();\r\nif ($contenido && $edit) {\r\n    $tpl->set(''s'', ''text'', $sText);\r\n    $tpl->generate(''templates/headline_h1.html'');\r\n} else {\r\n    if ($sText != '''') {\r\n        $tpl->set(''s'', ''text'', strip_tags($sText));\r\n        $tpl->generate(''templates/headline_h1.html'');\r\n    }\r\n}\r\n\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:54:15', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (7, 1, 'Login_Form', 'Content', 'none', 'Display login-form.', NULL, '', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Display login form\r\n*\r\n* @version 1.0.0\r\n* @author Rudi Bieller\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2008-04-07\r\n* }}\r\n*\r\n* $Id$\r\n*/\r\n\r\nif (!isset($tpl) || !is_object($tpl)) {\r\n    $tpl = new Template();\r\n}\r\n\r\n$tpl->reset();\r\n\r\nif ($auth->auth["uid"] == "nobody") {\r\n	$sTargetIdcat = getEffectiveSetting(''login'', ''idcat'', ''1'');\r\n	$sTargetIdart = getEffectiveSetting(''login'', ''idart'', ''1'');\r\n	$sFormAction = ''front_content.php?idcat=''.$sTargetIdcat.''&amp;idart=''.$sTargetIdart;\r\n	\r\n	$tpl->set(''s'', ''headline'', mi18n("Geschlossener Bereich Login"));\r\n	$tpl->set(''s'', ''form_action'', $sFormAction);\r\n	$tpl->set(''s'', ''label_name'', mi18n("name"));\r\n	$tpl->set(''s'', ''label_pass'', mi18n("pass"));\r\n	$tpl->set(''s'', ''label_login'', mi18n("einloggen"));\r\n	$tpl->generate(''templates/login_form.html'');\r\n} else {\r\n    try {\r\n	    $oConCat = new Contenido_Category($db, $cfg);\r\n		$oConCat->load($idcat, true, $lang);\r\n		$bCatIsPublic = ($oConCat->getCategoryLanguage()->getVisible() == 1 && $oConCat->getCategoryLanguage()->getPublic() == 1) \r\n		                ? true : false;\r\n    } catch (Exception $e) {\r\n        echo $e->getMessage();\r\n    }\r\n    $oFeUserCollection = new FrontendUserCollection();\r\n	$oFeUser = $oFeUserCollection->loadItem($auth->auth["uid"]);\r\n    $sText = str_replace(''[uname]'', $oFeUser->get(''username''), mi18n("Willkommen <strong>[uname]</strong>, sch�n, dass Sie wieder bei uns vorbeischauen."));\r\n    if ($bCatIsPublic === true) {\r\n        $sUrl = ''front_content.php?idcat=''.$idcat.''&amp;idart=''.$idart.''&logout=true'';\r\n    } else {\r\n        $iIdcatHome = (int) getEffectiveSetting(''navigation'', ''idcat-home'', ''1'');\r\n        $sUrl = ''front_content.php?idcat=''.$iIdcatHome.''&amp;logout=true'';\r\n    }\r\n    $tpl->set(''s'', ''headline'', mi18n("Geschlossener Bereich Logout"));\r\n	$tpl->set(''s'', ''text'', $sText);\r\n	$tpl->set(''s'', ''url'', $sUrl);\r\n	$tpl->set(''s'', ''label_logout'', mi18n("ausloggen"));\r\n	$tpl->generate(''templates/login_form_loggedin.html'');\r\n}\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:55:09', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (8, 1, 'Logo_Bottom', 'Content', 'none', 'Display logo on bottom of page.', NULL, '', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Display Logo on bottom of page\r\n*\r\n* @version 1.0.0\r\n* @author Rudi Bieller\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2008-04-07\r\n* }}\r\n*\r\n* $Id$\r\n*/\r\nif (!isset($tpl) || !is_object($tpl)) {\r\n    $tpl = new Template();\r\n}\r\n\r\n\r\n$tpl->reset();\r\n$tpl->generate(''templates/logo_bottom.html'');\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:55:27', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (9, 1, 'Navigation_Breadcrumb', 'Navigation', 'none', 'Display a breadcrumb navigation.', NULL, '', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Build a breadcrumb navigation \r\n* starting from top idcat (of given level) down to current idcat\r\n*\r\n* @version 1.0.0\r\n* @author Rudi Bieller\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2008-04-08\r\n* }}\r\n*\r\n* $Id$\r\n*/\r\n\r\ntry {\r\n	$oBreadcrumb = new Contenido_FrontendNavigation_Breadcrumb($db, $cfg, $client, $lang, $cfgClient);\r\n	$oBreadCategories = $oBreadcrumb->get($idcat, 1); // starting level in this case is 1, not 0\r\n	if ($oBreadCategories->count() > 0) {\r\n		foreach ($oBreadCategories as $oBreadCategory) {\r\n			// please remember, this is a sample - or a live application it''s better to use a template!\r\n            echo ''&gt; <a href="front_content.php?idcat=''.$oBreadCategory->getIdCat().''">''.\r\n                        $oBreadCategory->getCategoryLanguage()->getName().\r\n                ''</a> '';\r\n		}\r\n	}\r\n} catch(Exception $e) {\r\n	echo ''Shit happens: '' . $e->getMessage() . '': '' . $e->getFile() . '' at line ''.$e->getLine() . '' (''.$e->getTraceAsString().'')'';\r\n}\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:55:44', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (10, 1, 'Navigation_Main', 'Navigation', 'none', 'Display main navigation on left side.', NULL, '', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: \r\n* Main Navigation, displays Navigation from a starting idcat down to the max. level set.\r\n* For now (as of 2009-01-12) all subcategories are put inside one <ul> and are assigned css classes \r\n* to distinguish level depth, first/last and active item property.\r\n* \r\n* Module requires two client settings: \r\n* navigation_main_standard | start_idcat\r\n* navigation_main_standard | level_depth\r\n* \r\n* To modify the behaviour of the module (e.g. style of URL, CSS classes, ...), you need to edit Contenido_NavMain_Util::loopCats\r\n* @see {frontend}/includes/Util/Modules/Contenido_NavMain_Util.class.php\r\n*\r\n* @version 1.0.0\r\n* @author Rudi Bieller\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2009-01-12\r\n* }}\r\n*\r\n* $Id: Navigation_Standard.php 3444 2009-01-19 11:42:59Z rudi.bieller $\r\n*/\r\n\r\nif (!isset($db)) {\r\n    $db = new DB_Contenido();\r\n}\r\nif (!isset($tpl)) {\r\n    $tpl = new Template();\r\n}\r\n$tpl->reset();\r\n\r\ncInclude(''frontend'', ''includes/Util/Modules/Contenido_NavMain_Util.class.php'');\r\n\r\n$iStartIdcat = getEffectiveSetting(''navigation'', ''idcat-home'', 1);\r\n$iSelectedDepth = getEffectiveSetting(''navigation'', ''level-depth'', 3);\r\n\r\nif ($iStartIdcat > 0) {\r\n    $oFeNav = new Contenido_FrontendNavigation($db, $cfg, $client, $lang, $cfgClient);\r\n    $oFeNav->setAuth($auth);\r\n    $oFeNav->setRootCat($iStartIdcat);\r\n    $oSubCategories = $oFeNav->getSubCategories($iStartIdcat, true, true, 1);\r\n    // see if there are any subcategories to display\r\n    if ($oSubCategories->count() > 0) {\r\n        $aLevelInfo = array();\r\n        $aDepthInfo = array();\r\n        $aDepthInfo[0] = 0;\r\n        $aDepthInfo[1] = $iSelectedDepth;\r\n        foreach ($oSubCategories as $oSubCategory) {\r\n            Contenido_NavMain_Util::loopCats($oSubCategory, $oFeNav, $tpl, $cfg, $lang, $aLevelInfo, intval($idcat), $aDepthInfo);\r\n        }\r\n        $tpl->generate(''templates/navigation_standard.html'');\r\n    }\r\n} else {\r\n    echo ''<p>Navigation not configured correctly.</p>'';\r\n}\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:57:42', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (11, 1, 'Navigation_Meta', 'Navigation', 'none', 'Display meta navigation on bottom of page.', NULL, '', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Meta Navigation on bottom of page\r\n*\r\n* @version 1.0.0\r\n* @author Rudi Bieller\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2008-04-07\r\n* }}\r\n*\r\n* $Id$\r\n*/\r\n\r\n// get start idcat\r\n$iIdcatStart = getEffectiveSetting(''navigation'', ''idcat-meta'', 2);\r\n\r\n//check if there is a template instance\r\nif (!isset($tpl) || !is_object($tpl)) {\r\n    $tpl = new Template();\r\n}\r\n\r\n// reset template object\r\n$tpl->reset();\r\n\r\n// build navigation\r\ntry {\r\n    $oFeNav = new Contenido_FrontendNavigation($db, $cfg, $client, $lang, $cfgClient);\r\n    $oFeNav->setAuth($auth);\r\n    $oContenidoCategories = $oFeNav->getSubCategories($iIdcatStart, true);\r\n    if ($oContenidoCategories->count() > 0) {\r\n        foreach ($oContenidoCategories as $oContenidoCategory) {\r\n            // this is just for sample client - modify to your needs!\r\n            if ($cfg[''url_builder''][''name''] == ''front_content'' || $cfg[''url_builder''][''name''] == ''MR'') {\r\n                $aParams = array(''lang'' => $lang, ''idcat'' => $oContenidoCategory->getIdCat());\r\n            } else {\r\n                $aParams = array(''a'' => $oContenidoCategory->getIdCat(), \r\n                                ''idcat'' => $oContenidoCategory->getIdCat(), // needed to build category path\r\n                                ''lang'' => $lang, // needed to build category path\r\n                                ''level'' => 0); // needed to build category path\r\n            }\r\n            try {\r\n                $tpl->set(''d'', ''url'', Contenido_Url::getInstance()->build($aParams));\r\n            } catch (InvalidArgumentException $e) {\r\n                $tpl->set(''d'', ''url'', ''front_content.php?idcat=''.$oContenidoCategory->getIdCat());\r\n            }\r\n            $tpl->set(''d'', ''title'', $oContenidoCategory->getCategoryLanguage()->getName());\r\n            $tpl->set(''d'', ''label'', $oContenidoCategory->getCategoryLanguage()->getName());\r\n            $tpl->next();\r\n        }\r\n        $sItems = $tpl->generate(''templates/navigation_meta_item.html'', true, false);\r\n        $tpl->reset();\r\n        $tpl->set(''s'', ''items'', $sItems);\r\n        $tpl->generate(''templates/navigation_meta_container.html'');\r\n    }\r\n} catch (Exception $e) {\r\n    echo ''Shit happens: '' . $e->getMessage() . '': '' . $e->getFile() . '' at line ''.$e->getLine() . '' (''.$e->getTraceAsString().'')'';\r\n}\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:57:53', '2013-01-09 01:26:19');
INSERT INTO !PREFIX!_mod VALUES (12, 1, 'News', 'Content', 'none', 'teaser article of a category\r\nAuthor: Andreas Lindner\r\nVersion:1.0', NULL, '?><?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Newslist / ArticleList. Module "Input".\r\n*\r\n* @version 1.0.0\r\n* @author Andreas Lindner\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2005-08-12\r\n* }}\r\n*\r\n* $Id$\r\n*/\r\n\r\n#Select category\r\n$cms_idcat = "CMS_VALUE[1]";\r\n\r\necho ''<table cellpadding="0" cellspacing="0" border="0">'';\r\n\r\necho ''\r\n        <tr><td class="text_medium" style="padding:5px">Kategorie w&auml;hlen: </td></tr>\r\n        <tr><td class="text_medium" style="padding:5px">'';\r\n\r\necho buildCategorySelect("CMS_VAR[1]", "CMS_VALUE[1]");\r\necho ''&nbsp;<input type="image" src="images/submit.gif">'';\r\n\r\necho ''</td></tr>'';\r\n\r\n#Select sort field and sort order\r\n$sortdate = ''checked'';\r\n$cms_imgsize = "CMS_VALUE[14]";\r\n$cms_limit_articles = "CMS_VALUE[15]";\r\n$cms_sort_direction = "CMS_VALUE[16]";\r\nif ("CMS_VALUE[17]" != '''') {\r\n    $cms_include_start_article = '' checked'';\r\n} else {\r\n    $cms_include_start_article = '''';\r\n}\r\n\r\nif ("CMS_VALUE[3]" == ''sortdate'') {\r\n    $sortdate = ''checked'';\r\n    $sortnum = '''';\r\n}\r\nelseif ("CMS_VALUE[3]" == ''sortnum'') {\r\n    $sortdate = '''';\r\n    $sortnum = ''checked'';\r\n}\r\n\r\necho ''\r\n        <tr>\r\n          <td class="text_medium" style="padding:5px;">''.mi18n("Sortierung nach Datum").'':</td>\r\n          <td style="padding:5px;"><input type="radio" name="CMS_VAR[3]" value="sortdate" ''.$sortdate.''></td>\r\n        </tr>\r\n        <tr>\r\n          <td class="text_medium" style="padding:5px;">''.mi18n("Sortierung nach Nummer").'':</td>\r\n          <td style="padding:5px;"><input type="radio" name="CMS_VAR[3]" value="sortnum" ''.$sortnum.''></td>\r\n        </tr>\r\n        <tr>\r\n          <td class="text_medium" style="padding:5px;">''.mi18n("Sortierung aufsteigend").'':</td>\r\n          <td style="padding:5px;">'';\r\nif (strtolower($cms_sort_direction) == ''desc'') {\r\n    echo ''<input type="radio" name="CMS_VAR[16]" value="asc"/>'';\r\n} else {\r\n    echo ''<input type="radio" name="CMS_VAR[16]" value="asc" checked/>'';\r\n}\r\necho ''</td>\r\n        </tr>\r\n        <tr>\r\n          <td class="text_medium" style="padding:5px;">''.mi18n("Sortierung absteigend").'':</td>\r\n          <td style="padding:5px;">'';\r\nif (strtolower($cms_sort_direction) == ''desc'') {\r\n    echo ''<input type="radio" name="CMS_VAR[16]" value="desc" checked/>'';\r\n} else {\r\n    echo ''<input type="radio" name="CMS_VAR[16]" value="desc"/>'';\r\n}\r\necho ''</td>\r\n        </tr>'';\r\n\r\n$noimg = '''';\r\nif ("CMS_VALUE[13]" == ''true'') {\r\n    $noimg = ''checked'';\r\n}\r\n\r\n#Headline\r\necho ''\r\n        <tr><td class="text_medium" style="padding:5px;">''.mi18n("&Uuml;berschrift").'': </td></tr>\r\n        <tr><td style="padding:5px;"><input type="text" name="CMS_VAR[4]" value="CMS_VALUE[4]"></td></tr>\r\n        <tr>\r\n          <td colspan="2" class="text_medium" style="padding:5px;"><b><u>''.mi18n("Bild f&uuml;r Teaser").'':</u></b></td>\r\n        </tr>\r\n        <tr>\r\n          <td colspan="2" class="text_medium" style="padding:5px;">''.mi18n("Es wird das erste Bild des Artikels angezeigt.").''</td>\r\n        </tr>'';\r\n#Image width\r\necho ''\r\n        <tr><td class="text_medium" style="padding:5px;">''.mi18n("Bildbreite").'': </td></tr>\r\n        <tr><td style="padding:5px;"><input type="text" name="CMS_VAR[14]" value="''.$cms_imgsize.''" maxlength="3"></td></tr>'';\r\n#Disable images\r\necho ''\r\n        <tr>\r\n          <td class="text_medium" style="padding:5px;">''.mi18n("Kein Bild anzeigen").'':</td>\r\n          <td style="padding:5px;"><input type="checkbox" name="CMS_VAR[13]" value="true" ''.$noimg.''></td>\r\n        </tr>'';\r\n#Number of articles\r\necho ''\r\n        <tr>\r\n          <td class="text_medium" style="padding:5px;">''.mi18n("Anzahl Artikel begrenzen").'':</td>\r\n          <td style="padding:5px;"><input type="text" name="CMS_VAR[15]" value="''.$cms_limit_articles.''"></td>\r\n        </tr>'';\r\n#Include start article\r\necho ''\r\n        <tr>\r\n          <td class="text_medium" style="padding:5px;">''.mi18n("Startartikel in Liste einbeziehen").'':</td>\r\n          <td style="padding:5px;"><input type="checkbox" name="CMS_VAR[17]" value="yes"''.$cms_include_start_article.''></td>\r\n        </tr>'';\r\n\r\necho ''</table>'';\r\n?><?php', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Newslist / ArticleList. Module "Output".\r\n*\r\n* @version 1.1.0\r\n* @author Andreas Lindner\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2005-08-12\r\n* modified 2009-01-16 Rudi Bieller Added new Contenido_Url for creating URLs\r\n* }}\r\n*\r\n* $Id$\r\n*/\r\n\r\ncInclude(''includes'', ''functions.api.string.php'');\r\ncInclude(''includes'', ''functions.api.images.php'');\r\n\r\nif (!isset($tpl) || !is_object($tpl)) {\r\n    $tpl = new Template();\r\n}\r\n\r\n$tpl->reset();\r\n\r\n$sql = "SELECT\r\n            htmlpath, frontendpath\r\n        FROM\r\n            ".$cfg["tab"]["clients"]." \r\n        WHERE\r\n            idclient = ".$client." ";\r\n\r\n$db->query($sql);\r\n\r\nif ($db->next_record()) {\r\n    $htmlpath = $db->f(''htmlpath'');\r\n    $frontendpath = $db->f(''frontendpath'');\r\n}\r\n\r\n// selected category\r\n$selcat = "CMS_VALUE[1]";\r\n$template = "teaser-standard.html";\r\n// anzahl der zeichen text\r\n$mxtext = 200;\r\n\r\n$limit = "CMS_VALUE[15]";\r\n\r\n$cms_sort_direction = "CMS_VALUE[16]";\r\nif ($cms_sort_direction == '''') {\r\n    $cms_sort_direction = ''desc'';\r\n}\r\n\r\nif ("CMS_VALUE[3]" == "sortdate") {\r\n    $order = ''lastmodified'';\r\n} else {\r\n    $order = ''artsort'';\r\n}\r\n\r\nif ("CMS_VALUE[17]" != '''') {\r\n    $with_start = true;\r\n} else {\r\n    $with_start = false;\r\n}\r\n\r\n$newsheadline = "CMS_VALUE[4]";\r\n\r\n$tpl->set(''s'', ''TITLE'', $newsheadline);\r\n\r\nif (strlen($selcat) > 0 && $selcat != ''0'') {\r\n    $options = array (''idcat'' => $selcat, "start" => $with_start, "order" => $order, "direction" => $cms_sort_direction);\r\n\r\n    $list = new ArticleCollection($options);\r\n\r\n    $count = $list->count;\r\n\r\n    if ($count > 0) {\r\n        if (is_numeric($limit) AND strlen($limit) > 0) {\r\n            if ($limit < $list->count) {\r\n                $limit_art = $limit;\r\n            } else {\r\n                $limit_art = $list->count;\r\n            }\r\n        } else {\r\n            $limit_art = $list->count;\r\n        }\r\n\r\n        for ($i = 0; $i < $limit_art; $i ++) {\r\n\r\n            $article = $list->nextArticle();\r\n\r\n            $article_id = $article->getField(''idart'');\r\n\r\n            $teaser_img = '''';\r\n            if ($noimg != ''true'') {\r\n                $text_html = $article->getContent(''CMS_HTML'', 1);\r\n\r\n                $regEx = "/<img[^>]*?>.*?/i";\r\n                $match = array ();\r\n                preg_match($regEx, $text_html, $match);\r\n\r\n                $regEx = "/(src)(=)([''\\"]?)([^\\"'']*)([''\\"]?)/i";\r\n                $img = array ();\r\n                preg_match($regEx, $match[0], $img);\r\n                $img_src = preg_split("/\\//", $img[0]);\r\n\r\n                $img_name = $img_src[count($img_src) - 1];\r\n                $img_name = preg_replace("/\\"/", "", $img_name);\r\n                $img_split = preg_split("/\\./", $img_name);\r\n                $img_type = $img_split[count($img_split) - 1];\r\n\r\n                $img_split2 = preg_split("/_/", $img_split[0]);\r\n\r\n                $name = $img_name;\r\n\r\n                if (count($img_split2) > 1) {\r\n                    $img_x = $img_split2[count($img_split2) - 1];\r\n                    $img_y = $img_split2[count($img_split2) - 2];\r\n\r\n                    if (is_numeric($img_x) AND is_numeric($img_y)) {\r\n                        $suffix = "_".$img_x."_".$img_y.".".$img_type;\r\n                        $name = preg_replace("/$suffix/", "", $img_name);\r\n                        $name = $name.".[a-zA-Z]{3}";\r\n                    }\r\n                }\r\n\r\n                $img_teaser = '''';\r\n\r\n                if (strlen($name) > 0) {\r\n                    $sql = "SELECT\r\n                                                    *\r\n                                                FROM\r\n                                                    ".$cfg["tab"]["upl"]." \r\n                                                WHERE\r\n                                                    filename REGEXP ''$name'' ";\r\n\r\n                    //echo "<pre>"; print_r($sql); echo "</pre>";\r\n\r\n                    $db->query($sql);\r\n\r\n                    if ($db->next_record()) {\r\n                        $filename = $db->f(''filename'');\r\n                        $dirname = $db->f(''dirname'');\r\n                    }\r\n\r\n                    $img_path = $cfgClient[$client]["upl"]["path"].$dirname.$filename;\r\n\r\n                    $img_size = "CMS_VALUE[14]";\r\n\r\n                    $img_teaser = capiImgScale($img_path, $img_size, $img_size, $crop = false, $expand = false, $cacheTime = 1000, $wantHQ = false);\r\n                } // end if strlen\r\n\r\n                if (strlen($img_teaser) > 0) {\r\n                    $teaser_img = ''<img src="''.$img_teaser.''" class="teaser_img">'';\r\n                } else {\r\n                    $teaser_img = '''';\r\n                }\r\n\r\n            } // end if noimg       \r\n\r\n            $headline = strip_tags($article->getContent(''CMS_HTMLHEAD'', 1));\r\n            $headline = str_replace($replace, " ", $headline);\r\n\r\n            /*          $subheadline = strip_tags($article->getContent(''CMS_HTMLHEAD'', 2));\r\n                        $subheadline = str_replace($replace, " ", $subheadline);*/\r\n\r\n            $teaserheadline = /*$subheadline."&nbsp;-&nbsp;".*/\r\n            $headline;\r\n            // this is just for sample client - modify to your needs!\r\n            if ($cfg[''url_builder''][''name''] == ''front_content'' || $cfg[''url_builder''][''name''] == ''MR'') {\r\n                $aParams = array(''lang'' => $lang, ''idcat'' => $selcat, ''idart'' => $article_id);\r\n            } else {\r\n                $aParams = array(''b'' => array(''lang'' => $lang, ''idcat'' => $selcat, ''idart'' => $article_id), \r\n                                ''idcat'' => $selcat, // needed to build category path\r\n                                ''lang'' => $lang, // needed to build category path\r\n                                ''level'' => 1); // needed to build category path\r\n            }\r\n            try {\r\n                $href = Contenido_Url::getInstance()->build($aParams);\r\n            } catch (InvalidArgumentException $e) {\r\n                $href = $sess->url("front_content.php?idcat=$selcat&amp;idart=$article_id");\r\n            }\r\n            $teasertext = $article->getField(''summary'');\r\n\r\n            if (strlen(trim($teasertext)) == 0) {\r\n                $teasertext = strip_tags($article->getContent(''CMS_HTML'', 1));\r\n                $teasertext2 = $teasertext;\r\n                $teasertext = capiStrTrimAfterWord($teasertext, $mxtext);\r\n                if ($teasertext!=$teasertext2) {\r\n                    $teasertext.= ''...'';\r\n                }\r\n                \r\n            } // end if             \r\n\r\n            $teasertext = $teasertext."&nbsp;";\r\n\r\n            $tpl->set(''d'', ''HEADLINE'', $teaserheadline);\r\n            $tpl->set(''d'', ''TEXT'', $teasertext);\r\n            $tpl->set(''d'', ''HREF'', $href);\r\n            $tpl->set(''d'', ''IMG'', $teaser_img);\r\n            $tpl->set(''d'', ''MORE'', mi18n("mehr"));\r\n\r\n            $tpl->next();\r\n\r\n        } // end for\r\n\r\n        $tpl->generate(''templates/''.$template);\r\n\r\n    }\r\n}\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:58:05', '2013-01-09 01:27:11');
INSERT INTO !PREFIX!_mod VALUES (13, 1, 'Newsletter_Form', 'Content', 'none', 'Newsletter Subscription Module V4.0.0 (for text and HTML newsletters)\r\n\r\nProvides multilanguage form for newsletter subscribing and cancellation.\r\n\r\nBased on the work of 4fb, www.x28.de, HerrB, 01.06.2007\r\n\r\nNotes:\r\n- The default language is english. Use the translation functionality to translate the module in other languages\r\n- Create a template which includes this module and create an article using that template.\r\n- Configure category/arcticle specifying handler article id', NULL, '   // Includes\r\n   cInclude(''frontend'', ''includes/class.input.helper.php''); # Note, this file is located in <client-path>/includes!\r\n\r\n   // Initialisation\r\n   $oClientLang = new cApiClientLanguage(false, $client, $lang);\r\n\r\n   /*\r\n   *  Used variables:\r\n   *  JoinSel:         Selection, which group will be joined (Default, Selected, UserSelected)\r\n   *  JoinMultiple:    If JoinSel = UserSelected then: If more than one group has been specified, select more than one\r\n   *  JoinGroups:      Selected group(s)\r\n   *  JoinMessageType: Message type for new recipients: User select (user), text or html\r\n   *  OptNewWindow:    Open handler window in new browser window?\r\n   */\r\n   $aSettings   = array();\r\n   $aSettings[''JoinSel'']         = $oClientLang->getProperty(''newsletter'', ''joinsel'');\r\n   $aSettings[''JoinMultiple'']    = $oClientLang->getProperty(''newsletter'', ''joinmultiple'');\r\n   $aSettings[''JoinGroups'']      = $oClientLang->getProperty(''newsletter'', ''joingroups'');\r\n   $aSettings[''JoinMessageType''] = $oClientLang->getProperty(''newsletter'', ''joinmessagetype'');\r\n   $aSettings[''OptNewWindow'']    = "CMS_VALUE[4]";\r\n   \r\n   // Setting default values\r\n   /*\r\n   *  If nothing is set or if the option "UserSelected" has been activated, but no groups\r\n   *  have been selected, set option "Default". Note, that requiring to select groups when option\r\n   *  "Selected" has been activated doesn''t make so much sense here (even, as it is possible to do).\r\n   *  Why? Because the groups to be joined have to be specified on the handler page, not here...\r\n   *  To prevent users to select a group (or not to save the selection) when the option "Selected" is\r\n   *  active should make more problems than just to ignore the selection in the Output area\r\n   */\r\n   \r\n   if ($aSettings[''JoinSel''] == '''' || ($aSettings[''JoinSel''] == ''UserSelected'' && $aSettings[''JoinGroups''] == '''')) {\r\n      $aSettings[''JoinSel''] = ''Default'';\r\n   }\r\n   if (!is_numeric($_REQUEST[''selHandlerCatArt''.$cnumber]) || $_REQUEST[''selHandlerCatArt''.$cnumber] < 0) {\r\n      $_REQUEST[''selHandlerCatArt''.$cnumber] = 0;\r\n   }\r\n   \r\n   // Saving changes, if any\r\n   if ($_REQUEST[''hidAction''.$cnumber] == ''save'')\r\n   {\r\n      if ($_REQUEST[''radJoin''.$cnumber] != '''' && $_REQUEST[''radJoin''.$cnumber] != $aSettings[''JoinSel''])\r\n      {\r\n         $aSettings[''JoinSel''] = $_REQUEST[''radJoin''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joinsel'', $aSettings[''JoinSel'']);\r\n      }\r\n      if ($_REQUEST[''ckbJoinMultiple''.$cnumber] != $aSettings[''JoinMultiple''])\r\n      {\r\n         $aSettings[''JoinMultiple''] = $_REQUEST[''ckbJoinMultiple''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joinmultiple'', $aSettings[''JoinMultiple'']);\r\n      }\r\n      if ($_REQUEST[''hidJoinGroups''.$cnumber] != '''' && $_REQUEST[''hidJoinGroups''.$cnumber] != $aSettings[''JoinGroups''])\r\n      {\r\n         $aSettings[''JoinGroups''] = $_REQUEST[''hidJoinGroups''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joingroups'', $aSettings[''JoinGroups'']);\r\n      }\r\n      if ($_REQUEST[''selMessageType''.$cnumber] != $aSettings[''JoinMessageType''])\r\n      {\r\n         $aSettings[''JoinMessageType''] = $_REQUEST[''selMessageType''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joinmessagetype'', $aSettings[''JoinMessageType'']);\r\n      }\r\n   \r\n      if ($_REQUEST[''ckbUpdateHandlerID''.$cnumber] == ''enabled'')\r\n      {\r\n         // Trick: If UpdateHandlerID is enabled, save id as client setting\r\n         $iHandlerCatArt = $_REQUEST[''selHandlerCatArt''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''idcatart'', $iHandlerCatArt);\r\n      }\r\n   }\r\n   // Getting current handler article id\r\n   $iHandlerCatArt = $oClientLang->getProperty(''newsletter'', ''idcatart'');\r\n   unset ($oClientLang);\r\n   \r\n   // Showing options\r\n   $oCfgTable = new UI_Config_Table;\r\n   \r\n   $oHidAction        = new cHTMLHiddenField(''hidAction''.$cnumber, ''save'');\r\n   \r\n   $oSelHandlerCatArt = new cHTMLInputSelectElement(''selHandlerCatArt''.$cnumber, 1, '''', true);\r\n   $oOption           = new cHTMLOptionElement(mi18n("- Please select -"), '''');\r\n   $oSelHandlerCatArt->addOptionElement(0, $oOption);\r\n   $oSelHandlerCatArt->addCategories(0, true, false, false, true, true);\r\n   $oSelHandlerCatArt->setDefault($iHandlerCatArt);\r\n   \r\n   $oCkbUpdate        = new cHTMLCheckbox(''ckbUpdateHandlerID''.$cnumber, ''enabled'');\r\n   $oCkbUpdate->setEvent(''click'', ''if (this.checked) {document.forms[0].selHandlerCatArt''.$cnumber.''.disabled = false;} else {document.forms[0].selHandlerCatArt''.$cnumber.''.disabled = true;}'');\r\n   \r\n   $oCfgTable->setCell(''handler'', 0, mi18n("Handler Article:"));\r\n   $oCfgTable->setCell(''handler'', 1, $oHidAction->render().$oSelHandlerCatArt->render()."\\n&nbsp;".$oCkbUpdate->toHTML(false).mi18n("Update"));\r\n   \r\n   // Getting newsletter groups (if any)\r\n   $oRcpGroups = new RecipientGroupCollection;\r\n   $oRcpGroups->setWhere(''idclient'', $client);\r\n   $oRcpGroups->setWhere(''idlang'',   $lang);\r\n   $oRcpGroups->setWhere(''defaultgroup'', ''0'');\r\n   $oRcpGroups->setOrder(''defaultgroup DESC, groupname ASC'');\r\n   $oRcpGroups->query();\r\n   \r\n   // Join options\r\n   // If newsletter groups are available, provide group options, otherwise show only\r\n   // ''Default'' option. This is necessary, as there may have been groups specified (and used)\r\n   // but they have been deleted, later on.\r\n   \r\n   $oCfgTable->setCell(''join_01'', 0, mi18n("Join:"));\r\n   \r\n   if ($oRcpGroups->Count() == 0) {\r\n      // No groups available, only default group possible\r\n   \r\n      $oRadJoinDefault = new cHTMLRadioButton (''radJoin''.$cnumber, ''Default'', '''', true);\r\n      $oCfgTable->setCell(''join_01'', 1, $oRadJoinDefault->toHTML(false).mi18n("default group"));\r\n   } else {\r\n      // Groups available, show different group join options\r\n   \r\n      // Join default group only\r\n      if ($aSettings[''JoinSel''] == ''Default'') {\r\n         $oRadJoinDefault = new cHTMLRadioButton (''radJoin''.$cnumber, ''Default'', '''', true);\r\n      } else {\r\n         $oRadJoinDefault = new cHTMLRadioButton (''radJoin''.$cnumber, ''Default'');\r\n      }\r\n      $oRadJoinDefault->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = true; document.forms[0].selGroup".$cnumber.".disabled = true;");\r\n      $oCfgTable->setCell(''join_01'', 1, $oRadJoinDefault->toHTML(false).mi18n("default group"));\r\n      $oCfgTable->setRowBgColor(''join_01'', $cfg["color"]["table_light"]);\r\n   \r\n      // Join admin selected groups automatically\r\n      if ($aSettings[''JoinSel''] == ''Selected'') {\r\n         $oRadJoinSelected = new cHTMLRadioButton (''radJoin''.$cnumber, ''Selected'', '''', true);\r\n      } else {\r\n         $oRadJoinSelected = new cHTMLRadioButton (''radJoin''.$cnumber, ''Selected'');\r\n      }\r\n      $oRadJoinSelected->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = false; document.forms[0].selGroup".$cnumber.".disabled = false;");\r\n      $oCfgTable->setCell(''join_02'', 0, '''');\r\n      $oCfgTable->setCell(''join_02'', 1, $oRadJoinSelected->toHTML(false).mi18n("selected group(s)"));\r\n      $oCfgTable->setRowBgColor(''join_02'', $cfg["color"]["table_light"]);\r\n   \r\n      // Join the groups the user has selected (-> provide a list for the user), optionally, the user may select more than one group\r\n      if ($aSettings[''JoinSel''] == ''UserSelected'')\r\n      {\r\n         $oRadJoinUserSel  = new cHTMLRadioButton (''radJoin''.$cnumber, ''UserSelected'', '''', true);\r\n         $oCkbJoinMultiple = new cHTMLCheckbox (''ckbJoinMultiple''.$cnumber, ''enabled'', '''', $aSettings[''JoinMultiple'']);\r\n      } else {\r\n         $oRadJoinUserSel  = new cHTMLRadioButton (''radJoin''.$cnumber, ''UserSelected'');\r\n         $oCkbJoinMultiple = new cHTMLCheckbox (''ckbJoinMultiple''.$cnumber, ''enabled'', '''', false, true);\r\n      }\r\n      $oRadJoinUserSel->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = false; document.forms[0].selGroup".$cnumber.".disabled = false;");\r\n      $oCfgTable->setCell(''join_03'', 0, '''');\r\n      $oCfgTable->setCell(''join_03'', 1, $oRadJoinUserSel->toHTML(false).mi18n("group(s) as selected by user").''<br />''."\\n".$oCkbJoinMultiple->toHTML(false).mi18n("Multiple group selection allowed"));\r\n      $oCfgTable->setRowBgColor(''join_03'', $cfg["color"]["table_light"]);\r\n   \r\n      $oCfgTable->setCell(''groups'', 0, mi18n("Select group(s):"));\r\n   \r\n      // Show groups\r\n      // Trick: To save multiple selections in <select>-Element, add some JS which saves the\r\n      // selection, comma separated in a hidden input field on change.\r\n      $sSkript = ''              <script type="text/javascript"><!--''."\\n".\r\n                 ''                  function fncUpdateSel() {''."\\n".\r\n                 ''                     var strSel = "";''."\\n".\r\n                 ''                     for(i = 0; i < document.forms[0].selGroup''.$cnumber.''.length; i++) {''."\\n".\r\n                 ''                        if(document.forms[0].selGroup''.$cnumber.''.options[i].selected == true) {''."\\n".\r\n                 ''                           if (strSel != "")''."\\n".\r\n                 ''                              strSel = strSel + ",";''."\\n".\r\n                 ''                           strSel = strSel + document.forms[0].selGroup''.$cnumber.''.options[i].value;''."\\n".\r\n                 ''                        }''."\\n".\r\n                 ''                     }''."\\n".\r\n                 ''                     document.forms[0].elements["hidJoinGroups''.$cnumber.''"].value = strSel;''."\\n".\r\n                 ''                  }''."\\n".\r\n                 ''                  //--></script>''."\\n";\r\n\r\n      if ($aSettings[''JoinSel''] == ''Default'') {\r\n         $oSelGroup = new cHTMLSelectElement (''selGroup''.$cnumber, '''', '''', true);\r\n      } else {\r\n         $oSelGroup = new cHTMLSelectElement (''selGroup''.$cnumber, '''');\r\n      }\r\n      $oSelGroup->setSize(5);\r\n      $oSelGroup->setMultiselect();\r\n      $oSelGroup->setEvent(''change'', "fncUpdateSel()");\r\n\r\n      $aGroups = explode('','', $aSettings[''JoinGroups'']);\r\n      while ($oRcpGroup = $oRcpGroups->next()) {\r\n         $iID = $oRcpGroup->get(''idnewsgroup'');\r\n         if (in_array ($iID, $aGroups)) {\r\n            $oOption = new cHTMLOptionElement($oRcpGroup->get(''groupname''), $iID, true);\r\n         } else {\r\n            $oOption = new cHTMLOptionElement($oRcpGroup->get(''groupname''), $iID, false);\r\n         }\r\n         $oSelGroup->addOptionElement($iID, $oOption);\r\n      }\r\n   \r\n      $oHidGroups = new cHTMLHiddenField (''hidJoinGroups''.$cnumber, $aSettings[''JoinGroups'']);\r\n      $oCfgTable->setCell(''groups'', 1, $sSkript.$oSelGroup->render().$oHidGroups->render());\r\n   }\r\n   \r\n   // Options: Message type (user [->selectbox], text or html)\r\n   $oCfgTable->setCell(''options_01'', 0, mi18n("Options:"));\r\n\r\n   $oSelMsgType = new cHTMLSelectElement (''selMessageType''.$cnumber);\r\n   $oOption = new cHTMLOptionElement(mi18n("User selected"), "user");\r\n   $oSelMsgType->addOptionElement(0, $oOption);\r\n   $oOption = new cHTMLOptionElement(mi18n("Text only"), "text");\r\n   $oSelMsgType->addOptionElement(1, $oOption);\r\n   $oOption = new cHTMLOptionElement(mi18n("HTML and text"), "html");\r\n   $oSelMsgType->addOptionElement(2, $oOption);\r\n   $oSelMsgType->setDefault($aSettings[''JoinMessageType'']);\r\n\r\n   $oCfgTable->setCell(''options_01'', 1, mi18n("Default message type:").''&nbsp;''.$oSelMsgType->render());\r\n   \r\n   // Options: Open handler article in new window?\r\n   $oCfgTable->setCell(''options_02'', 0, '''');\r\n   $oCkbNewWindow = new cHTMLCheckbox("CMS_VAR[4]", ''enabled'', '''', "CMS_VALUE[4]");\r\n   $oCfgTable->setCell(''options_02'', 1, $oCkbNewWindow->toHTML(false).mi18n("Open handler article in new window"));\r\n   $oCfgTable->setRowBgColor(''options_02'', $cfg["color"]["table_light"]);\r\n   \r\n   $oCfgTable->render(true);', '<?php\r\n   // Initialisation\r\n   $oClientLang = new cApiClientLanguage(false, $client, $lang);\r\n\r\n   /*\r\n   *  Used variables:\r\n   *  JoinSel:         Selection, which group will be joined (Default, Selected, UserSelected)\r\n   *  JoinMultiple:    If JoinSel = UserSelected then: If more than one group has been specified, select more than one\r\n   *  JoinGroups:      Selected group(s)\r\n   *  JoinMessageType: Message type for new recipients: User select (user), text or html\r\n   *  OptNewWindow:    Open handler window in new browser window?\r\n   */\r\n   $aSettings   = array();\r\n   $aSettings[''JoinSel'']         = $oClientLang->getProperty(''newsletter'', ''joinsel'');\r\n   $aSettings[''JoinMultiple'']    = $oClientLang->getProperty(''newsletter'', ''joinmultiple'');\r\n   $aSettings[''JoinGroups'']      = $oClientLang->getProperty(''newsletter'', ''joingroups'');\r\n   $aSettings[''JoinMessageType''] = $oClientLang->getProperty(''newsletter'', ''joinmessagetype'');\r\n   $aSettings[''OptNewWindow'']    = "CMS_VALUE[4]";\r\n\r\n   $sTemplate = ''newsletter_form.html'';\r\n\r\n   if ($aSettings["JoinSel"] == "" || ($aSettings["JoinSel"] == "UserSelected" && $aSettings["JoinGroups"] == "")) {\r\n      $aSettings["JoinSel"]= "Default";\r\n   }\r\n\r\n   if (!isset($oPage) || !is_object($oPage)) {\r\n      $oPage = new Template;\r\n   }\r\n   $oPage->reset();\r\n\r\n   $oPage->set(''s'', ''FORM_ACTION'', ''front_content.php?changelang=''.$lang.''&amp;idcatart=''.\r\n                                   $oClientLang->getProperty(''newsletter'', ''idcatart''));\r\n   unset ($oClientLang);\r\n\r\n   if ($aSettings["OptNewWindow"]) {\r\n      $oPage->set(''s'', ''FORM_TARGET'', '' target="_blank"'');\r\n   } else {\r\n      $oPage->set(''s'', ''FORM_TARGET'', '''');\r\n   }\r\n   $oPage->set(''s'', ''EMAILNAME'', mi18n("Name"));\r\n   $oPage->set(''s'', ''EMAIL'',     mi18n("E-Mail"));\r\n\r\n   $sTmpHTML = "";\r\n   if ($aSettings["JoinSel"] == "UserSelected") {\r\n      $oRcpGroups = new RecipientGroupCollection;\r\n      $oRcpGroups->setWhere(''idclient'', $client);\r\n      $oRcpGroups->setWhere(''idlang'',   $lang);\r\n      $oRcpGroups->setWhere(''defaultgroup'', ''0'');\r\n      $oRcpGroups->setWhere(''idnewsgroup'', explode('','', $aSettings["JoinGroups"]), ''IN'');\r\n      $oRcpGroups->setOrder(''groupname ASC'');\r\n      $oRcpGroups->query();\r\n\r\n      #$oRcpGroups->select("idclient = ''$client'' AND idlang = ''$lang'' AND defaultgroup = ''0'' AND idnewsgroup IN (".$aSettings["JoinGroups"].")","", "groupname ASC");\r\n\r\n      if ($oRcpGroups->Count() > 0) {\r\n         $oLblGroupSel = new cHTMLLabel(mi18n("Select"), "selNewsletterGroup");\r\n\r\n         $oSelGroup = new cHTMLSelectElement("selNewsletterGroup[]", "", "selNewsletterGroup");\r\n         $oSelGroup->setSize(2);\r\n         $oSelGroup->setClass("");\r\n\r\n         if ($aSettings["JoinMultiple"] == "enabled") {\r\n            $oSelGroup->setMultiselect();\r\n         }\r\n         \r\n         while ($oRcpGroup = $oRcpGroups->next())\r\n         {\r\n            $iID = $oRcpGroup->get("idnewsgroup");\r\n            $oOption = new cHTMLOptionElement ($oRcpGroup->get("groupname"), $iID);\r\n            $oSelGroup->addOptionElement($iID, $oOption);\r\n         }\r\n\r\n         $sTmpHTML .= ''         ''.$oLblGroupSel->toHTML()."\\n";\r\n         $sTmpHTML .= ''         ''.$oSelGroup->render()."\\n";\r\n         $sTmpHTML .= ''         <br class="y"/>'';\r\n      }\r\n   }\r\n   // You may like to add here additional rows for fields used in recipient- or frontenduser-plugins\r\n   // $sTmpHTML .= ''...'';\r\n\r\n   if ($aSettings[''JoinMessageType''] == ''user'')\r\n   {\r\n         $oLblType = new cHTMLLabel(mi18n("Type"), "selNewsletterType");\r\n\r\n         $oSelType = new cHTMLSelectElement("selNewsletterType", "", "selNewsletterType");\r\n         $oSelType->setSize(1);\r\n         $oSelType->setClass("");\r\n         \r\n         $oOption = new cHTMLOptionElement (mi18n("Text only"), 0);\r\n         $oSelType->addOptionElement(0, $oOption);\r\n         $oOption = new cHTMLOptionElement (mi18n("HTML"), 1);\r\n         $oSelType->addOptionElement(1, $oOption);\r\n\r\n         //$sTmpHTML .= ''         ''.$oLblType->toHTML()."\\n";\r\n         $sTmpHTML .= ''         ''.$oSelType->render()."\\n";\r\n         $sTmpHTML .= ''         <br class="y"/>'';\r\n   }\r\n   $oPage->set(''s'', ''EXTRAHTML'', $sTmpHTML);\r\n\r\n   $oPage->set(''s'', ''NEWSLETTER'', mi18n("Newsletter"));\r\n   $oPage->set(''s'', ''SUBSCRIBE'',  mi18n("Subscribe"));\r\n   $oPage->set(''s'', ''DELETE'',     mi18n("Unsubscribe"));\r\n\r\n   $oPage->set("s", "ABSCHICKEN", mi18n("submit"));\r\n   $oPage->set("s", "LOESCHEN", mi18n("delete"));\r\n   $oPage->set(''s'', ''JOIN'', mi18n("Join"));\r\n\r\n   $oPage->generate(''templates/''.$sTemplate);\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:58:33', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (14, 1, 'Newsletter_Handler', 'Content', 'none', 'Newsletter Handler Module V4.0.1 (for text and HTML newsletters)\r\n\r\nProvides multilanguage handling for newsletter subscribing, cancellation and other features.\r\n\r\nBased on the work of 4fb, www.x28.de, HerrB, 01.05.2007\r\n\r\nNotes:\r\n- The default language is english. Use the translation functionality to translate the module in other languages\r\n- Create a template which includes this module and create an article using that template.\r\n- Configure category/arcticle specifying handler article id', NULL, '   cInclude(''frontend'', ''includes/class.input.helper.php''); # Note, this file is located in <client-path>/includes!\r\n\r\n   // Initialisation\r\n   $oClientLang = new cApiClientLanguage(false, $client, $lang);\r\n   $oClient     = new cApiClient($client);\r\n\r\n   /*\r\n   *  Used variables:\r\n   *  JoinSel:         Selection, which group will be joined (Default, Selected, User specified)\r\n   *  JoinMultiple:    If JoinSel = UserSelected then: More than one group may be selected\r\n   *  JoinGroups:      Selected group(s)\r\n   *  JoinMessageType: Message type for new recipients: User select (user), text or html\r\n   *  FrontendLink:    Link to Frontend Users enabled?\r\n   *  FrontendConfirm: Confirmation of newsletter subscription means: Activate frontend account, nothing\r\n   *  FrontendDel:     Cancellation of newsletter subscription means: Delete frontend account, Deactivate account, nothing\r\n   *  SenderEMail:     Sender e-mail address\r\n   *  HandlerID:       ID of handler article\r\n   *  ChangeEMailID:   ID of change e-mail handler article\r\n   */\r\n   $aSettings   = array();\r\n   $aSettings[''JoinSel'']         = $oClientLang->getProperty(''newsletter'', ''joinsel'');\r\n   $aSettings[''JoinMultiple'']    = $oClientLang->getProperty(''newsletter'', ''joinmultiple'');\r\n   $aSettings[''JoinGroups'']      = $oClientLang->getProperty(''newsletter'', ''joingroups'');\r\n   $aSettings[''JoinMessageType''] = $oClientLang->getProperty(''newsletter'', ''joinmessagetype'');\r\n   $aSettings[''FrontendLink'']    = $oClient->getProperty(''newsletter'', ''frontendlink''); # Note: Stored for client, as frontendusers are language independent\r\n   $aSettings[''FrontendConfirm''] = "CMS_VALUE[5]";\r\n   $aSettings[''FrontendDel'']     = "CMS_VALUE[6]";\r\n   $aSettings[''SenderEMail'']     = $oClient->getProperty(''global'', ''sender-email''); # This one could be recycled by other modules...\r\n\r\n   // Setting default values\r\n   // If there is no selection option set or if no groups has been selected, activate option Default\r\n   if ($aSettings[''JoinSel''] == '''' || $aSettings[''JoinGroups''] == '''') {\r\n      $aSettings[''JoinSel''] = "Default";\r\n   }\r\n   if ($aSettings[''FrontendConfirm''] == '''') {\r\n      $aSettings[''FrontendConfirm''] = "ActivateUser";\r\n   }\r\n   if ($aSettings[''FrontendDel''] == '''') {\r\n      $aSettings[''FrontendDel''] = "DeleteUser";\r\n   }\r\n   if (!is_numeric($_REQUEST[''selHandlerCatArt''.$cnumber]) || $_REQUEST[''selHandlerCatArt''.$cnumber] < 0) {\r\n      $_REQUEST[''selHandlerCatArt''.$cnumber] = 0;\r\n   }\r\n\r\n   // Saving changes, if any\r\n   if ($_REQUEST[''hidAction''.$cnumber] == ''save'')\r\n   {\r\n      if ($_REQUEST[''radJoin''.$cnumber] != '''' && $_REQUEST[''radJoin''.$cnumber] != $aSettings[''JoinSel''])\r\n      {\r\n         $aSettings[''JoinSel''] = $_REQUEST[''radJoin''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joinsel'', $aSettings[''JoinSel'']);\r\n      }\r\n      if ($_REQUEST[''ckbJoinMultiple''.$cnumber] != $aSettings[''JoinMultiple''])\r\n      {\r\n         $aSettings[''JoinMultiple''] = $_REQUEST[''ckbJoinMultiple''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joinmultiple'', $aSettings[''JoinMultiple'']);\r\n      }\r\n      if ($_REQUEST[''hidJoinGroups''.$cnumber] != '''' && $_REQUEST[''hidJoinGroups''.$cnumber] != $aSettings[''JoinGroups''])\r\n      {\r\n         $aSettings[''JoinGroups''] = $_REQUEST[''hidJoinGroups''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joingroups'', $aSettings[''JoinGroups'']);\r\n      }\r\n      if ($_REQUEST[''selMessageType''.$cnumber] != $aSettings[''JoinMessageType''])\r\n      {\r\n         $aSettings[''JoinMessageType''] = $_REQUEST[''selMessageType''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''joinmessagetype'', $aSettings[''JoinMessageType'']);\r\n      }\r\n      if ($_REQUEST[''ckbFrontendLink''.$cnumber] != $aSettings[''FrontendLink''])\r\n      {\r\n         $aSettings[''FrontendLink''] = $_REQUEST[''ckbFrontendLink''.$cnumber];\r\n         $oClient->setProperty(''newsletter'', ''frontendlink'', $aSettings[''FrontendLink'']);\r\n      }\r\n\r\n      if ($_REQUEST[''ckbUpdateHandlerID''.$cnumber] == ''enabled'')\r\n      {\r\n         // Trick: If UpdateHandlerID is enabled, save id as client setting\r\n         $iHandlerCatArt = $_REQUEST[''selHandlerCatArt''.$cnumber];\r\n         $oClientLang->setProperty(''newsletter'', ''idcatart'', $iHandlerCatArt);\r\n      }\r\n      \r\n      if (isValidMail($_REQUEST[''txtSender''.$cnumber]) && $_REQUEST[''txtSender''.$cnumber] != $aSettings[''SenderEMail''])\r\n      {\r\n         $aSettings[''SenderEMail''] = $_REQUEST[''txtSender''.$cnumber];\r\n         $oClient->setProperty(''global'', ''sender-email'', $aSettings[''SenderEMail'']);\r\n      }\r\n   }\r\n\r\n   // Getting current handler article id\r\n   $iHandlerCatArt = $oClientLang->getProperty(''newsletter'', ''idcatart'');\r\n   unset ($oClientLang);\r\n   unset ($oClient);\r\n\r\n   // Show options\r\n   $oCfgTable = new UI_Config_Table;\r\n\r\n   $oHidAction        = new cHTMLHiddenField(''hidAction''.$cnumber, ''save'');\r\n   \r\n   $oTxtSender = new cHTMLTextbox("txtSender".$cnumber, $aSettings[''SenderEMail''], 30);\r\n\r\n   $oCfgTable->setCell(''sender'', 0, mi18n("Sender e-mail:"));\r\n   $oCfgTable->setCell(''sender'', 1, $oHidAction->render().$oTxtSender->render());\r\n\r\n   $oSelHandlerCatArt = new cHTMLInputSelectElement(''selHandlerCatArt''.$cnumber, 1, '''', true);\r\n   $oOption           = new cHTMLOptionElement(mi18n("- Please select -"), '''');\r\n   $oSelHandlerCatArt->addOptionElement(0, $oOption);\r\n   $oSelHandlerCatArt->addCategories(0, true, false, false, true, true);\r\n   $oSelHandlerCatArt->setDefault($iHandlerCatArt);\r\n\r\n   $oCkbUpdate        = new cHTMLCheckbox(''ckbUpdateHandlerID''.$cnumber, ''enabled'');\r\n   $oCkbUpdate->setEvent(''click'', ''if (this.checked) {document.forms[0].selHandlerCatArt''.$cnumber.''.disabled = false;} else {document.forms[0].selHandlerCatArt''.$cnumber.''.disabled = true;}'');\r\n\r\n   $oCfgTable->setCell(''handler'', 0, mi18n("Handler Article:"));\r\n   $oCfgTable->setCell(''handler'', 1, $oSelHandlerCatArt->render()."\\n&nbsp;".$oCkbUpdate->toHTML(false).mi18n("Update"));\r\n\r\n   // Getting newsletter groups (if any)\r\n   $oRcpGroups = new RecipientGroupCollection;\r\n   $oRcpGroups->setWhere(''idclient'', $client);\r\n   $oRcpGroups->setWhere(''idlang'',   $lang);\r\n   $oRcpGroups->setWhere(''defaultgroup'', ''0'');\r\n   $oRcpGroups->setOrder(''defaultgroup DESC, groupname ASC'');\r\n   $oRcpGroups->query();\r\n   \r\n   // Join options\r\n   // If newsletter groups are available, provide group options, otherwise show only\r\n   // ''Default'' option. This is necessary, as there may have been groups specified (and used)\r\n   // but they have been deleted, later on.\r\n   \r\n   $oCfgTable->setCell(''join_01'', 0, mi18n("Join:"));\r\n   \r\n   if ($oRcpGroups->Count() == 0) {\r\n      // No groups available, only default group possible\r\n   \r\n      $oRadJoinDefault = new cHTMLRadioButton (''radJoin''.$cnumber, ''Default'', '''', true);\r\n      $oCfgTable->setCell(''join_01'', 1, $oRadJoinDefault->toHTML(false).mi18n("default group"));\r\n   } else {\r\n      // Groups available, show different group join options\r\n   \r\n      // Join default group only\r\n      if ($aSettings[''JoinSel''] == ''Default'') {\r\n         $oRadJoinDefault = new cHTMLRadioButton (''radJoin''.$cnumber, ''Default'', '''', true);\r\n      } else {\r\n         $oRadJoinDefault = new cHTMLRadioButton (''radJoin''.$cnumber, ''Default'');\r\n      }\r\n      $oRadJoinDefault->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = true; document.forms[0].selGroup".$cnumber.".disabled = true;");\r\n      $oCfgTable->setCell(''join_01'', 1, $oRadJoinDefault->toHTML(false).mi18n("default group"));\r\n      $oCfgTable->setRowBgColor(''join_01'', $cfg["color"]["table_dark"]);\r\n   \r\n      // Join admin selected groups automatically\r\n      if ($aSettings[''JoinSel''] == ''Selected'') {\r\n         $oRadJoinSelected = new cHTMLRadioButton (''radJoin''.$cnumber, ''Selected'', '''', true);\r\n      } else {\r\n         $oRadJoinSelected = new cHTMLRadioButton (''radJoin''.$cnumber, ''Selected'');\r\n      }\r\n      $oRadJoinSelected->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = false; document.forms[0].selGroup".$cnumber.".disabled = false;");\r\n      $oCfgTable->setCell(''join_02'', 0, '''');\r\n      $oCfgTable->setCell(''join_02'', 1, $oRadJoinSelected->toHTML(false).mi18n("selected group(s)"));\r\n      $oCfgTable->setRowBgColor(''join_02'', $cfg["color"]["table_dark"]);\r\n   \r\n      // Join the groups the user has selected (-> provide a list for the user), optionally, the user may select more than one group\r\n      if ($aSettings[''JoinSel''] == ''UserSelected'')\r\n      {\r\n         $oRadJoinUserSel  = new cHTMLRadioButton (''radJoin''.$cnumber, ''UserSelected'', '''', true);\r\n         $oCkbJoinMultiple = new cHTMLCheckbox (''ckbJoinMultiple''.$cnumber, ''enabled'', '''', $aSettings[''JoinMultiple'']);\r\n      } else {\r\n         $oRadJoinUserSel  = new cHTMLRadioButton (''radJoin''.$cnumber, ''UserSelected'');\r\n         $oCkbJoinMultiple = new cHTMLCheckbox (''ckbJoinMultiple''.$cnumber, ''enabled'', '''', false, true);\r\n      }\r\n      $oRadJoinUserSel->setEvent(''click'', "document.forms[0].elements[''ckbJoinMultiple".$cnumber."''].disabled = false; document.forms[0].selGroup".$cnumber.".disabled = false;");\r\n      $oCfgTable->setCell(''join_03'', 0, '''');\r\n      $oCfgTable->setCell(''join_03'', 1, $oRadJoinUserSel->toHTML(false).mi18n("group(s) as selected by user").''<br />''."\\n".$oCkbJoinMultiple->toHTML(false).mi18n("Multiple group selection allowed"));\r\n      $oCfgTable->setRowBgColor(''join_03'', $cfg["color"]["table_dark"]);\r\n   \r\n      $oCfgTable->setCell(''groups'', 0, mi18n("Select group(s):"));\r\n   \r\n      // Show groups\r\n      // Trick: To save multiple selections in <select>-Element, add some JS which saves the\r\n      // selection, comma separated in a hidden input field on change.\r\n      $sSkript = ''              <script type="text/javascript"><!--''."\\n".\r\n                 ''                  function fncUpdateSel() {''."\\n".\r\n                 ''                     var strSel = "";''."\\n".\r\n                 ''                     for(i = 0; i < document.forms[0].selGroup''.$cnumber.''.length; i++) {''."\\n".\r\n                 ''                        if(document.forms[0].selGroup''.$cnumber.''.options[i].selected == true) {''."\\n".\r\n                 ''                           if (strSel != "")''."\\n".\r\n                 ''                              strSel = strSel + ",";''."\\n".\r\n                 ''                           strSel = strSel + document.forms[0].selGroup''.$cnumber.''.options[i].value;''."\\n".\r\n                 ''                        }''."\\n".\r\n                 ''                     }''."\\n".\r\n                 ''                     document.forms[0].elements["hidJoinGroups''.$cnumber.''"].value = strSel;''."\\n".\r\n                 ''                  }''."\\n".\r\n                 ''                  //--></script>''."\\n";\r\n\r\n      if ($aSettings[''JoinSel''] == ''Default'') {\r\n         $oSelGroup = new cHTMLSelectElement (''selGroup''.$cnumber, '''', '''', true);\r\n      } else {\r\n         $oSelGroup = new cHTMLSelectElement (''selGroup''.$cnumber, '''');\r\n      }\r\n      $oSelGroup->setSize(5);\r\n      $oSelGroup->setMultiselect();\r\n      $oSelGroup->setEvent(''change'', "fncUpdateSel()");\r\n\r\n      $aGroups = explode('','', $aSettings[''JoinGroups'']);\r\n      while ($oRcpGroup = $oRcpGroups->next()) {\r\n         $iID = $oRcpGroup->get(''idnewsgroup'');\r\n         if (in_array ($iID, $aGroups)) {\r\n            $oOption = new cHTMLOptionElement($oRcpGroup->get(''groupname''), $iID, true);\r\n         } else {\r\n            $oOption = new cHTMLOptionElement($oRcpGroup->get(''groupname''), $iID, false);\r\n         }\r\n         $oSelGroup->addOptionElement($iID, $oOption);\r\n      }\r\n   \r\n      $oHidGroups = new cHTMLHiddenField (''hidJoinGroups''.$cnumber, $aSettings[''JoinGroups'']);\r\n      $oCfgTable->setCell(''groups'', 1, $sSkript.$oSelGroup->render().$oHidGroups->render());\r\n   }\r\n   \r\n   // Options: Message type (user [->selectbox], text or html)\r\n   $oCfgTable->setCell(''options_01'', 0, mi18n("Options:"));\r\n\r\n   $oSelMsgType = new cHTMLSelectElement (''selMessageType''.$cnumber);\r\n   $oOption = new cHTMLOptionElement(mi18n("User selected"), "user");\r\n   $oSelMsgType->addOptionElement(0, $oOption);\r\n   $oOption = new cHTMLOptionElement(mi18n("Text only"), "text");\r\n   $oSelMsgType->addOptionElement(1, $oOption);\r\n   $oOption = new cHTMLOptionElement(mi18n("HTML and text"), "html");\r\n   $oSelMsgType->addOptionElement(2, $oOption);\r\n   $oSelMsgType->setDefault($aSettings[''JoinMessageType'']);\r\n\r\n   $oCfgTable->setCell(''options_01'', 1, mi18n("Default message type:").''&nbsp;''.$oSelMsgType->render());\r\n\r\n   // Frontend Link\r\n   $oCfgTable->setCell(''link_01'', 0, mi18n("Frontend Users:"));\r\n   $oCkbLink = new cHTMLCheckbox(''ckbFrontendLink''.$cnumber, ''enabled'', '''', $aSettings[''FrontendLink'']);\r\n   \r\n   $sSkript = "if (this.checked) {\r\n                  document.forms[0].elements[''CMS_VAR[5]''][0].disabled = false;\r\n                  document.forms[0].elements[''CMS_VAR[5]''][1].disabled = false;\r\n                  document.forms[0].elements[''CMS_VAR[6]''][0].disabled = false;\r\n                  document.forms[0].elements[''CMS_VAR[6]''][1].disabled = false;\r\n                  document.forms[0].elements[''CMS_VAR[6]''][2].disabled = false;\r\n               } else {\r\n                  document.forms[0].elements[''CMS_VAR[5]''][0].disabled = true;\r\n                  document.forms[0].elements[''CMS_VAR[5]''][1].disabled = true;\r\n                  document.forms[0].elements[''CMS_VAR[6]''][0].disabled = true;\r\n                  document.forms[0].elements[''CMS_VAR[6]''][1].disabled = true;\r\n                  document.forms[0].elements[''CMS_VAR[6]''][2].disabled = true;}";\r\n   $oCkbLink->setEvent("click", $sSkript);\r\n\r\n   $oCfgTable->setCell(''link_01'', 1, $oCkbLink->toHTML(false).mi18n("Activate Link"));\r\n   $oCfgTable->setRowBgColor(''link_01'', $cfg["color"]["table_light"]);\r\n   \r\n   // Link: Activation options\r\n   $oCfgTable->setCell(''link_02'', 0, '''');\r\n   \r\n   switch ($aSettings[''FrontendConfirm''])\r\n   {\r\n      case "Nothing":\r\n         $oRadActivateUser    = new cHTMLRadioButton ("CMS_VAR[5]", "ActivateUser", "", false);\r\n         $oRadActivateNothing = new cHTMLRadioButton ("CMS_VAR[5]", "Nothing",      "", true);\r\n         break;\r\n      default:\r\n         $oRadActivateUser    = new cHTMLRadioButton ("CMS_VAR[5]", "ActivateUser", "", true);\r\n         $oRadActivateNothing = new cHTMLRadioButton ("CMS_VAR[5]", "Nothing",      "", false);\r\n   }\r\n\r\n   switch ($aSettings[''FrontendDel''])\r\n   {\r\n      case "DisableUser":\r\n         $oRadDelDelete  = new cHTMLRadioButton ("CMS_VAR[6]", "DeleteUser",  "", false);\r\n         $oRadDelDisable = new cHTMLRadioButton ("CMS_VAR[6]", "DisableUser", "", true);\r\n         $oRadDelNothing = new cHTMLRadioButton ("CMS_VAR[6]", "Nothing",     "", false);\r\n         break;\r\n      case "Nothing":\r\n         $oRadDelDelete  = new cHTMLRadioButton ("CMS_VAR[6]", "DeleteUser",  "", false);\r\n         $oRadDelDisable = new cHTMLRadioButton ("CMS_VAR[6]", "DisableUser", "", false);\r\n         $oRadDelNothing = new cHTMLRadioButton ("CMS_VAR[6]", "Nothing",     "", true);\r\n         break;\r\n      default:\r\n         $oRadDelDelete  = new cHTMLRadioButton ("CMS_VAR[6]", "DeleteUser",  "", true);\r\n         $oRadDelDisable = new cHTMLRadioButton ("CMS_VAR[6]", "DisableUser", "", false);\r\n         $oRadDelNothing = new cHTMLRadioButton ("CMS_VAR[6]", "Nothing",     "", false);\r\n   }\r\n\r\n   if ($aSettings[''FrontendLink''] == '''')\r\n   {\r\n      $oRadActivateUser->setDisabled(true);\r\n      $oRadActivateNothing->setDisabled(true);\r\n      $oRadDelDelete->setDisabled(true);\r\n      $oRadDelDisable->setDisabled(true);\r\n      $oRadDelNothing->setDisabled(true);\r\n   }\r\n   $oCfgTable->setCell(''link_02'', 1, mi18n("Confirmation means:").''<br />''.\r\n                                     $oRadActivateUser->toHTML(false).mi18n("Activate").\r\n                                     $oRadActivateNothing->toHTML(false).mi18n("No changes"));\r\n   $oCfgTable->setRowBgColor(''link_02'', $cfg["color"]["table_light"]);\r\n\r\n   // Link: Cancellation options\r\n   $oCfgTable->setCell(''link_03'', 0, '''');\r\n\r\n   $oCfgTable->setCell(''link_03'', 1, mi18n("Cancellation means:").''<br />''.\r\n                                     $oRadDelDelete->toHTML(false).mi18n("Delete").\r\n                                     $oRadDelDisable->toHTML(false).mi18n("Disable").\r\n                                     $oRadDelNothing->toHTML(false).mi18n("No changes"));\r\n   $oCfgTable->setRowBgColor(''link_03'', $cfg["color"]["table_light"]);\r\n\r\n   $oCfgTable->render(true);', '<?php\r\n   // Initialisation\r\n   $oClientLang = new cApiClientLanguage(false, $client, $lang);\r\n   $oClient     = new cApiClient($client);\r\n   $oRecipients = new RecipientCollection;\r\n   $sMessage = "&nbsp;";\r\n   unset($recipient); // Unset any existing recipient objects - note, that it must be $recipient for the plugins...\r\n\r\n   $aSettings   = array();\r\n   $aSettings[''JoinSel'']         = $oClientLang->getProperty(''newsletter'', ''joinsel'');\r\n   $aSettings[''JoinMultiple'']    = $oClientLang->getProperty(''newsletter'', ''joinmultiple'');\r\n   $aSettings[''JoinGroups'']      = $oClientLang->getProperty(''newsletter'', ''joingroups'');\r\n   $aSettings[''JoinMessageType''] = $oClientLang->getProperty(''newsletter'', ''joinmessagetype'');\r\n   $aSettings[''FrontendLink'']    = $oClient->getProperty(''newsletter'', ''frontendlink''); # Note: Stored for client, as frontendusers are language independent\r\n   $aSettings[''FrontendConfirm''] = "CMS_VALUE[5]";\r\n   $aSettings[''FrontendDel'']     = "CMS_VALUE[6]";\r\n   $aSettings[''SenderEMail'']     = $oClient->getProperty(''global'', ''sender-email''); # This one could be recycled by other modules...\r\n   $aSettings[''HandlerID'']       = $oClientLang->getProperty(''newsletter'', ''idcatart'');\r\n   \r\n   $sTemplate = ''newsletter_handler.html'';\r\n   \r\n   if (!isset($oPage) || !is_object($oPage)) {\r\n      $oPage = new Template;\r\n   }\r\n   $oPage->reset();\r\n\r\n   // If there is no selection option set or if no groups has been selected, activate option Default\r\n   if ($aSettings[''JoinSel''] == '''' || $aSettings[''JoinGroups''] == '''') {\r\n      $aSettings[''JoinSel''] = "Default";\r\n   }\r\n   if ($aSettings[''FrontendConfirm''] == '''') {\r\n      $aSettings[''FrontendConfirm''] = "ActivateUser";\r\n   }\r\n   if ($aSettings[''FrontendDel''] == '''') {\r\n      $aSettings[''FrontendDel''] = "DeleteUser";\r\n   }\r\n\r\n   if ($_POST[''action''] == "subscribe") {\r\n      if (!isset($_POST[''email'']) || !$_POST[''email'']) {\r\n         $sMessage = mi18n("Please specify an e-mail address.");\r\n      } elseif (!isValidMail($_POST[''email'']) || strpos($_POST[''email''], ",") != false || strpos($_POST[''email''], ";") != false) {\r\n         $sMessage = mi18n("Please specify a valid e-mail address.");\r\n      } elseif ($oRecipients->emailExists($_POST[''email''])) {\r\n         $sMessage = mi18n("This e-mail address has been already registered for the newsletter.");\r\n      } else {\r\n         $sEMail = preg_replace(''/[\\r\\n]+/'', '''', stripslashes($_POST[''email'']));\r\n         $sName  = stripslashes($_POST["emailname"]);\r\n\r\n         // Which newsletter type should the recipient receive?\r\n         switch ($aSettings[''JoinMessageType''])\r\n         {\r\n            case "user":\r\n               if ($_POST["selNewsletterType"] == 1) {\r\n                  $iMessageType = 1; // html\r\n               } else {\r\n                  $iMessageType = 0; // text\r\n               }\r\n               break;\r\n            case "html":\r\n               $iMessageType = 1; // html\r\n               break;\r\n            default:\r\n               $iMessageType = 0; // Default: text\r\n         }\r\n\r\n         // Analyze group specification\r\n         switch ($aSettings[''JoinSel''])\r\n         {\r\n            case "Selected":\r\n               $recipient = $oRecipients->create($sEMail, $sName, 0, $aSettings[''JoinGroups''], $iMessageType);\r\n               break;\r\n            case "UserSelected":\r\n               $iSelCount = count($_POST[''selNewsletterGroup'']);\r\n   \r\n               if ($iSelCount == 0) {\r\n                  $recipient = $oRecipients->create($sEMail, $sName, 0, "", $iMessageType); // No group selected\r\n               } else {\r\n                  if ($iSelCount > 1 && $aSettings[''JoinMultiple''] != "enabled") {\r\n                     $sMessage = mi18n("Please select one group, only.");\r\n                  } else {\r\n                     // Recipient wants to join special groups\r\n                     $aGroups = explode(",", $aSettings[''JoinGroups'']);\r\n\r\n                     /* Check, if received data is valid and matches the group selection */\r\n                     $bError = false;\r\n                     foreach ($_POST[''selNewsletterGroup''] as $iIDGroup)\r\n                     {\r\n                        if (!is_numeric($iIDGroup) || !in_array($iIDGroup, $aGroups))\r\n                        {\r\n                           $bError = true;\r\n                           break;\r\n                        }\r\n                     }\r\n\r\n                     if ($bError) {\r\n                        $sMessage = mi18n("There was an error processing your request. Please ask the webmaster for help.");\r\n                     } else {\r\n                        $recipient = $oRecipients->create($sEMail, $sName, 0, implode(",", $_POST[''selNewsletterGroup'']));\r\n                     }\r\n                  }\r\n               }\r\n               break;\r\n            default:\r\n               $recipient = $oRecipients->create($sEMail, $sName, 0, "", $iMessageType);\r\n         }\r\n\r\n         if ($recipient)\r\n         {\r\n            // Add here code, if you like to store additional information per >recipient< (see frontenduser below)\r\n            // Example: $recipient->setProperty("contact", "firstname", $_REQUEST["firstname"]);\r\n            // contact/firstname have to match the values used in the firstname-recipient-plugin\r\n            // $_REQUEST["firstname"] contains the data from the input-field firstname in the\r\n            // Form module (-> there has to be a field with this name)\r\n            // Note: You should check the values you get (safety)!!!\r\n\r\n            $sBody = mi18n("txtMailSubscribe")."\\n".$cfgClient[$client][''path''][''htmlpath'']."front_content.php?changelang=".$lang."&idcatart=".$aSettings[''HandlerID'']."&confirm=".$recipient->get("hash")."\\n\\n";\r\n\r\n            $oMail = new PHPMailer();\r\n            $oMail->From     = $aSettings[''SenderEMail''];\r\n            $oMail->FromName = $aSettings[''SenderEMail''];\r\n            $oMail->AddAddress($sEMail);\r\n            $oMail->Mailer   = "mail";\r\n            $oMail->Subject  = mi18n("Newsletter: Confirmation");\r\n            $oMail->Body     = $sBody;\r\n\r\n            if($oMail->Send())\r\n            {\r\n               $sMessage = mi18n("Dear subscriber,<br>your e-mail address is now subscribed for our newsletter. You will now receive an e-mail asking you to confirm your subscription.");\r\n\r\n               if ($aSettings[''FrontendLink''] == "enabled")\r\n               {\r\n                  $oFrontendUsers = new FrontendUserCollection;\r\n\r\n                  if (!$oFrontendUsers->userExists($sEMail))\r\n                  {\r\n                     if ($frontenduser = $oFrontendUsers->create($sEMail)) // it''s "frontenduser" (instead of oFrontendUser) for plugins...\r\n                     {\r\n                        // Add here code, if you like to store additional information per >frontenduser<\r\n                        // Example: $frontenduser->setProperty("contact", "firstname", $_REQUEST["firstname"]);\r\n                        // contact/firstname have to match the values used in the firstname-frontenduser-plugin\r\n                        // $_REQUEST["firstname"] contains the data from the input-field firstname in the\r\n                        // Form module (-> there has to be a field with this name)\r\n                        // Note: You should check the values you get (safety)!!!\r\n\r\n                        if ($aSettings[''FrontendConfirm''] == "ActivateUser")\r\n                        {\r\n                           // Inform about frontend user account creation\r\n                           $sMessage .= mi18n("<br><br>After the confirmation you will also receive a password which you can use with your e-mail address to logon to special areas on this website.");\r\n                        }\r\n                     } else {\r\n                        $sMessage .= mi18n("<br><br>Sorry, there was a problem creating your website account. Please ask the webmaster for help.");\r\n                     }\r\n                  }\r\n               }\r\n            } else {\r\n               $sMessage = mi18n("Sorry, there was a problem sending the confirmation mail to your e-mail address. Please ask the webmaster for help.");\r\n            }\r\n         } else {\r\n            $sMessage = mi18n("Sorry, there was a problem subscribing your e-mail address for the newsletter. Please ask the webmaster for help.");\r\n         }\r\n      }\r\n   } elseif ($_POST[''action''] == "delete") {\r\n      if (!isset($_POST[''email'']) || !$_POST[''email'']) {\r\n         $sMessage = mi18n("Please specify an e-mail address.");\r\n      } elseif (!isValidMail($_POST[''email'']) || strpos($_POST[''email''], ",") != false || strpos($_POST[''email''], ";") != false) {\r\n         $sMessage = mi18n("Please specify a valid e-mail address.");\r\n      } elseif ($recipient = $oRecipients->emailExists($_POST[''email''])) {\r\n         $sBody = mi18n("txtMailDelete")."\\n".$cfgClient[$client][''path''][''htmlpath'']."front_content.php?changelang=".$lang."&idcatart=".$aSettings[''HandlerID'']."&unsubscribe=".$recipient->get("hash")."\\n\\n";\r\n\r\n         $oMail = new PHPMailer();\r\n         $oMail->From     = $aSettings[''SenderEMail''];\r\n         $oMail->FromName = $aSettings[''SenderEMail''];\r\n         $oMail->AddAddress($recipient->get("email"));\r\n         $oMail->Mailer   = "mail";\r\n         $oMail->Subject  = mi18n("Newsletter: Cancel subscription");\r\n         $oMail->Body     = $sBody;\r\n\r\n         if($oMail->Send())\r\n         {\r\n            $sMessage = mi18n("Dear subscriber,<br>a mail has been sent to your e-mail address. Please confirm the cancelation of the newsletter subscription.");\r\n         } else {\r\n            $sMessage = mi18n("Sorry, there was a problem sending you the cancelation confirmation e-mail. Please ask the webmaster for help.");\r\n         }\r\n      } else {\r\n         $sMessage = mi18n("Sorry, the e-mail address was not found.");\r\n      }\r\n   } elseif (strlen($_GET[''confirm'']) == 30 && is_alphanumeric($_GET[''confirm''])) {\r\n      $oRecipients->setWhere("idclient", $client);\r\n      $oRecipients->setWhere("idlang", $lang);\r\n      $oRecipients->setWhere("hash", $_GET[''confirm'']);\r\n      $oRecipients->query();\r\n\r\n      if ($recipient = $oRecipients->next())\r\n      {\r\n         $iID    = $recipient->get("idnewsrcp"); // For some reason, $recipient may get invalid later on - save id\r\n         $sEMail = $recipient->get("email");     // ... and email\r\n         $recipient->set("confirmed", 1);\r\n         $recipient->set("confirmeddate", date("Y-m-d H:i:s"), false);\r\n         $recipient->set("deactivated", 0);\r\n         $recipient->store();\r\n\r\n         $sMessage = mi18n("Thank you! You have confirmed your subscription to our newsletter!");\r\n\r\n         $oNewsletters = New NewsletterCollection;\r\n         $oNewsletters->setWhere("idclient", $client);\r\n         $oNewsletters->setWhere("idlang", $lang);\r\n         $oNewsletters->setWhere("welcome", ''1'');\r\n         $oNewsletters->query();\r\n\r\n         if ($oNewsletter = $oNewsletters->next())\r\n         {\r\n            $aRecipients = array(); // Needed, as used by reference\r\n            $oNewsletter->sendDirect($aSettings[''HandlerID''], $iID, false, $aRecipients);\r\n\r\n            $sMessage .= mi18n(" The welcome newsletter is already on the way to you!");\r\n         }\r\n         \r\n         if ($aSettings[''FrontendLink''] == "enabled" && $aSettings[''FrontendConfirm''] == "ActivateUser")\r\n         {\r\n            $oFrontendUsers = new FrontendUserCollection;\r\n            $oFrontendUsers->setWhere("idclient", $client);\r\n            $oFrontendUsers->setWhere("username", $sEMail);\r\n            $oFrontendUsers->query();\r\n\r\n            if ($frontenduser = $oFrontendUsers->next())\r\n            {\r\n               $frontenduser->set("active", 1);\r\n               $sPassword = substr(md5(rand()),0,8); // Generating password\r\n               $frontenduser->set("password", $sPassword);\r\n               $frontenduser->store();\r\n\r\n               $sMessage .= mi18n("<br><br>Additionally, your website account has been activated. You can now use the following username and password to log in to access special areas on our website:<br>");\r\n               $sMessage .= mi18n("Username: ").$sEMail.mi18n("<br>Password: ").$sPassword;\r\n   \r\n               $sBody = mi18n("txtMailPassword")."\\n\\n".mi18n("Username: ").$sEMail."\\n".mi18n("Password: ").$sPassword."\\n\\n".mi18n("Click here to login: ").$cfgClient[$client][''path''][''htmlpath'']."front_content.php?changelang=".$lang;\r\n\r\n               $oMail           = new PHPMailer();\r\n               $oMail->From     = $aSettings[''SenderEMail''];\r\n               $oMail->FromName = $aSettings[''SenderEMail''];\r\n               $oMail->AddAddress($sEMail);\r\n               $oMail->Mailer   = "mail";\r\n               $oMail->Subject  = mi18n("Website account");\r\n               $oMail->Body     = $sBody;\r\n\r\n               if($oMail->Send())\r\n               {\r\n                  $sMessage .= mi18n("<br><br>The account details and the password has also been sent to your mail account.");\r\n               } else {\r\n                  $sMessage .= mi18n("<br><br><b>Sorry, there was a problem sending you the account details by mail. Please remember the given password.</b><b>");\r\n               }\r\n            } else {\r\n               $sMessage .= mi18n("<br><br>Sorry, there was a problem activating your website account, also. Please ask the webmaster for help.");\r\n            }\r\n         }\r\n      } else {\r\n         $sMessage = mi18n("Sorry, there was a problem confirming your subscription. Please ask the webmaster for help.");\r\n      }\r\n   } elseif (strlen($_GET[''stop'']) == 30 && is_alphanumeric($_GET[''stop''])) {\r\n      $oRecipients->setWhere("idclient", $client);\r\n      $oRecipients->setWhere("idlang", $lang);\r\n      $oRecipients->setWhere("hash", $_GET[''stop'']);\r\n      $oRecipients->query();\r\n\r\n      if ($recipient = $oRecipients->next())\r\n      {\r\n         $recipient->set("deactivated", 1);\r\n         $recipient->store();\r\n\r\n         $sMessage = mi18n("Your newsletter subscription has been paused.");\r\n      } else {\r\n         $sMessage = mi18n("Sorry, there was a problem pausing your newsletter subscription. Please ask the webmaster for help.");\r\n      }\r\n   } elseif (strlen($_GET[''goon'']) == 30 && is_alphanumeric($_GET[''goon''])) {\r\n      $oRecipients->setWhere("idclient", $client);\r\n      $oRecipients->setWhere("idlang", $lang);\r\n      $oRecipients->setWhere("hash", $_GET[''goon'']);\r\n      $oRecipients->query();\r\n\r\n      if ($recipient = $oRecipients->next())\r\n      {\r\n         $recipient->set("deactivated", 0);\r\n         $recipient->store();\r\n\r\n         $sMessage = mi18n("Newsletter subscription has been resumed.");\r\n      } else {\r\n         $sMessage = mi18n("Sorry, there was a problem resuming your newsletter subscription. Please ask the webmaster for help.");\r\n      }\r\n   } elseif (strlen($_GET[''unsubscribe'']) == 30 && is_alphanumeric($_GET[''unsubscribe''])) {\r\n      $oRecipients->setWhere("idclient", $client);\r\n      $oRecipients->setWhere("idlang", $lang);\r\n      $oRecipients->setWhere("hash", $_GET[''unsubscribe'']);\r\n      $oRecipients->query();\r\n      \r\n      if ($recipient = $oRecipients->next()) {\r\n         $sEMail = $recipient->get("email"); // Saving recipient e-mail address for frontend account\r\n         $oRecipients->delete($recipient->get("idnewsrcp"));\r\n\r\n         $sMessage = mi18n("Your e-mail address has been removed from our list of newsletter recipients.");\r\n\r\n         if ($aSettings[''FrontendLink''] == "enabled")\r\n         {\r\n            $oFrontendUsers = new FrontendUserCollection;\r\n            $oFrontendUsers->setWhere("idclient", $client);\r\n            $oFrontendUsers->setWhere("username", $sEMail);\r\n            $oFrontendUsers->query();\r\n\r\n            if ($frontenduser = $oFrontendUsers->next())\r\n            {\r\n               switch ($aSettings[''FrontendDel''])\r\n               {\r\n                  case "DeleteUser": // Deleting frontend account\r\n                     $oFrontendUsers->delete($frontenduser->get("idfrontenduser"));\r\n                     $sMessage .= mi18n(" Your website account has been deleted.");\r\n                     break;\r\n                  case "DisableUser": // Disabling frontend account\r\n                     $frontenduser->set("active", 0);\r\n                     $frontenduser->store();\r\n                     $sMessage .= mi18n(" Your website account has been disabled.");\r\n                     break;\r\n                  default:\r\n               }\r\n            }\r\n         }\r\n      } else {\r\n         $sMessage = mi18n("Sorry, there was a problem removing your e-mail address. Please ask the webmaster for help.");\r\n      }\r\n   }\r\n\r\n   $oPage->set(''s'', ''CONTENT'', $sMessage);\r\n   $oPage->generate(''templates/''.$sTemplate);\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:58:52', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (15, 1, 'Picture_Gallery', 'Content', 'none', 'Displays a picture gallery by files in upload directory', NULL, '?><?php\r\n/***********************************************\r\n* Bildergalerie Input\r\n*\r\n* Author      :     Timo A. Hummel\r\n* Copyright   :     four for business AG\r\n* Created     :     30-09-2005\r\n************************************************/?>\r\n\r\n<table>\r\n  <tr>\r\n    <td><?php echo mi18n("Breite");?></td>\r\n    <td><input type="text" name="<?php echo "CMS_VAR[0]"; ?>" value="<?php echo "CMS_VALUE[0]"; ?>"></td>\r\n  </tr>\r\n  <tr>\r\n    <td><?php echo mi18n("H&ouml;he");?></td>\r\n    <td><input type="text" name="<?php echo "CMS_VAR[1]"; ?>" value="<?php echo "CMS_VALUE[1]"; ?>"></td>\r\n  </tr>\r\n  <tr>\r\n    <td><?php echo mi18n("Spalten");?></td>\r\n    <td><input type="text" name="<?php echo "CMS_VAR[2]"; ?>" value="<?php echo "CMS_VALUE[2]"; ?>"></td>\r\n  </tr>\r\n  <tr>\r\n    <td><?php echo mi18n("Zeilen");?></td>\r\n    <td><input type="text" name="<?php echo "CMS_VAR[3]"; ?>" value="<?php echo "CMS_VALUE[3]"; ?>"></td>\r\n  </tr>\r\n  <tr>\r\n    <td><?php echo mi18n("Breite Detailansicht");?></td>\r\n    <td><input type="text" name="<?php echo "CMS_VAR[4]"; ?>" value="<?php echo "CMS_VALUE[4]"; ?>"></td>\r\n  </tr>\r\n  <?php\r\n  $sql = "SELECT DISTINCT dirname FROM ".$cfg[''tab''][''upl'']." ORDER BY dirname";\r\n  $db->query($sql);\r\n  echo ''<tr><td>''.mi18n("Verzeichnis ausw&auml;hlen").''</td><td>\r\n        <select name="CMS_VAR[5]" size="1" style="width: 320px">\r\n            <option value="">''.mi18n("Nichts ausgew&auml;hlt").''</option>'';\r\n            while ($db->next_record()) {\r\n                if ( stristr($db->f("dirname"),''CVS/'') === FALSE ) {\r\n                    if ($db->f("dirname")=="CMS_VALUE[5]") {\r\n                        echo ''<option value="''.$db->f("dirname").''" selected="selected">''.$db->f("dirname").''</option>'';\r\n                    } else {\r\n                        echo ''<option value="''.$db->f("dirname").''">''.$db->f("dirname").''</option>'';\r\n                    }\r\n                }\r\n            }\r\n    echo ''</select></td></tr>'';?>\r\n</table>\r\n<?php\r\n', '<?php\r\n\r\n\r\n/***********************************************\r\n* Bildergalerie Output\r\n*\r\n* Author      :     Timo A. Hummel\r\n* Copyright   :     four for business AG\r\n* Created     :     30-09-2005\r\n* Modified    :     10-04-2008 by Bilal Arslan added new Bottom Navigation and change style\r\n* Modified    :     22-04-2009 by Timo Trautmann, fixed parse error bug, when picture gallery has only one page\r\n************************************************/\r\n\r\ncInclude("includes", "functions.api.images.php");\r\n\r\n/* Gallery variables */\r\n$bRecursive= false;\r\n\r\n/* mi18n variables */\r\n$sSeeImage= mi18n("Bildvorschau");\r\n$sDownImage= mi18n("Bild herunterladen");\r\n\r\n$sPath= "CMS_VALUE[5]";\r\nif ($sPath == '''') {\r\n    $sPath= $cfgClient[$client]["path"]["frontend"] . $cfgClient[$client]["upl"]["frontendpath"] . "bildergalerie/";\r\n} else {\r\n    $sPath= $cfgClient[$client]["path"]["frontend"] . $cfgClient[$client]["upl"]["frontendpath"] . "CMS_VALUE[5]";\r\n}\r\n\r\n$iRows= "CMS_VALUE[3]";\r\n\r\nif ($iRows == 0) {\r\n    $iRows= 2;\r\n}\r\n\r\n$iColumns= "CMS_VALUE[2]";\r\n\r\nif ($iColumns == 0) {\r\n    $iColumns= 2;\r\n}\r\n\r\n$start= $_REQUEST[''start''];\r\n\r\nif (isset ($start) && $start != "") {\r\n    $iCurrentPage= $start;\r\n} else {\r\n    $iCurrentPage= 1;\r\n    $start= 1;\r\n}\r\n\r\n$iWidth= "CMS_VALUE[0]";\r\n$iHeight= "CMS_VALUE[1]";\r\n\r\nif ($iWidth == 0) {\r\n    $iWidth= 300;\r\n}\r\n\r\nif ($iHeight == 0) {\r\n    $iHeight= 300;\r\n}\r\n\r\n$iDetailWidth= "CMS_VALUE[4]";\r\n\r\nif ($iDetailWidth == 0) {\r\n    $iDetailWidth= 300;\r\n}\r\n\r\n$aValidExtensions= array (\r\n    "jpg",\r\n    "jpeg",\r\n    "gif",\r\n    "png"\r\n);\r\n\r\n$iImagesPerPage= $iRows * $iColumns;\r\n\r\nif ($_REQUEST[''view''] == '''') {\r\n    /* Read all gallery files */\r\n    $aGalleryFiles= scanDirectory($sPath, $bRecursive);\r\n\r\n    if (is_array($aGalleryFiles)) {\r\n        /* Filter out non-images */\r\n        foreach ($aGalleryFiles as $key => $aGalleryFile) {\r\n            $sExtension= strtolower(getFileExtension($aGalleryFile));\r\n\r\n            if (!in_array($sExtension, $aValidExtensions)) {\r\n                unset ($aGalleryFiles[$key]);\r\n            }\r\n        }\r\n\r\n        /* Calculate effective variables */\r\n        $iFileCount= count($aGalleryFiles);\r\n        $iPages= ceil($iFileCount / $iImagesPerPage);\r\n\r\n        $aImagesToDisplay= array_slice($aGalleryFiles, ($iCurrentPage -1) * $iImagesPerPage, $iImagesPerPage);\r\n\r\n        $oImageTpl= new Template;\r\n        $oGalleryTpl= new Template;\r\n        $oEmptyImageTpl= new Template;\r\n\r\n        $aRenderedImages= array ();\r\n\r\n        $iRow= 0;\r\n        $iImagesRendered= 0;\r\n        $j= 1;\r\n        foreach ($aImagesToDisplay as $sImageToDisplay) {\r\n\r\n            $sDownloadImage= str_replace($cfgClient[$client][''path''][''frontend''], '''', $sImageToDisplay);\r\n\r\n            /* Do Scaling */\r\n            $sScaledImage= cApiImgScale($sImageToDisplay, $iWidth, $iHeight);\r\n\r\n            $link= ''front_content.php?idcatart='' . $idcatart . ''&amp;start='' . $_REQUEST[''start''] . ''&amp;view='' . urlencode(str_replace($cfgClient[$client][''path''][''frontend''], '''', $sImageToDisplay));\r\n\r\n            $description= ig_getImageDescription($sImageToDisplay);\r\n            if ($description == '''') {\r\n                $description= ''&nbsp;'';\r\n            }\r\n\r\n            $download_link= str_replace($cfgClient[$client][''path''][''frontend''], $cfgClient[$client][''path''][''htmlpath''], $sImageToDisplay);\r\n\r\n            $download_size= ig_GetReadableFileSize($sImageToDisplay);\r\n\r\n            $oImageTpl->reset();\r\n            $oImageTpl->set("s", "FILE", $sScaledImage);\r\n            $oImageTpl->set("s", "WIDTH", $iWidth);\r\n            $oImageTpl->set("s", "HEIGHT", $iHeight);\r\n            $oImageTpl->set("s", "LINK", $link);\r\n            $oImageTpl->set("s", "DESCRIPTION", $description);\r\n            $oImageTpl->set("s", "DOWNLOAD_LINK", $download_link);\r\n            $oImageTpl->set("s", "DOWNLOAD_SIZE", $download_size);\r\n            $oImageTpl->set("s", "DOWNLOAD_CAPTION", mi18n("Bild herunterladen"));\r\n            $oImageTpl->set("s", "PREVIEW_CAPTION", mi18n("Bildvorschau"));\r\n            $oImageTpl->set("s", "LINK_DOWN", $sDownloadImage); // a href\r\n            $oImageTpl->set("s", "LINKDESCRIPTION", '''');\r\n            $oImageTpl->set("s", "SEE_IMAGE", $sSeeImage);\r\n            $oImageTpl->set("s", "DOWN_IMAGE", $sDownImage);\r\n            $oImageTpl->set("s", "", $sDownImage);\r\n\r\n            #style links rechts\r\n            $sStyle= "";\r\n            $sStyle2 = '''';\r\n            \r\n            if (($j % 2) == 0) {\r\n                $sStyle= ''text-align:right'';\r\n                $sStyle2 = ''padding-left:65px'';\r\n            } else {\r\n                $sStyle= ''text-align:left'';\r\n                $sStyle2 = '''';\r\n            }\r\n            $j++;\r\n            $oImageTpl->set("s", "style", $sStyle);\r\n            $oImageTpl->set("s", "style_2", $sStyle2);\r\n            \r\n\r\n            $aRenderedImages[]= $oImageTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery_image.html", true, false);\r\n\r\n            $iImagesRendered++;\r\n\r\n            if ($iImagesRendered == $iColumns) {\r\n                $oGalleryTpl->set("d", "COLUMNS", implode("", $aRenderedImages));\r\n                $oGalleryTpl->next();\r\n                $iImagesRendered= 0;\r\n                $aRenderedImages= array ();\r\n            }\r\n        }\r\n\r\n        if (count($aRenderedImages) < $iColumns && count($aRenderedImages) > 0) {\r\n            $iEmptyCells= $iColumns -count($aRenderedImages);\r\n\r\n            $oEmptyImageTpl->set("s", "WIDTH", $iWidth);\r\n            $oEmptyImageTpl->set("s", "HEIGHT", $iHeight);\r\n\r\n            $sEmptyCells= str_repeat($oEmptyImageTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery_empty.html", true, false), $iEmptyCells);\r\n\r\n            $oGalleryTpl->set("d", "COLUMNS", implode("", $aRenderedImages) . $sEmptyCells);\r\n            $oGalleryTpl->next();\r\n        }\r\n\r\n        //      Begin Navigation Bottom\r\n        $aLinks= array ();\r\n\r\n        if ($iCurrentPage == "")\r\n            $iCurrentPage= 1;\r\n        $sBack= $cfgClient[$client]["path"]["htmlpath"] . sprintf("front_content.php?idcatart=%s&amp;start=%s", $idcatart, $iCurrentPage -1);\r\n        $sNext= $cfgClient[$client]["path"]["htmlpath"] . sprintf("front_content.php?idcatart=%s&amp;start=%s", $idcatart, $iCurrentPage +1);\r\n\r\n        for ($i= 1; $i <= $iPages; $i++) {\r\n\r\n            if ($i == $iCurrentPage) {\r\n                $aAllLinks[$i]= $i;\r\n            } else {\r\n                $aAllLinks[$i]= $cfgClient[$client]["path"]["htmlpath"] . sprintf("front_content.php?idcatart=%s&amp;start=%s", $idcatart, $i);\r\n            }\r\n\r\n        }\r\n\r\n        $sHtml= ''<a href="%s" title="%s"> %s </a>''; // Template\r\n\r\n        if ($iPages == 1) { // if pages count is = 1\r\n            $oCurrenTpl= new Template;\r\n\r\n            $oCurrenTpl->set("s", "Begin", '''');\r\n            $oCurrenTpl->set("s", "Body", '''');\r\n            $oCurrenTpl->set("s", "End", '''');\r\n            $aLinks[]= $oCurrenTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery_link.html", true, false);\r\n        }\r\n\r\n        if ($iCurrentPage == 1 && $iPages > 1) { // current page=1\r\n\r\n            $oTpl1= new Template;\r\n\r\n            $sNextButton= sprintf($sHtml, $sNext, mi18n("vor"), mi18n("&nbsp;vor&nbsp;") . ''<img src="images/link_pfeil_klein.gif">'');\r\n            $oTpl1->set("s", "Begin", '''');\r\n\r\n            foreach ($aAllLinks as $key => $value) {\r\n                #echo ''<br> value: ''.$value;\r\n                if (strlen($value) > 7) { // longer as url\r\n                    $sNumber= sprintf($sHtml, $value, $key, $key);\r\n                } else {\r\n                    $sNumber= $key;\r\n                }\r\n\r\n                $oTpl1->set(''d'', ''Body'', $sNumber);\r\n                $oTpl1->next();\r\n                $sNumber= "";\r\n            }\r\n\r\n            $oTpl1->set("s", "End", $sNextButton);\r\n            $aLinks[]= $oTpl1->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery_link.html", true, false);\r\n        }\r\n\r\n        if ($iCurrentPage > 1 && ($iPages - $iCurrentPage) != 0) { // body see all\r\n            $oPreviousTpl= new Template;\r\n\r\n            $sBackButton= sprintf($sHtml, $sBack, mi18n("zur&uuml;ck"), "<img src=''images/link_pfeil_klein_links.gif''/>" . mi18n("&nbsp;zur&uuml;ck&nbsp;"));\r\n            $sNextButton= sprintf($sHtml, $sNext, mi18n("vor"), mi18n("&nbsp;vor&nbsp;") . ''<img src="images/link_pfeil_klein.gif">'');\r\n\r\n            $oPreviousTpl->set("s", "Begin", $sBackButton);\r\n\r\n            foreach ($aAllLinks as $key => $value) {\r\n                #filter current page\r\n                if (strlen($value) > 7) { // longer as url\r\n                    $sNumber= sprintf($sHtml, $value, $key, $key);\r\n                } else {\r\n                    $sNumber= $key;\r\n                }\r\n\r\n                $oPreviousTpl->set(''d'', ''Body'', $sNumber);\r\n                $oPreviousTpl->next();\r\n\r\n            }\r\n\r\n            $oPreviousTpl->set("s", "End", $sNextButton);\r\n\r\n            $aLinks[]= $oPreviousTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery_link.html", true, false);\r\n        } else\r\n            if ($iPages - $iCurrentPage == 0) { // this is end\r\n                $oNextTpl= new Template;\r\n                $oNextTpl->reset();\r\n                $sBackButton= sprintf($sHtml, $sBack, mi18n("zur&uuml;ck"), "<img src=''images/link_pfeil_klein_links.gif''/>" . mi18n("&nbsp;zur&uuml;ck&nbsp;"));\r\n                $oNextTpl->set("s", "End", '''');\r\n\r\n                foreach ($aAllLinks as $key => $value) {\r\n                    #filter current page\r\n                    if (strlen($value) > 7) { // longer as url\r\n                        $sNumber= sprintf($sHtml, $value, $key, $key);\r\n                    } else {\r\n                        $sNumber= $key;\r\n                    }\r\n\r\n                    $oNextTpl->set(''d'', ''Body'', $sNumber);\r\n                    $oNextTpl->next();\r\n                }\r\n\r\n                $oNextTpl->set("s", "Begin", $sBackButton);\r\n                $aLinks[]= $oNextTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery_link.html", true, false);\r\n\r\n            }\r\n\r\n        $oGalleryTpl->set("s", "NAVIGATION", implode("", $aLinks));\r\n        $oGalleryTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery.html", false, false);\r\n        $oGalleryTpl->reset(); // Navigation end\r\n        unset ($aAllLinks);\r\n    }\r\n} else { // See only one Image\r\n    $sImageToDisplay= $cfgClient[$client][''path''][''frontend''] . $_REQUEST[''view''];\r\n    $sScaledImage= cApiImgScale($sImageToDisplay, $iDetailWidth, 1000);\r\n\r\n    $description= ig_getImageDescription($sImageToDisplay);\r\n\r\n    $download_link= str_replace($cfgClient[$client][''path''][''frontend''], $cfgClient[$client][''path''][''htmlpath''], $sImageToDisplay);\r\n\r\n    $download_size= ig_GetReadableFileSize($sImageToDisplay);\r\n\r\n    $oImageTpl= new Template;\r\n    $oImageTpl->set("s", "IMG", $sScaledImage);\r\n    $oImageTpl->set("s", "BACKLINK", ''front_content.php?idcat='' . $idcat . ''&amp;idart='' . $idart . ''&amp;start='' . $_REQUEST[''start'']);\r\n    $oImageTpl->set("s", "BACKCAPTION", mi18n("&nbsp;zur&uuml;ck"));\r\n    $oImageTpl->set("s", "DESCRIPTION", $description);\r\n    $oImageTpl->set("s", "DOWNLOAD_LINK", $download_link);\r\n    $oImageTpl->set("s", "DOWNLOAD_SIZE", $download_size);\r\n    $oImageTpl->set("s", "DOWNLOAD_CAPTION", mi18n("Bild herunterladen&nbsp;"));\r\n\r\n    $oImageTpl->generate($cfgClient[$client]["path"]["frontend"] . "templates/gallery_detail.html", false, false);\r\n}\r\n\r\nfunction ig_getImageDescription($idupl) {\r\n\r\n    global $cfg, $cfgClient, $db, $client, $lang;\r\n\r\n    $cApiClient= new cApiClient($client);\r\n    $language_separator= $cApiClient->getProperty(''language'', ''separator'');\r\n    if ($language_separator == "") {\r\n        //Sanity, if module used in client without set client setting\r\n        $language_separator= "���";\r\n        $cApiClient->setProperty(''language'', ''separator'', $language_separator);\r\n    }\r\n    if (is_numeric($idupl)) {\r\n        //ID is a number \r\n        $query= "SELECT description FROM " . $cfg["tab"]["upl"] . " WHERE idupl = " . $idupl;\r\n    } else {\r\n        //ID is a string\r\n        $path_parts= pathinfo($idupl);\r\n        $upload= $cfgClient[$client][''upl''][''frontendpath''];\r\n        $len= strlen($upload);\r\n        $pos= strpos($idupl, $upload);\r\n        $dirname= substr($path_parts[''dirname''], $pos + $len) . ''/'';\r\n        $query= "SELECT description FROM " . $cfg["tab"]["upl"] . " WHERE (dirname = ''" . $dirname . "'') AND (filename=''" . $path_parts[''basename''] . "'') AND (filetype=''" . $path_parts[''extension''] . "'')";\r\n    }\r\n    $db->query($query);\r\n    if ($db->next_record()) {\r\n        return conHtmlSpecialChars(urldecode($db->f("description")));\r\n    } else {\r\n        return '''';\r\n    }\r\n}\r\n\r\nfunction ig_GetReadableFileSize($path) {\r\n    $filesize= filesize($path);\r\n    $unit= "bytes";\r\n\r\n    if ($filesize > 1024) {\r\n        $filesize= ($filesize / 1024);\r\n        $unit= "kB";\r\n    }\r\n    if ($filesize > 1024) {\r\n        $filesize= ($filesize / 1024);\r\n        $unit= "MB";\r\n    }\r\n    if ($filesize > 1024) {\r\n        $filesize= ($filesize / 1024);\r\n        $unit= "GB";\r\n    }\r\n    if ($filesize > 1024) {\r\n        $filesize= ($filesize / 1024);\r\n        $unit= "TB";\r\n    }\r\n\r\n    $filesize= round($filesize, 0);\r\n    return $filesize . " " . $unit;\r\n}\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:59:06', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (16, 1, 'RSS_Reader', 'Content', 'none', 'Display an RSS Feed.', NULL, '?><?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Display an RSS Feed. Module "Input".\r\n*\r\n* @version 1.0.0\r\n* @author Timo Hummel, Andreas Lindner\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2005-09-30\r\n* }}\r\n*\r\n* $Id$\r\n*/\r\n\r\necho ''<table>'';\r\necho ''<tr><td>''.mi18n("URL").''</td><td><input type="text" name="''."CMS_VAR[0]".''" value="''."CMS_VALUE[0]".''" style="width: 320px"></td></tr>'';\r\necho ''<tr><td>'';\r\necho mi18n("RSS-Template ausw�hlen").'':</td><td><select name="CMS_VAR[1]" size="1" style="width: 320px">\r\n<option value="">Nichts ausgew�hlt</option>'';\r\n$strPath_fs = $cfgClient[$client]["path"]["frontend"].''templates/'';\r\n$handle = opendir($strPath_fs);\r\nwhile ($entryName = readdir($handle)) {\r\n	if (is_file($strPath_fs.$entryName)) { \r\n		if ("CMS_VALUE[1]"==$entryName) {\r\n			echo ''<option selected value="''.$entryName.''">''.$entryName.''</option>'';\r\n		} else {\r\n			echo ''<option value="''.$entryName.''">''.$entryName.''</option>'';\r\n		}\r\n	}\r\n}\r\necho ''</select></td></tr>'';\r\n\r\necho ''<tr><td>''.mi18n("Anzahl Eintr�ge").''</td><td><input type="text" name="''."CMS_VAR[2]".''" value="''."CMS_VALUE[2]".''"</td></tr>'';\r\n\r\necho ''</table>'';\r\n\r\n?><?php', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Display an RSS Feed. Module "Output".\r\n*\r\n* @version 1.0.0\r\n* @author Timo Hummel, Andreas Lindner\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2005-09-30\r\n* }}\r\n*\r\n* $Id$\r\n*/\r\n\r\ncInclude("pear", "XML/Parser.php");\r\ncInclude("pear", "XML/RSS.php");\r\n\r\nif ("CMS_VALUE[0]" == "")\r\n{\r\n  $sFeed = "http://www.contenido.org/rss/de/news";\r\n} else {\r\n  $sFeed = "CMS_VALUE[0]";\r\n}\r\n\r\nif ("CMS_VALUE[2]" == "")\r\n{\r\n  $FeedMaxItems = 999;\r\n} else {\r\n	$FeedMaxItems = intval("CMS_VALUE[2]");\r\n}\r\n\r\n/* Preparse feed for an encoding due to the poorly designed\r\n   PHP XML parser */\r\n$sFeedContent = substr(@file_get_contents($sFeed),0,1024);\r\n\r\n$regExp = "/<\\?xml.*encoding=[\\"\\''](.*)[\\"\\'']\\?>/i";\r\n		\r\npreg_match($regExp,trim($sFeedContent),$matches);\r\n\r\nif ($matches[1])\r\n{\r\n  $rss = new XML_RSS($sFeed, $matches[1]);\r\n} else {\r\n  $rss = new XML_RSS($sFeed);\r\n}\r\n\r\n$rss->parse();\r\n\r\nif (!isset($tpl) || !is_object($tpl)) {\r\n    $tpl = new Template();\r\n}\r\n$tpl->reset();\r\n\r\n$i = 0;\r\nforeach ($rss->getItems() as $item)\r\n{\r\n	if ($i < $FeedMaxItems) {\r\n	    $tpl->set("d", "TITLE", conHtmlentities($item[''title''],ENT_QUOTES));\r\n    	$tpl->set("d", "LINK", conHtmlentities($item[''link''],ENT_QUOTES));\r\n    	$tpl->set("d", "DESCRIPTION", conHtmlentities($item[''description''],ENT_QUOTES));\r\n    	$tpl->set("d", "READ_ON", mi18n("weiterlesen"));\r\n	    $tpl->next();\r\n	}\r\n	$i++;\r\n}\r\n\r\n$tpl->generate($cfgClient[$client]["path"]["frontend"]."templates/"."CMS_VALUE[1]");\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:59:19', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (17, 1, 'Search_Input', 'Content', 'none', 'Search input box', NULL, '', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Search input box\r\n*\r\n* @version 1.0.0\r\n* @author Rudi Bieller\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2008-04-07\r\n* }}\r\n*\r\n* $Id$\r\n*/\r\n\r\nif (!isset($tpl) || !is_object($tpl)) {\r\n    $tpl = new Template();\r\n}\r\n$tpl->reset();\r\n\r\n$sTargetIdcat = getEffectiveSetting(''search-results'', ''idcat'', ''1'');\r\n$sTargetIdart = getEffectiveSetting(''search-results'', ''idart'', ''1'');\r\n$sFormAction = ''front_content.php?idcat=''.$sTargetIdcat.''&amp;idart=''.$sTargetIdart;\r\n\r\n$tpl->set(''s'', ''form_action'', $sFormAction);\r\n$tpl->set(''s'', ''label_search'', mi18n("Suche"));\r\n$tpl->generate(''templates/search_input.html'');\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 15:59:48', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (18, 1, 'Search_Output', 'Content', 'none', 'Search output box configurable as follows:\r\n\r\n- Client-setting: List of category tree ids to limit the search\r\n- Client-setting: List of additional category ids to limit the search\r\n- Client-setting: List of additional articles ids to limit the search\r\n- Client-setting: List of article ids which should be explicitly searchable\r\n- Number of search results to display per page\r\n- Max length of text to display (headline, subheadline and teasertext)\r\n- Type of db search (regular expression, like or exact search)\r\n- Specify and/or search, if search term contains more than one word\r\n- Search range specified in (categories/articles in client settings) is excluded, otherwise included (exclusive)\r\n- Search offline articles or articles in categories which are offline (''visible'' and ''online'')\r\n- Don''t search articles or articles in categories which are offline or protected\r\n- Search in predefined cms-types\r\n- Specify HTML tags (start and end) to emphasize the located search term in search results\r\n', NULL, '?><?php\r\n/**\r\n * Module-Input: Search_Output\r\n *\r\n * @author     Murat Purc <murat@purc.de>\r\n * @copyright  four for business AG <www.4fb.de>\r\n * @version    $Id: Search_Output_input.php 14 2013-01-03 16:08:10Z murat $\r\n */\r\n\r\n// #################################################################################################\r\n// INITIALIZATION\r\n\r\n$modContext = new stdClass();\r\n\r\n$modContext->oApiClient = new cApiClient($client);\r\n\r\n$modContext->dbSearchOptions = array(\r\n    ''regexp'' => mi18n("REGEXP Suche"),\r\n    ''like'' => mi18n("LIKE Suche"),\r\n    ''exact'' => mi18n("Exakte Suche")\r\n);\r\n\r\n$modContext->combineOptions = array(\r\n    '''' => mi18n("Automatische Erkennung (per default Und-Suche)"),\r\n    ''and'' => mi18n("Und-Suche"),\r\n    ''or'' => mi18n("Oder-Suche")\r\n);\r\n\r\n$modContext->defaultCmsOptions = ''head,html,htmlhead,htmltext,text'';\r\n\r\n$modContext->defaultEmphasizeWith = ''<strong>,</strong>'';\r\n\r\n\r\n// #################################################################################################\r\n// CMS VARIABLES & LOGIC\r\n\r\n$modContext->categoryTree = $modContext->oApiClient->getProperty(''searchrange'', ''include'');\r\nif (empty($modContext->categoryTree)) {\r\n    $modContext->categoryTree = mi18n(''k. a.'');\r\n}\r\n\r\n$modContext->categories = $modContext->oApiClient->getProperty(''searchrange'', ''include_categories'');\r\nif (empty($modContext->categories)) {\r\n    $modContext->categories = mi18n(''k. a.'');\r\n}\r\n\r\n$modContext->articles = $modContext->oApiClient->getProperty(''searchrange'', ''include_articles'');\r\nif (empty($modContext->articles)) {\r\n    $modContext->articles = mi18n(''k. a.'');\r\n}\r\n\r\n$modContext->searchableArticles = $modContext->oApiClient->getProperty(''searchrange'', ''searchable_articles'');\r\nif (empty($modContext->searchableArticles)) {\r\n    $modContext->searchableArticles = mi18n(''k. a.'');\r\n}\r\n\r\n$modContext->cmsValueItemsPerPage = "CMS_VALUE[1]";\r\n$modContext->cmsVarItemsPerPage = "CMS_VAR[1]";\r\n\r\n$modContext->cmsValueMaxLengthTeasertext = "CMS_VALUE[2]";\r\n$modContext->cmsVarMaxLengthTeasertext = "CMS_VAR[2]";\r\n\r\n$modContext->cmsValueDbSearchOption = "CMS_VALUE[3]";\r\n$modContext->cmsVarDbSearchOption = "CMS_VAR[3]";\r\n\r\n$modContext->cmsValueCombine = "CMS_VALUE[4]";\r\n$modContext->cmsVarCombine = "CMS_VAR[4]";\r\n\r\n$modContext->cmsValueExclude = "CMS_VALUE[5]";\r\n$modContext->cmsVarExclude = "CMS_VAR[5]";\r\n$modContext->cmsChkExclude = ("1" == $modContext->cmsValueExclude) ? '' checked="checked"'' : '''';\r\n\r\n$modContext->cmsValueDontShowOfflineArticles = "CMS_VALUE[6]";\r\n$modContext->cmsVarDontShowOfflineArticles = "CMS_VAR[6]";\r\n$modContext->cmsChkDontShowOfflineArticles = ("1" == $modContext->cmsValueDontShowOfflineArticles) ? '' checked="checked"'' : '''';\r\n\r\n$modContext->cmsValueProtected = "CMS_VALUE[7]";\r\n$modContext->cmsVarProtected = "CMS_VAR[7]";\r\n$modContext->cmsChkProtected = ("1" == $modContext->cmsValueProtected) ? '' checked="checked"'' : '''';\r\n\r\n$modContext->cmsValueOptions = "CMS_VALUE[8]";\r\n$modContext->cmsVarOptions = "CMS_VAR[8]";\r\nif (empty($modContext->cmsValueOptions)) {\r\n    $modContext->cmsValueOptions = $modContext->defaultCmsOptions;\r\n}\r\n\r\n$modContext->cmsValueEmphasizeWith = "CMS_VALUE[9]";\r\n$modContext->cmsVarEmphasizeWith = "CMS_VAR[9]";\r\nif (empty($modContext->cmsValueEmphasizeWith)) {\r\n    $modContext->cmsValueEmphasizeWith = $modContext->defaultEmphasizeWith;\r\n}\r\n\r\n// #################################################################################################\r\n// OUTPUT\r\n\r\n?>\r\n\r\n<table cellspacing="0" cellpadding="3" border="0">\r\n\r\n<!-- client setting - category tree ids -->\r\n<tr>\r\n    <td valign="top" class="text_medium"><?php echo mi18n("Kategorieb&auml;ume") ?></td>\r\n    <td class="text_medium">\r\n        <?php echo $modContext->categoryTree ?> (<?php echo mi18n("Mandanteneinstellung") ?>)<br />\r\n        <small><?php echo mi18n("Es wird auch in allen Unterkategorien gesucht") ?></small>\r\n    </td>\r\n</tr>\r\n\r\n<!-- client setting - category ids -->\r\n<tr>\r\n    <td valign="top" class="text_medium"><?php echo mi18n("Kategorie-Ids") ?></td>\r\n    <td class="text_medium">\r\n        <?php echo $modContext->categories ?> (<?php echo mi18n("Mandanteneinstellung") ?>)<br />\r\n        <small><?php echo mi18n("Zus&auml;tzlich zu Kategorieb&auml;ume auch in einzelnen Kategorien suchen") ?></small>\r\n    </td>\r\n</tr>\r\n\r\n<!-- client setting - article ids -->\r\n<tr>\r\n    <td valign="top" class="text_medium"><?php echo mi18n("Artikel-Ids") ?></td>\r\n    <td class="text_medium">\r\n        <?php echo $modContext->articles ?> (<?php echo mi18n("Mandanteneinstellung") ?>)<br />\r\n        <small><?php echo mi18n("Zus&auml;tzlich zu Kategorieb&auml;ume auch in einzelnen Artikeln suchen") ?></small>\r\n    </td>\r\n</tr>\r\n\r\n<!-- client setting - searchable article ids -->\r\n<tr>\r\n    <td valign="top" class="text_medium"><?php echo mi18n("Suche nur in Artikel-Ids") ?></td>\r\n    <td class="text_medium">\r\n        <?php echo $modContext->searchableArticles ?> (<?php echo mi18n("Mandanteneinstellung") ?>)<br />\r\n        <small><?php echo mi18n("Suche nur in angegebenen Artikel-Ids, &uuml;berschreibt die Mandanteneinstellung f&uuml; Kategorieb&auml;ume, Kategorie-Ids und Artikel-Ids") ?></small>\r\n    </td>\r\n</tr>\r\n\r\n<!-- items per page -->\r\n<tr>\r\n    <td valign="top" class="text_medium"><?php echo mi18n("Ergebnisse pro Seite") ?></td>\r\n    <td class="text_medium">\r\n        <input type="text" class="text_medium" style="width:50px;" name="<?php echo $modContext->cmsVarItemsPerPage ?>" value="<?php echo $modContext->cmsValueItemsPerPage ?>" />\r\n    </td>\r\n</tr>\r\n\r\n<!-- max length teasertext -->\r\n<tr>\r\n    <td valign="top" class="text_medium"><?php echo mi18n("Maximale Anzahl der Zeichen") ?></td>\r\n    <td class="text_medium">\r\n        <input type="text" class="text_medium" style="width:50px;" name="<?php echo $modContext->cmsVarMaxLengthTeasertext ?>" value="<?php echo $modContext->cmsValueMaxLengthTeasertext ?>" />\r\n    </td>\r\n</tr>\r\n\r\n<!-- db search option -->\r\n<tr>\r\n    <td valign="top" class="text_medium"><?php echo mi18n("Datenbank Suchmodus") ?></td>\r\n    <td class="text_medium">\r\n        <select class="text_medium" name="<?php echo $modContext->cmsVarDbSearchOption ?>">\r\n        <?php\r\n        foreach ($modContext->dbSearchOptions as $k => $v) {\r\n            $sel = ($modContext->cmsValueDbSearchOption == $k) ? '' selected="selected"'' : '''';\r\n            echo ''<option value="'' . $k . ''"'' . $sel . ''>'' . $v . ''</option>'' . "\\n";\r\n        }\r\n        ?>\r\n        </select>\r\n    </td>\r\n</tr>\r\n\r\n<!-- combine -->\r\n<tr>\r\n    <td valign="top" class="text_medium"><?php echo mi18n("Suchart bei mehreren W&ouml;rtern") ?></td>\r\n    <td class="text_medium">\r\n        <select class="text_medium" name="<?php echo $modContext->cmsVarCombine ?>">\r\n        <?php\r\n        foreach ($modContext->combineOptions as $k => $v) {\r\n            $sel = ($modContext->cmsValueCombine == $k) ? '' selected="selected"'' : '''';\r\n            echo ''<option value="'' . $k . ''"'' . $sel . ''>'' . $v . ''</option>'' . "\\n";\r\n        }\r\n        ?>\r\n        </select>\r\n    </td>\r\n</tr>\r\n\r\n<!-- exclude -->\r\n<tr>\r\n    <td valign="top" class="text_medium"><?php echo mi18n("Eingegebene Ids ausschlie&szlig;en") ?></td>\r\n    <td class="text_medium">\r\n        <input type="checkbox" name="<?php echo $modContext->cmsVarExclude ?>" value="1"<?php echo $modContext->cmsChkExclude ?>><br />\r\n        <small><?php echo mi18n("Wenn gew&auml;hlt, wird in konfigurierten Kategorien/Artikeln nicht gesucht") ?></small>\r\n    </td>\r\n</tr>\r\n\r\n<!-- don''t show offline articles -->\r\n<tr>\r\n    <td valign="top" class="text_medium"><?php echo mi18n("Online/Sichtbare Artikel anzeigen") ?></td>\r\n    <td class="text_medium">\r\n        <input type="checkbox" name="<?php echo $modContext->cmsVarDontShowOfflineArticles ?>" value="1"<?php echo $modContext->cmsChkProtected ?>><br />\r\n        <small><?php echo mi18n("Wenn gew&auml;hlt, werden nur Artikel angezeigt, die online und sichtbar sind") ?></small>\r\n    </td>\r\n</tr>\r\n\r\n<!-- protected -->\r\n<tr>\r\n    <td valign="top" class="text_medium"><?php echo mi18n("Online/Sichtbare/&Ouml;ffentliche Artikel anzeigen") ?></td>\r\n    <td class="text_medium">\r\n        <input type="checkbox" name="<?php echo $modContext->cmsVarProtected ?>" value="1"<?php echo $modContext->cmsChkProtected ?>><br />\r\n        <small><?php echo mi18n("Wenn gew&auml;hlt, werden nur Artikel angezeigt, die online und sichtbar und nicht gesch&uuml;tzt sind") ?></small>\r\n    </td>\r\n</tr>\r\n\r\n<!-- cms options -->\r\n<tr>\r\n    <td valign="top" class="text_medium"><?php echo mi18n("Suche in CMS-Typen") ?></td>\r\n    <td class="text_medium">\r\n        <input type="text" class="text_medium" style="width:300px;" name="<?php echo $modContext->cmsVarOptions ?>" value="<?php echo $modContext->cmsValueOptions ?>" /><br />\r\n        <small><?php echo mi18n("Komma separierte Liste von CMS-Typen, klein geschrieben und ohne cms_ Prefix") ?></small>\r\n    </td>\r\n</tr>\r\n\r\n<!-- emphasize with -->\r\n<tr>\r\n    <td valign="top" class="text_medium"><?php echo mi18n("Ergebnisse hervorheben mit") ?></td>\r\n    <td class="text_medium">\r\n        <input type="text" class="text_medium" style="width:300px;" name="<?php echo $modContext->cmsVarEmphasizeWith ?>" value="<?php echo $modContext->cmsValueEmphasizeWith ?>" /><br />\r\n        <small><?php echo mi18n("Komma separierte HTML Tags (Start und Ende) um die Sucheregebnisse hervorzuheben") ?></small>\r\n    </td>\r\n</tr>\r\n\r\n</table>\r\n\r\n<?php\r\n\r\nunset($modContext);', '<?php\r\n/**\r\n * Module-Output: Search_Output\r\n *\r\n * NOTES:\r\n * System properties in use:\r\n * - Type: searchrange, Name: include, contains comma-separated list of categories to be included into search (sub-cats are included automatically)\r\n * - Type: searchrange, Name: include_categories, contains additional comma-separated list of categories to be included into search (sub-cats are not included automatically)\r\n * - Type: searchrange, Name: include_articles, contains additional comma-separated list of articles to be included into search\r\n * - Type: searchrange, Name: searchable_articles, contains comma-separated list of articles to use for search (note: overwrites ''include'', ''include_categories'' and ''include_articles'')\r\n * Logical combination of search terms with AND or OR\r\n *\r\n * @author     Willi Man, Murat Purc <murat@purc.de>\r\n * @copyright  four for business AG <www.4fb.de>\r\n * @version    1.0.1\r\n *\r\n * $Id: Search_Output_output.php 14 2013-01-03 16:08:10Z murat $\r\n */\r\n\r\n// #################################################################################################\r\n// INITIALIZATION\r\n\r\ncInclude(''includes'', ''functions.api.string.php'');\r\n\r\nif (!is_object($tpl)) {\r\n    $tpl = new Template();\r\n}\r\n$tpl->reset();\r\n\r\n$modContext = new stdClass();\r\n\r\n$modContext->oApiClient = new cApiClient($client);\r\n$modContext->oUrl = Contenido_Url::getInstance();\r\n\r\n$modContext->dbSearchOptions = array(''regexp'', ''like'', ''exact'');\r\n\r\n$modContext->combineOptions = array(''and'', ''or'', '''');\r\n\r\n$modContext->defaultCmsOptions = ''head,html,htmlhead,htmltext,text'';\r\n\r\n$modContext->defaultEmphasizeWith = ''<strong>,</strong>'';\r\n\r\n// Some simple templates\r\n$modContext->tplPageNavItemCurrent = ''<span style="white-space:nowrap;">&nbsp;<strong>%s</strong>&nbsp;</span>'';\r\n$modContext->tplPageNavItem = ''<span style="white-space:nowrap;">&nbsp;<a href="%s" title="%s. '' . mi18n(''Ergebnisseite anzeigen'') . ''">%s</a>&nbsp;</span>'';\r\n$modContext->tplNextPage = ''&nbsp;<a href="%s" title="'' . mi18n(''n�chste Ergebnisseite anzeigen'') . ''">'' . mi18n(''vor'') . ''&nbsp;&nbsp;<img src="images/link_pfeil_klein.gif" alt="" /></a>'';\r\n$modContext->tplPreviousPage = ''<a href="%s" title="'' . mi18n(''vorherige Ergebnisseite anzeigen'') . ''"><img src="images/link_pfeil_klein_links.gif" alt="" />&nbsp;&nbsp;'' . mi18n(''zur&uuml;ck'') . ''</a>&nbsp;'';\r\n\r\n\r\n// #################################################################################################\r\n// SETTINGS\r\n\r\n// (bool) Enable debugging\r\n$modContext->debug = false;\r\n\r\n// (array) List of category tree ids to limit the search\r\n$modContext->cfgCategoryTree = $modContext->oApiClient->getProperty(''searchrange'', ''include'');\r\nif (!empty($modContext->cfgCategoryTree)) {\r\n    $modContext->cfgCategoryTree = explode('','', $modContext->cfgCategoryTree);\r\n} else {\r\n    $modContext->cfgCategoryTree = null;\r\n}\r\n\r\n// (array) List of additional category ids to limit the search (in addition to ''cfgCategoryTree'')\r\n$modContext->cfgCategories = $modContext->oApiClient->getProperty(''searchrange'', ''include_categories'');\r\nif (!empty($modContext->cfgCategories)) {\r\n    $modContext->cfgCategories = explode('','', $modContext->cfgCategories);\r\n} else {\r\n    $modContext->cfgCategories = null;\r\n}\r\n\r\n// (array) List of additional articles ids to limit the search (in addition to ''cfgCategoryTree'')\r\n$modContext->cfgArticles = $modContext->oApiClient->getProperty(''searchrange'', ''include_articles'');\r\nif (!empty($modContext->cfgArticles)) {\r\n    $modContext->cfgArticles = explode('','', $modContext->cfgArticles);\r\n} else {\r\n    $modContext->cfgArticles = null;\r\n}\r\n\r\n// (array) List of article ids which should be searchable.\r\n//         NOTE: Overwrites settings ''cfgCategoryTree'', ''cfgCategories'' and ''cfgArticles''\r\n$modContext->cfgSearchableArticles = $modContext->oApiClient->getProperty(''searchrange'', ''searchable_articles'');\r\nif (!empty($modContext->cfgSearchableArticles)) {\r\n    $modContext->cfgSearchableArticles = explode('','', $modContext->cfgSearchableArticles);\r\n} else {\r\n    $modContext->cfgSearchableArticles = null;\r\n}\r\n\r\n// (int) Number of search results to display per page\r\n$modContext->cfgItemsPerPage = "CMS_VALUE[1]";\r\nif ((int) $modContext->cfgItemsPerPage < 1) {\r\n    $modContext->cfgItemsPerPage = 10;\r\n}\r\n\r\n// (int) Max length of text to display (headline, subheadline and teasertext)\r\n$modContext->cfgMaxLengthTeasertext = "CMS_VALUE[2]";\r\nif ((int) $modContext->cfgMaxLengthTeasertext < 1) {\r\n    $modContext->cfgMaxLengthTeasertext = 200;\r\n}\r\n\r\n// (string) Type of db search, feasible values are ''regexp'', ''like'' or ''exact''\r\n$modContext->cfgDbSearchOption = "CMS_VALUE[3]";\r\nif (!in_array($modContext->dbSearchOption, $modContext->dbSearchOptions)) {\r\n    $modContext->cfgDbSearchOption = ''regexp'';\r\n}\r\n\r\n// (string) Specify and/or search, if searchterm contains more than one word.\r\n$modContext->cfgCombine = "CMS_VALUE[4]";\r\nif (!in_array($modContext->combine, $modContext->combineOptions)) {\r\n    $modContext->cfgCombine = '''';\r\n}\r\n\r\n// (bool) Searchrange specified in ''categoryTree'', ''cfgCategories'' and ''cfgArticles'' is excluded, otherwise included (exclusive)\r\n$modContext->cfgExclude = ("CMS_VALUE[5]" == "1") ? true : false;\r\n\r\n// (bool) Search offline articles or articles in categories which are offline.\r\n//        If eanbled, it searches only in items with active ''visible'' and ''online'' state.\r\n$modContext->cfgDontShowOfflineArticles = ("CMS_VALUE[6]" == "1") ? true : false;\r\n\r\n// (bool) Don''t search articles or articles in categories which are offline or protected.\r\n//        If eanbled, it overwrites the setting ''dontShowOfflineArticles''.\r\n$modContext->cfgProtected = ("CMS_VALUE[7]" == "1") ? true : false;\r\n\r\n// (array) Search only in these cms-types (entries in lower case and without the ''cms_'' prefix)\r\n$modContext->cfgCmsOptions = "CMS_VALUE[8]";\r\nif (empty($modContext->cfgCmsOptions)) {\r\n    $modContext->cfgCmsOptions = $modContext->defaultCmsOptions;\r\n}\r\n$modContext->cfgCmsOptions = explode('','', $modContext->cfgCmsOptions);\r\n\r\n// (array) HTML tags (start and end) to emphasize the located searchterm in search results\r\n$modContext->cfgEmphasizeWith = "CMS_VALUE[9]";\r\nif (empty($modContext->cfgEmphasizeWith)) {\r\n    $modContext->cfgEmphasizeWith = $modContext->defaultEmphasizeWith;\r\n}\r\n$modContext->cfgEmphasizeWith = explode('','', $modContext->cfgEmphasizeWith);\r\n\r\n\r\n// #################################################################################################\r\n// MISC\r\n\r\nif (!function_exists(''module_searchOutput_getArticleSpecification'')) {\r\n    /**\r\n     * Get specification of an article\r\n     * @param  int  $articleId  Article id\r\n     * @param  int  $langId  Language id\r\n     * @return  int|bool  Id of article specification or false\r\n     */\r\n    function module_searchOutput_getArticleSpecification($articleId, $langId) {\r\n        global $db, $cfg;\r\n        $sql = "SELECT artspec FROM " . $cfg[''tab''][''art_lang''] . " WHERE"\r\n             . " idart = " . (int) $articleId . " AND idlang = " . (int) $langId;\r\n        $db->query($sql);\r\n        return ($db->next_record()) ? $db->f(''artspec'') : false;\r\n    }\r\n}\r\n\r\n\r\n// #################################################################################################\r\n// PROCESSING / OUTPUT\r\n\r\n\r\nif ($modContext->debug) {\r\n    echo ''<pre>Settings: '';\r\n    foreach ($modContext as $var => $value) {\r\n        if (0 === strpos($var, ''cfg'')) {\r\n            echo "$var: " . print_r($value, true) . "\\n";\r\n        }\r\n    }\r\n    echo ''</pre>'';\r\n}\r\n\r\n// Get search term and pre-process it\r\n$searchTerm = '''';\r\nif (!empty($_GET[''searchterm''])) {\r\n    $searchTerm = urldecode(conHtmlentities(strip_tags(stripslashes($_GET[''searchterm'']))));\r\n} elseif (!empty($_POST[''searchterm''])) {\r\n    $searchTerm = urldecode(conHtmlentities(strip_tags(stripslashes($_POST[''searchterm'']))));\r\n}\r\n$searchTerm = str_replace('' + '', '' AND '', $searchTerm);\r\n$searchTerm = str_replace('' - '', '' NOT '', $searchTerm);\r\n$searchTermDisplay = $searchTerm;\r\n\r\n// Get all article specs\r\n$sql = "SELECT idartspec, artspec FROM " . $cfg[''tab''][''art_spec''] . " WHERE "\r\n        . "client = $client AND lang = $lang AND online = 1";\r\n$db->query($sql);\r\n$aArtSpecs = array();\r\nwhile ($db->next_record()) {\r\n    $aArtSpecs[] = $db->f(''idartspec'');\r\n}\r\n$aArtSpecs[] = 0;\r\n\r\nif (strlen(trim($searchTerm)) > 0) {\r\n    // Parse search term and set search options\r\n    $searchTerm = conHtmlEntityDecode($searchTerm);\r\n\r\n    if (empty($modContext->cfgCombine)) {\r\n        $modContext->cfgCombine = (stristr($searchTerm, '' or '') === false) ? ''and'' : ''or'';\r\n    }\r\n\r\n    $searchTerm = str_replace('' and '', '' '', strtolower($searchTerm));\r\n    $searchTerm = str_replace('' or '', '' '', strtolower($searchTerm));\r\n\r\n    // Instantiate search with some options\r\n    $options = array(\r\n        ''db'' => $modContext->cfgDbSearchOption,\r\n        ''combine'' => $modContext->cfgCombine,\r\n        ''exclude'' => $modContext->cfgExclude,\r\n        ''cat_tree'' => $modContext->cfgCategoryTree,\r\n        ''categories'' => $modContext->cfgCategories,\r\n        ''articles'' => $modContext->cfgArticles,\r\n        ''searchable_articles'' => $modContext->cfgSearchableArticles,\r\n        ''artspecs'' => $aArtSpecs, // array of article specifications => search only articles with these artspecs\r\n        ''protected'' => $modContext->cfgProtected,\r\n        ''dontshowofflinearticles'' => $modContext->cfgDontShowOfflineArticles\r\n    );\r\n    $search = new Search($options);\r\n\r\n    $search->setCmsOptions($modContext->cfgCmsOptions);\r\n\r\n    // Execute search\r\n    $aSearchResults = $search->searchIndex($searchTerm, '''');\r\n\r\n    // Build results page\r\n    if (count($aSearchResults) > 0) {\r\n        $tpl->set(''s'', ''result_page'', mi18n(''Ergebnis-Seite'') . '':'');\r\n\r\n        // Build meessage\r\n        $message = sprintf("%s ''%s'' %s:", mi18n(''Ihre Suche nach''), conHtmlSpecialChars(strip_tags($searchTermDisplay)), mi18n(''hat $$$ Treffer ergeben''));\r\n        $message = str_replace(''$$$'', count($aSearchResults), $message);\r\n        $tpl->set(''s'', ''MESSAGE'', $message);\r\n\r\n        // Get search results, number of results per page and pages\r\n        $oSearchResults = new SearchResult($aSearchResults, $modContext->cfgItemsPerPage);\r\n        $iNumberOfResults = $oSearchResults->getNumberOfResults();\r\n        $iNumberOfPages = $oSearchResults->getNumberOfPages();\r\n        $oSearchResults->setReplacement($modContext->cfgEmphasizeWith[0], $modContext->cfgEmphasizeWith[1]);\r\n\r\n        // Get current result page\r\n        $page = (!empty($_GET[''page'']) && (int) $_GET[''page''] > 0) ? $_GET[''page''] : 1;\r\n        $aResPage = $oSearchResults->getSearchResultPage($page);\r\n\r\n        // Build result pages navigation\r\n        $pagesNav = '''';\r\n        for ($i = 1; $i <= $iNumberOfPages; $i++) {\r\n            // This is just for sample client - modify to your needs!\r\n            if ($cfg[''url_builder''][''name''] == ''front_content'' || $cfg[''url_builder''][''name''] == ''MR'') {\r\n                $aParams = array(''lang'' => $lang, ''idcat'' => $idcat, ''idart'' => $idart, ''searchterm'' => $searchTermDisplay, ''page'' => ($i . $sArtSpecs));\r\n            } else {\r\n                $aParams = array(\r\n                    ''search'' => array(''lang'' => $lang, ''idcat'' => $idcat, ''idart'' => $idart, ''searchterm'' => $searchTermDisplay, ''page'' => ($i . $sArtSpecs)),\r\n                    ''idcat'' => $idcat, // needed to build category path\r\n                    ''lang'' => $lang, // needed to build category path\r\n                    ''level'' => 1 // needed to build category path\r\n                );\r\n            }\r\n            try {\r\n                $url = $modContext->oUrl->build($aParams);\r\n            } catch (InvalidArgumentException $e) {\r\n                $url = $sess->url(''front_content.php?idcat='' . $idcat . ''&amp;idart='' . $idart . ''&amp;searchterm='' . $searchTermDisplay . ''&amp;page='' . $i . $sArtSpecs);\r\n            }\r\n            if ($i == $page) {\r\n                $pagesNav .= sprintf($modContext->tplPageNavItemCurrent, $i);\r\n            } else {\r\n                $pagesNav .= sprintf($modContext->tplPageNavItem, $url, $i, $i);\r\n            }\r\n        }\r\n        $tpl->set(''s'', ''PAGES'', $pagesNav);\r\n\r\n        // Build link to next result page\r\n        if ($page < $iNumberOfPages) {\r\n            $n = $page + 1;\r\n            // This is just for sample client - modify to your needs!\r\n            if ($cfg[''url_builder''][''name''] == ''front_content'' || $cfg[''url_builder''][''name''] == ''MR'') {\r\n                $aParams = array(''lang'' => $lang, ''idcat'' => $idcat, ''idart'' => $idart, ''searchterm'' => $searchTermDisplay, ''page'' => ($n . $sArtSpecs));\r\n            } else {\r\n                $aParams = array(\r\n                    ''search'' => array(''lang'' => $lang, ''idcat'' => $idcat, ''idart'' => $idart, ''searchterm'' => $searchTermDisplay, ''page'' => ($n . $sArtSpecs)),\r\n                    ''idcat'' => $idcat, // needed to build category path\r\n                    ''lang'' => $lang, // needed to build category path\r\n                    ''level'' => 1 // needed to build category path\r\n                );\r\n            }\r\n            try {\r\n                $url = $modContext->oUrl->build($aParams);\r\n            } catch (InvalidArgumentException $e) {\r\n                $url = $sess->url(''front_content.php?idcat='' . $idcat . ''&amp;idart='' . $idart . ''&amp;searchterm='' . $searchTerm . ''&amp;page='' . $n . $sArtSpecs);\r\n            }\r\n            $nextpage .= sprintf($modContext->tplNextPage, $url);\r\n            $tpl->set(''s'', ''NEXT'', $nextpage);\r\n        } else {\r\n            $tpl->set(''s'', ''NEXT'', '''');\r\n        }\r\n\r\n        // Build link to previous result page\r\n        if ($page > 1) {\r\n            $p = $page - 1;\r\n            // This is just for sample client - modify to your needs!\r\n            if ($cfg[''url_builder''][''name''] == ''front_content'' || $cfg[''url_builder''][''name''] == ''MR'') {\r\n                $aParams = array(''lang'' => $lang, ''idcat'' => $idcat, ''idart'' => $idart, ''searchterm'' => $searchTermDisplay, ''page'' => ($p . $sArtSpecs));\r\n            } else {\r\n                $aParams = array(\r\n                    ''search'' => array(''lang'' => $lang, ''idcat'' => $idcat, ''idart'' => $idart, ''searchterm'' => $searchTermDisplay, ''page'' => ($p . $sArtSpecs)),\r\n                    ''idcat'' => $idcat, // needed to build category path\r\n                    ''lang'' => $lang, // needed to build category path\r\n                    ''level'' => 1 // needed to build category path\r\n                );\r\n            }\r\n            try {\r\n                $url = $modContext->oUrl->build($aParams);\r\n            } catch (InvalidArgumentException $e) {\r\n                $url = $sess->url(''front_content.php?idcat='' . $idcat . ''&amp;idart='' . $idart . ''&amp;searchterm='' . $searchTerm . ''&amp;page='' . $p . $sArtSpecs);\r\n            }\r\n            $prevpage .= sprintf($modContext->tplPreviousPage, $url);\r\n            $tpl->set(''s'', ''PREV'', $prevpage);\r\n        } else {\r\n            $tpl->set(''s'', ''PREV'', '''');\r\n        }\r\n\r\n        if (count($aResPage) > 0) {\r\n            $i = 1;\r\n            // Build single search result on result page\r\n            foreach ($aResPage as $key => $val) {\r\n                $num = $i + (($page - 1) * $modContext->cfgItemsPerPage);\r\n                $oArt = new Article($key, $client, $lang);\r\n                // Get publishing date of article\r\n                $sPublished = $oArt->getField(''published'');\r\n                $sPublishedBy = trim(strip_tags($oArt->getContent(''HEAD'', 90)));\r\n                if ($sPublishedBy != '''') {\r\n                    $sPublishedDate = ''['' . $sPublishedBy . '']'';\r\n                } else {\r\n                    $sPublishedDate = '''';\r\n                    if ($sPublished[8] != ''0'') {\r\n                        $sPublishedDate .= $sPublished[8];\r\n                    }\r\n                    $sPublishedDate .= $sPublished[9] . ''.'';\r\n                    if ($sPublished[5] != ''0'') {\r\n                        $sPublishedDate .= $sPublished[5];\r\n                    }\r\n                    $sPublishedDate .= $sPublished[6] . ''.'' . $sPublished[0] . $sPublished[1] . $sPublished[2] . $sPublished[3] . '']'';\r\n                    $sPublishedDate = ''['' . $sPublishedDate;\r\n                }\r\n\r\n                // Get text and headline of current article\r\n                $iCurrentArtSpec = module_searchOutput_getArticleSpecification($key, $lang);\r\n                $aHeadline = $oSearchResults->getSearchContent($key, ''HTMLHEAD'', 1);\r\n                $aSubheadline = $oSearchResults->getSearchContent($key, ''HTMLHEAD'', 2);\r\n                $aText = $oSearchResults->getSearchContent($key, ''HTML'', 1);\r\n                $sText = capiStrTrimAfterWord($aText[0], $modContext->cfgMaxLengthTeasertext);\r\n                $sHeadline = capiStrTrimAfterWord($aHeadline[0], $modContext->cfgMaxLengthTeasertext); # conflict with capiStrTrimAfterWord and setReplacement(''<strong>'', ''</strong>'')\r\n                $sSubHeadline = capiStrTrimAfterWord($aSubheadline[0], $modContext->cfgMaxLengthTeasertext);\r\n\r\n                $iCategoryId = $oSearchResults->getArtCat($key);\r\n                $fSimilarity = sprintf(''%.0f'', $oSearchResults->getSimilarity($key));\r\n\r\n                // Send output to template\r\n                // This is just for sample client - modify to your needs!\r\n                if ($cfg[''url_builder''][''name''] == ''front_content'' || $cfg[''url_builder''][''name''] == ''MR'') {\r\n                    $aParams = array(''lang'' => $lang, ''idcat'' => $iCategoryId, ''idart'' => $key);\r\n                } else {\r\n                    $aParams = array(\r\n                        ''search'' => array(''lang'' => $lang, ''idcat'' => $iCategoryId, ''idart'' => $key),\r\n                        ''idcat'' => $idcat, // needed to build category path\r\n                        ''lang'' => $lang, // needed to build category path\r\n                        ''level'' => 1  // needed to build category path\r\n                    );\r\n                }\r\n                try {\r\n                    $sHref = $modContext->oUrl->build($aParams);\r\n                } catch (InvalidArgumentException $e) {\r\n                    $sHref = $sess->url("front_content.php?idcat=$iCategoryId&amp;idart=$key");\r\n                }\r\n                $tpl->set(''d'', ''more'', mi18n(''mehr''));\r\n                $tpl->set(''d'', ''HREF'', $sHref);\r\n                $tpl->set(''d'', ''TITLE'', mi18n(''Link zu Suchergebnis'') . '' '' . $i);\r\n                $tpl->set(''d'', ''NUM'', $num);\r\n                $tpl->set(''d'', ''CATNAME'', $sHeadline);\r\n                $tpl->set(''d'', ''HEADLINE'', $sText);\r\n                $tpl->set(''d'', ''SUBHEADLINE'', $sSubHeadline);\r\n                $tpl->set(''d'', ''SIMILARITY'', $fSimilarity);\r\n                $tpl->set(''d'', ''TARGET'', ''_self'');\r\n                $tpl->set(''d'', ''PUB_DATE'', $sPublishedDate);\r\n                $tpl->next();\r\n                $i++;\r\n            }\r\n            $tpl->generate(''templates/search_output.html'');\r\n        }\r\n    } else {\r\n        // No results\r\n        $tpl->set(''s'', ''MESSAGE'', mi18n(''Ihre Suche nach'') . " ''" . conHtmlSpecialChars(strip_tags($searchTerm)) . "'' " . mi18n(''hat leider keine Treffer ergeben'') . ''.'');\r\n        $tpl->set(''s'', ''NEXT'', '''');\r\n        $tpl->set(''s'', ''PREV'', '''');\r\n        $tpl->set(''s'', ''PAGES'', '''');\r\n        $tpl->set(''s'', ''result_page'', '''');\r\n        $tpl->generate(''templates/search_output.html'');\r\n    }\r\n} else {\r\n    echo ''<div id="searchResults">'';\r\n    echo ''<h1>'' . mi18n(''Keine Suchergebnisse - Bitte suchen Sie &uuml;ber das Sucheingabefeld!'') . ''</h1>'';\r\n    echo ''</div>'';\r\n}\r\n\r\nunset($modContext);\r\n\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 16:00:03', '2013-01-09 01:28:58');
INSERT INTO !PREFIX!_mod VALUES (19, 1, 'Sitemap', 'Content', 'none', '', NULL, '?><?php\r\n/**\r\n * Project: \r\n * contenido.org\r\n * \r\n * Description: \r\n * Simple sitemap\r\n * \r\n * Requirements: \r\n * @con_php_req 5.0\r\n * \r\n *\r\n * @version    0.1.0\r\n * @author     Rudi Bieller\r\n * @copyright  four for business AG <www.4fb.de>\r\n * @license    http://www.contenido.org/license/LIZENZ.txt\r\n * @link       http://www.4fb.de\r\n * @link       http://www.contenido.org\r\n * @todo move function to load all categories somewhere else...\r\n * @todo use some template instead of html in code...\r\n * \r\n * {@internal \r\n *   created 2009-01-05\r\n *   $Id: Sitemap_Standard_INPUT.php 3410 2009-01-07 15:51:49Z rudi.bieller $\r\n * }}\r\n * \r\n */\r\n\r\nif (!isset($db)) {\r\n    $db = new DB_Contenido();\r\n}\r\n\r\n$iSelectedCat = intval("CMS_VALUE[1]");\r\n$iSelectedDepth = intval("CMS_VALUE[2]");\r\n$iSelectedHtmlOutputStyle = intval("CMS_VALUE[3]");\r\n$aAllCategories = sitemap_getAllCategories($db, $cfg, $lang, $client);\r\n$sOptionsCategories = '''';\r\n$sOptionsDepth = '''';\r\n$sSelectedHtmlStyle0 = $iSelectedHtmlOutputStyle == 0 ? '' selected="selected"'' : '''';\r\n$sSelectedHtmlStyle1 = $iSelectedHtmlOutputStyle == 1 ? '' selected="selected"'' : '''';\r\n\r\n$sHtmlTable = ''<table border="0" cellpadding="10" cellspacing="0"> \r\n    <tr>\r\n        <td>''.mi18n("Kategorie w�hlen:").''</td> \r\n        <td>\r\n            <select name="'' . "CMS_VAR[1]" . ''"> \r\n                <option value="0">---Alle---</option>\r\n                [SNIP_CATEGORIES]\r\n            </select>\r\n        </td>\r\n</tr> \r\n<tr> \r\n    <td>''.mi18n("Maximale Anzahl Ebenen:").''</td> \r\n    <td>\r\n        <select name="'' . "CMS_VAR[2]" . ''"> \r\n            <option value="0">---Select---</option>\r\n            [SNIP_DEPTH]\r\n        </select>\r\n    </td>\r\n</tr>\r\n<tr> \r\n    <td>''.mi18n("HTML Ausgabe:").''</td> \r\n    <td>\r\n        <select name="'' . "CMS_VAR[3]" . ''"> \r\n            <option value="0"''.$sSelectedHtmlStyle0.''>&lt;ul&gt;&lt;li&gt;Alle Kategorien in einer Liste&lt;/li&gt;&lt;/ul&gt;</option>\r\n            <option value="1"''.$sSelectedHtmlStyle1.''>&lt;ul&gt;&lt;li&gt;Alle Hauptkategorien in einer eigenen ul&lt;/li&gt;&lt;/ul&gt;</option>\r\n        </select>\r\n    </td>\r\n</tr>\r\n</table>\r\n'';\r\n\r\n$iSelectedCat = intval("CMS_VALUE[1]");\r\n$iSelectedDepth = intval("CMS_VALUE[2]");\r\n$aAllCategories = sitemap_getAllCategories($db, $cfg, $lang, $client);\r\n$sOptionsCategories = '''';\r\n$sOptionsDepth = '''';\r\n\r\nfor ($i = 1; $i <= 30; $i++) {\r\n    $sSelected = $iSelectedDepth == $i ? '' selected="selected"'' : '''';\r\n    $sOptionsDepth .= ''<option value="''.strval($i).''"''.$sSelected.''>''.strval($i).''</option>'';\r\n}\r\n\r\nif (sizeof($aAllCategories) > 0) {\r\n    foreach ($aAllCategories as $aCatDetails) {\r\n        $sSelected = $iSelectedCat == intval($aCatDetails[''idcat'']) ? '' selected="selected"'' : '''';\r\n        $sSpace = str_repeat(''-'', intval($aCatDetails[''level'']));\r\n        $sCssLevelZero = intval($aCatDetails[''level'']) == 0 ? '' style="background-color:#F8FDDC;"'' : '''';\r\n        $sOptionsCategories .= ''<option value="''.strval($aCatDetails[''idcat'']).''"''.$sSelected.$sCssLevelZero.''>''.$sSpace.'' ''.strval($aCatDetails[''name'']).''</option>'';\r\n    }\r\n}\r\n\r\necho str_replace(array(''[SNIP_CATEGORIES]'', ''[SNIP_DEPTH]''), array($sOptionsCategories, $sOptionsDepth), $sHtmlTable);\r\n\r\n\r\n/**\r\n * Return array with all info on ALL categories of current client/lang\r\n *\r\n * @param unknown_type $oDb\r\n * @param array $aCfg\r\n * @param unknown_type $iLang\r\n * @param unknown_type $iClient\r\n * @return unknown\r\n */\r\nfunction sitemap_getAllCategories($oDb, array $aCfg, $iLang, $iClient) {\r\n    $aResult = array();\r\n    $sSql = "SELECT\r\n            A.idcat,\r\n            A.level,\r\n            C.name\r\n          FROM\r\n            ".$aCfg[''tab''][''cat_tree'']." AS A,\r\n            ".$aCfg[''tab''][''cat'']." AS B,\r\n            ".$aCfg[''tab''][''cat_lang'']." AS C\r\n          WHERE\r\n            A.idcat=B.idcat  \r\n            AND B.idcat=C.idcat \r\n            AND C.idlang=''".intval($iLang)."''\r\n            AND B.idclient=''".intval($iClient)."'' \r\n            AND C.visible=1\r\n          ORDER BY A.idtree";\r\n    $oDb->query($sSql);\r\n    if ($oDb->Errno == 0 && $oDb->num_rows() > 0) {\r\n        while($oDb->next_record()) {\r\n            $aResult[] = array(\r\n                                ''idcat'' => intval($oDb->f(''idcat'')), \r\n                                ''level'' => intval($oDb->f(''level'')), \r\n                                ''name'' => strval($oDb->f(''name''))\r\n                                );\r\n        }\r\n    }\r\n    return $aResult;\r\n}', '<?php\r\n/**\r\n * Project: \r\n * contenido.org\r\n * \r\n * Description: \r\n * Simple sitemap.\r\n * Can output all categories in one list or each main category as separate list\r\n * \r\n * To modify the behaviour of the module (e.g. style of URL, CSS classes, ...), you need to edit Contenido_Sitemap_Util::loopCats\r\n * @see {frontend}/includes/Util/Modules/Contenido_Sitemap_Util.class.php\r\n * \r\n * Requirements: \r\n * @con_php_req 5.0\r\n * \r\n *\r\n * @version    0.1.0\r\n * @author     Rudi Bieller\r\n * @copyright  four for business AG <www.4fb.de>\r\n * \r\n * {@internal \r\n *   created 2009-01-05\r\n *   $Id: Sitemap_Standard.php 3438 2009-01-15 10:54:05Z rudi.bieller $\r\n * }}\r\n * \r\n */\r\n\r\nif (!isset($db)) {\r\n    $db = new DB_Contenido();\r\n}\r\nif (!isset($tpl)) {\r\n    $tpl = new Template();\r\n}\r\n$tpl->reset();\r\n\r\ncInclude(''frontend'', ''includes/Util/Modules/Contenido_Sitemap_Util.class.php'');\r\n\r\n$iSelectedCat = intval("CMS_VALUE[1]");\r\n$iSelectedDepth = intval("CMS_VALUE[2]");\r\n$iHtmlOutputType = intval("CMS_VALUE[3]");\r\n$sUrlStyle = $cfg[''url_builder''][''name''];\r\n\r\nif ($iSelectedCat > 0 && $iSelectedDepth >= 0) {\r\n    $oFeNav = new Contenido_FrontendNavigation($db, $cfg, $client, $lang, $cfgClient);\r\n    $oFeNav->setAuth($auth);\r\n    $oSubCategories = $oFeNav->getSubCategories($iSelectedCat, true, true, 1);\r\n    // see if there are any subcategories to display\r\n    if ($oSubCategories->count() > 0) {\r\n        $aDepthInfo = array();\r\n        $aDepthInfo[0] = 0;\r\n        $aDepthInfo[1] = $iSelectedDepth;\r\n        if ($iHtmlOutputType == 1) {\r\n            $sMainCats = '''';\r\n        }\r\n        foreach ($oSubCategories as $oSubCategory) {\r\n            switch($iHtmlOutputType) {\r\n                case 0:\r\n                    Contenido_Sitemap_Util::loopCats($oSubCategory, $oFeNav, $tpl, $sUrlStyle, $cfg, $lang, $aDepthInfo);\r\n                    break;\r\n                case 1:\r\n                    $tpl->reset();\r\n                    Contenido_Sitemap_Util::loopCats($oSubCategory, $oFeNav, $tpl, $sUrlStyle, $cfg, $lang, $aDepthInfo);\r\n                    $sSubCats = $tpl->generate(''templates/sitemap_standard_li.html'', true);\r\n                    $tpl->reset();\r\n                    $tpl->set(''s'', ''list_items'', $sSubCats);\r\n                    $sMainCats .= $tpl->generate(''templates/sitemap_standard_ul.html'', true);\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n        if ($iHtmlOutputType == 0) {\r\n            $tpl->generate(''templates/sitemap_standard.html'');\r\n        } else {\r\n            echo $sMainCats;\r\n        }\r\n    }\r\n} else {\r\n    echo ''<p>Sitemap not configured correctly.</p>'';\r\n}\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 16:00:14', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (20, 1, 'Sub_Headline', 'Content', 'none', 'Output standard h2 subheadline', NULL, '', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Output standard h2 subheadline\r\n*\r\n* @version 1.0.0\r\n* @author Rudi Bieller\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2008-04-07\r\n* }}\r\n*\r\n* $Id$\r\n*/\r\n\r\n$sText = "CMS_HTMLHEAD[2]";\r\n\r\nif (!isset($tpl) || !is_object($tpl)) {\r\n    $tpl = new Template();\r\n}\r\n\r\n$tpl->reset();\r\nif ($contenido && $edit) {\r\n    $tpl->set(''s'', ''text'', $sText);\r\n    $tpl->generate(''templates/subheadline_h2.html'');\r\n} else {\r\n    if ($sText != '''') {\r\n	    $tpl->set(''s'', ''text'', strip_tags($sText));\r\n	    $tpl->generate(''templates/subheadline_h2.html'');\r\n    }\r\n}\r\n\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 16:00:26', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (21, 1, 'Teaser_Right', 'Content', 'none', 'Display teaser on right side', NULL, '', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Display teaser on right side\r\n*\r\n* @version 1.0.0\r\n* @author Rudi Bieller\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2008-04-07\r\n* }}\r\n*\r\n* $Id$\r\n*/\r\n\r\nif (!isset($tpl) || !is_object($tpl)) {\r\n    $tpl = new Template();\r\n}\r\n\r\n$tpl->reset();\r\n$tpl->generate(''templates/teaser_right.html'');\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 16:00:37', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (22, 1, 'Title_Tag', 'Content', 'none', 'Outputs html tag <title> with navigation path to article.', NULL, '', '<?php\n/**\n* $RCSfile$\n*\n* Description: Print HTML title tag content\n*\n* @version 1.0.0\n* @author Rudi Bieller\n* @copyright four for business AG <www.4fb.de>\n*\n* {@internal\n* created 2008-04-07\n* }}\n*\n* $Id$\n*/\n\ntry {\n    $oBread = new Contenido_FrontendNavigation_Breadcrumb($db, $cfg, $client, $lang, $cfgClient);\n    $oBreadCats = $oBread->get($idcat, 1);\n    $sBread = ''Contenido - '';\n    $aBread = array();\n    foreach ($oBreadCats as $oConCat) {\n        $aBread[] = $oConCat->getCategoryLanguage()->getName();\n    }\n    $sBread .= implode('' - '', $aBread);\n    $oArticle = new Article($idart, $client, $lang);\n    $sHeadline = strip_tags($oArticle->getContent(''CMS_HTMLHEAD'', 1));\n    if ($sHeadline != '''') {\n        $sBread .= '' - ''.$sHeadline;\n    }\n    echo $sBread;\n} catch (InvalidArgumentException $eI) {\n    echo ''Contenido'';\n} catch (Exception $e) {\n    echo ''Contenido'';\n}\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 16:00:53', '0000-00-00 00:00:00');
INSERT INTO !PREFIX!_mod VALUES (23, 1, 'Text', 'Content', 'none', 'Displays CMS_HTML Element', NULL, '', '<?php\r\n/**\r\n* $RCSfile$\r\n*\r\n* Description: Output some HTML text\r\n*\r\n* @version 1.0.0\r\n* @author Rudi Bieller\r\n* @copyright four for business AG <www.4fb.de>\r\n*\r\n* {@internal\r\n* created 2008-04-07\r\n* }}\r\n*\r\n* $Id$\r\n*/\r\n\r\nif (!isset($tpl) || !is_object($tpl)) {\r\n    $tpl = new Template();\r\n}\r\n\r\n$tpl->reset();\r\n$tpl->set(''s'', ''text'', "CMS_HTML[1]");\r\n$tpl->generate(''templates/text_html.html'');\r\n?>', '', 0, NULL, NULL, '48a365b4ce1e322a55ae9017f3daf0c0', '2008-04-14 16:00:53', '0000-00-00 00:00:00');
