################################################################################
# Apache settings for CONTENIDO frontend.
#
# NOTE:
# This file contains rules being configured for the default client directory 'cms'
# in a CONTENIDO installation.
# Ensure to adapt the client directory name if it differs from it.
#
# @version    0.0.1
# @author     Murat Purc <murat@purc.de>
# @copyright  four for business AG <www.4fb.de>
# @license    http://www.contenido.org/license/LIZENZ.txt
# @link       http://www.4fb.de
# @link       http://www.contenido.org
# @since      file available since CONTENIDO release 4.9.0
#
# $Id: $
################################################################################


# Protect some directories/files from direct access
<FilesMatch "\.(inc|mo|po|sh|sql)$|^(cms/includes.*|cms/logs.*|cms/module.*|cms/templates.*|cms/version.*|conlib.*|contenido/cronjobs.*|contenido/includes.*|data.*|contenido/templates.*|contenido/xml.*|pear.*|library.*|test.*)$">
    Order deny,allow
</FilesMatch>


# Catch some hacking attempts
<IfModule mod_rewrite.c>
    # Enable rewrite engine
    RewriteEngine on

    # Catch some common exploits in query string to get rid of them.
    # NOTE: Conditions to prevent protocols (ftp, http[s]) in query string could
    #       be a disadvantage in some cases.
    RewriteCond %{QUERY_STRING} contenido_path=.*$  [NC,OR]
    RewriteCond %{QUERY_STRING} cfg\[path\]=.*$  [NC,OR]
    RewriteCond %{QUERY_STRING} _PHPLIB\[libdir\]=.*$  [NC,OR]
    RewriteCond %{QUERY_STRING} (\<|%3C).*script.*(\>|%3E) [NC,OR]
    RewriteCond %{QUERY_STRING} ftp://.*$  [NC,OR]
    RewriteCond %{QUERY_STRING} http[s]*://.*$ [NC]
    RewriteRule ^.* - [F,L]  # all matching conditions from above will end in nirvana
</IfModule>


# Error message for requesting non-existent favicon.ico
<Files favicon.ico>
    # Without ending quote due to compatibility with Apache 1.3!
    ErrorDocument 404 "Requested file favicon.ico wasn't found.
</Files>


# Define cache rules for some filetypes
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresDefault "access plus 1 month 1 days"

    ExpiresByType application/x-javascript "access plus 1 month 1 days"
    ExpiresByType image/gif "access plus 1 month 1 days"
    ExpiresByType image/jpeg "access plus 1 month 1 days"
    ExpiresByType image/png "access plus 1 month 1 days"
    ExpiresByType image/x-ico "access plus 2 months 1 days"
    ExpiresByType text/css "access plus 1 month 1 days"
    ExpiresByType text/html "access plus 1 month 1 days"
    ExpiresByType text/javascript "access plus 1 month 1 week"
    ExpiresByType text/xml "access plus 1 seconds"
</IfModule>


# Some rules to compress files.
<IfModule mod_deflate.c>
    <FilesMatch "\.(js|css|html|htm|php|xml)$">
        SetOutputFilter DEFLATE
    </FilesMatch>
</IfModule>
